<!DOCTYPE html><html><head><meta charset="UTF-8"><script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-bash.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-http.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-javascript.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-json.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-markup.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-none.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-sql.min.js"></script><style>
        .article {
            position: relative;
            padding-bottom: 24px;
        }
        

        .bordered-element-rounded {
            border: 1px solid #c4c4c4;
            border-radius: 7px;
            overflow: hidden;
        }
        

        .code-block {
            overflow: hidden;
            position: relative;
            padding: 0;
            border-radius: 8px;
            font-variant-ligatures: none;
            background-color: rgba(25, 25, 28, .05);
            word-break: break-all;
        }
        

        .control {
            color: #19191c;
            font-size: 16px;
            font-weight: 670;
        }
        

        .detached {
            margin-block-start: 0;
            margin-block-end: 0;
            margin-bottom: 8px;
        }
        

        .flex {
            display: flex;
        }
        

        .header-row {
            background: #e6e6e6;
        }
        

        .inline-code {
            border-radius: 4px;
            display: inline;
            padding: 2px 1px;
            font-family: JetBrains Sans,monospace;
            background: #e6e6e6;
        }
        

        .list {
            list-style-type: disc;
            padding-left: 0;
            margin-left: 15px;
        }
        

        .list-decimal {
            list-style-type: decimal;
        }
        

        .list-item {
            margin-top: 6px;
            margin-bottom: 6px;
            margin-left: 4px;
        }
        

        .main-title {
            padding-bottom: 24px;
            margin-top: 0;
            font-size: 40px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        

        .mermaid {
            page-break-inside: avoid;
        }
        
        /* Light theme */
/** Common */
#mermaid .label, #mermaid {font-family:"trebuchet ms",arial,sans-serif; font-size:16px;fill:#333;}#mermaid .error-icon{fill:#552222;}#mermaid .error-text{fill:#552222;stroke:#552222;}#mermaid .edge-thickness-normal{stroke-width:2px;}#mermaid .edge-thickness-thick{stroke-width:3.5px;}#mermaid .edge-pattern-solid{stroke-dasharray:0;}#mermaid .edge-pattern-dashed{stroke-dasharray:3;}#mermaid .edge-pattern-dotted{stroke-dasharray:2;}#mermaid .marker{fill:#333333;stroke:#333333;}#mermaid .marker.cross{stroke:#333333;} #mermaid {max-width: 100%;}
/** Flowchart */
#mermaid .cluster-label text{fill:#333;}#mermaid .cluster-label span{color:#333;}#mermaid .label text,#mermaid span{fill:#333;color:#333;}#mermaid .node rect,#mermaid .node circle,#mermaid .node ellipse,#mermaid .node polygon,#mermaid .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid .node .label{text-align:center;}#mermaid .node.clickable{cursor:pointer;}#mermaid .arrowheadPath{fill:#333333;}#mermaid .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid .flowchart-link{stroke:#333333;fill:none;}#mermaid .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid .cluster text{fill:#333;}#mermaid .cluster span{color:#333;}#mermaid div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}
/** Sequence diagram */
#mermaid .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid text.actor>tspan{fill:black;stroke:none;}#mermaid .actor-line{stroke:grey;}#mermaid .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid #arrowhead path{fill:#333;stroke:#333;}#mermaid .sequenceNumber{fill:white;}#mermaid #sequencenumber{fill:#333;}#mermaid #crosshead path{fill:#333;stroke:#333;}#mermaid .messageText{fill:#333;stroke:none;}#mermaid .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid .labelText,#mermaid .labelText>tspan{fill:black;stroke:none;}#mermaid .loopText,#mermaid .loopText>tspan{fill:black;stroke:none;}#mermaid .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mermaid .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid .noteText,#mermaid .noteText>tspan{fill:black;stroke:none;}#mermaid .activation0{fill:#f4f4f4;stroke:#666;}#mermaid .activation1{fill:#f4f4f4;stroke:#666;}#mermaid .activation2{fill:#f4f4f4;stroke:#666;}#mermaid .actorPopupMenu{position:absolute;}#mermaid .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid .actor-man circle,#mermaid line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}
/** Gantt */
#mermaid .exclude-range{fill:#eeeeee;}#mermaid .section{stroke:none;opacity:0.2;}#mermaid .section0{fill:rgba(102, 102, 255, 0.49);}#mermaid .section2{fill:#fff400;}#mermaid .section1,#mermaid .section3{fill:white;opacity:0.2;}#mermaid .sectionTitle0{fill:#333;}#mermaid .sectionTitle1{fill:#333;}#mermaid .sectionTitle2{fill:#333;}#mermaid .sectionTitle3{fill:#333;}#mermaid .sectionTitle{text-anchor:start;}#mermaid .grid .tick{stroke:lightgrey;opacity:0.8;shape-rendering:crispEdges;}#mermaid .grid .tick text{fill:#333;}#mermaid .grid path{stroke-width:0;}#mermaid .today{fill:none;stroke:red;stroke-width:2px;}#mermaid .task{stroke-width:2;}#mermaid .taskText{text-anchor:middle;}#mermaid .taskTextOutsideRight{fill:black;text-anchor:start;}#mermaid .taskTextOutsideLeft{fill:black;text-anchor:end;}#mermaid .task.clickable{cursor:pointer;}#mermaid .taskText.clickable{cursor:pointer;fill:#003163!important;font-weight:bold;}#mermaid .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163!important;font-weight:bold;}#mermaid .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163!important;font-weight:bold;}#mermaid .taskText0,#mermaid .taskText1,#mermaid .taskText2,#mermaid .taskText3{fill:white;}#mermaid .task0,#mermaid .task1,#mermaid .task2,#mermaid .task3{fill:#8a90dd;stroke:#534fbc;}#mermaid .taskTextOutside0,#mermaid .taskTextOutside2{fill:black;}#mermaid .taskTextOutside1,#mermaid .taskTextOutside3{fill:black;}#mermaid .active0,#mermaid .active1,#mermaid .active2,#mermaid .active3{fill:#bfc7ff;stroke:#534fbc;}#mermaid .activeText0,#mermaid .activeText1,#mermaid .activeText2,#mermaid .activeText3{fill:black!important;}#mermaid .done0,#mermaid .done1,#mermaid .done2,#mermaid .done3{stroke:grey;fill:lightgrey;stroke-width:2;}#mermaid .doneText0,#mermaid .doneText1,#mermaid .doneText2,#mermaid .doneText3{fill:black!important;}#mermaid .crit0,#mermaid .crit1,#mermaid .crit2,#mermaid .crit3{stroke:#ff8888;fill:red;stroke-width:2;}#mermaid .activeCrit0,#mermaid .activeCrit1,#mermaid .activeCrit2,#mermaid .activeCrit3{stroke:#ff8888;fill:#bfc7ff;stroke-width:2;}#mermaid .doneCrit0,#mermaid .doneCrit1,#mermaid .doneCrit2,#mermaid .doneCrit3{stroke:#ff8888;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges;}#mermaid .milestone{transform:rotate(45deg) scale(0.8,0.8);}#mermaid .milestoneText{font-style:italic;}#mermaid .doneCritText0,#mermaid .doneCritText1,#mermaid .doneCritText2,#mermaid .doneCritText3{fill:black!important;}#mermaid .activeCritText0,#mermaid .activeCritText1,#mermaid .activeCritText2,#mermaid .activeCritText3{fill:black!important;}#mermaid .titleText{text-anchor:middle;font-size:18px;fill:#333;}
/** Class diagram */
#mermaid g.classGroup text{fill:#9370DB;fill:#131300;stroke:none;font-size:10px;}#mermaid g.classGroup text .title{font-weight:bolder;}#mermaid .nodeLabel,#mermaid .edgeLabel{color:#131300;}#mermaid .edgeLabel .label rect{fill:#ECECFF;}#mermaid .label text{fill:#131300;}#mermaid .edgeLabel .label span{background:#ECECFF;}#mermaid .classTitle{font-weight:bolder;}#mermaid .node rect,#mermaid .node circle,#mermaid .node ellipse,#mermaid .node polygon,#mermaid .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid .divider{stroke:#9370DB;stroke:1;}#mermaid g.clickable{cursor:pointer;}#mermaid g.classGroup rect{fill:#ECECFF;stroke:#9370DB;}#mermaid g.classGroup line{stroke:#9370DB;stroke-width:1;}#mermaid .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5;}#mermaid .classLabel .label{fill:#9370DB;font-size:10px;}#mermaid .relation{stroke:#333333;stroke-width:1;fill:none;}#mermaid .dashed-line{stroke-dasharray:3;}#mermaid #compositionStart,#mermaid .composition{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid #compositionEnd,#mermaid .composition{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid #dependencyStart,#mermaid .dependency{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid #dependencyStart,#mermaid .dependency{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid #extensionStart,#mermaid .extension{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid #extensionEnd,#mermaid .extension{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid #aggregationStart,#mermaid .aggregation{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#mermaid #aggregationEnd,#mermaid .aggregation{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#mermaid #lollipopStart,#mermaid .lollipop{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#mermaid #lollipopEnd,#mermaid .lollipop{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#mermaid .edgeTerminals{font-size:11px;}
/** Git graph */
#mermaid .commit-id,#mermaid .commit-msg{fill:lightgrey;}#mermaid .commit0{stroke:hsl(240, 100%, 46.2745098039%);fill:hsl(240, 100%, 46.2745098039%);}#mermaid .commit-highlight0{stroke:hsl(60, 100%, 3.7254901961%);fill:hsl(60, 100%, 3.7254901961%);}#mermaid .label0{fill:hsl(240, 100%, 46.2745098039%);}#mermaid .arrow0{stroke:hsl(240, 100%, 46.2745098039%);}#mermaid .branch-label1{fill:black;}#mermaid .commit1{stroke:hsl(60, 100%, 43.5294117647%);fill:hsl(60, 100%, 43.5294117647%);}#mermaid .commit-highlight1{stroke:rgb(0, 0, 160.5);fill:rgb(0, 0, 160.5);}#mermaid .label1{fill:hsl(60, 100%, 43.5294117647%);}#mermaid .arrow1{stroke:hsl(60, 100%, 43.5294117647%);}#mermaid .branch-label2{fill:black;}#mermaid .commit2{stroke:hsl(80, 100%, 46.2745098039%);fill:hsl(80, 100%, 46.2745098039%);}#mermaid .commit-highlight2{stroke:rgb(48.8333333334, 0, 146.5000000001);fill:rgb(48.8333333334, 0, 146.5000000001);}#mermaid .label2{fill:hsl(80, 100%, 46.2745098039%);}#mermaid .arrow2{stroke:hsl(80, 100%, 46.2745098039%);}#mermaid .branch-label3{fill:#ffffff;}#mermaid .commit3{stroke:hsl(210, 100%, 46.2745098039%);fill:hsl(210, 100%, 46.2745098039%);}#mermaid .commit-highlight3{stroke:rgb(146.5000000001, 73.2500000001, 0);fill:rgb(146.5000000001, 73.2500000001, 0);}#mermaid .label3{fill:hsl(210, 100%, 46.2745098039%);}#mermaid .arrow3{stroke:hsl(210, 100%, 46.2745098039%);}#mermaid .branch-label4{fill:black;}#mermaid .commit4{stroke:hsl(180, 100%, 46.2745098039%);fill:hsl(180, 100%, 46.2745098039%);}#mermaid .commit-highlight4{stroke:rgb(146.5000000001, 0, 0);fill:rgb(146.5000000001, 0, 0);}#mermaid .label4{fill:hsl(180, 100%, 46.2745098039%);}#mermaid .arrow4{stroke:hsl(180, 100%, 46.2745098039%);}#mermaid .branch-label5{fill:black;}#mermaid .commit5{stroke:hsl(150, 100%, 46.2745098039%);fill:hsl(150, 100%, 46.2745098039%);}#mermaid .commit-highlight5{stroke:rgb(146.5000000001, 0, 73.2500000001);fill:rgb(146.5000000001, 0, 73.2500000001);}#mermaid .label5{fill:hsl(150, 100%, 46.2745098039%);}#mermaid .arrow5{stroke:hsl(150, 100%, 46.2745098039%);}#mermaid .branch-label6{fill:black;}#mermaid .commit6{stroke:hsl(300, 100%, 46.2745098039%);fill:hsl(300, 100%, 46.2745098039%);}#mermaid .commit-highlight6{stroke:rgb(0, 146.5000000001, 0);fill:rgb(0, 146.5000000001, 0);}#mermaid .label6{fill:hsl(300, 100%, 46.2745098039%);}#mermaid .arrow6{stroke:hsl(300, 100%, 46.2745098039%);}#mermaid .branch-label7{fill:black;}#mermaid .commit7{stroke:hsl(0, 100%, 46.2745098039%);fill:hsl(0, 100%, 46.2745098039%);}#mermaid .commit-highlight7{stroke:rgb(0, 146.5000000001, 146.5000000001);fill:rgb(0, 146.5000000001, 146.5000000001);}#mermaid .label7{fill:hsl(0, 100%, 46.2745098039%);}#mermaid .arrow7{stroke:hsl(0, 100%, 46.2745098039%);}#mermaid .branch{stroke-width:1;stroke:#333333;stroke-dasharray:2;}#mermaid .commit-label{font-size:10px;fill:#000021;}#mermaid .commit-label-bkg{font-size:10px;fill:#ffffde;opacity:0.5;}#mermaid .tag-label{font-size:10px;fill:#131300;}#mermaid .tag-label-bkg{fill:#ECECFF;stroke:hsl(240, 60%, 86.2745098039%);}#mermaid .tag-hole{fill:#333;}#mermaid .commit-merge{stroke:#ECECFF;fill:#ECECFF;}#mermaid .commit-reverse{stroke:#ECECFF;fill:#ECECFF;stroke-width:3;}#mermaid .commit-highlight-inner{stroke:#ECECFF;fill:#ECECFF;}#mermaid .arrow{stroke-width:8;stroke-linecap:round;fill:none;}
#mermaid .branchLabel .label {font-size:16px;} #mermaid g.label.branch-label0 text, #mermaid g.label.branch-label3 text { fill: #eee; }
/** Entity relationship */
#mermaid .entityBox{fill:#ECECFF;stroke:#9370DB;}#mermaid .attributeBoxOdd{fill:#ffffff;stroke:#9370DB;}#mermaid .attributeBoxEven{fill:#f2f2f2;stroke:#9370DB;}#mermaid .relationshipLabelBox{fill:hsl(80, 100%, 96.2745098039%);opacity:0.7;background-color:hsl(80, 100%, 96.2745098039%);}#mermaid .relationshipLabelBox rect{opacity:0.5;}#mermaid .relationshipLine{stroke:#333333;}
/** Journey */
#mermaid .label{color:#333;}#mermaid .mouth{stroke:#666;}#mermaid line{stroke:#333;}#mermaid .legend{fill:#333;}#mermaid .label text{fill:#333;}#mermaid .label{color:#333;}#mermaid .face{fill:#FFF8DC;stroke:#999;}#mermaid .node rect,#mermaid .node circle,#mermaid .node ellipse,#mermaid .node polygon,#mermaid .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid .node .label{text-align:center;}#mermaid .node.clickable{cursor:pointer;}#mermaid .arrowheadPath{fill:#333333;}#mermaid .edgePath .path{stroke:#333333;stroke-width:1.5px;}#mermaid .flowchart-link{stroke:#333333;fill:none;}#mermaid .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid .edgeLabel rect{opacity:0.5;}#mermaid .cluster text{fill:#333;}#mermaid div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid .task-type-0,#mermaid .section-type-0{fill:#ECECFF;}#mermaid .task-type-1,#mermaid .section-type-1{fill:#ffffde;}#mermaid .task-type-2,#mermaid .section-type-2{fill:hsl(304, 100%, 96.2745098039%);}#mermaid .task-type-3,#mermaid .section-type-3{fill:hsl(124, 100%, 93.5294117647%);}#mermaid .task-type-4,#mermaid .section-type-4{fill:hsl(176, 100%, 96.2745098039%);}#mermaid .task-type-5,#mermaid .section-type-5{fill:hsl(-4, 100%, 93.5294117647%);}#mermaid .task-type-6,#mermaid .section-type-6{fill:hsl(8, 100%, 96.2745098039%);}#mermaid .task-type-7,#mermaid .section-type-7{fill:hsl(188, 100%, 93.5294117647%);}
/** State diagram */
#mermaid defs #statediagram-barbEnd{fill:#333333;stroke:#333333;}#mermaid g.stateGroup text{fill:#9370DB;stroke:none;font-size:10px;}#mermaid g.stateGroup text{fill:#333;stroke:none;font-size:10px;}#mermaid g.stateGroup .state-title{font-weight:bolder;fill:#131300;}#mermaid g.stateGroup rect{fill:#ECECFF;stroke:#9370DB;}#mermaid g.stateGroup line{stroke:#333333;stroke-width:1;}#mermaid .transition{stroke:#333333;stroke-width:1;fill:none;}#mermaid .stateGroup .composit{fill:white;border-bottom:1px;}#mermaid .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px;}#mermaid .state-note{stroke:#aaaa33;fill:#fff5ad;}#mermaid .state-note text{fill:black;stroke:none;font-size:10px;}#mermaid .stateLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5;}#mermaid .edgeLabel .label rect{fill:#ECECFF;opacity:0.5;}#mermaid .edgeLabel .label text{fill:#333;}#mermaid .label div .edgeLabel{color:#333;}#mermaid .stateLabel text{fill:#131300;font-size:10px;font-weight:bold;}#mermaid .node circle.state-start{fill:#333333;stroke:#333333;}#mermaid .node .fork-join{fill:#333333;stroke:#333333;}#mermaid .node circle.state-end{fill:#9370DB;stroke:white;stroke-width:1.5;}#mermaid .end-state-inner{fill:white;stroke-width:1.5;}#mermaid .node rect{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid .node polygon{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid #statediagram-barbEnd{fill:#333333;}#mermaid .statediagram-cluster rect{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid .cluster-label,#mermaid .nodeLabel{color:#131300;}#mermaid .statediagram-cluster rect.outer{rx:5px;ry:5px;}#mermaid .statediagram-state .divider{stroke:#9370DB;}#mermaid .statediagram-state .title-state{rx:5px;ry:5px;}#mermaid .statediagram-cluster.statediagram-cluster .inner{fill:white;}#mermaid .statediagram-cluster.statediagram-cluster-alt .inner{fill:#f0f0f0;}#mermaid .statediagram-cluster .inner{rx:0;ry:0;}#mermaid .statediagram-state rect.basic{rx:5px;ry:5px;}#mermaid .statediagram-state rect.divider{stroke-dasharray:10,10;fill:#f0f0f0;}#mermaid .note-edge{stroke-dasharray:5;}#mermaid .statediagram-note rect{fill:#fff5ad;stroke:#aaaa33;stroke-width:1px;rx:0;ry:0;}#mermaid .statediagram-note rect{fill:#fff5ad;stroke:#aaaa33;stroke-width:1px;rx:0;ry:0;}#mermaid .statediagram-note text{fill:black;}#mermaid .statediagram-note .nodeLabel{color:black;}#mermaid .statediagram .edgeLabel{color:red;}#mermaid #dependencyStart,#mermaid #dependencyEnd{fill:#333333;stroke:#333333;stroke-width:1;}
/** Pie chart */
#mermaid .pieCircle{stroke:#222;stroke-width:1px;}#mermaid .pieTitleText{text-anchor:middle;font-size:25px;fill:black;}#mermaid .slice{fill:#333;font-size:17px;}#mermaid .legend text{fill:black;font-size:17px;}
/** Requirements */
#mermaid marker{fill:#333333;stroke:#333333;}#mermaid marker.cross{stroke:#333333;}#mermaid svg{font-size:16px;}#mermaid .reqBox{fill:#ECECFF;fill-opacity:100%;stroke:hsl(240, 60%, 86.2745098039%);stroke-width:hsl(240, 60%, 86.2745098039%);}#mermaid .reqTitle,#mermaid .reqLabel{fill:#131300;}#mermaid .reqLabelBox{fill:#e8e8e8;fill-opacity:100%;}#mermaid .req-title-line{stroke:hsl(240, 60%, 86.2745098039%);stroke-width:hsl(240, 60%, 86.2745098039%);}#mermaid .relationshipLine{stroke:#333333;stroke-width:1;}#mermaid .relationshipLabel{fill:black;}
/** C4 system */
#mermaid .person{stroke:calculated;fill:calculated;}
/** Mind map */
#mermaid .section-root.mindmap-node { fill: hsl(240, 100%, 50%); } #mermaid .section-root.mindmap-node text { fill: white; }
#mermaid .mindmap-edges .edge-depth-0 { stroke-width: 14; }
#mermaid .mindmap-edges .edge-depth-1 { stroke-width: 11; }
#mermaid .mindmap-edges .edge-depth-2 { stroke-width: 8; }
#mermaid .mindmap-edges .edge-depth-3 { stroke-width: 5; }
#mermaid .mindmap-edges .edge-depth-4 { stroke-width: 3; }
#mermaid .mindmap-edges .edge-depth-5 { stroke-width: 2; }
#mermaid .mindmap-edges .edge-depth-6 { stroke-width: 1; }
#mermaid .mindmap-edges .section-edge-0,  #mermaid .mindmap-node.section-0  path { fill: hsl(60, 100%, 70%); stroke: hsl(60, 100%, 70%); } #mermaid .mindmap-node.section-0  text { fill: black; }
#mermaid .mindmap-edges .section-edge-1,  #mermaid .mindmap-node.section-1  path { fill: hsl(170, 90%, 70%); stroke: hsl(170, 90%, 70%); } #mermaid .mindmap-node.section-1  text { fill: black; }
#mermaid .mindmap-edges .section-edge-2,  #mermaid .mindmap-node.section-2  path { fill: hsl(280, 90%, 70%); stroke: hsl(280, 90%, 70%); } #mermaid .mindmap-node.section-2  text { fill: white; }
#mermaid .mindmap-edges .section-edge-3,  #mermaid .mindmap-node.section-3  path { fill: hsl(30, 90%, 70%);  stroke: hsl(30, 90%, 70%);  } #mermaid .mindmap-node.section-3  text { fill: black; }
#mermaid .mindmap-edges .section-edge-4,  #mermaid .mindmap-node.section-4  path { fill: hsl(140, 90%, 70%); stroke: hsl(140, 90%, 70%); } #mermaid .mindmap-node.section-4  text { fill: black; }
#mermaid .mindmap-edges .section-edge-5,  #mermaid .mindmap-node.section-5  path { fill: hsl(250, 90%, 70%); stroke: hsl(250, 90%, 70%); } #mermaid .mindmap-node.section-5  text { fill: white; }
#mermaid .mindmap-edges .section-edge-6,  #mermaid .mindmap-node.section-6  path { fill: hsl(0, 90%, 70%);   stroke: hsl(0, 90%, 70%);   } #mermaid .mindmap-node.section-6  text { fill: black; }
#mermaid .mindmap-edges .section-edge-7,  #mermaid .mindmap-node.section-7  path { fill: hsl(110, 90%, 70%); stroke: hsl(110, 90%, 70%); } #mermaid .mindmap-node.section-7  text { fill: black; }
#mermaid .mindmap-edges .section-edge-8,  #mermaid .mindmap-node.section-8  path { fill: hsl(220, 90%, 70%); stroke: hsl(220, 90%, 70%); } #mermaid .mindmap-node.section-8  text { fill: white; }
#mermaid .mindmap-edges .section-edge-9,  #mermaid .mindmap-node.section-9  path { fill: hsl(330, 90%, 70%); stroke: hsl(330, 90%, 70%); } #mermaid .mindmap-node.section-9  text { fill: black; }
#mermaid .mindmap-edges .section-edge-10, #mermaid .mindmap-node.section-10 path { fill: hsl(80, 90%, 70%);  stroke: hsl(80, 90%, 70%);  } #mermaid .mindmap-node.section-10 text { fill: black; }
#mermaid .mindmap-edges .section-edge-11, #mermaid .mindmap-node.section-11 path { fill: hsl(190, 90%, 70%); stroke: hsl(190, 90%, 70%); } #mermaid .mindmap-node.section-11 text { fill: black; }
#mermaid .mindmap-edges .section-edge-12, #mermaid .mindmap-node.section-12 path { fill: hsl(300, 90%, 70%); stroke: hsl(300, 90%, 70%); } #mermaid .mindmap-node.section-12 text { fill: black; }
/** Timeline */
#mermaid .timeline text tspan { fill: #222; } #mermaid .timeline-node path { fill: #ccc; }

/* Dark theme */
/** Common */
html.theme-dark #mermaid {fill:#ccc;}html.theme-dark #mermaid .error-icon{fill:#a44141;}html.theme-dark #mermaid .error-text{fill:#ddd;stroke:#ddd;}html.theme-dark #mermaid .edge-pattern-solid{stroke-dasharray:0;}html.theme-dark #mermaid .edge-pattern-dashed{stroke-dasharray:3;}html.theme-dark #mermaid .edge-pattern-dotted{stroke-dasharray:2;}html.theme-dark #mermaid .marker{fill:lightgrey;stroke:lightgrey;}html.theme-dark #mermaid .marker.cross{stroke:lightgrey;}
/** Flowchart */
html.theme-dark #mermaid .label{color:#ccc;}html.theme-dark #mermaid .cluster-label text{fill:#F9FFFE;}html.theme-dark #mermaid .cluster-label span{color:#F9FFFE;}html.theme-dark #mermaid .label text,html.theme-dark #mermaid span{fill:#ccc;color:#ccc;}html.theme-dark #mermaid .node rect,html.theme-dark #mermaid .node circle,html.theme-dark #mermaid .node ellipse,html.theme-dark #mermaid .node polygon,html.theme-dark #mermaid .node path{fill:#1f2020;stroke:#81B1DB;stroke-width:1px;}html.theme-dark #mermaid .node .label{text-align:center;}html.theme-dark #mermaid .node.clickable{cursor:pointer;}html.theme-dark #mermaid .arrowheadPath{fill:lightgrey;}html.theme-dark #mermaid .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}html.theme-dark #mermaid .flowchart-link{stroke:lightgrey;fill:none;}html.theme-dark #mermaid .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}html.theme-dark #mermaid .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}html.theme-dark #mermaid .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}html.theme-dark #mermaid .cluster text{fill:#F9FFFE;}html.theme-dark #mermaid .cluster span{color:#F9FFFE;}html.theme-dark #mermaid div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}html.theme-dark #mermaid :root{--mermaid-}
/** Sequence diagram */
html.theme-dark #mermaid .actor{stroke:#81B1DB;fill:#1f2020;}html.theme-dark #mermaid text.actor>tspan{fill:lightgrey;stroke:none;}html.theme-dark #mermaid .actor-line{stroke:lightgrey;}html.theme-dark #mermaid .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}html.theme-dark #mermaid .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}html.theme-dark #mermaid #arrowhead path{fill:lightgrey;stroke:lightgrey;}html.theme-dark #mermaid .sequenceNumber{fill:black;}html.theme-dark #mermaid #sequencenumber{fill:lightgrey;}html.theme-dark #mermaid #crosshead path{fill:lightgrey;stroke:lightgrey;}html.theme-dark #mermaid .messageText{fill:lightgrey;stroke:none;}html.theme-dark #mermaid .labelBox{stroke:#81B1DB;fill:#1f2020;}html.theme-dark #mermaid .labelText,html.theme-dark #mermaid .labelText>tspan{fill:lightgrey;stroke:none;}html.theme-dark #mermaid .loopText,html.theme-dark #mermaid .loopText>tspan{fill:lightgrey;stroke:none;}html.theme-dark #mermaid .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#81B1DB;fill:#81B1DB;}html.theme-dark #mermaid .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}html.theme-dark #mermaid .noteText,html.theme-dark #mermaid .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}html.theme-dark #mermaid .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#81B1DB;}html.theme-dark #mermaid .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#81B1DB;}html.theme-dark #mermaid .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#81B1DB;}html.theme-dark #mermaid .actorPopupMenu{position:absolute;}html.theme-dark #mermaid .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}html.theme-dark #mermaid .actor-man line{stroke:#81B1DB;fill:#1f2020;}html.theme-dark #mermaid .actor-man circle,html.theme-dark #mermaid line{stroke:#81B1DB;fill:#1f2020;stroke-width:2px;}html.theme-dark #mermaid :root{--mermaid-}
/** Gantt */
html.theme-dark #mermaid .exclude-range{fill:#444;}html.theme-dark #mermaid .section{stroke:none;opacity:0.2;}html.theme-dark #mermaid .section0{fill:hsl(52.9411764706, 28.813559322%, 58.431372549%);}html.theme-dark #mermaid .section2{fill:#EAE8D9;}html.theme-dark #mermaid .section1,html.theme-dark #mermaid .section3{fill:#333;opacity:0.2;}html.theme-dark #mermaid .sectionTitle0{fill:#F9FFFE;}html.theme-dark #mermaid .sectionTitle1{fill:#F9FFFE;}html.theme-dark #mermaid .sectionTitle2{fill:#F9FFFE;}html.theme-dark #mermaid .sectionTitle3{fill:#F9FFFE;}html.theme-dark #mermaid .sectionTitle{text-anchor:start;}html.theme-dark #mermaid .grid .tick{stroke:lightgrey;opacity:0.8;shape-rendering:crispEdges;}html.theme-dark #mermaid .grid .tick text{fill:#ccc;}html.theme-dark #mermaid .grid path{stroke-width:0;}html.theme-dark #mermaid .today{fill:none;stroke:#DB5757;stroke-width:2px;}html.theme-dark #mermaid .task{stroke-width:2;}html.theme-dark #mermaid .taskText{text-anchor:middle;}html.theme-dark #mermaid .taskTextOutsideRight{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%);text-anchor:start;}html.theme-dark #mermaid .taskTextOutsideLeft{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%);text-anchor:end;}html.theme-dark #mermaid .task.clickable{cursor:pointer;}html.theme-dark #mermaid .taskText.clickable{cursor:pointer;fill:#003163!important;font-weight:bold;}html.theme-dark #mermaid .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163!important;font-weight:bold;}html.theme-dark #mermaid .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163!important;font-weight:bold;}html.theme-dark #mermaid .taskText0,html.theme-dark #mermaid .taskText1,html.theme-dark #mermaid .taskText2,html.theme-dark #mermaid .taskText3{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%);}html.theme-dark #mermaid .task0,html.theme-dark #mermaid .task1,html.theme-dark #mermaid .task2,html.theme-dark #mermaid .task3{fill:hsl(180, 1.5873015873%, 35.3529411765%);stroke:#ffffff;}html.theme-dark #mermaid .taskTextOutside0,html.theme-dark #mermaid .taskTextOutside2{fill:lightgrey;}html.theme-dark #mermaid .taskTextOutside1,html.theme-dark #mermaid .taskTextOutside3{fill:lightgrey;}html.theme-dark #mermaid .active0,html.theme-dark #mermaid .active1,html.theme-dark #mermaid .active2,html.theme-dark #mermaid .active3{fill:#81B1DB;stroke:#ffffff;}html.theme-dark #mermaid .activeText0,html.theme-dark #mermaid .activeText1,html.theme-dark #mermaid .activeText2,html.theme-dark #mermaid .activeText3{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%)!important;}html.theme-dark #mermaid .done0,html.theme-dark #mermaid .done1,html.theme-dark #mermaid .done2,html.theme-dark #mermaid .done3{stroke:grey;fill:lightgrey;stroke-width:2;}html.theme-dark #mermaid .doneText0,html.theme-dark #mermaid .doneText1,html.theme-dark #mermaid .doneText2,html.theme-dark #mermaid .doneText3{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%)!important;}html.theme-dark #mermaid .crit0,html.theme-dark #mermaid .crit1,html.theme-dark #mermaid .crit2,html.theme-dark #mermaid .crit3{stroke:#E83737;fill:#E83737;stroke-width:2;}html.theme-dark #mermaid .activeCrit0,html.theme-dark #mermaid .activeCrit1,html.theme-dark #mermaid .activeCrit2,html.theme-dark #mermaid .activeCrit3{stroke:#E83737;fill:#81B1DB;stroke-width:2;}html.theme-dark #mermaid .doneCrit0,html.theme-dark #mermaid .doneCrit1,html.theme-dark #mermaid .doneCrit2,html.theme-dark #mermaid .doneCrit3{stroke:#E83737;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges;}html.theme-dark #mermaid .milestone{transform:rotate(45deg) scale(0.8,0.8);}html.theme-dark #mermaid .milestoneText{font-style:italic;}html.theme-dark #mermaid .doneCritText0,html.theme-dark #mermaid .doneCritText1,html.theme-dark #mermaid .doneCritText2,html.theme-dark #mermaid .doneCritText3{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%)!important;}html.theme-dark #mermaid .activeCritText0,html.theme-dark #mermaid .activeCritText1,html.theme-dark #mermaid .activeCritText2,html.theme-dark #mermaid .activeCritText3{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%)!important;}html.theme-dark #mermaid .titleText{text-anchor:middle;fill:#ccc;}html.theme-dark #mermaid :root{--mermaid-}
/** Class diagram */
html.theme-dark #mermaid g.classGroup text{fill:#e0dfdf;stroke:none;}html.theme-dark #mermaid g.classGroup text .title{font-weight:bolder;}html.theme-dark #mermaid .nodeLabel,html.theme-dark #mermaid .edgeLabel{color:#e0dfdf;}html.theme-dark #mermaid .edgeLabel .label rect{fill:#1f2020;}html.theme-dark #mermaid .label text{fill:#e0dfdf;}html.theme-dark #mermaid .edgeLabel .label span{background:#1f2020;}html.theme-dark #mermaid .classTitle{font-weight:bolder;}html.theme-dark #mermaid .node rect,html.theme-dark #mermaid .node circle,html.theme-dark #mermaid .node ellipse,html.theme-dark #mermaid .node polygon,html.theme-dark #mermaid .node path{fill:#1f2020;stroke:#81B1DB;stroke-width:1px;}html.theme-dark #mermaid .divider{stroke:#81B1DB;stroke:1;}html.theme-dark #mermaid g.clickable{cursor:pointer;}html.theme-dark #mermaid g.classGroup rect{fill:#1f2020;stroke:#81B1DB;}html.theme-dark #mermaid g.classGroup line{stroke:#81B1DB;stroke-width:1;}html.theme-dark #mermaid .classLabel .box{stroke:none;stroke-width:0;fill:#1f2020;opacity:0.5;}html.theme-dark #mermaid .classLabel .label{fill:#81B1DB;}html.theme-dark #mermaid .relation{stroke:lightgrey;stroke-width:1;fill:none;}html.theme-dark #mermaid .dashed-line{stroke-dasharray:3;}html.theme-dark #mermaid #compositionStart,html.theme-dark #mermaid .composition{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}html.theme-dark #mermaid #compositionEnd,html.theme-dark #mermaid .composition{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}html.theme-dark #mermaid #dependencyStart,html.theme-dark #mermaid .dependency{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}html.theme-dark #mermaid #dependencyStart,html.theme-dark #mermaid .dependency{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}html.theme-dark #mermaid #extensionStart,html.theme-dark #mermaid .extension{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}html.theme-dark #mermaid #extensionEnd,html.theme-dark #mermaid .extension{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}html.theme-dark #mermaid #aggregationStart,html.theme-dark #mermaid .aggregation{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}html.theme-dark #mermaid #aggregationEnd,html.theme-dark #mermaid .aggregation{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}html.theme-dark #mermaid #lollipopStart,html.theme-dark #mermaid .lollipop{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}html.theme-dark #mermaid #lollipopEnd,html.theme-dark #mermaid .lollipop{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}html.theme-dark #mermaid .edgeTerminals{}html.theme-dark #mermaid :root{--mermaid-}
/** Git graph */
html.theme-dark #mermaid .commit-id,html.theme-dark #mermaid .commit-msg,html.theme-dark #mermaid .branch-label{fill:lightgrey;color:lightgrey;}html.theme-dark #mermaid .branch-label0{fill:undefined;}html.theme-dark #mermaid .commit0{stroke:hsl(180, 1.5873015873%, 48.3529411765%);fill:hsl(180, 1.5873015873%, 48.3529411765%);}html.theme-dark #mermaid .commit-highlight0{stroke:rgb(133.6571428571, 129.7428571428, 129.7428571428);fill:rgb(133.6571428571, 129.7428571428, 129.7428571428);}html.theme-dark #mermaid .label0{fill:hsl(180, 1.5873015873%, 48.3529411765%);}html.theme-dark #mermaid .arrow0{stroke:hsl(180, 1.5873015873%, 48.3529411765%);}html.theme-dark #mermaid .branch-label1{fill:undefined;}html.theme-dark #mermaid .commit1{stroke:hsl(321.6393442623, 65.5913978495%, 38.2352941176%);fill:hsl(321.6393442623, 65.5913978495%, 38.2352941176%);}html.theme-dark #mermaid .commit-highlight1{stroke:rgb(93.5483870969, 221.4516129033, 139.677419355);fill:rgb(93.5483870969, 221.4516129033, 139.677419355);}html.theme-dark #mermaid .label1{fill:hsl(321.6393442623, 65.5913978495%, 38.2352941176%);}html.theme-dark #mermaid .arrow1{stroke:hsl(321.6393442623, 65.5913978495%, 38.2352941176%);}html.theme-dark #mermaid .branch-label2{fill:undefined;}html.theme-dark #mermaid .commit2{stroke:hsl(194.4, 16.5562913907%, 49.6078431373%);fill:hsl(194.4, 16.5562913907%, 49.6078431373%);}html.theme-dark #mermaid .commit-highlight2{stroke:rgb(149.4437086091, 117.6092715231, 107.5562913906);fill:rgb(149.4437086091, 117.6092715231, 107.5562913906);}html.theme-dark #mermaid .label2{fill:hsl(194.4, 16.5562913907%, 49.6078431373%);}html.theme-dark #mermaid .arrow2{stroke:hsl(194.4, 16.5562913907%, 49.6078431373%);}html.theme-dark #mermaid .branch-label3{fill:undefined;}html.theme-dark #mermaid .commit3{stroke:hsl(23.0769230769, 49.0566037736%, 40.7843137255%);fill:hsl(23.0769230769, 49.0566037736%, 40.7843137255%);}html.theme-dark #mermaid .commit-highlight3{stroke:rgb(99.9811320754, 162.7735849057, 202.0188679245);fill:rgb(99.9811320754, 162.7735849057, 202.0188679245);}html.theme-dark #mermaid .label3{fill:hsl(23.0769230769, 49.0566037736%, 40.7843137255%);}html.theme-dark #mermaid .arrow3{stroke:hsl(23.0769230769, 49.0566037736%, 40.7843137255%);}html.theme-dark #mermaid .branch-label4{fill:undefined;}html.theme-dark #mermaid .commit4{stroke:hsl(0, 83.3333333333%, 43.5294117647%);fill:hsl(0, 83.3333333333%, 43.5294117647%);}html.theme-dark #mermaid .commit-highlight4{stroke:rgb(51.5000000001, 236.5, 236.5);fill:rgb(51.5000000001, 236.5, 236.5);}html.theme-dark #mermaid .label4{fill:hsl(0, 83.3333333333%, 43.5294117647%);}html.theme-dark #mermaid .arrow4{stroke:hsl(0, 83.3333333333%, 43.5294117647%);}html.theme-dark #mermaid .branch-label5{fill:undefined;}html.theme-dark #mermaid .commit5{stroke:hsl(289.1666666667, 100%, 24.1176470588%);fill:hsl(289.1666666667, 100%, 24.1176470588%);}html.theme-dark #mermaid .commit-highlight5{stroke:rgb(154.2083333334, 255, 132.0000000001);fill:rgb(154.2083333334, 255, 132.0000000001);}html.theme-dark #mermaid .label5{fill:hsl(289.1666666667, 100%, 24.1176470588%);}html.theme-dark #mermaid .arrow5{stroke:hsl(289.1666666667, 100%, 24.1176470588%);}html.theme-dark #mermaid .branch-label6{fill:undefined;}html.theme-dark #mermaid .commit6{stroke:hsl(35.1315789474, 98.7012987013%, 40.1960784314%);fill:hsl(35.1315789474, 98.7012987013%, 40.1960784314%);}html.theme-dark #mermaid .commit-highlight6{stroke:rgb(51.331168831, 135.1948051946, 253.6688311688);fill:rgb(51.331168831, 135.1948051946, 253.6688311688);}html.theme-dark #mermaid .label6{fill:hsl(35.1315789474, 98.7012987013%, 40.1960784314%);}html.theme-dark #mermaid .arrow6{stroke:hsl(35.1315789474, 98.7012987013%, 40.1960784314%);}html.theme-dark #mermaid .branch-label7{fill:undefined;}html.theme-dark #mermaid .commit7{stroke:hsl(106.1538461538, 84.4155844156%, 35.0980392157%);fill:hsl(106.1538461538, 84.4155844156%, 35.0980392157%);}html.theme-dark #mermaid .commit-highlight7{stroke:rgb(206.1818181817, 89.948051948, 241.051948052);fill:rgb(206.1818181817, 89.948051948, 241.051948052);}html.theme-dark #mermaid .label7{fill:hsl(106.1538461538, 84.4155844156%, 35.0980392157%);}html.theme-dark #mermaid .arrow7{stroke:hsl(106.1538461538, 84.4155844156%, 35.0980392157%);}html.theme-dark #mermaid .branch{stroke-width:1;stroke:lightgrey;stroke-dasharray:2;}html.theme-dark #mermaid .commit-label{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);}html.theme-dark #mermaid .commit-label-bkg{fill:hsl(180, 1.5873015873%, 28.3529411765%);opacity:0.5;}html.theme-dark #mermaid .tag-label{fill:#e0dfdf;}html.theme-dark #mermaid .tag-label-bkg{fill:#1f2020;stroke:#cccccc;}html.theme-dark #mermaid .tag-hole{fill:#ccc;}html.theme-dark #mermaid .commit-merge{stroke:#1f2020;fill:#1f2020;}html.theme-dark #mermaid .commit-reverse{stroke:#1f2020;fill:#1f2020;stroke-width:3;}html.theme-dark #mermaid .commit-highlight-inner{stroke:#1f2020;fill:#1f2020;}html.theme-dark #mermaid .arrow{stroke-width:8;stroke-linecap:round;fill:none;}:root{--mermaid-}
/** Entity relationship */
html.theme-dark #mermaid .entityBox{fill:#1f2020;stroke:#81B1DB;}html.theme-dark #mermaid .attributeBoxOdd{fill:hsl(0, 0%, 32%);stroke:#81B1DB;}html.theme-dark #mermaid .attributeBoxEven{fill:hsl(0, 0%, 22%);stroke:#81B1DB;}html.theme-dark #mermaid .relationshipLabelBox{fill:hsl(20, 1.5873015873%, 12.3529411765%);opacity:0.7;background-color:hsl(20, 1.5873015873%, 12.3529411765%);}html.theme-dark #mermaid .relationshipLabelBox rect{opacity:0.5;}html.theme-dark #mermaid .relationshipLine{stroke:lightgrey;}html.theme-dark #mermaid :root{--mermaid-}
/** Journey */
html.theme-dark #mermaid .label{color:#ccc;}html.theme-dark #mermaid .mouth{stroke:#666;}html.theme-dark #mermaid line{stroke:#ccc;}html.theme-dark #mermaid .legend{fill:#ccc;}html.theme-dark #mermaid .label text{fill:#333;}html.theme-dark #mermaid .label{color:#ccc;}html.theme-dark #mermaid .face{fill:#FFF8DC;stroke:#999;}html.theme-dark #mermaid .node rect,html.theme-dark #mermaid .node circle,html.theme-dark #mermaid .node ellipse,html.theme-dark #mermaid .node polygon,html.theme-dark #mermaid .node path{fill:#1f2020;stroke:#81B1DB;stroke-width:1px;}html.theme-dark #mermaid .node .label{text-align:center;}html.theme-dark #mermaid .node.clickable{cursor:pointer;}html.theme-dark #mermaid .arrowheadPath{fill:lightgrey;}html.theme-dark #mermaid .edgePath .path{stroke:lightgrey;stroke-width:1.5px;}html.theme-dark #mermaid .flowchart-link{stroke:lightgrey;fill:none;}html.theme-dark #mermaid .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}html.theme-dark #mermaid .edgeLabel rect{opacity:0.5;}html.theme-dark #mermaid .cluster text{fill:#F9FFFE;}html.theme-dark #mermaid div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}html.theme-dark #mermaid .task-type-0,html.theme-dark #mermaid .section-type-0{fill:#1f2020;}html.theme-dark #mermaid .task-type-1,html.theme-dark #mermaid .section-type-1{fill:hsl(180, 1.5873015873%, 28.3529411765%);}html.theme-dark #mermaid .task-type-2,html.theme-dark #mermaid .section-type-2{fill:hsl(244, 1.5873015873%, 12.3529411765%);}html.theme-dark #mermaid .task-type-3,html.theme-dark #mermaid .section-type-3{fill:hsl(244, 1.5873015873%, 28.3529411765%);}html.theme-dark #mermaid .task-type-4,html.theme-dark #mermaid .section-type-4{fill:hsl(116, 1.5873015873%, 12.3529411765%);}html.theme-dark #mermaid .task-type-5,html.theme-dark #mermaid .section-type-5{fill:hsl(116, 1.5873015873%, 28.3529411765%);}html.theme-dark #mermaid .task-type-6,html.theme-dark #mermaid .section-type-6{fill:hsl(308, 1.5873015873%, 12.3529411765%);}html.theme-dark #mermaid .task-type-7,html.theme-dark #mermaid .section-type-7{fill:hsl(308, 1.5873015873%, 28.3529411765%);}html.theme-dark #mermaid :root{--mermaid-}
/** State diagram */
html.theme-dark #mermaid defs #statediagram-barbEnd{fill:lightgrey;stroke:lightgrey;}html.theme-dark #mermaid g.stateGroup text{fill:#81B1DB;stroke:none;}html.theme-dark #mermaid g.stateGroup text{fill:#ccc;stroke:none;}html.theme-dark #mermaid g.stateGroup .state-title{font-weight:bolder;fill:#e0dfdf;}html.theme-dark #mermaid g.stateGroup rect{fill:#1f2020;stroke:#81B1DB;}html.theme-dark #mermaid g.stateGroup line{stroke:lightgrey;stroke-width:1;}html.theme-dark #mermaid .transition{stroke:lightgrey;stroke-width:1;fill:none;}html.theme-dark #mermaid .stateGroup .composit{fill:#333;border-bottom:1px;}html.theme-dark #mermaid .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px;}html.theme-dark #mermaid .state-note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}html.theme-dark #mermaid .state-note text{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}html.theme-dark #mermaid .stateLabel .box{stroke:none;stroke-width:0;fill:#1f2020;opacity:0.5;}html.theme-dark #mermaid .edgeLabel .label rect{fill:#1f2020;opacity:0.5;}html.theme-dark #mermaid .edgeLabel .label text{fill:#ccc;}html.theme-dark #mermaid .label div .edgeLabel{color:#ccc;}html.theme-dark #mermaid .stateLabel text{fill:#e0dfdf;font-weight:bold;}html.theme-dark #mermaid .node circle.state-start{fill:#f4f4f4;stroke:#f4f4f4;}html.theme-dark #mermaid .node .fork-join{fill:#f4f4f4;stroke:#f4f4f4;}html.theme-dark #mermaid .node circle.state-end{fill:#cccccc;stroke:#333;stroke-width:1.5;}html.theme-dark #mermaid .end-state-inner{fill:#333;stroke-width:1.5;}html.theme-dark #mermaid .node rect{fill:#1f2020;stroke:#81B1DB;stroke-width:1px;}html.theme-dark #mermaid .node polygon{fill:#1f2020;stroke:#81B1DB;stroke-width:1px;}html.theme-dark #mermaid #statediagram-barbEnd{fill:lightgrey;}html.theme-dark #mermaid .statediagram-cluster rect{fill:#1f2020;stroke:#81B1DB;stroke-width:1px;}html.theme-dark #mermaid .cluster-label,html.theme-dark #mermaid .nodeLabel{color:#e0dfdf;}html.theme-dark #mermaid .statediagram-cluster rect.outer{rx:5px;ry:5px;}html.theme-dark #mermaid .statediagram-state .divider{stroke:#81B1DB;}html.theme-dark #mermaid .statediagram-state .title-state{rx:5px;ry:5px;}html.theme-dark #mermaid .statediagram-cluster.statediagram-cluster .inner{fill:#333;}html.theme-dark #mermaid .statediagram-cluster.statediagram-cluster-alt .inner{fill:#555;}html.theme-dark #mermaid .statediagram-cluster .inner{rx:0;ry:0;}html.theme-dark #mermaid .statediagram-state rect.basic{rx:5px;ry:5px;}html.theme-dark #mermaid .statediagram-state rect.divider{stroke-dasharray:10,10;fill:#555;}html.theme-dark #mermaid .note-edge{stroke-dasharray:5;}html.theme-dark #mermaid .statediagram-note rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:hsl(180, 0%, 18.3529411765%);stroke-width:1px;rx:0;ry:0;}html.theme-dark #mermaid .statediagram-note rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:hsl(180, 0%, 18.3529411765%);stroke-width:1px;rx:0;ry:0;}html.theme-dark #mermaid .statediagram-note text{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);}html.theme-dark #mermaid .statediagram-note .nodeLabel{color:rgb(183.8476190475, 181.5523809523, 181.5523809523);}html.theme-dark #mermaid .statediagram .edgeLabel{color:red;}html.theme-dark #mermaid #dependencyStart,html.theme-dark #mermaid #dependencyEnd{fill:lightgrey;stroke:lightgrey;stroke-width:1;}html.theme-dark #mermaid :root{--mermaid-}
/** Pie chart */
html.theme-dark #mermaid .pieCircle{filter: brightness(0.7);} html.theme-dark #mermaid[aria-roledescription=pie] .legend rect { filter: brightness(0.7); } html.theme-dark #mermaid .pieTitleText{text-anchor:middle;fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%);}html.theme-dark #mermaid .slice{fill:#222;}html.theme-dark #mermaid .legend text{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%);}html.theme-dark #mermaid :root{--mermaid-}
/** Requirements */
html.theme-dark #mermaid marker{fill:lightgrey;stroke:lightgrey;}html.theme-dark #mermaid marker.cross{stroke:lightgrey;}html.theme-dark #mermaid svg{}html.theme-dark #mermaid .reqBox{fill:#1f2020;fill-opacity:100%;stroke:#cccccc;stroke-width:#cccccc;}html.theme-dark #mermaid .reqTitle,html.theme-dark #mermaid .reqLabel{fill:#e0dfdf;}html.theme-dark #mermaid .reqLabelBox{fill:hsl(180, 1.5873015873%, 28.3529411765%);fill-opacity:100%;}html.theme-dark #mermaid .req-title-line{stroke:#cccccc;stroke-width:#cccccc;}html.theme-dark #mermaid .relationshipLine{stroke:lightgrey;stroke-width:1;}html.theme-dark #mermaid .relationshipLabel{fill:lightgrey;}html.theme-dark #mermaid :root{--mermaid-}
/** C4 system */
html.theme-dark #mermaid .person{stroke:calculated;fill:calculated;} html.theme-dark #mermaid[aria-roledescription=c4] rect {stroke: #ddd;} html.theme-dark #mermaid[aria-roledescription=c4] text {fill:#eee;}
/** Mind map */
html.theme-dark #mermaid .section-root.mindmap-node { fill: #ccc; } html.theme-dark #mermaid .section-root.mindmap-node text { fill: black; }
html.theme-dark #mermaid .mindmap-edges path, html.theme-dark #mermaid .mindmap-node { filter: hue-rotate(180deg) invert(0.9); }
/** Timeline */
html.theme-dark #mermaid .timeline text tspan { fill: #eee; } html.theme-dark #mermaid .timeline-node path { fill: #222; }

        

        .prism {
            page-break-inside: avoid;
        }
        
        /* PrismJS 1.29.0
https://prismjs.com/download.html#themes=prism&languages=markup+css+clike+javascript+abap+abnf+actionscript+ada+agda+al+antlr4+apacheconf+apex+apl+applescript+aql+arduino+arff+armasm+arturo+asciidoc+aspnet+asm6502+asmatmel+autohotkey+autoit+avisynth+avro-idl+awk+bash+basic+batch+bbcode+bbj+bicep+birb+bison+bnf+bqn+brainfuck+brightscript+bro+bsl+c+csharp+cpp+cfscript+chaiscript+cil+cilkc+cilkcpp+clojure+cmake+cobol+coffeescript+concurnas+csp+cooklang+coq+crystal+css-extras+csv+cue+cypher+d+dart+dataweave+dax+dhall+diff+django+dns-zone-file+docker+dot+ebnf+editorconfig+eiffel+ejs+elixir+elm+etlua+erb+erlang+excel-formula+fsharp+factor+false+firestore-security-rules+flow+fortran+ftl+gml+gap+gcode+gdscript+gedcom+gettext+gherkin+git+glsl+gn+linker-script+go+go-module+gradle+graphql+groovy+haml+handlebars+haskell+haxe+hcl+hlsl+hoon+http+hpkp+hsts+ichigojam+icon+icu-message-format+idris+ignore+inform7+ini+io+j+java+javadoc+javadoclike+javastacktrace+jexl+jolie+jq+jsdoc+js-extras+json+json5+jsonp+jsstacktrace+js-templates+julia+keepalived+keyman+kotlin+kumir+kusto+latex+latte+less+lilypond+liquid+lisp+livescript+llvm+log+lolcode+lua+magma+makefile+markdown+markup-templating+mata+matlab+maxscript+mel+mermaid+metafont+mizar+mongodb+monkey+moonscript+n1ql+n4js+nand2tetris-hdl+naniscript+nasm+neon+nevod+nginx+nim+nix+nsis+objectivec+ocaml+odin+opencl+openqasm+oz+parigp+parser+pascal+pascaligo+psl+pcaxis+peoplecode+perl+php+phpdoc+php-extras+plant-uml+plsql+powerquery+powershell+processing+prolog+promql+properties+protobuf+pug+puppet+pure+purebasic+purescript+python+qsharp+q+qml+qore+r+racket+cshtml+jsx+tsx+reason+regex+rego+renpy+rescript+rest+rip+roboconf+robotframework+ruby+rust+sas+sass+scss+scala+scheme+shell-session+smali+smalltalk+smarty+sml+solidity+solution-file+soy+sparql+splunk-spl+sqf+sql+squirrel+stan+stata+iecst+stylus+supercollider+swift+systemd+t4-templating+t4-cs+t4-vb+tap+tcl+tt2+textile+toml+tremor+turtle+twig+typescript+typoscript+unrealscript+uorazor+uri+v+vala+vbnet+velocity+verilog+vhdl+vim+visual-basic+warpscript+wasm+web-idl+wgsl+wiki+wolfram+wren+xeora+xml-doc+xojo+xquery+yaml+yang+zig&plugins=highlight-keywords */
code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre-wrap;word-spacing:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:16px;margin:0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}

        

        .prompt {
            flex-direction: row;
            letter-spacing: .0015em;
            font-size: 16px;
            font-weight: 400;
            line-height: 24px;
            margin-left: 0;
            margin-right: 0;
        }
        

        .prompt-content {
            padding: 15px;
            overflow: hidden;
            flex: 1 1 auto;
        }
        

        .prompt-content-p p {
            margin-block-start: 0;
            margin-block-end: 0;
        }
        

        .prompt-icon {
            flex: 0 0 auto;
            margin-left: 15px;
            margin-top: 15px;
            fill: currentcolor;
            width: 24px;
            height: 24px;
        }
        

        :root {
            width: 95%;
            max-width: 95vw;
            padding: 0 0 0 30px;
        }
        
        body {
            font-family: JetBrains Sans,serif;
        }
        
        a {
            overflow-wrap: anywhere;
            width: 100vw;
        }
        
        
        @font-face {
            font-family: JetBrains Sans;
            src: url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Light.woff2) format("woff2"), url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Light.woff) format("woff");
            font-weight: 300;
            font-style: normal;
        }

        @font-face {
            font-family: JetBrains Sans;
            src: url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Regular.woff2) format("woff2"), url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Regular.woff) format("woff");
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: JetBrains Sans;
            src: url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-SemiBold.woff2) format("woff2"), url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-SemiBold.woff) format("woff");
            font-weight: 600;
            font-style: normal;
        }
        
        
        code {
            display: inline;
            word-break: break-word;
            font-size: 15px;
            line-height: inherit;
            font-variant-ligatures: none;
            font-family: JetBrains Sans,monospace;
            white-space: pre-line;
            overflow-wrap: break-word;
        }
        
        figcaption {
            margin-top: 5px;
        }
        
        h2 {
            padding-top: 16px;
            padding-bottom: 8px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        
        h3 {
            padding-top: 8px;
            padding-bottom: 8px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        
        h4 {
            padding-top: 4px;
            padding-bottom: 8px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        
        p {
            padding: 0;
            border: 0;
            line-height: 25px;
            margin-block-start: 0;
            margin-block-end: 0;
            padding-bottom: 8px;
        }
        
        div {
            display: block;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            page-break-inside: avoid;
        }
        
        th, td {
            border: 1px solid #c4c4c4;
            padding: 10px;
            text-align: left;
            word-break: break-all;
        }
        
        .entry {
            display: grid;
            grid-template-columns: auto max-content;
            grid-template-areas: "chapter page";
            align-items: end;
            gap: 0 .25rem;
            line-height: 25px;
        }
        
        .toc-link-container{
            grid-area: chapter;
            position: relative;
            overflow: hidden;
        }
        
        .toc-link{
            text-decoration: none;
            color: black;
        }
        
        .toc-link-container::after {
            position: absolute;
            padding-left: .25ch;
            content: " . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . "
            ". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . "
            ". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ";
            text-align: right;
        }
        
        .page {
            grid-area: page;
            width: 30px;
            text-align: right;
        }
        

        .table-wrapper {
            overflow: hidden;
            box-sizing: border-box;
            font: inherit;
        }
        

        .tip {
            background-color: rgba(25, 25, 28, .05);
        }
        

        .topic {
            page-break-before: always;
        }
        </style><title>pdfSourceIN</title></head><body><div><section class="topic"><div><article class="article"><h1 class="main-title">Table of contents</h1><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1701825237">Alcance y Limitaciones - SURA Foundation Framework</a></div><div class="page">3</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#2007547606">Arquitectura General - SURA Foundation Framework</a></div><div class="page">9</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#362417808">Patrones de Dise&ntilde;o - Framework Foundation</a></div><div class="page">19</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#480351126">Modelo de Datos - SURA Foundation Framework</a></div><div class="page">27</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-483439626">`ProductHandler` Apex Class Documentation</a></div><div class="page">41</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-172468156">ResponsabilityHandler</a></div><div class="page">56</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1707928647">FoundationEventLogController</a></div><div class="page">60</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#2106303">Core</a></div><div class="page">74</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-149877873">BaseProcessManager</a></div><div class="page">85</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1701264068">BaseProcessFoundationVlocityAdapter</a></div><div class="page">90</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1156337433">BaseObserver</a></div><div class="page">94</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#514145071">Adapter</a></div><div class="page">96</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#374953083">RateProductHandler</a></div><div class="page">107</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1920880855">QuoteProductHandler</a></div><div class="page">110</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-2130585883">ProductHandlerNotImplementedException</a></div><div class="page">119</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#66328258">ProductHandlerImplementationException</a></div><div class="page">127</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1377939673">Documentaci&oacute;n T&eacute;cnica - Objeto `Subconjunto Registro de Evento`</a></div><div class="page">136</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1511612937">LeadProductHandler</a></div><div class="page">140</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1606364044">IssueProductHandler</a></div><div class="page">146</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#2057955537">LeadConfigurator</a></div><div class="page">155</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1538875026">LeadBuilderFoundation</a></div><div class="page">161</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1183693549">LeadUtils</a></div><div class="page">170</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#170943110">LeadProductHandler</a></div><div class="page">173</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-760055542">RUNTWrapper</a></div><div class="page">177</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1772259966">RUNTServiceHandler</a></div><div class="page">183</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1024734388">LocalEmisionNotificationHandler</a></div><div class="page">190</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-277013134">IntegrationProcedureExecutor</a></div><div class="page">195</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1356896840">InsServiceAdapter</a></div><div class="page">205</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1402701071">GenerateURLServiceHandler</a></div><div class="page">213</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-583978235">ExternalServiceValidationUtil</a></div><div class="page">224</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-513411284">ExternalServiceValidationException</a></div><div class="page">230</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1327318235">ExternalServiceException</a></div><div class="page">234</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1425473036">ExternalNotificationHandler</a></div><div class="page">238</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1598943198">CCMServiceHandler</a></div><div class="page">248</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#791714434">MetaDataUtils</a></div><div class="page">261</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#312447433">LocalEmisionNotificationHandlerMock</a></div><div class="page">265</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#632001157">EventLog_Subset_CleanupScheduleClass</a></div><div class="page">267</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1004768122">EventLog_Subset_CleanupBatchClass</a></div><div class="page">272</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-472222476">EventLogManagerProvider</a></div><div class="page">281</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1647977607">EventLogManagerFoundationAdapter</a></div><div class="page">289</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1679465955">EventLogManager</a></div><div class="page">298</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#315742789">CustomMetadataCallback</a></div><div class="page">309</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1384593519">CumuloMissingParameterException</a></div><div class="page">320</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#2045408102">LocalEmisionNotificationHandlerTest</a></div><div class="page">331</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1406606362">IFeatureFlags</a></div><div class="page">333</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1223111818">IFeatureFlagProvider</a></div><div class="page">344</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1350189393">FeatureFlags</a></div><div class="page">352</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1002509171">FeatureFlagProvider</a></div><div class="page">358</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1104960030">AccountConfigurator</a></div><div class="page">361</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-53121842">AccountBuilder</a></div><div class="page">368</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1368901578">QuotingException</a></div><div class="page">375</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-809568624">APIs y Endpoints - SURA Foundation Framework</a></div><div class="page">381</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1028232267">QuoteUtils</a></div><div class="page">395</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-427355904">Gu&iacute;as de Implementaci&oacute;n - SURA Foundation Framework</a></div><div class="page">405</div></div></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1701825237">Alcance y Limitaciones - SURA Foundation Framework</h1><section><h2 id="-1701825237#objetivo-del-proyecto" data-toc="objetivo-del-proyecto#01 - Alcance y Limitaciones.md-objetivo-del-proyecto">Objetivo del Proyecto</h2><p id="-1701825237#-ibv6bx_11">Desarrollar e implementar un framework de procesamiento centralizado (<span class="control" id="-1701825237#-ibv6bx_12">SURA Foundation</span>) que permita la separaci&oacute;n l&oacute;gica y arquitect&oacute;nica de los procesos de venta de seguros, proporcionando una base s&oacute;lida y reutilizable para m&uacute;ltiples productos de la familia SURA, con especial enfoque en productos de movilidad (Motos, Autos, Viajes, Arrendamiento).</p></section><section><h2 id="-1701825237#contexto-del-proyecto" data-toc="contexto-del-proyecto#01 - Alcance y Limitaciones.md-contexto-del-proyecto">Contexto del Proyecto</h2><p id="-1701825237#-ibv6bx_13"><span class="control" id="-1701825237#-ibv6bx_14">SURA Foundation</span> surge como respuesta a los problemas arquitect&oacute;nicos identificados en el sistema actual, donde m&uacute;ltiples productos comparten c&oacute;digo h&iacute;brido y artefactos sin separaci&oacute;n l&oacute;gica clara, generando inestabilidad, dificultades de mantenimiento y imposibilidad de medir el rendimiento real de cada proceso.</p></section><section><h2 id="-1701825237#alcance" data-toc="alcance#01 - Alcance y Limitaciones.md-alcance">Alcance</h2><section><h3 id="-1701825237#funcionalidades-incluidas" data-toc="funcionalidades-incluidas#01 - Alcance y Limitaciones.md-funcionalidades-incluidas">Funcionalidades Incluidas</h3><ol class="list list-decimal" id="-1701825237#-ibv6bx_18" type="1" start="1"><li class="list-item" id="-1701825237#-ibv6bx_19"><p id="-1701825237#-ibv6bx_27"><span class="control" id="-1701825237#-ibv6bx_29">Framework Core de Procesamiento</span></p><ul class="list" id="-1701825237#-ibv6bx_28" start="1"><li class="list-item" id="-1701825237#-ibv6bx_30"><p>Implementaci&oacute;n del patr&oacute;n Chain of Responsibility para procesos secuenciales</p></li><li class="list-item" id="-1701825237#-ibv6bx_31"><p>Sistema de observadores (Observer Pattern) para eventos de negocio</p></li><li class="list-item" id="-1701825237#-ibv6bx_32"><p>Adaptadores (Adapter Pattern) para integraci&oacute;n con Vlocity y sistemas externos</p></li><li class="list-item" id="-1701825237#-ibv6bx_33"><p>Template Method Pattern para estandarizaci&oacute;n de procesos</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_20"><p id="-1701825237#-ibv6bx_34"><span class="control" id="-1701825237#-ibv6bx_36">Gesti&oacute;n de Procesos por Etapas</span></p><ul class="list" id="-1701825237#-ibv6bx_35" start="1"><li class="list-item" id="-1701825237#-ibv6bx_37"><p>Procesamiento Pre, In y Post para cada etapa del flujo de venta</p></li><li class="list-item" id="-1701825237#-ibv6bx_38"><p>Manejo de eventos mediante Platform Events</p></li><li class="list-item" id="-1701825237#-ibv6bx_39"><p>Service Callouts integrados con l&oacute;gica de reintentos configurable</p></li><li class="list-item" id="-1701825237#-ibv6bx_40"><p>Panel de administraci&oacute;n centralizado para gesti&oacute;n de procesos</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_21"><p id="-1701825237#-ibv6bx_41"><span class="control" id="-1701825237#-ibv6bx_43">Separaci&oacute;n L&oacute;gica por Producto</span></p><ul class="list" id="-1701825237#-ibv6bx_42" start="1"><li class="list-item" id="-1701825237#-ibv6bx_44"><p>Procesos independientes para cada l&iacute;nea de negocio (Motos, Autos, Viajes, etc.)</p></li><li class="list-item" id="-1701825237#-ibv6bx_45"><p>Handlers espec&iacute;ficos por producto con nomenclatura estandarizada</p></li><li class="list-item" id="-1701825237#-ibv6bx_46"><p>Responsabilidades claramente definidas por proceso y producto</p></li><li class="list-item" id="-1701825237#-ibv6bx_47"><p>Capacidad de medir desempe&ntilde;o individual por proceso</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_22"><p id="-1701825237#-ibv6bx_48"><span class="control" id="-1701825237#-ibv6bx_50">Artefactos Reutilizables Centralizados</span></p><ul class="list" id="-1701825237#-ibv6bx_49" start="1"><li class="list-item" id="-1701825237#-ibv6bx_51"><p><span class="control" id="-1701825237#-ibv6bx_56">Conocimiento:</span> LeadManager y componentes base</p></li><li class="list-item" id="-1701825237#-ibv6bx_52"><p><span class="control" id="-1701825237#-ibv6bx_57">Tarificaci&oacute;n:</span> Componentes de c&aacute;lculo y pricing</p></li><li class="list-item" id="-1701825237#-ibv6bx_53"><p><span class="control" id="-1701825237#-ibv6bx_58">Cotizaci&oacute;n:</span> SURACrearNumeroPrepoliza, QuoteManager, SURAPaymentManager</p></li><li class="list-item" id="-1701825237#-ibv6bx_54"><p><span class="control" id="-1701825237#-ibv6bx_59">Emisi&oacute;n:</span> InsurancePolicyManager, SURAAccountManager, SURAOpportunityManager</p></li><li class="list-item" id="-1701825237#-ibv6bx_55"><p><span class="control" id="-1701825237#-ibv6bx_60">Legalizaci&oacute;n:</span> InsurancePolicyTransactionManager, SURAInvoiceListeningServiceV1</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_23"><p id="-1701825237#-ibv6bx_61"><span class="control" id="-1701825237#-ibv6bx_63">Sistema de Feature Flags</span></p><ul class="list" id="-1701825237#-ibv6bx_62" start="1"><li class="list-item" id="-1701825237#-ibv6bx_64"><p>Control din&aacute;mico de funcionalidades por ambiente</p></li><li class="list-item" id="-1701825237#-ibv6bx_65"><p>Configuraci&oacute;n sin deployments mediante Custom Metadata Types</p></li><li class="list-item" id="-1701825237#-ibv6bx_66"><p>Gesti&oacute;n granular de permisos por funcionalidad</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_24"><p id="-1701825237#-ibv6bx_67"><span class="control" id="-1701825237#-ibv6bx_69">Integraci&oacute;n con Vlocity</span></p><ul class="list" id="-1701825237#-ibv6bx_68" start="1"><li class="list-item" id="-1701825237#-ibv6bx_70"><p>Adaptadores espec&iacute;ficos para Integration Procedures</p></li><li class="list-item" id="-1701825237#-ibv6bx_71"><p>Reutilizaci&oacute;n del modelo est&aacute;ndar de Vlocity</p></li><li class="list-item" id="-1701825237#-ibv6bx_72"><p>Compatibilidad con Omnistudio y Salesforce Core</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_25"><p id="-1701825237#-ibv6bx_73"><span class="control" id="-1701825237#-ibv6bx_75">Empaquetamiento como Managed Package</span></p><ul class="list" id="-1701825237#-ibv6bx_74" start="1"><li class="list-item" id="-1701825237#-ibv6bx_76"><p>C&oacute;digo protegido y no modificable</p></li><li class="list-item" id="-1701825237#-ibv6bx_77"><p>Versionado controlado (inestables: 0.x.x-NEXT, estables: 1.x-x)</p></li><li class="list-item" id="-1701825237#-ibv6bx_78"><p>Distribuci&oacute;n centralizada a m&uacute;ltiples organizaciones</p></li><li class="list-item" id="-1701825237#-ibv6bx_79"><p>Actualizaciones controladas del framework</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_26"><p id="-1701825237#-ibv6bx_80"><span class="control" id="-1701825237#-ibv6bx_82">L&oacute;gica Avanzada de Integraciones</span></p><ul class="list" id="-1701825237#-ibv6bx_81" start="1"><li class="list-item" id="-1701825237#-ibv6bx_83"><p>Configuraci&oacute;n independiente por integraci&oacute;n</p></li><li class="list-item" id="-1701825237#-ibv6bx_84"><p>Sistema de reintentos configurable (Fijo, Incremental, Fibonacci)</p></li><li class="list-item" id="-1701825237#-ibv6bx_85"><p>Manejo de c&oacute;digos de respuesta espec&iacute;ficos (400, 404, 500, etc.)</p></li><li class="list-item" id="-1701825237#-ibv6bx_86"><p>Respeto a l&iacute;mites de gobierno de Salesforce (&lt; 10000ms total)</p></li></ul></li></ol></section><section><h3 id="-1701825237#productos-soportados" data-toc="productos-soportados#01 - Alcance y Limitaciones.md-productos-soportados">Productos Soportados</h3><ul class="list" id="-1701825237#-ibv6bx_87" start="1"><li class="list-item" id="-1701825237#-ibv6bx_88"><p><span class="control" id="-1701825237#-ibv6bx_92">Seguros de Motos</span> - Implementaci&oacute;n completa</p></li><li class="list-item" id="-1701825237#-ibv6bx_89"><p><span class="control" id="-1701825237#-ibv6bx_93">Seguros de Autos</span> - Implementaci&oacute;n completa</p></li><li class="list-item" id="-1701825237#-ibv6bx_90"><p><span class="control" id="-1701825237#-ibv6bx_94">Seguros de Viajes</span> - Base arquitect&oacute;nica preparada</p></li><li class="list-item" id="-1701825237#-ibv6bx_91"><p><span class="control" id="-1701825237#-ibv6bx_95">Arrendamiento</span> - Base arquitect&oacute;nica preparada</p></li></ul></section><section><h3 id="-1701825237#procesos-de-venta-cubiertos" data-toc="procesos-de-venta-cubiertos#01 - Alcance y Limitaciones.md-procesos-de-venta-cubiertos">Procesos de Venta Cubiertos</h3><ol class="list list-decimal" id="-1701825237#-ibv6bx_96" type="1" start="1"><li class="list-item" id="-1701825237#-ibv6bx_97"><p id="-1701825237#-ibv6bx_102"><span class="control" id="-1701825237#-ibv6bx_104">Conocimiento/Prospecci&oacute;n</span></p><ul class="list" id="-1701825237#-ibv6bx_103" start="1"><li class="list-item" id="-1701825237#-ibv6bx_105"><p>Gesti&oacute;n de Leads</p></li><li class="list-item" id="-1701825237#-ibv6bx_106"><p>Captura y validaci&oacute;n de datos iniciales</p></li><li class="list-item" id="-1701825237#-ibv6bx_107"><p>Integraciones con fuentes externas (RUNT, FASECOLDA)</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_98"><p id="-1701825237#-ibv6bx_108"><span class="control" id="-1701825237#-ibv6bx_110">Tarificaci&oacute;n</span></p><ul class="list" id="-1701825237#-ibv6bx_109" start="1"><li class="list-item" id="-1701825237#-ibv6bx_111"><p>C&aacute;lculos de pricing por producto</p></li><li class="list-item" id="-1701825237#-ibv6bx_112"><p>Configuraci&oacute;n flexible de planes y coberturas</p></li><li class="list-item" id="-1701825237#-ibv6bx_113"><p>Validaciones de riesgos consultables</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_99"><p id="-1701825237#-ibv6bx_114"><span class="control" id="-1701825237#-ibv6bx_116">Cotizaci&oacute;n</span></p><ul class="list" id="-1701825237#-ibv6bx_115" start="1"><li class="list-item" id="-1701825237#-ibv6bx_117"><p>Generaci&oacute;n de prepolizas</p></li><li class="list-item" id="-1701825237#-ibv6bx_118"><p>Gesti&oacute;n de numeraci&oacute;n autom&aacute;tica</p></li><li class="list-item" id="-1701825237#-ibv6bx_119"><p>C&aacute;lculos de ajustes y descuentos</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_100"><p id="-1701825237#-ibv6bx_120"><span class="control" id="-1701825237#-ibv6bx_122">Emisi&oacute;n</span></p><ul class="list" id="-1701825237#-ibv6bx_121" start="1"><li class="list-item" id="-1701825237#-ibv6bx_123"><p>Creaci&oacute;n de p&oacute;lizas definitivas</p></li><li class="list-item" id="-1701825237#-ibv6bx_124"><p>Integraci&oacute;n con sistemas de emisi&oacute;n</p></li><li class="list-item" id="-1701825237#-ibv6bx_125"><p>Notificaciones autom&aacute;ticas</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_101"><p id="-1701825237#-ibv6bx_126"><span class="control" id="-1701825237#-ibv6bx_128">Legalizaci&oacute;n</span></p><ul class="list" id="-1701825237#-ibv6bx_127" start="1"><li class="list-item" id="-1701825237#-ibv6bx_129"><p>Gesti&oacute;n de pagos y transacciones</p></li><li class="list-item" id="-1701825237#-ibv6bx_130"><p>Integraci&oacute;n con pasarelas de pago</p></li><li class="list-item" id="-1701825237#-ibv6bx_131"><p>Finalizaci&oacute;n del proceso de venta</p></li></ul></li></ol></section></section><section><h2 id="-1701825237#fuera-del-alcance" data-toc="fuera-del-alcance#01 - Alcance y Limitaciones.md-fuera-del-alcance">Fuera del Alcance</h2><section><h3 id="-1701825237#limitaciones-actuales" data-toc="limitaciones-actuales#01 - Alcance y Limitaciones.md-limitaciones-actuales">Limitaciones Actuales</h3><ol class="list list-decimal" id="-1701825237#-ibv6bx_134" type="1" start="1"><li class="list-item" id="-1701825237#-ibv6bx_135"><p id="-1701825237#-ibv6bx_140"><span class="control" id="-1701825237#-ibv6bx_142">Procesos Internos Espec&iacute;ficos de Productos</span></p><ul class="list" id="-1701825237#-ibv6bx_141" start="1"><li class="list-item" id="-1701825237#-ibv6bx_143"><p>El framework no desarrolla la l&oacute;gica de negocio espec&iacute;fica de cada producto</p></li><li class="list-item" id="-1701825237#-ibv6bx_144"><p>Solo proporciona la base arquitect&oacute;nica para integrarlos</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_136"><p id="-1701825237#-ibv6bx_145"><span class="control" id="-1701825237#-ibv6bx_147">Modificaci&oacute;n de Procesos Neur&aacute;lgicos</span></p><ul class="list" id="-1701825237#-ibv6bx_146" start="1"><li class="list-item" id="-1701825237#-ibv6bx_148"><p>Los procesos core de PreVenta no pueden ser duplicados o modificados</p></li><li class="list-item" id="-1701825237#-ibv6bx_149"><p>Implementaci&oacute;n obligatoria del modelo est&aacute;ndar de Vlocity</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_137"><p id="-1701825237#-ibv6bx_150"><span class="control" id="-1701825237#-ibv6bx_152">Productos No Incluidos</span></p><ul class="list" id="-1701825237#-ibv6bx_151" start="1"><li class="list-item" id="-1701825237#-ibv6bx_153"><p>Seguros de Vida</p></li><li class="list-item" id="-1701825237#-ibv6bx_154"><p>Seguros de Hogar</p></li><li class="list-item" id="-1701825237#-ibv6bx_155"><p>Seguros Empresariales</p></li><li class="list-item" id="-1701825237#-ibv6bx_156"><p>Otros productos fuera de la familia de Movilidad</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_138"><p id="-1701825237#-ibv6bx_157"><span class="control" id="-1701825237#-ibv6bx_159">Mejoras en L&oacute;gica Existente</span></p><ul class="list" id="-1701825237#-ibv6bx_158" start="1"><li class="list-item" id="-1701825237#-ibv6bx_160"><p>No se incluyen optimizaciones de procesos legacy</p></li><li class="list-item" id="-1701825237#-ibv6bx_161"><p>El enfoque es arquitect&oacute;nico, no funcional</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_139"><p id="-1701825237#-ibv6bx_162"><span class="control" id="-1701825237#-ibv6bx_164">Interfaces de Usuario</span></p><ul class="list" id="-1701825237#-ibv6bx_163" start="1"><li class="list-item" id="-1701825237#-ibv6bx_165"><p>No incluye componentes de frontend espec&iacute;ficos</p></li><li class="list-item" id="-1701825237#-ibv6bx_166"><p>Se enfoca en la capa de servicios y l&oacute;gica de negocio</p></li></ul></li></ol></section><section><h3 id="-1701825237#dependencias-externas" data-toc="dependencias-externas#01 - Alcance y Limitaciones.md-dependencias-externas">Dependencias Externas</h3><ol class="list list-decimal" id="-1701825237#-ibv6bx_167" type="1" start="1"><li class="list-item" id="-1701825237#-ibv6bx_168"><p id="-1701825237#-ibv6bx_171"><span class="control" id="-1701825237#-ibv6bx_173">Salesforce Platform</span></p><ul class="list" id="-1701825237#-ibv6bx_172" start="1"><li class="list-item" id="-1701825237#-ibv6bx_174"><p>Requiere Salesforce Enterprise o superior</p></li><li class="list-item" id="-1701825237#-ibv6bx_175"><p>Dependiente de l&iacute;mites de gobierno de la plataforma</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_169"><p id="-1701825237#-ibv6bx_176"><span class="control" id="-1701825237#-ibv6bx_178">Vlocity/OmniStudio</span></p><ul class="list" id="-1701825237#-ibv6bx_177" start="1"><li class="list-item" id="-1701825237#-ibv6bx_179"><p>Integraci&oacute;n obligatoria con Vlocity framework</p></li><li class="list-item" id="-1701825237#-ibv6bx_180"><p>Dependiente de versiones compatibles de OmniStudio</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_170"><p id="-1701825237#-ibv6bx_181"><span class="control" id="-1701825237#-ibv6bx_183">Sistemas Externos</span></p><ul class="list" id="-1701825237#-ibv6bx_182" start="1"><li class="list-item" id="-1701825237#-ibv6bx_184"><p>RUNT (Registro &Uacute;nico Nacional de Tr&aacute;nsito)</p></li><li class="list-item" id="-1701825237#-ibv6bx_185"><p>FASECOLDA (Federaci&oacute;n de Aseguradores Colombianos)</p></li><li class="list-item" id="-1701825237#-ibv6bx_186"><p>Sistemas de pagos y SARLAFT</p></li></ul></li></ol></section></section><section><h2 id="-1701825237#roadmap-de-implementaci-n" data-toc="roadmap-de-implementaci-n#01 - Alcance y Limitaciones.md-roadmap-de-implementaci-n">Roadmap de Implementaci&oacute;n</h2><section><h3 id="-1701825237#fase-1-foundation-core-completada" data-toc="fase-1-foundation-core-completada#01 - Alcance y Limitaciones.md-fase-1-foundation-core-completada">Fase 1: Foundation Core (Completada)</h3><ul class="list" id="-1701825237#-ibv6bx_191" start="1"><li class="list-item" id="-1701825237#-ibv6bx_192"><p>✅ Implementaci&oacute;n de patrones base</p></li><li class="list-item" id="-1701825237#-ibv6bx_193"><p>✅ Managed Package inicial</p></li><li class="list-item" id="-1701825237#-ibv6bx_194"><p>✅ Procesos para Motos y Autos</p></li></ul></section><section><h3 id="-1701825237#fase-2-expansi-n-de-productos" data-toc="fase-2-expansi-n-de-productos#01 - Alcance y Limitaciones.md-fase-2-expansi-n-de-productos">Fase 2: Expansi&oacute;n de Productos</h3><ul class="list" id="-1701825237#-ibv6bx_195" start="1"><li class="list-item" id="-1701825237#-ibv6bx_196"><p>🔄 Implementaci&oacute;n para Seguros de Viajes</p></li><li class="list-item" id="-1701825237#-ibv6bx_197"><p>🔄 Implementaci&oacute;n para Arrendamiento</p></li><li class="list-item" id="-1701825237#-ibv6bx_198"><p>🔄 Optimizaci&oacute;n de performance</p></li></ul></section><section><h3 id="-1701825237#fase-3-funcionalidades-avanzadas" data-toc="fase-3-funcionalidades-avanzadas#01 - Alcance y Limitaciones.md-fase-3-funcionalidades-avanzadas">Fase 3: Funcionalidades Avanzadas</h3><ul class="list" id="-1701825237#-ibv6bx_199" start="1"><li class="list-item" id="-1701825237#-ibv6bx_200"><p>⏳ Dashboard de monitoreo en tiempo real</p></li><li class="list-item" id="-1701825237#-ibv6bx_201"><p>⏳ Analytics de performance por proceso</p></li><li class="list-item" id="-1701825237#-ibv6bx_202"><p>⏳ Integraci&oacute;n con herramientas de CI/CD</p></li></ul></section><section><h3 id="-1701825237#fase-4-escalabilidad" data-toc="fase-4-escalabilidad#01 - Alcance y Limitaciones.md-fase-4-escalabilidad">Fase 4: Escalabilidad</h3><ul class="list" id="-1701825237#-ibv6bx_203" start="1"><li class="list-item" id="-1701825237#-ibv6bx_204"><p>⏳ Soporte para nuevas familias de productos</p></li><li class="list-item" id="-1701825237#-ibv6bx_205"><p>⏳ Integraci&oacute;n con sistemas de terceros</p></li><li class="list-item" id="-1701825237#-ibv6bx_206"><p>⏳ Arquitectura multi-tenant avanzada</p></li></ul></section></section><section><h2 id="-1701825237#retos-a-afrontar" data-toc="retos-a-afrontar#01 - Alcance y Limitaciones.md-retos-a-afrontar">Retos a Afrontar</h2><section><h3 id="-1701825237#t-cnicos" data-toc="t-cnicos#01 - Alcance y Limitaciones.md-t-cnicos">T&eacute;cnicos</h3><ol class="list list-decimal" id="-1701825237#-ibv6bx_209" type="1" start="1"><li class="list-item" id="-1701825237#-ibv6bx_210"><p id="-1701825237#-ibv6bx_213"><span class="control" id="-1701825237#-ibv6bx_215">Mantenimiento del Core</span></p><ul class="list" id="-1701825237#-ibv6bx_214" start="1"><li class="list-item" id="-1701825237#-ibv6bx_216"><p>Evoluci&oacute;n continua del framework base</p></li><li class="list-item" id="-1701825237#-ibv6bx_217"><p>Compatibilidad con nuevas versiones de Salesforce/Vlocity</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_211"><p id="-1701825237#-ibv6bx_218"><span class="control" id="-1701825237#-ibv6bx_220">Migraci&oacute;n de Productos Existentes</span></p><ul class="list" id="-1701825237#-ibv6bx_219" start="1"><li class="list-item" id="-1701825237#-ibv6bx_221"><p>Implementaci&oacute;n del nuevo enfoque en productos actuales</p></li><li class="list-item" id="-1701825237#-ibv6bx_222"><p>Minimizaci&oacute;n del impacto en procesos en producci&oacute;n</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_212"><p id="-1701825237#-ibv6bx_223"><span class="control" id="-1701825237#-ibv6bx_225">Gesti&oacute;n de Versiones</span></p><ul class="list" id="-1701825237#-ibv6bx_224" start="1"><li class="list-item" id="-1701825237#-ibv6bx_226"><p>Mantenimiento de m&uacute;ltiples versiones del package</p></li><li class="list-item" id="-1701825237#-ibv6bx_227"><p>Estrategia de deprecaci&oacute;n de versiones antiguas</p></li></ul></li></ol></section><section><h3 id="-1701825237#organizacionales" data-toc="organizacionales#01 - Alcance y Limitaciones.md-organizacionales">Organizacionales</h3><ol class="list list-decimal" id="-1701825237#-ibv6bx_228" type="1" start="1"><li class="list-item" id="-1701825237#-ibv6bx_229"><p id="-1701825237#-ibv6bx_232"><span class="control" id="-1701825237#-ibv6bx_234">Cambio de Mentalidad</span></p><ul class="list" id="-1701825237#-ibv6bx_233" start="1"><li class="list-item" id="-1701825237#-ibv6bx_235"><p>Adopci&oacute;n del nuevo modelo de desarrollo</p></li><li class="list-item" id="-1701825237#-ibv6bx_236"><p>Capacitaci&oacute;n en patrones de dise&ntilde;o y mejores pr&aacute;cticas</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_230"><p id="-1701825237#-ibv6bx_237"><span class="control" id="-1701825237#-ibv6bx_239">Coordinaci&oacute;n entre Equipos</span></p><ul class="list" id="-1701825237#-ibv6bx_238" start="1"><li class="list-item" id="-1701825237#-ibv6bx_240"><p>Sincronizaci&oacute;n entre equipos de diferentes productos</p></li><li class="list-item" id="-1701825237#-ibv6bx_241"><p>Establecimiento de est&aacute;ndares de desarrollo</p></li></ul></li><li class="list-item" id="-1701825237#-ibv6bx_231"><p id="-1701825237#-ibv6bx_242"><span class="control" id="-1701825237#-ibv6bx_244">Puntos de Integraci&oacute;n</span></p><ul class="list" id="-1701825237#-ibv6bx_243" start="1"><li class="list-item" id="-1701825237#-ibv6bx_245"><p>Mantenimiento de interfaces con sistemas externos</p></li><li class="list-item" id="-1701825237#-ibv6bx_246"><p>Gesti&oacute;n de dependencias entre componentes</p></li></ul></li></ol></section></section><section><h2 id="-1701825237#beneficios-esperados" data-toc="beneficios-esperados#01 - Alcance y Limitaciones.md-beneficios-esperados">Beneficios Esperados</h2><section><h3 id="-1701825237#t-cnicos" data-toc="t-cnicos#01 - Alcance y Limitaciones.md-t-cnicos">T&eacute;cnicos</h3><ul class="list" id="-1701825237#-ibv6bx_250" start="1"><li class="list-item" id="-1701825237#-ibv6bx_251"><p><span class="control" id="-1701825237#-ibv6bx_256">Separaci&oacute;n l&oacute;gica clara</span> entre procesos de diferentes productos</p></li><li class="list-item" id="-1701825237#-ibv6bx_252"><p><span class="control" id="-1701825237#-ibv6bx_257">Facilidad para incluir nuevos productos</span> y procesos</p></li><li class="list-item" id="-1701825237#-ibv6bx_253"><p><span class="control" id="-1701825237#-ibv6bx_258">Versionado y obsolescencia controlada</span> de componentes</p></li><li class="list-item" id="-1701825237#-ibv6bx_254"><p><span class="control" id="-1701825237#-ibv6bx_259">Mejoras en el manejo de eventos</span> y notificaciones</p></li><li class="list-item" id="-1701825237#-ibv6bx_255"><p><span class="control" id="-1701825237#-ibv6bx_260">Independencia l&oacute;gica</span> entre productos</p></li></ul></section><section><h3 id="-1701825237#operacionales" data-toc="operacionales#01 - Alcance y Limitaciones.md-operacionales">Operacionales</h3><ul class="list" id="-1701825237#-ibv6bx_261" start="1"><li class="list-item" id="-1701825237#-ibv6bx_262"><p><span class="control" id="-1701825237#-ibv6bx_266">Distribuci&oacute;n controlada</span> mediante managed packages</p></li><li class="list-item" id="-1701825237#-ibv6bx_263"><p><span class="control" id="-1701825237#-ibv6bx_267">Disponibilidad desde Salesforce Core y Omnistudio</span></p></li><li class="list-item" id="-1701825237#-ibv6bx_264"><p><span class="control" id="-1701825237#-ibv6bx_268">Capacidad de medir desempe&ntilde;o</span> real por proceso</p></li><li class="list-item" id="-1701825237#-ibv6bx_265"><p><span class="control" id="-1701825237#-ibv6bx_269">M&uacute;ltiples l&oacute;gicas simult&aacute;neas</span> de tarificaci&oacute;n, cotizaci&oacute;n y emisi&oacute;n</p></li></ul></section><section><h3 id="-1701825237#estrat-gicos" data-toc="estrat-gicos#01 - Alcance y Limitaciones.md-estrat-gicos">Estrat&eacute;gicos</h3><ul class="list" id="-1701825237#-ibv6bx_270" start="1"><li class="list-item" id="-1701825237#-ibv6bx_271"><p><span class="control" id="-1701825237#-ibv6bx_275">Base escalable</span> para futuros productos</p></li><li class="list-item" id="-1701825237#-ibv6bx_272"><p><span class="control" id="-1701825237#-ibv6bx_276">Arquitectura enterprise</span> robusta y mantenible</p></li><li class="list-item" id="-1701825237#-ibv6bx_273"><p><span class="control" id="-1701825237#-ibv6bx_277">Reducci&oacute;n de riesgos</span> por acoplamiento de c&oacute;digo</p></li><li class="list-item" id="-1701825237#-ibv6bx_274"><p><span class="control" id="-1701825237#-ibv6bx_278">Velocidad de implementaci&oacute;n</span> de nuevos productos</p></li></ul></section></section><section><h2 id="-1701825237#consideraciones-de-implementaci-n" data-toc="consideraciones-de-implementaci-n#01 - Alcance y Limitaciones.md-consideraciones-de-implementaci-n">Consideraciones de Implementaci&oacute;n</h2><section><h3 id="-1701825237#prerrequisitos" data-toc="prerrequisitos#01 - Alcance y Limitaciones.md-prerrequisitos">Prerrequisitos</h3><ul class="list" id="-1701825237#-ibv6bx_282" start="1"><li class="list-item" id="-1701825237#-ibv6bx_283"><p>Salesforce Enterprise Edition o superior</p></li><li class="list-item" id="-1701825237#-ibv6bx_284"><p>Vlocity Industries CPQ instalado</p></li><li class="list-item" id="-1701825237#-ibv6bx_285"><p>Permisos de instalaci&oacute;n de managed packages</p></li><li class="list-item" id="-1701825237#-ibv6bx_286"><p>Configuraci&oacute;n de Named Credentials para integraciones</p></li></ul></section><section><h3 id="-1701825237#recursos-requeridos" data-toc="recursos-requeridos#01 - Alcance y Limitaciones.md-recursos-requeridos">Recursos Requeridos</h3><ul class="list" id="-1701825237#-ibv6bx_287" start="1"><li class="list-item" id="-1701825237#-ibv6bx_288"><p>Desarrolladores con experiencia en Salesforce y Vlocity</p></li><li class="list-item" id="-1701825237#-ibv6bx_289"><p>Arquitectos familiarizados con patrones de dise&ntilde;o</p></li><li class="list-item" id="-1701825237#-ibv6bx_290"><p>Administradores para configuraci&oacute;n de procesos</p></li><li class="list-item" id="-1701825237#-ibv6bx_291"><p>Equipo de QA para validaci&oacute;n de integraciones</p></li></ul></section><section><h3 id="-1701825237#m-tricas-de-xito" data-toc="m-tricas-de-xito#01 - Alcance y Limitaciones.md-m-tricas-de-xito">M&eacute;tricas de &Eacute;xito</h3><ul class="list" id="-1701825237#-ibv6bx_292" start="1"><li class="list-item" id="-1701825237#-ibv6bx_295"><p>Reducci&oacute;n en tiempo de implementaci&oacute;n de nuevos productos</p></li><li class="list-item" id="-1701825237#-ibv6bx_296"><p>Mejora en la estabilidad de procesos existentes</p></li><li class="list-item" id="-1701825237#-ibv6bx_297"><p>Disminuci&oacute;n de incidentes por acoplamiento de c&oacute;digo</p></li><li class="list-item" id="-1701825237#-ibv6bx_298"><p>Aumento en la velocidad de resoluci&oacute;n de issues</p></li></ul><p id="-1701825237#-ibv6bx_294"><span class="control" id="-1701825237#-ibv6bx_299">Fecha de &Uacute;ltima Actualizaci&oacute;n:</span> Mayo 2025<span class="control" id="-1701825237#-ibv6bx_301">Versi&oacute;n del Documento:</span> 1.0<span class="control" id="-1701825237#-ibv6bx_303">Responsables:</span> Soulberto Lorenzo, Jean Carlos Melendez</p></section></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="2007547606">Arquitectura General - SURA Foundation Framework</h1><section><h2 id="2007547606#resumen-ejecutivo" data-toc="resumen-ejecutivo#Arquitectura General.md-resumen-ejecutivo">Resumen Ejecutivo</h2><p id="2007547606#-axwvfu_16"><span class="control" id="2007547606#-axwvfu_18">SURA Foundation</span> es un framework de procesamiento centralizado dise&ntilde;ado como un <span class="control" id="2007547606#-axwvfu_19">Managed Package</span> de Salesforce que proporciona una arquitectura modular y escalable para los procesos de venta de seguros. El framework implementa patrones de dise&ntilde;o enterprise para garantizar la separaci&oacute;n l&oacute;gica, reutilizaci&oacute;n de componentes y facilitar el mantenimiento de m&uacute;ltiples productos de seguros.</p></section><section><h2 id="2007547606#visi-n-arquitect-nica" data-toc="visi-n-arquitect-nica#Arquitectura General.md-visi-n-arquitect-nica">🏗️ Visi&oacute;n Arquitect&oacute;nica</h2><section><h3 id="2007547606#concepto-central-suratech-core" data-toc="concepto-central-suratech-core#Arquitectura General.md-concepto-central-suratech-core">Concepto Central: Suratech Core</h3><p id="2007547606#-axwvfu_21">El coraz&oacute;n del framework es <span class="control" id="2007547606#-axwvfu_25">Suratech Core</span>, un managed package que encapsula:</p><ul class="list" id="2007547606#-axwvfu_22" start="1"><li class="list-item" id="2007547606#-axwvfu_26"><p>L&oacute;gica de negocio com&uacute;n a todos los productos</p></li><li class="list-item" id="2007547606#-axwvfu_27"><p>Patrones de procesamiento estandarizados</p></li><li class="list-item" id="2007547606#-axwvfu_28"><p>Interfaces de integraci&oacute;n con sistemas externos</p></li><li class="list-item" id="2007547606#-axwvfu_29"><p>Componentes reutilizables para el ciclo de vida de ventas</p></li></ul><div class="detached code-block" id="2007547606#-axwvfu_23"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────┐
│                    SURATECH CORE                           │
│                 (Managed Package)                          │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌────────┐ │
│  │   MOTOS     │ │    AUTOS    │ │   VIAJES    │ │  LEASE │ │
│  │   Handler   │ │   Handler   │ │   Handler   │ │Handler │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └────────┘ │
└─────────────────────────────────────────────────────────────┘</code></pre></div></section></section><section><h2 id="2007547606#evoluci-n-arquitect-nica" data-toc="evoluci-n-arquitect-nica#Arquitectura General.md-evoluci-n-arquitect-nica">🔄 Evoluci&oacute;n Arquitect&oacute;nica</h2><section><h3 id="2007547606#arquitectura-actual-problem-tica" data-toc="arquitectura-actual-problem-tica#Arquitectura General.md-arquitectura-actual-problem-tica">Arquitectura Actual (Problem&aacute;tica)</h3><p id="2007547606#-axwvfu_32"><span class="control" id="2007547606#-axwvfu_35">Problemas Identificados:</span></p><ul class="list" id="2007547606#-axwvfu_33" start="1"><li class="list-item" id="2007547606#-axwvfu_36"><p>C&oacute;digo h&iacute;brido compartido entre m&uacute;ltiples productos</p></li><li class="list-item" id="2007547606#-axwvfu_37"><p>L&oacute;gica mezclada sin separaci&oacute;n clara</p></li><li class="list-item" id="2007547606#-axwvfu_38"><p>Modificaciones por diferentes c&eacute;lulas sin control</p></li><li class="list-item" id="2007547606#-axwvfu_39"><p>Imposibilidad de medir desempe&ntilde;o individual</p></li><li class="list-item" id="2007547606#-axwvfu_40"><p>Dif&iacute;cil mantenimiento y extensibilidad</p></li><li class="list-item" id="2007547606#-axwvfu_41"><p>Responsabilidades no definidas por producto</p></li></ul><div class="detached code-block" id="2007547606#-axwvfu_34"><pre><code class="language-none">┌───────────────────────────────────────────────────────────┐
│        ARQUITECTURA MONOLÍTICA ACTUAL                    │
│                                                           │
│  ◆────▢────◆────▢────◆────▢                             │
│   │    │    │    │    │    │                             │
│   ▼    ▲    ▼    ▲    ▼    ▲                             │
│  ▢────▢────▢────▢────▢────▢                              │
│                                                           │
│  ⚠️ Código compartido y mezclado                          │
│  ⚠️ Sin separación de responsabilidades                   │
└───────────────────────────────────────────────────────────┘</code></pre></div></section><section><h3 id="2007547606#nueva-arquitectura-soluci-n" data-toc="nueva-arquitectura-soluci-n#Arquitectura General.md-nueva-arquitectura-soluci-n">Nueva Arquitectura (Soluci&oacute;n)</h3><p id="2007547606#-axwvfu_42"><span class="control" id="2007547606#-axwvfu_46">Beneficios del Nuevo Enfoque:</span></p><ul class="list" id="2007547606#-axwvfu_43" start="1"><li class="list-item" id="2007547606#-axwvfu_47"><p>Separaci&oacute;n l&oacute;gica clara por proceso y producto</p></li><li class="list-item" id="2007547606#-axwvfu_48"><p>Componentes encapsulados y reutilizables</p></li><li class="list-item" id="2007547606#-axwvfu_49"><p>Facilidad para agregar nuevos productos</p></li><li class="list-item" id="2007547606#-axwvfu_50"><p>Medici&oacute;n individual de desempe&ntilde;o</p></li><li class="list-item" id="2007547606#-axwvfu_51"><p>Versionado y distribuci&oacute;n controlada</p></li></ul><div class="detached code-block" id="2007547606#-axwvfu_44"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────┐
│                 NUEVA ARQUITECTURA                          │
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │   PROCESO   │    │   PROCESO   │    │   PROCESO   │     │
│  │   MOTOS     │    │    AUTOS    │    │   VIAJES    │     │
│  │             │    │             │    │             │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
│          │                  │                  │           │
│          └──────────────────┼──────────────────┘           │
│                             │                              │
│           ┌─────────────────▼─────────────────┐            │
│           │         SURATECH CORE             │            │
│           │      (Managed Package)            │            │
│           └───────────────────────────────────┘            │
└─────────────────────────────────────────────────────────────┘</code></pre></div></section></section><section><h2 id="2007547606#estructura-de-procesamiento" data-toc="estructura-de-procesamiento#Arquitectura General.md-estructura-de-procesamiento">🔧 Estructura de Procesamiento</h2><section><h3 id="2007547606#modelo-pre-in-pos" data-toc="modelo-pre-in-pos#Arquitectura General.md-modelo-pre-in-pos">Modelo Pre-In-Pos</h3><p id="2007547606#-axwvfu_53">El framework implementa un modelo de procesamiento en tres fases para cada etapa del flujo de ventas:</p><div class="detached code-block" id="2007547606#-axwvfu_54"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────────┐
│                    FLUJO DE PROCESAMIENTO                       │
│                                                                 │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐                     │
│  │   PRE   │    │   IN    │    │   POS   │                     │
│  │         │    │         │    │         │                     │
│  │ ◆────▢  │    │ ◆────▢  │    │ ◆────▢  │                     │
│  │  │   │  │    │  │   │  │    │  │   │  │                     │
│  │  ▼   ▲  │    │  ▼   ▲  │    │  ▼   ▲  │                     │
│  │ ▢────▢  │    │ ▢────▢  │    │ ▢────▢  │                     │
│  └─────────┘    └─────────┘    └─────────┘                     │
│       │              │              │                         │
│       ▼              ▼              ▼                         │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐                     │
│  │Observer │    │Observer │    │Observer │                     │
│  └─────────┘    └─────────┘    └─────────┘                     │
│       │              │              │                         │
│       ▼              ▼              ▼                         │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐                     │
│  │Platform │    │Platform │    │Platform │                     │
│  │ Event   │    │ Event   │    │ Event   │                     │
│  └─────────┘    └─────────┘    └─────────┘                     │
│                       │                                        │
│                       ▼                                        │
│                ┌─────────────┐                                 │
│                │Service      │                                 │
│                │Callout      │                                 │
│                └─────────────┘                                 │
└─────────────────────────────────────────────────────────────────┘</code></pre></div><section><h4 id="2007547606#fases-de-procesamiento" data-toc="fases-de-procesamiento#Arquitectura General.md-fases-de-procesamiento">Fases de Procesamiento:</h4><ol class="list list-decimal" id="2007547606#-axwvfu_57" type="1" start="1"><li class="list-item" id="2007547606#-axwvfu_58"><p><span class="control" id="2007547606#-axwvfu_61">PRE</span>: Validaciones y preparaci&oacute;n de datos</p></li><li class="list-item" id="2007547606#-axwvfu_59"><p><span class="control" id="2007547606#-axwvfu_62">IN</span>: L&oacute;gica de negocio principal</p></li><li class="list-item" id="2007547606#-axwvfu_60"><p><span class="control" id="2007547606#-axwvfu_63">POS</span>: Notificaciones y procesos posteriores</p></li></ol></section><section><h4 id="2007547606#componentes-de-integraci-n" data-toc="componentes-de-integraci-n#Arquitectura General.md-componentes-de-integraci-n">Componentes de Integraci&oacute;n:</h4><ul class="list" id="2007547606#-axwvfu_64" start="1"><li class="list-item" id="2007547606#-axwvfu_66"><p><span class="control" id="2007547606#-axwvfu_69">Observer</span>: Monitoreo de eventos en cada fase</p></li><li class="list-item" id="2007547606#-axwvfu_67"><p><span class="control" id="2007547606#-axwvfu_70">Platform Events</span>: Comunicaci&oacute;n as&iacute;ncrona entre componentes</p></li><li class="list-item" id="2007547606#-axwvfu_68"><p><span class="control" id="2007547606#-axwvfu_71">Service Callout</span>: Integraci&oacute;n con servicios externos</p></li></ul></section></section></section><section><h2 id="2007547606#arquitectura-de-componentes" data-toc="arquitectura-de-componentes#Arquitectura General.md-arquitectura-de-componentes">📦 Arquitectura de Componentes</h2><section><h3 id="2007547606#artefactos-principales-por-proceso" data-toc="artefactos-principales-por-proceso#Arquitectura General.md-artefactos-principales-por-proceso">Artefactos Principales por Proceso</h3><section><h4 id="2007547606#1-conocimiento-lead-management" data-toc="1-conocimiento-lead-management#Arquitectura General.md-1-conocimiento-lead-management">1. Conocimiento (Lead Management)</h4><div class="detached code-block" id="2007547606#-axwvfu_78"><pre><code class="language-none">┌─────────────────────────┐
│     CONOCIMIENTO        │
├─────────────────────────┤
│ • LeadManager           │
│ • SURA_ConsultarVehiculo│
│ • SURA_ConsultaFasecolda│
│ • SURA_RiesgosConsultables│
└─────────────────────────┘</code></pre></div></section><section><h4 id="2007547606#2-tarificaci-n-pricing" data-toc="2-tarificaci-n-pricing#Arquitectura General.md-2-tarificaci-n-pricing">2. Tarificaci&oacute;n (Pricing)</h4><div class="detached code-block" id="2007547606#-axwvfu_79"><pre><code class="language-none">┌─────────────────────────┐
│     TARIFICACIÓN        │
├─────────────────────────┤
│ • RateProductHandler    │
│ • PricingEngine         │
│ • ValidationComponents  │
└─────────────────────────┘</code></pre></div></section><section><h4 id="2007547606#3-cotizaci-n-quoting" data-toc="3-cotizaci-n-quoting#Arquitectura General.md-3-cotizaci-n-quoting">3. Cotizaci&oacute;n (Quoting)</h4><div class="detached code-block" id="2007547606#-axwvfu_80"><pre><code class="language-none">┌─────────────────────────┐
│      COTIZACIÓN         │
├─────────────────────────┤
│ • SURACrearNumeroPrepoliza│
│ • SURAQuotePricingAdjustmentTrigger│
│ • SURAPaymentManager    │
│ • QuoteManager          │
│ • PAGOS_GenerarUrlPago  │
│ • CCM_EnviarBienvenida  │
│ • PAGOS_ValidacionSARLAFT│
└─────────────────────────┘</code></pre></div></section><section><h4 id="2007547606#4-emisi-n-issuance" data-toc="4-emisi-n-issuance#Arquitectura General.md-4-emisi-n-issuance">4. Emisi&oacute;n (Issuance)</h4><div class="detached code-block" id="2007547606#-axwvfu_81"><pre><code class="language-none">┌─────────────────────────┐
│       EMISIÓN           │
├─────────────────────────┤
│ • SURANotificatorToExternalServices│
│ • SURAHomologacionPreEmision│
│ • InsurancePolicyManager│
│ • SURAAccountManager    │
│ • SURAOpportunityManager│
└─────────────────────────┘</code></pre></div></section><section><h4 id="2007547606#5-legalizaci-n-legalization" data-toc="5-legalizaci-n-legalization#Arquitectura General.md-5-legalizaci-n-legalization">5. Legalizaci&oacute;n (Legalization)</h4><div class="detached code-block" id="2007547606#-axwvfu_82"><pre><code class="language-none">┌─────────────────────────┐
│     LEGALIZACIÓN        │
├─────────────────────────┤
│ • SURAInvoiceListeningServiceV1│
│ • InsurancePolicyTransactionServicesV1│
│ • InsurancePolicyTransactionManager│
└─────────────────────────┘</code></pre></div></section></section></section><section><h2 id="2007547606#patrones-de-dise-o-implementados" data-toc="patrones-de-dise-o-implementados#Arquitectura General.md-patrones-de-dise-o-implementados">🎯 Patrones de Dise&ntilde;o Implementados</h2><section><h3 id="2007547606#1-chain-of-responsibility-cadena-de-responsabilidad" data-toc="1-chain-of-responsibility-cadena-de-responsabilidad#Arquitectura General.md-1-chain-of-responsibility-cadena-de-responsabilidad">1. Chain of Responsibility (Cadena de Responsabilidad)</h3><div class="detached code-block" id="2007547606#-axwvfu_88"><pre><code class="language-none">Request ──┬──&gt; [Motos Handler] ──┬──&gt; [Autos Handler] ──┬──&gt; [Viajes Handler]
          │                     │                     │
          ▼                     ▼                     ▼
       ☹️ Reject              ☹️ Reject              ✅ Process</code></pre></div><p id="2007547606#-axwvfu_89"><span class="control" id="2007547606#-axwvfu_91">Aplicaci&oacute;n:</span></p><ul class="list" id="2007547606#-axwvfu_90" start="1"><li class="list-item" id="2007547606#-axwvfu_92"><p>Procesamiento secuencial por tipo de producto</p></li><li class="list-item" id="2007547606#-axwvfu_93"><p>Cada handler determina si puede procesar la solicitud</p></li><li class="list-item" id="2007547606#-axwvfu_94"><p>Si no puede, la pasa al siguiente en la cadena</p></li></ul></section><section><h3 id="2007547606#2-observer-pattern-observador" data-toc="2-observer-pattern-observador#Arquitectura General.md-2-observer-pattern-observador">2. Observer Pattern (Observador)</h3><div class="detached code-block" id="2007547606#-axwvfu_95"><pre><code class="language-none">┌─────────────┐    notify    ┌─────────────┐
│   Subject   │ ─────────────&gt;│  Observer   │
│ (Process)   │              │ (Listener)  │
└─────────────┘              └─────────────┘
      │                            │
      │                            ▼
      │                    ┌─────────────┐
      │                    │Platform     │
      └────────────────────&gt;│Event        │
                           └─────────────┘</code></pre></div><p id="2007547606#-axwvfu_96"><span class="control" id="2007547606#-axwvfu_98">Aplicaci&oacute;n:</span></p><ul class="list" id="2007547606#-axwvfu_97" start="1"><li class="list-item" id="2007547606#-axwvfu_99"><p>Monitoreo de cambios en procesos de negocio</p></li><li class="list-item" id="2007547606#-axwvfu_100"><p>Desacoplamiento entre emisores y receptores de eventos</p></li><li class="list-item" id="2007547606#-axwvfu_101"><p>Notificaciones autom&aacute;ticas de estados</p></li></ul></section><section><h3 id="2007547606#3-adapter-pattern-adaptador" data-toc="3-adapter-pattern-adaptador#Arquitectura General.md-3-adapter-pattern-adaptador">3. Adapter Pattern (Adaptador)</h3><div class="detached code-block" id="2007547606#-axwvfu_102"><pre><code class="language-none">┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Client    │───&gt;│   Adapter   │───&gt;│   Vlocity   │
│ (Foundation)│    │  Interface  │    │   Service   │
└─────────────┘    └─────────────┘    └─────────────┘</code></pre></div><p id="2007547606#-axwvfu_103"><span class="control" id="2007547606#-axwvfu_105">Aplicaci&oacute;n:</span></p><ul class="list" id="2007547606#-axwvfu_104" start="1"><li class="list-item" id="2007547606#-axwvfu_106"><p>Integraci&oacute;n transparente con Vlocity/OmniStudio</p></li><li class="list-item" id="2007547606#-axwvfu_107"><p>Abstracci&oacute;n de servicios externos</p></li><li class="list-item" id="2007547606#-axwvfu_108"><p>Reutilizaci&oacute;n de componentes existentes</p></li></ul></section><section><h3 id="2007547606#4-template-method-m-todo-plantilla" data-toc="4-template-method-m-todo-plantilla#Arquitectura General.md-4-template-method-m-todo-plantilla">4. Template Method (M&eacute;todo Plantilla)</h3><div class="detached code-block" id="2007547606#-axwvfu_109"><pre><code class="language-none">┌─────────────────────────┐
│   ProductHandler        │
│                         │
│ ┌─────────────────────┐ │
│ │    OnPre()          │ │ ◄── Virtual
│ │    (Virtual)        │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │    Process()        │ │ ◄── Encapsulated
│ │  (Encapsulated)     │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │    OnPos()          │ │ ◄── Virtual
│ │    (Virtual)        │ │
│ └─────────────────────┘ │
└─────────────────────────┘</code></pre></div><p id="2007547606#-axwvfu_110"><span class="control" id="2007547606#-axwvfu_113">Aplicaci&oacute;n:</span></p><ul class="list" id="2007547606#-axwvfu_111" start="1"><li class="list-item" id="2007547606#-axwvfu_114"><p>Estructura com&uacute;n para todos los handlers de producto</p></li><li class="list-item" id="2007547606#-axwvfu_115"><p>Puntos de extensi&oacute;n predefinidos (OnPre, OnPos)</p></li><li class="list-item" id="2007547606#-axwvfu_116"><p>L&oacute;gica core protegida y reutilizable</p></li></ul></section></section><section><h2 id="2007547606#integraci-n-con-ecosistema-salesforce" data-toc="integraci-n-con-ecosistema-salesforce#Arquitectura General.md-integraci-n-con-ecosistema-salesforce">🔗 Integraci&oacute;n con Ecosistema Salesforce</h2><section><h3 id="2007547606#vlocity-omnistudio-integration" data-toc="vlocity-omnistudio-integration#Arquitectura General.md-vlocity-omnistudio-integration">Vlocity/OmniStudio Integration</h3><div class="detached code-block" id="2007547606#-axwvfu_119"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────┐
│                    SALESFORCE ORG                          │
│                                                             │
│  ┌─────────────────┐    ┌─────────────────────────────────┐ │
│  │   VLOCITY/      │    │      SURA FOUNDATION            │ │
│  │   OMNISTUDIO    │◄──►│     (Managed Package)           │ │
│  │                 │    │                                 │ │
│  │ • Integration   │    │ • Adapters                      │ │
│  │   Procedures    │    │ • Process Handlers              │ │
│  │ • DataRaptors   │    │ • Event Management              │ │
│  │ • FlexCards     │    │ • External Integrations        │ │
│  └─────────────────┘    └─────────────────────────────────┘ │
│           │                           │                     │
│           └───────────────┬───────────┘                     │
│                           │                                 │
│  ┌─────────────────────────▼─────────────────────────────┐   │
│  │            SALESFORCE CORE                           │   │
│  │                                                      │   │
│  │ • Custom Objects     • Platform Events              │   │
│  │ • Custom Metadata    • Integration APIs              │   │
│  │ • Triggers           • Security Model                │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘</code></pre></div></section><section><h3 id="2007547606#puntos-de-integraci-n" data-toc="puntos-de-integraci-n#Arquitectura General.md-puntos-de-integraci-n">Puntos de Integraci&oacute;n:</h3><ol class="list list-decimal" id="2007547606#-axwvfu_120" type="1" start="1"><li class="list-item" id="2007547606#-axwvfu_122"><p><span class="control" id="2007547606#-axwvfu_126">Integration Procedures</span>: Llamadas desde Vlocity hacia Foundation</p></li><li class="list-item" id="2007547606#-axwvfu_123"><p><span class="control" id="2007547606#-axwvfu_127">Platform Events</span>: Comunicaci&oacute;n as&iacute;ncrona bidireccional</p></li><li class="list-item" id="2007547606#-axwvfu_124"><p><span class="control" id="2007547606#-axwvfu_128">Custom Metadata Types</span>: Configuraci&oacute;n compartida</p></li><li class="list-item" id="2007547606#-axwvfu_125"><p><span class="control" id="2007547606#-axwvfu_129">Apex Classes</span>: L&oacute;gica de negocio expuesta via interfaces</p></li></ol></section></section><section><h2 id="2007547606#arquitectura-de-datos" data-toc="arquitectura-de-datos#Arquitectura General.md-arquitectura-de-datos">📊 Arquitectura de Datos</h2><section><h3 id="2007547606#modelo-de-metadatos" data-toc="modelo-de-metadatos#Arquitectura General.md-modelo-de-metadatos">Modelo de Metadatos</h3><div class="detached code-block" id="2007547606#-axwvfu_131"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────┐
│                 FOUNDATION METADATA                         │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │  Process Config │  │  Feature Flags  │                  │
│  │                 │  │                 │                  │
│  │ • Product       │  │ • Feature Name  │                  │
│  │ • Stage         │  │ • Enabled       │                  │
│  │ • Handler Class │  │ • Environment   │                  │
│  │ • Active        │  │ • Scope         │                  │
│  └─────────────────┘  └─────────────────┘                  │
│           │                     │                          │
│           └─────────────────────┼──────────────────────────┘
│                                 │                          
│  ┌─────────────────┐  ┌─────────▼───────┐                  │
│  │ Integration     │  │  Event Log      │                  │
│  │ Settings        │  │  Configuration  │                  │
│  │                 │  │                 │                  │
│  │ • Endpoint      │  │ • Log Level     │                  │
│  │ • Timeout       │  │ • Retention     │                  │
│  │ • Retry Policy  │  │ • Categories    │                  │
│  │ • Auth Method   │  │ • Cleanup Rules │                  │
│  └─────────────────┘  └─────────────────┘                  │
└─────────────────────────────────────────────────────────────┘</code></pre></div></section></section><section><h2 id="2007547606#empaquetamiento-y-distribuci-n" data-toc="empaquetamiento-y-distribuci-n#Arquitectura General.md-empaquetamiento-y-distribuci-n">🚀 Empaquetamiento y Distribuci&oacute;n</h2><section><h3 id="2007547606#managed-package-strategy" data-toc="managed-package-strategy#Arquitectura General.md-managed-package-strategy">Managed Package Strategy</h3><section><h4 id="2007547606#estructura-del-paquete" data-toc="estructura-del-paquete#Arquitectura General.md-estructura-del-paquete">Estructura del Paquete:</h4><div class="detached code-block" id="2007547606#-axwvfu_137"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────┐
│                 SURA FOUNDATION PACKAGE                     │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                 UPGRADEABLE COMPONENTS                  │ │
│  │                                                         │ │
│  │ • Custom Metadata Types                                 │ │
│  │ • Platform Events                                       │ │
│  │ • Custom Settings                                       │ │
│  │ • Subscriber-Editable Attributes                        │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                NON-UPGRADEABLE COMPONENTS               │ │
│  │                                                         │ │
│  │ • Apex Classes (Core Logic)                             │ │
│  │ • Triggers                                              │ │
│  │ • Flows                                                 │ │
│  │ • Locked Attributes                                     │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘</code></pre></div></section><section><h4 id="2007547606#ventajas-del-managed-package" data-toc="ventajas-del-managed-package#Arquitectura General.md-ventajas-del-managed-package">Ventajas del Managed Package:</h4><ol class="list list-decimal" id="2007547606#-axwvfu_138" type="1" start="1"><li class="list-item" id="2007547606#-axwvfu_139"><p><span class="control" id="2007547606#-axwvfu_144">C&oacute;digo Protegido</span>: L&oacute;gica core no visible ni modificable</p></li><li class="list-item" id="2007547606#-axwvfu_140"><p><span class="control" id="2007547606#-axwvfu_145">Versionado Controlado</span>: Gesti&oacute;n de versiones y actualizaciones</p></li><li class="list-item" id="2007547606#-axwvfu_141"><p><span class="control" id="2007547606#-axwvfu_146">Distribuci&oacute;n Centralizada</span>: Instalaci&oacute;n en m&uacute;ltiples orgs</p></li><li class="list-item" id="2007547606#-axwvfu_142"><p><span class="control" id="2007547606#-axwvfu_147">Compatibilidad</span>: Asegura funcionamiento correcto</p></li><li class="list-item" id="2007547606#-axwvfu_143"><p><span class="control" id="2007547606#-axwvfu_148">Soporte</span>: Mantenimiento centralizado del framework</p></li></ol></section><section><h4 id="2007547606#estrategia-de-versionado" data-toc="estrategia-de-versionado#Arquitectura General.md-estrategia-de-versionado">Estrategia de Versionado:</h4><ul class="list" id="2007547606#-axwvfu_149" start="1"><li class="list-item" id="2007547606#-axwvfu_151"><p><span class="control" id="2007547606#-axwvfu_154">Versiones Inestables</span>: 0.1.0-NEXT, 0.1.0-2, etc.</p></li><li class="list-item" id="2007547606#-axwvfu_152"><p><span class="control" id="2007547606#-axwvfu_155">Versiones Estables</span>: 1.0-1, 1.0-3, etc.</p></li><li class="list-item" id="2007547606#-axwvfu_153"><p><span class="control" id="2007547606#-axwvfu_156">Actualizaciones</span>: Autom&aacute;ticas para componentes upgradeables</p></li></ul></section></section></section><section><h2 id="2007547606#arquitectura-de-integraci-n-externa" data-toc="arquitectura-de-integraci-n-externa#Arquitectura General.md-arquitectura-de-integraci-n-externa">🔧 Arquitectura de Integraci&oacute;n Externa</h2><section><h3 id="2007547606#sistema-de-reintentos" data-toc="sistema-de-reintentos#Arquitectura General.md-sistema-de-reintentos">Sistema de Reintentos</h3><div class="detached code-block" id="2007547606#-axwvfu_159"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────┐
│                 INTEGRATION RETRY LOGIC                     │
│                                                             │
│  Caller ──┬──&gt; Business Process ──┬──&gt; External Service     │
│           │                       │                        │
│           │    ┌─────────────┐    │    ┌─────────────┐     │
│           │    │ Callout 1   │    │    │ Response    │     │
│           │    │ Te1 + Tr1   │    │    │ Handler     │     │
│           │    └─────────────┘    │    └─────────────┘     │
│           │                       │                        │
│           │    ┌─────────────┐    │                        │
│           │    │ Callout 2   │    │                        │
│           │    │ Te2 + Tr2   │    │                        │
│           │    └─────────────┘    │                        │
│           │                       │                        │
│           └──&gt; Total &lt; 10000ms ───┘                        │
│                                                             │
│  Retry Patterns:                                           │
│  • Fixed: 100ms, 100ms, 100ms...                          │
│  • Incremental: 100ms, 200ms, 300ms...                    │
│  • Fibonacci: 100ms, 200ms, 300ms, 500ms, 800ms...       │
└─────────────────────────────────────────────────────────────┘</code></pre></div></section><section><h3 id="2007547606#configuraci-n-de-integraciones" data-toc="configuraci-n-de-integraciones#Arquitectura General.md-configuraci-n-de-integraciones">Configuraci&oacute;n de Integraciones:</h3><ul class="list" id="2007547606#-axwvfu_160" start="1"><li class="list-item" id="2007547606#-axwvfu_162"><p><span class="control" id="2007547606#-axwvfu_167">Por Integraci&oacute;n</span>: Configuraci&oacute;n independiente</p></li><li class="list-item" id="2007547606#-axwvfu_163"><p><span class="control" id="2007547606#-axwvfu_168">C&oacute;digos de Respuesta</span>: Definir qu&eacute; c&oacute;digos activan reintentos (400, 404, 500, etc.)</p></li><li class="list-item" id="2007547606#-axwvfu_164"><p><span class="control" id="2007547606#-axwvfu_169">Cantidad de Reintentos</span>: M&iacute;nimo 1, m&aacute;ximo 5</p></li><li class="list-item" id="2007547606#-axwvfu_165"><p><span class="control" id="2007547606#-axwvfu_170">Intervalos de Espera</span>: Configurables por patr&oacute;n</p></li><li class="list-item" id="2007547606#-axwvfu_166"><p><span class="control" id="2007547606#-axwvfu_171">L&iacute;mites de Gobierno</span>: Respeto a los 10 segundos de Salesforce</p></li></ul></section></section><section><h2 id="2007547606#panel-de-administraci-n" data-toc="panel-de-administraci-n#Arquitectura General.md-panel-de-administraci-n">📋 Panel de Administraci&oacute;n</h2><section><h3 id="2007547606#caracter-sticas-del-panel" data-toc="caracter-sticas-del-panel#Arquitectura General.md-caracter-sticas-del-panel">Caracter&iacute;sticas del Panel:</h3><div class="detached code-block" id="2007547606#-axwvfu_173"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────┐
│              FOUNDATION ADMIN PANEL                         │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                 PROCESS MANAGEMENT                      │ │
│  │                                                         │ │
│  │ ┌─────────┬──────────┬─────────┬────────┬──────────────┐ │ │
│  │ │ Nombre  │ Producto │ Etapa   │ Orden  │ Estado       │ │ │
│  │ ├─────────┼──────────┼─────────┼────────┼──────────────┤ │ │
│  │ │ Lead    │ Viajes   │ Gestión │   0    │ ✅ Activo    │ │ │
│  │ │ Rate    │ Viajes   │ Tarif.  │   0    │ ✅ Activo    │ │ │
│  │ │ Quote   │ Viajes   │ Cotiz.  │   0    │ ✅ Activo    │ │ │
│  │ │ Emision │ Viajes   │ Emisión │   0    │ ✅ Activo    │ │ │
│  │ └─────────┴──────────┴─────────┴────────┴──────────────┘ │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                             │
│  [Instalar Metadatos] [Configuraciones] [Refrescar] [Nuevo] │
└─────────────────────────────────────────────────────────────┘</code></pre></div><p id="2007547606#-axwvfu_174"><span class="control" id="2007547606#-axwvfu_177">Funcionalidades:</span></p><ul class="list" id="2007547606#-axwvfu_175" start="1"><li class="list-item" id="2007547606#-axwvfu_178"><p>Activar/Desactivar procesos din&aacute;micamente</p></li><li class="list-item" id="2007547606#-axwvfu_179"><p>Configurar orden de ejecuci&oacute;n</p></li><li class="list-item" id="2007547606#-axwvfu_180"><p>Monitorear estado de integraciones</p></li><li class="list-item" id="2007547606#-axwvfu_181"><p>Gestionar feature flags por ambiente</p></li></ul></section></section><section><h2 id="2007547606#beneficios-arquitect-nicos" data-toc="beneficios-arquitect-nicos#Arquitectura General.md-beneficios-arquitect-nicos">🎯 Beneficios Arquitect&oacute;nicos</h2><section><h3 id="2007547606#t-cnicos" data-toc="t-cnicos#Arquitectura General.md-t-cnicos">T&eacute;cnicos</h3><ul class="list" id="2007547606#-axwvfu_185" start="1"><li class="list-item" id="2007547606#-axwvfu_186"><p><span class="control" id="2007547606#-axwvfu_191">Modularidad</span>: Componentes independientes y reutilizables</p></li><li class="list-item" id="2007547606#-axwvfu_187"><p><span class="control" id="2007547606#-axwvfu_192">Escalabilidad</span>: F&aacute;cil adici&oacute;n de nuevos productos y procesos</p></li><li class="list-item" id="2007547606#-axwvfu_188"><p><span class="control" id="2007547606#-axwvfu_193">Mantenibilidad</span>: C&oacute;digo organizado con responsabilidades claras</p></li><li class="list-item" id="2007547606#-axwvfu_189"><p><span class="control" id="2007547606#-axwvfu_194">Testabilidad</span>: Componentes aislados facilitan pruebas unitarias</p></li><li class="list-item" id="2007547606#-axwvfu_190"><p><span class="control" id="2007547606#-axwvfu_195">Performance</span>: Medici&oacute;n individual de cada proceso</p></li></ul></section><section><h3 id="2007547606#operacionales" data-toc="operacionales#Arquitectura General.md-operacionales">Operacionales</h3><ul class="list" id="2007547606#-axwvfu_196" start="1"><li class="list-item" id="2007547606#-axwvfu_197"><p><span class="control" id="2007547606#-axwvfu_201">Disponibilidad</span>: Framework disponible desde Salesforce Core y OmniStudio</p></li><li class="list-item" id="2007547606#-axwvfu_198"><p><span class="control" id="2007547606#-axwvfu_202">Configurabilidad</span>: Feature flags y metadata configurable</p></li><li class="list-item" id="2007547606#-axwvfu_199"><p><span class="control" id="2007547606#-axwvfu_203">Monitoreo</span>: Eventos y logs centralizados</p></li><li class="list-item" id="2007547606#-axwvfu_200"><p><span class="control" id="2007547606#-axwvfu_204">Distribuci&oacute;n</span>: Managed package para m&uacute;ltiples organizaciones</p></li></ul></section><section><h3 id="2007547606#estrat-gicos" data-toc="estrat-gicos#Arquitectura General.md-estrat-gicos">Estrat&eacute;gicos</h3><ul class="list" id="2007547606#-axwvfu_205" start="1"><li class="list-item" id="2007547606#-axwvfu_207"><p><span class="control" id="2007547606#-axwvfu_211">Tiempo al Mercado</span>: Reducci&oacute;n en tiempo de implementaci&oacute;n</p></li><li class="list-item" id="2007547606#-axwvfu_208"><p><span class="control" id="2007547606#-axwvfu_212">Consistencia</span>: Est&aacute;ndares unificados para todos los productos</p></li><li class="list-item" id="2007547606#-axwvfu_209"><p><span class="control" id="2007547606#-axwvfu_213">Evoluci&oacute;n</span>: Base s&oacute;lida para futuras expansiones</p></li><li class="list-item" id="2007547606#-axwvfu_210"><p><span class="control" id="2007547606#-axwvfu_214">Riesgo</span>: Reducci&oacute;n de errores por c&oacute;digo acoplado</p></li></ul></section></section><section><h2 id="2007547606#roadmap-arquitect-nico" data-toc="roadmap-arquitect-nico#Arquitectura General.md-roadmap-arquitect-nico">🔮 Roadmap Arquitect&oacute;nico</h2><section><h3 id="2007547606#versi-n-actual-1-0" data-toc="versi-n-actual-1-0#Arquitectura General.md-versi-n-actual-1-0">Versi&oacute;n Actual (1.0)</h3><ul class="list" id="2007547606#-axwvfu_218" start="1"><li class="list-item" id="2007547606#-axwvfu_219"><p>✅ Framework core implementado</p></li><li class="list-item" id="2007547606#-axwvfu_220"><p>✅ Patrones de dise&ntilde;o establecidos</p></li><li class="list-item" id="2007547606#-axwvfu_221"><p>✅ Integraci&oacute;n con Vlocity</p></li><li class="list-item" id="2007547606#-axwvfu_222"><p>✅ Productos Motos y Autos</p></li></ul></section><section><h3 id="2007547606#versi-n-2-0-pr-xima" data-toc="versi-n-2-0-pr-xima#Arquitectura General.md-versi-n-2-0-pr-xima">Versi&oacute;n 2.0 (Pr&oacute;xima)</h3><ul class="list" id="2007547606#-axwvfu_223" start="1"><li class="list-item" id="2007547606#-axwvfu_224"><p>🔄 Expansi&oacute;n a Viajes y Arrendamiento</p></li><li class="list-item" id="2007547606#-axwvfu_225"><p>🔄 Dashboard de monitoreo avanzado</p></li><li class="list-item" id="2007547606#-axwvfu_226"><p>🔄 APIs REST para integraciones externas</p></li><li class="list-item" id="2007547606#-axwvfu_227"><p>🔄 Optimizaciones de performance</p></li></ul></section><section><h3 id="2007547606#versi-n-3-0-futuro" data-toc="versi-n-3-0-futuro#Arquitectura General.md-versi-n-3-0-futuro">Versi&oacute;n 3.0 (Futuro)</h3><ul class="list" id="2007547606#-axwvfu_228" start="1"><li class="list-item" id="2007547606#-axwvfu_231"><p>⏳ Soporte multi-tenant avanzado</p></li><li class="list-item" id="2007547606#-axwvfu_232"><p>⏳ Machine Learning para optimizaci&oacute;n</p></li><li class="list-item" id="2007547606#-axwvfu_233"><p>⏳ Integraci&oacute;n con herramientas DevOps</p></li><li class="list-item" id="2007547606#-axwvfu_234"><p>⏳ Expansi&oacute;n a otras l&iacute;neas de negocio</p></li></ul><p id="2007547606#-axwvfu_230"><span class="control" id="2007547606#-axwvfu_235">Fecha de Actualizaci&oacute;n:</span> Mayo 2025<span class="control" id="2007547606#-axwvfu_237">Versi&oacute;n del Documento:</span> 1.0<span class="control" id="2007547606#-axwvfu_239">Arquitectos:</span> Soulberto Lorenzo, Jean Carlos Melendez<span class="control" id="2007547606#-axwvfu_241">Estado:</span> Documento Vivo - Actualizaci&oacute;n Continua</p></section></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="362417808">Patrones de Dise&ntilde;o - Framework Foundation</h1><section><h2 id="362417808#descripci-n-general" data-toc="descripci-n-general#Patrones de Diseño.md-descripci-n-general">Descripci&oacute;n General</h2><p id="362417808#-gzhnj8_10">Este documento describe los patrones de dise&ntilde;o implementados en el Framework Foundation, analizando su prop&oacute;sito, implementaci&oacute;n y beneficios dentro de la arquitectura del sistema. El framework utiliza m&uacute;ltiples patrones que trabajan en conjunto para crear una soluci&oacute;n robusta, extensible y mantenible.</p></section><section><h2 id="362417808#patrones-implementados" data-toc="patrones-implementados#Patrones de Diseño.md-patrones-implementados">Patrones Implementados</h2><section><h3 id="362417808#1-observer-pattern" data-toc="1-observer-pattern#Patrones de Diseño.md-1-observer-pattern">1. Observer Pattern</h3><section><h4 id="362417808#implementaci-n" data-toc="implementaci-n#Patrones de Diseño.md-implementaci-n">Implementaci&oacute;n</h4><p id="362417808#-gzhnj8_23"><span class="control" id="362417808#-gzhnj8_24">Clase:</span> <span class="inline-code" id="362417808#-gzhnj8_25">BaseObserver</span> <span class="control" id="362417808#-gzhnj8_26">Interfaz:</span> <span class="inline-code" id="362417808#-gzhnj8_27">IObserver</span></p></section><section><h4 id="362417808#prop-sito" data-toc="prop-sito#Patrones de Diseño.md-prop-sito">Prop&oacute;sito</h4><p id="362417808#-gzhnj8_28">Permite que m&uacute;ltiples objetos observen y reaccionen a eventos del sistema sin acoplamiento directo entre el emisor y los receptores.</p></section><section><h4 id="362417808#c-mo-se-utiliza" data-toc="c-mo-se-utiliza#Patrones de Diseño.md-c-mo-se-utiliza">C&oacute;mo se Utiliza</h4><div class="detached code-block" id="362417808#-gzhnj8_29"><pre><code class="language-none">public virtual class BaseObserver implements IObserver {
    public virtual void updateObserver(String flag, Object data) {
        Core.debug('flag=&quot;' + flag);
    }
    
    public virtual void publishPlatFormEvent(String flag, String productName) {
        Core.debug('Publishing platform event for product= ' + productName);
    }
}</code></pre></div></section><section><h4 id="362417808#beneficios-en-el-framework" data-toc="beneficios-en-el-framework#Patrones de Diseño.md-beneficios-en-el-framework">Beneficios en el Framework</h4><ul class="list" id="362417808#-gzhnj8_30" start="1"><li class="list-item" id="362417808#-gzhnj8_31"><p><span class="control" id="362417808#-gzhnj8_35">Desacoplamiento:</span> Los componentes pueden comunicarse sin conocerse directamente</p></li><li class="list-item" id="362417808#-gzhnj8_32"><p><span class="control" id="362417808#-gzhnj8_36">Extensibilidad:</span> Nuevos observadores pueden agregarse sin modificar el c&oacute;digo existente</p></li><li class="list-item" id="362417808#-gzhnj8_33"><p><span class="control" id="362417808#-gzhnj8_37">Event-Driven Architecture:</span> Facilita una arquitectura basada en eventos</p></li><li class="list-item" id="362417808#-gzhnj8_34"><p><span class="control" id="362417808#-gzhnj8_38">Reactividad:</span> El sistema puede responder autom&aacute;ticamente a cambios de estado</p></li></ul></section><section><h4 id="362417808#casos-de-uso" data-toc="casos-de-uso#Patrones de Diseño.md-casos-de-uso">Casos de Uso</h4><ul class="list" id="362417808#-gzhnj8_39" start="1"><li class="list-item" id="362417808#-gzhnj8_41"><p>Notificaciones de cambios de estado en objetos de negocio</p></li><li class="list-item" id="362417808#-gzhnj8_42"><p>Logging autom&aacute;tico de eventos del sistema</p></li><li class="list-item" id="362417808#-gzhnj8_43"><p>Integraci&oacute;n con Platform Events de Salesforce</p></li><li class="list-item" id="362417808#-gzhnj8_44"><p>Auditor&iacute;a de operaciones cr&iacute;ticas</p></li></ul></section></section><section><h3 id="362417808#2-provider-pattern" data-toc="2-provider-pattern#Patrones de Diseño.md-2-provider-pattern">2. Provider Pattern</h3><section><h4 id="362417808#implementaci-n" data-toc="implementaci-n#Patrones de Diseño.md-implementaci-n">Implementaci&oacute;n</h4><p id="362417808#-gzhnj8_50"><span class="control" id="362417808#-gzhnj8_51">Clase:</span> <span class="inline-code" id="362417808#-gzhnj8_52">FeatureFlagProvider</span> <span class="control" id="362417808#-gzhnj8_53">Interfaz:</span> <span class="inline-code" id="362417808#-gzhnj8_54">IFeatureFlagProvider</span></p></section><section><h4 id="362417808#prop-sito" data-toc="prop-sito#Patrones de Diseño.md-prop-sito">Prop&oacute;sito</h4><p id="362417808#-gzhnj8_55">Abstrae la obtenci&oacute;n de datos y configuraciones, permitiendo diferentes fuentes de informaci&oacute;n sin cambiar el c&oacute;digo cliente.</p></section><section><h4 id="362417808#c-mo-se-utiliza" data-toc="c-mo-se-utiliza#Patrones de Diseño.md-c-mo-se-utiliza">C&oacute;mo se Utiliza</h4><div class="detached code-block" id="362417808#-gzhnj8_56"><pre><code class="language-none">public with sharing class FeatureFlagProvider implements IFeatureFlagProvider {
    public Set&lt;String&gt; getCustomPermissionNames(){
        // Obtiene permisos personalizados desde Salesforce
        List&lt;CustomPermission&gt; perms = [SELECT Id, DeveloperName FROM CustomPermission];
        // ... procesamiento
        return customPermissionNames;
    }

    public Map&lt;String,FeatureFlag__mdt&gt; getFeatureFlags(){
        return FeatureFlag__mdt.getAll();
    }
}</code></pre></div></section><section><h4 id="362417808#beneficios-en-el-framework" data-toc="beneficios-en-el-framework#Patrones de Diseño.md-beneficios-en-el-framework">Beneficios en el Framework</h4><ul class="list" id="362417808#-gzhnj8_57" start="1"><li class="list-item" id="362417808#-gzhnj8_58"><p><span class="control" id="362417808#-gzhnj8_62">Abstracci&oacute;n de Fuentes:</span> Oculta la complejidad de obtener datos de diferentes fuentes</p></li><li class="list-item" id="362417808#-gzhnj8_59"><p><span class="control" id="362417808#-gzhnj8_63">Testabilidad:</span> Permite inyecci&oacute;n de dependencias para testing</p></li><li class="list-item" id="362417808#-gzhnj8_60"><p><span class="control" id="362417808#-gzhnj8_64">Flexibilidad:</span> Diferentes proveedores para diferentes entornos</p></li><li class="list-item" id="362417808#-gzhnj8_61"><p><span class="control" id="362417808#-gzhnj8_65">Cacheo:</span> Centraliza estrategias de cache y performance</p></li></ul></section><section><h4 id="362417808#casos-de-uso" data-toc="casos-de-uso#Patrones de Diseño.md-casos-de-uso">Casos de Uso</h4><ul class="list" id="362417808#-gzhnj8_66" start="1"><li class="list-item" id="362417808#-gzhnj8_68"><p>Obtenci&oacute;n de feature flags desde Custom Metadata Types</p></li><li class="list-item" id="362417808#-gzhnj8_69"><p>Acceso a permisos personalizados</p></li><li class="list-item" id="362417808#-gzhnj8_70"><p>Configuraciones din&aacute;micas sin deployments</p></li><li class="list-item" id="362417808#-gzhnj8_71"><p>Testing con datos mock</p></li></ul></section></section><section><h3 id="362417808#3-strategy-pattern" data-toc="3-strategy-pattern#Patrones de Diseño.md-3-strategy-pattern">3. Strategy Pattern</h3><section><h4 id="362417808#implementaci-n" data-toc="implementaci-n#Patrones de Diseño.md-implementaci-n">Implementaci&oacute;n</h4><p id="362417808#-gzhnj8_77"><span class="control" id="362417808#-gzhnj8_78">Clases:</span> <span class="inline-code" id="362417808#-gzhnj8_79">FeatureFlags</span>, <span class="inline-code" id="362417808#-gzhnj8_80">AccountConfigurator</span> <span class="control" id="362417808#-gzhnj8_81">Interfaces:</span> <span class="inline-code" id="362417808#-gzhnj8_82">IFeatureFlags</span>, <span class="inline-code" id="362417808#-gzhnj8_83">AccountConfigurator</span></p></section><section><h4 id="362417808#prop-sito" data-toc="prop-sito#Patrones de Diseño.md-prop-sito">Prop&oacute;sito</h4><p id="362417808#-gzhnj8_84">Permite intercambiar algoritmos o comportamientos en tiempo de ejecuci&oacute;n sin modificar el c&oacute;digo cliente.</p></section><section><h4 id="362417808#c-mo-se-utiliza" data-toc="c-mo-se-utiliza#Patrones de Diseño.md-c-mo-se-utiliza">C&oacute;mo se Utiliza</h4><section><h5 id="362417808#en-featureflags" data-toc="en-featureflags#Patrones de Diseño.md-en-featureflags">En FeatureFlags</h5><div class="detached code-block" id="362417808#-gzhnj8_87"><pre><code class="language-none">public FeatureEvaluationResult evaluate(String featureName) {
    // Estrategia 1: Mock Values (para testing)
    if (Test.isRunningTest() &amp;&amp; mockValues.containsKey(featureName)) {
        return new FeatureEvaluationResult(mockValues.get(featureName), featureName, FeatureReason.MOCK_VALUE);
    }
    
    // Estrategia 2: Custom Permissions
    if (customPermissionNames.contains(featureName)) {
        if (FeatureManagement.checkPermission(featureName)) {
            return new FeatureEvaluationResult(true, featureName, FeatureReason.HAS_CUSTOM_PERMISSION);
        }
    }
    
    // Estrategia 3: Custom Metadata Types
    if (features.containsKey(featureName)) {
        if (features.get(featureName).Is_Active__c) {
            return new FeatureEvaluationResult(true, featureName, FeatureReason.CUSTOM_METADATA_TYPE_ENABLED);
        }
    }
}</code></pre></div></section><section><h5 id="362417808#en-accountconfigurator" data-toc="en-accountconfigurator#Patrones de Diseño.md-en-accountconfigurator">En AccountConfigurator</h5><div class="detached code-block" id="362417808#-gzhnj8_88"><pre><code class="language-none">global interface AccountConfigurator {
    void configure(Account account);
}

// Diferentes estrategias de configuración
global class IndustryAccountConfigurator implements AccountConfigurator {
    global void configure(Account account) {
        account.Industry = this.industry;
        // Lógica específica por industria
    }
}</code></pre></div></section></section><section><h4 id="362417808#beneficios-en-el-framework" data-toc="beneficios-en-el-framework#Patrones de Diseño.md-beneficios-en-el-framework">Beneficios en el Framework</h4><ul class="list" id="362417808#-gzhnj8_89" start="1"><li class="list-item" id="362417808#-gzhnj8_90"><p><span class="control" id="362417808#-gzhnj8_94">Intercambiabilidad:</span> Diferentes algoritmos para el mismo prop&oacute;sito</p></li><li class="list-item" id="362417808#-gzhnj8_91"><p><span class="control" id="362417808#-gzhnj8_95">Extensibilidad:</span> Nuevas estrategias sin modificar c&oacute;digo existente</p></li><li class="list-item" id="362417808#-gzhnj8_92"><p><span class="control" id="362417808#-gzhnj8_96">Mantenibilidad:</span> Separaci&oacute;n clara de responsabilidades</p></li><li class="list-item" id="362417808#-gzhnj8_93"><p><span class="control" id="362417808#-gzhnj8_97">Configurabilidad:</span> Comportamiento din&aacute;mico basado en configuraci&oacute;n</p></li></ul></section><section><h4 id="362417808#casos-de-uso" data-toc="casos-de-uso#Patrones de Diseño.md-casos-de-uso">Casos de Uso</h4><ul class="list" id="362417808#-gzhnj8_98" start="1"><li class="list-item" id="362417808#-gzhnj8_100"><p>Evaluaci&oacute;n de feature flags con m&uacute;ltiples fuentes</p></li><li class="list-item" id="362417808#-gzhnj8_101"><p>Configuraci&oacute;n modular de objetos Account</p></li><li class="list-item" id="362417808#-gzhnj8_102"><p>Algoritmos de procesamiento intercambiables</p></li><li class="list-item" id="362417808#-gzhnj8_103"><p>Validaciones condicionales</p></li></ul></section></section><section><h3 id="362417808#4-adapter-pattern" data-toc="4-adapter-pattern#Patrones de Diseño.md-4-adapter-pattern">4. Adapter Pattern</h3><section><h4 id="362417808#implementaci-n" data-toc="implementaci-n#Patrones de Diseño.md-implementaci-n">Implementaci&oacute;n</h4><p id="362417808#-gzhnj8_109"><span class="control" id="362417808#-gzhnj8_110">Clase:</span> <span class="inline-code" id="362417808#-gzhnj8_111">BaseProcessFoundationVlocityAdapter</span></p></section><section><h4 id="362417808#prop-sito" data-toc="prop-sito#Patrones de Diseño.md-prop-sito">Prop&oacute;sito</h4><p id="362417808#-gzhnj8_112">Permite que interfaces incompatibles trabajen juntas, actuando como puente entre diferentes sistemas o APIs.</p></section><section><h4 id="362417808#c-mo-se-utiliza" data-toc="c-mo-se-utiliza#Patrones de Diseño.md-c-mo-se-utiliza">C&oacute;mo se Utiliza</h4><div class="detached code-block" id="362417808#-gzhnj8_113"><pre><code class="language-none">global abstract class BaseProcessFoundationVlocityAdapter {
    global static Boolean applyInvoke(
        Map&lt;String, Object&gt; inputMap,
        Map&lt;String, Object&gt; outputMap,
        Map&lt;String, Object&gt; optionMap
    ) {
        String stage = (String) inputMap?.get('Stage');
        // Adapta la interfaz de Vlocity a BaseProcessManager
        return BaseProcessManager.invoke(stage, optionMap, inputMap, outputMap);
    }
    
    public Boolean invokeMethod(String methodName, Map&lt;String, Object&gt; inputMap, 
                               Map&lt;String, Object&gt; outputMap, Map&lt;String, Object&gt; optionMap) {
        // Invocación dinámica por nombre de método
        switch on methodName.toUpperCase() {
            when 'APPLYINVOKE' {
                return applyInvoke(inputMap, outputMap, optionMap);
            }
        }
    }
}</code></pre></div></section><section><h4 id="362417808#beneficios-en-el-framework" data-toc="beneficios-en-el-framework#Patrones de Diseño.md-beneficios-en-el-framework">Beneficios en el Framework</h4><ul class="list" id="362417808#-gzhnj8_114" start="1"><li class="list-item" id="362417808#-gzhnj8_115"><p><span class="control" id="362417808#-gzhnj8_119">Integraci&oacute;n:</span> Conecta Vlocity framework con l&oacute;gica de negocio personalizada</p></li><li class="list-item" id="362417808#-gzhnj8_116"><p><span class="control" id="362417808#-gzhnj8_120">Abstracci&oacute;n:</span> Oculta complejidad del BaseProcessManager</p></li><li class="list-item" id="362417808#-gzhnj8_117"><p><span class="control" id="362417808#-gzhnj8_121">Estandarizaci&oacute;n:</span> Interfaz consistente para diferentes invocaciones</p></li><li class="list-item" id="362417808#-gzhnj8_118"><p><span class="control" id="362417808#-gzhnj8_122">Desacoplamiento:</span> Vlocity no depende directamente de clases internas</p></li></ul></section><section><h4 id="362417808#casos-de-uso" data-toc="casos-de-uso#Patrones de Diseño.md-casos-de-uso">Casos de Uso</h4><ul class="list" id="362417808#-gzhnj8_123" start="1"><li class="list-item" id="362417808#-gzhnj8_125"><p>Integraci&oacute;n entre Vlocity y BaseProcessManager</p></li><li class="list-item" id="362417808#-gzhnj8_126"><p>Adaptaci&oacute;n de APIs externas</p></li><li class="list-item" id="362417808#-gzhnj8_127"><p>Puente entre diferentes versiones de interfaces</p></li><li class="list-item" id="362417808#-gzhnj8_128"><p>Normalizaci&oacute;n de par&aacute;metros entre sistemas</p></li></ul></section></section><section><h3 id="362417808#5-chain-of-responsibility-pattern" data-toc="5-chain-of-responsibility-pattern#Patrones de Diseño.md-5-chain-of-responsibility-pattern">5. Chain of Responsibility Pattern</h3><section><h4 id="362417808#implementaci-n" data-toc="implementaci-n#Patrones de Diseño.md-implementaci-n">Implementaci&oacute;n</h4><p id="362417808#-gzhnj8_134"><span class="control" id="362417808#-gzhnj8_135">Clase:</span> <span class="inline-code" id="362417808#-gzhnj8_136">BaseProcessManager</span> <span class="control" id="362417808#-gzhnj8_137">Componentes:</span> <span class="inline-code" id="362417808#-gzhnj8_138">ProductHandler</span>, <span class="inline-code" id="362417808#-gzhnj8_139">ProcessFactory</span>, <span class="inline-code" id="362417808#-gzhnj8_140">ReverseIterator</span></p></section><section><h4 id="362417808#prop-sito" data-toc="prop-sito#Patrones de Diseño.md-prop-sito">Prop&oacute;sito</h4><p id="362417808#-gzhnj8_141">Permite pasar solicitudes a lo largo de una cadena de manejadores hasta que uno de ellos procese la solicitud.</p></section><section><h4 id="362417808#c-mo-se-utiliza" data-toc="c-mo-se-utiliza#Patrones de Diseño.md-c-mo-se-utiliza">C&oacute;mo se Utiliza</h4><div class="detached code-block" id="362417808#-gzhnj8_142"><pre><code class="language-none">global static Boolean invoke(String stage, Map&lt;String, Object&gt; options, 
                            Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; output) {
    // 1. Obtener handlers para el stage
    ReverseIterator reverseIterator = new ReverseIterator(
        ((List&lt;ProductHandler&gt;) ProcessFactory.newInstances(
            ProcessFactory.getAllDefinitionsByStage(stage, ignoreCache)
        ))
    );

    // 2. Construir la cadena de responsabilidad
    if (!reverseIterator.isEmpty()) {
        ProductHandler previous = (ProductHandler) reverseIterator.next();
        
        while (reverseIterator.hasNext()) {
            ProductHandler current = (ProductHandler) reverseIterator.next();
            current.setNext(previous);  // Enlazar handlers
            previous = current;
        }

        // 3. Ejecutar la cadena
        ((ProductHandler) reverseIterator.first()).apply(options, input, output);
    }
    
    return true;
}</code></pre></div></section><section><h4 id="362417808#beneficios-en-el-framework" data-toc="beneficios-en-el-framework#Patrones de Diseño.md-beneficios-en-el-framework">Beneficios en el Framework</h4><ul class="list" id="362417808#-gzhnj8_143" start="1"><li class="list-item" id="362417808#-gzhnj8_144"><p><span class="control" id="362417808#-gzhnj8_148">Flexibilidad:</span> Configuraci&oacute;n din&aacute;mica de la cadena de procesamiento</p></li><li class="list-item" id="362417808#-gzhnj8_145"><p><span class="control" id="362417808#-gzhnj8_149">Desacoplamiento:</span> Handlers no conocen la estructura completa de la cadena</p></li><li class="list-item" id="362417808#-gzhnj8_146"><p><span class="control" id="362417808#-gzhnj8_150">Extensibilidad:</span> Nuevos handlers sin modificar c&oacute;digo existente</p></li><li class="list-item" id="362417808#-gzhnj8_147"><p><span class="control" id="362417808#-gzhnj8_151">Configurabilidad:</span> Orden y composici&oacute;n basada en metadata</p></li></ul></section><section><h4 id="362417808#casos-de-uso" data-toc="casos-de-uso#Patrones de Diseño.md-casos-de-uso">Casos de Uso</h4><ul class="list" id="362417808#-gzhnj8_152" start="1"><li class="list-item" id="362417808#-gzhnj8_154"><p>Procesamiento de &oacute;rdenes con m&uacute;ltiples validaciones</p></li><li class="list-item" id="362417808#-gzhnj8_155"><p>Pipeline de transformaci&oacute;n de datos</p></li><li class="list-item" id="362417808#-gzhnj8_156"><p>Workflows configurables por stage</p></li><li class="list-item" id="362417808#-gzhnj8_157"><p>Procesamiento secuencial con puntos de control</p></li></ul></section></section><section><h3 id="362417808#6-builder-pattern" data-toc="6-builder-pattern#Patrones de Diseño.md-6-builder-pattern">6. Builder Pattern</h3><section><h4 id="362417808#implementaci-n" data-toc="implementaci-n#Patrones de Diseño.md-implementaci-n">Implementaci&oacute;n</h4><p id="362417808#-gzhnj8_163"><span class="control" id="362417808#-gzhnj8_164">Clase:</span> <span class="inline-code" id="362417808#-gzhnj8_165">AccountBuilder</span> <span class="control" id="362417808#-gzhnj8_166">Interfaz:</span> <span class="inline-code" id="362417808#-gzhnj8_167">AccountConfigurator</span></p></section><section><h4 id="362417808#prop-sito" data-toc="prop-sito#Patrones de Diseño.md-prop-sito">Prop&oacute;sito</h4><p id="362417808#-gzhnj8_168">Construye objetos complejos paso a paso, permitiendo diferentes representaciones del mismo tipo de objeto.</p></section><section><h4 id="362417808#c-mo-se-utiliza" data-toc="c-mo-se-utiliza#Patrones de Diseño.md-c-mo-se-utiliza">C&oacute;mo se Utiliza</h4><div class="detached code-block" id="362417808#-gzhnj8_169"><pre><code class="language-none">global class AccountBuilder {
    global Account account;
    global List&lt;AccountConfigurator&gt; configurators = new List&lt;AccountConfigurator&gt;();

    // Métodos fluidos para construcción
    global AccountBuilder setName(String name) {
        account.Name = name;
        return this;
    }
    
    global AccountBuilder setPhone(String phone) {
        account.Phone = phone;
        return this;
    }
    
    global AccountBuilder addConfigurators(List&lt;AccountConfigurator&gt; configuratorsList) {
        this.configurators.addAll(configuratorsList);
        return this;
    }

    // Construcción final
    global Account build() {
        for (AccountConfigurator configurator : configurators) {
            configurator.configure(account);
        }
        return account;
    }
}</code></pre></div></section><section><h4 id="362417808#beneficios-en-el-framework" data-toc="beneficios-en-el-framework#Patrones de Diseño.md-beneficios-en-el-framework">Beneficios en el Framework</h4><ul class="list" id="362417808#-gzhnj8_170" start="1"><li class="list-item" id="362417808#-gzhnj8_171"><p><span class="control" id="362417808#-gzhnj8_175">Fluent Interface:</span> API intuitiva y legible</p></li><li class="list-item" id="362417808#-gzhnj8_172"><p><span class="control" id="362417808#-gzhnj8_176">Flexibilidad:</span> Construcci&oacute;n opcional e incremental</p></li><li class="list-item" id="362417808#-gzhnj8_173"><p><span class="control" id="362417808#-gzhnj8_177">Extensibilidad:</span> Configuradores personalizados</p></li><li class="list-item" id="362417808#-gzhnj8_174"><p><span class="control" id="362417808#-gzhnj8_178">Reutilizaci&oacute;n:</span> Mismo builder para diferentes variaciones</p></li></ul></section><section><h4 id="362417808#casos-de-uso" data-toc="casos-de-uso#Patrones de Diseño.md-casos-de-uso">Casos de Uso</h4><ul class="list" id="362417808#-gzhnj8_179" start="1"><li class="list-item" id="362417808#-gzhnj8_181"><p>Construcci&oacute;n de objetos Account complejos</p></li><li class="list-item" id="362417808#-gzhnj8_182"><p>Configuraci&oacute;n modular con Strategy pattern</p></li><li class="list-item" id="362417808#-gzhnj8_183"><p>APIs de creaci&oacute;n user-friendly</p></li><li class="list-item" id="362417808#-gzhnj8_184"><p>Testing con builders de datos mock</p></li></ul></section></section><section><h3 id="362417808#7-factory-pattern" data-toc="7-factory-pattern#Patrones de Diseño.md-7-factory-pattern">7. Factory Pattern</h3><section><h4 id="362417808#implementaci-n" data-toc="implementaci-n#Patrones de Diseño.md-implementaci-n">Implementaci&oacute;n</h4><p id="362417808#-gzhnj8_190"><span class="control" id="362417808#-gzhnj8_191">Clase:</span> <span class="inline-code" id="362417808#-gzhnj8_192">ProcessFactory</span> (referenciada en BaseProcessManager)</p></section><section><h4 id="362417808#prop-sito" data-toc="prop-sito#Patrones de Diseño.md-prop-sito">Prop&oacute;sito</h4><p id="362417808#-gzhnj8_193">Crea objetos sin especificar la clase exacta del objeto que ser&aacute; creado.</p></section><section><h4 id="362417808#c-mo-se-utiliza" data-toc="c-mo-se-utiliza#Patrones de Diseño.md-c-mo-se-utiliza">C&oacute;mo se Utiliza</h4><div class="detached code-block" id="362417808#-gzhnj8_194"><pre><code class="language-none">// Uso implícito en BaseProcessManager
List&lt;ProductHandler&gt; handlers = ProcessFactory.newInstances(
    ProcessFactory.getAllDefinitionsByStage(stage, ignoreCache)
);</code></pre></div></section><section><h4 id="362417808#beneficios-en-el-framework" data-toc="beneficios-en-el-framework#Patrones de Diseño.md-beneficios-en-el-framework">Beneficios en el Framework</h4><ul class="list" id="362417808#-gzhnj8_195" start="1"><li class="list-item" id="362417808#-gzhnj8_196"><p><span class="control" id="362417808#-gzhnj8_200">Abstracci&oacute;n:</span> Oculta l&oacute;gica de instanciaci&oacute;n</p></li><li class="list-item" id="362417808#-gzhnj8_197"><p><span class="control" id="362417808#-gzhnj8_201">Flexibilidad:</span> Diferentes tipos de handlers basados en configuraci&oacute;n</p></li><li class="list-item" id="362417808#-gzhnj8_198"><p><span class="control" id="362417808#-gzhnj8_202">Centralizaci&oacute;n:</span> L&oacute;gica de creaci&oacute;n en un solo lugar</p></li><li class="list-item" id="362417808#-gzhnj8_199"><p><span class="control" id="362417808#-gzhnj8_203">Cache:</span> Optimizaci&oacute;n de instanciaci&oacute;n</p></li></ul></section><section><h4 id="362417808#casos-de-uso" data-toc="casos-de-uso#Patrones de Diseño.md-casos-de-uso">Casos de Uso</h4><ul class="list" id="362417808#-gzhnj8_204" start="1"><li class="list-item" id="362417808#-gzhnj8_206"><p>Creaci&oacute;n din&aacute;mica de ProductHandlers</p></li><li class="list-item" id="362417808#-gzhnj8_207"><p>Instanciaci&oacute;n basada en metadata</p></li><li class="list-item" id="362417808#-gzhnj8_208"><p>Cache de instancias para performance</p></li><li class="list-item" id="362417808#-gzhnj8_209"><p>Inyecci&oacute;n de dependencias</p></li></ul></section></section></section><section><h2 id="362417808#interacci-n-entre-patrones" data-toc="interacci-n-entre-patrones#Patrones de Diseño.md-interacci-n-entre-patrones">Interacci&oacute;n Entre Patrones</h2><section><h3 id="362417808#feature-flags-ecosystem" data-toc="feature-flags-ecosystem#Patrones de Diseño.md-feature-flags-ecosystem">Feature Flags Ecosystem</h3><div class="detached code-block" id="362417808#-gzhnj8_213"><pre><code class="language-none">Provider Pattern → Strategy Pattern → Observer Pattern
(FeatureFlagProvider) → (FeatureFlags) → (BaseObserver)</code></pre></div></section><section><h3 id="362417808#process-management-chain" data-toc="process-management-chain#Patrones de Diseño.md-process-management-chain">Process Management Chain</h3><div class="detached code-block" id="362417808#-gzhnj8_214"><pre><code class="language-none">Adapter Pattern → Chain of Responsibility → Factory Pattern
(VlocityAdapter) → (BaseProcessManager) → (ProcessFactory)</code></pre></div></section><section><h3 id="362417808#account-building-system" data-toc="account-building-system#Patrones de Diseño.md-account-building-system">Account Building System</h3><div class="detached code-block" id="362417808#-gzhnj8_215"><pre><code class="language-none">Builder Pattern ← Strategy Pattern
(AccountBuilder) ← (AccountConfigurator)</code></pre></div></section></section><section><h2 id="362417808#beneficios-arquitect-nicos" data-toc="beneficios-arquitect-nicos#Patrones de Diseño.md-beneficios-arquitect-nicos">Beneficios Arquitect&oacute;nicos</h2><section><h3 id="362417808#mantenibilidad" data-toc="mantenibilidad#Patrones de Diseño.md-mantenibilidad">Mantenibilidad</h3><ul class="list" id="362417808#-gzhnj8_220" start="1"><li class="list-item" id="362417808#-gzhnj8_221"><p><span class="control" id="362417808#-gzhnj8_224">Separaci&oacute;n de responsabilidades:</span> Cada patr&oacute;n maneja una preocupaci&oacute;n espec&iacute;fica</p></li><li class="list-item" id="362417808#-gzhnj8_222"><p><span class="control" id="362417808#-gzhnj8_225">C&oacute;digo modular:</span> Cambios aislados sin efectos secundarios</p></li><li class="list-item" id="362417808#-gzhnj8_223"><p><span class="control" id="362417808#-gzhnj8_226">Testing independiente:</span> Cada componente puede probarse por separado</p></li></ul></section><section><h3 id="362417808#extensibilidad" data-toc="extensibilidad#Patrones de Diseño.md-extensibilidad">Extensibilidad</h3><ul class="list" id="362417808#-gzhnj8_227" start="1"><li class="list-item" id="362417808#-gzhnj8_228"><p><span class="control" id="362417808#-gzhnj8_231">Open/Closed Principle:</span> Abierto para extensi&oacute;n, cerrado para modificaci&oacute;n</p></li><li class="list-item" id="362417808#-gzhnj8_229"><p><span class="control" id="362417808#-gzhnj8_232">Configuraci&oacute;n sin c&oacute;digo:</span> Metadata-driven configuration</p></li><li class="list-item" id="362417808#-gzhnj8_230"><p><span class="control" id="362417808#-gzhnj8_233">Plugin architecture:</span> Nuevas funcionalidades como plugins</p></li></ul></section><section><h3 id="362417808#performance" data-toc="performance#Patrones de Diseño.md-performance">Performance</h3><ul class="list" id="362417808#-gzhnj8_234" start="1"><li class="list-item" id="362417808#-gzhnj8_235"><p><span class="control" id="362417808#-gzhnj8_238">Cache strategies:</span> Implementadas en Provider y Factory patterns</p></li><li class="list-item" id="362417808#-gzhnj8_236"><p><span class="control" id="362417808#-gzhnj8_239">Lazy loading:</span> Instanciaci&oacute;n bajo demanda</p></li><li class="list-item" id="362417808#-gzhnj8_237"><p><span class="control" id="362417808#-gzhnj8_240">Bulk operations:</span> Optimizaci&oacute;n para operaciones masivas</p></li></ul></section><section><h3 id="362417808#reusabilidad" data-toc="reusabilidad#Patrones de Diseño.md-reusabilidad">Reusabilidad</h3><ul class="list" id="362417808#-gzhnj8_241" start="1"><li class="list-item" id="362417808#-gzhnj8_242"><p><span class="control" id="362417808#-gzhnj8_245">Componentes intercambiables:</span> Interfaces bien definidas</p></li><li class="list-item" id="362417808#-gzhnj8_243"><p><span class="control" id="362417808#-gzhnj8_246">Configuraciones reutilizables:</span> Estrategias aplicables en m&uacute;ltiples contextos</p></li><li class="list-item" id="362417808#-gzhnj8_244"><p><span class="control" id="362417808#-gzhnj8_247">Abstracci&oacute;n de complejidad:</span> APIs simples para funcionalidad compleja</p></li></ul></section></section><section><h2 id="362417808#consideraciones-de-implementaci-n" data-toc="consideraciones-de-implementaci-n#Patrones de Diseño.md-consideraciones-de-implementaci-n">Consideraciones de Implementaci&oacute;n</h2><section><h3 id="362417808#performance" data-toc="performance#Patrones de Diseño.md-performance">Performance</h3><ul class="list" id="362417808#-gzhnj8_251" start="1"><li class="list-item" id="362417808#-gzhnj8_252"><p>Cache habilitado por feature flags</p></li><li class="list-item" id="362417808#-gzhnj8_253"><p>Factory pattern para optimizaci&oacute;n de instanciaci&oacute;n</p></li><li class="list-item" id="362417808#-gzhnj8_254"><p>Configuradores eficientes para operaciones bulk</p></li></ul></section><section><h3 id="362417808#security" data-toc="security#Patrones de Diseño.md-security">Security</h3><ul class="list" id="362417808#-gzhnj8_255" start="1"><li class="list-item" id="362417808#-gzhnj8_256"><p>Feature flags basados en permisos de usuario</p></li><li class="list-item" id="362417808#-gzhnj8_257"><p>Validaci&oacute;n en configuradores personalizados</p></li><li class="list-item" id="362417808#-gzhnj8_258"><p>Respeto a field-level security</p></li></ul></section><section><h3 id="362417808#testing" data-toc="testing#Patrones de Diseño.md-testing">Testing</h3><ul class="list" id="362417808#-gzhnj8_259" start="1"><li class="list-item" id="362417808#-gzhnj8_260"><p>Mock strategies en Strategy pattern</p></li><li class="list-item" id="362417808#-gzhnj8_261"><p>Builder pattern para datos de test</p></li><li class="list-item" id="362417808#-gzhnj8_262"><p>Provider pattern para inyecci&oacute;n de dependencias</p></li></ul></section></section><section><h2 id="362417808#evoluci-n-del-framework" data-toc="evoluci-n-del-framework#Patrones de Diseño.md-evoluci-n-del-framework">Evoluci&oacute;n del Framework</h2><section><h3 id="362417808#patrones-futuros-recomendados" data-toc="patrones-futuros-recomendados#Patrones de Diseño.md-patrones-futuros-recomendados">Patrones Futuros Recomendados</h3><ul class="list" id="362417808#-gzhnj8_265" start="1"><li class="list-item" id="362417808#-gzhnj8_266"><p><span class="control" id="362417808#-gzhnj8_270">Command Pattern:</span> Para operaciones undoable</p></li><li class="list-item" id="362417808#-gzhnj8_267"><p><span class="control" id="362417808#-gzhnj8_271">Memento Pattern:</span> Para state management</p></li><li class="list-item" id="362417808#-gzhnj8_268"><p><span class="control" id="362417808#-gzhnj8_272">Visitor Pattern:</span> Para operaciones sobre estructuras complejas</p></li><li class="list-item" id="362417808#-gzhnj8_269"><p><span class="control" id="362417808#-gzhnj8_273">Template Method:</span> Para algoritmos con pasos variables</p></li></ul></section><section><h3 id="362417808#mejoras-arquitect-nicas" data-toc="mejoras-arquitect-nicas#Patrones de Diseño.md-mejoras-arquitect-nicas">Mejoras Arquitect&oacute;nicas</h3><ul class="list" id="362417808#-gzhnj8_274" start="1"><li class="list-item" id="362417808#-gzhnj8_275"><p>Event sourcing con Observer pattern</p></li><li class="list-item" id="362417808#-gzhnj8_276"><p>CQRS con Strategy pattern</p></li><li class="list-item" id="362417808#-gzhnj8_277"><p>Microservices communication con Adapter pattern</p></li><li class="list-item" id="362417808#-gzhnj8_278"><p>Domain-driven design con Builder pattern</p></li></ul></section></section><section><h2 id="362417808#conclusi-n" data-toc="conclusi-n#Patrones de Diseño.md-conclusi-n">Conclusi&oacute;n</h2><p id="362417808#-gzhnj8_279">El Framework Foundation implementa una arquitectura s&oacute;lida basada en patrones de dise&ntilde;o probados. La combinaci&oacute;n de estos patrones crea un sistema que es:</p><ul class="list" id="362417808#-gzhnj8_280" start="1"><li class="list-item" id="362417808#-gzhnj8_282"><p><span class="control" id="362417808#-gzhnj8_287">Flexible:</span> Adaptable a diferentes requerimientos</p></li><li class="list-item" id="362417808#-gzhnj8_283"><p><span class="control" id="362417808#-gzhnj8_288">Extensible:</span> F&aacute;cil de expandir con nueva funcionalidad</p></li><li class="list-item" id="362417808#-gzhnj8_284"><p><span class="control" id="362417808#-gzhnj8_289">Mantenible:</span> C&oacute;digo limpio y bien estructurado</p></li><li class="list-item" id="362417808#-gzhnj8_285"><p><span class="control" id="362417808#-gzhnj8_290">Testeable:</span> Componentes independientes y mockeables</p></li><li class="list-item" id="362417808#-gzhnj8_286"><p><span class="control" id="362417808#-gzhnj8_291">Performante:</span> Optimizaciones integradas en el dise&ntilde;o</p></li></ul><p id="362417808#-gzhnj8_281">Esta arquitectura proporciona una base s&oacute;lida para el desarrollo de aplicaciones empresariales complejas en Salesforce, manteniendo la simplicidad de uso mientras se ofrece la flexibilidad necesaria para casos de uso avanzados.</p></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="480351126">Modelo de Datos - SURA Foundation Framework</h1><section><h2 id="480351126#resumen-ejecutivo" data-toc="resumen-ejecutivo#Modelo de Datos.md-resumen-ejecutivo">Resumen Ejecutivo</h2><p id="480351126#-yqsvq0_13">El modelo de datos de <span class="control" id="480351126#-yqsvq0_15">SURA Foundation Framework</span> est&aacute; dise&ntilde;ado para soportar la arquitectura modular y escalable del sistema. Se basa en una combinaci&oacute;n de <span class="control" id="480351126#-yqsvq0_16">Custom Objects</span> para datos transaccionales, <span class="control" id="480351126#-yqsvq0_17">Custom Metadata Types</span> para configuraci&oacute;n, y <span class="control" id="480351126#-yqsvq0_18">Platform Events</span> para comunicaci&oacute;n as&iacute;ncrona entre componentes.</p></section><section><h2 id="480351126#arquitectura-de-datos" data-toc="arquitectura-de-datos#Modelo de Datos.md-arquitectura-de-datos">🏗️ Arquitectura de Datos</h2><section><h3 id="480351126#principios-de-dise-o" data-toc="principios-de-dise-o#Modelo de Datos.md-principios-de-dise-o">Principios de Dise&ntilde;o</h3><ol class="list list-decimal" id="480351126#-yqsvq0_20" type="1" start="1"><li class="list-item" id="480351126#-yqsvq0_23"><p><span class="control" id="480351126#-yqsvq0_28">Separaci&oacute;n de Responsabilidades</span>: Datos transaccionales vs configuraci&oacute;n</p></li><li class="list-item" id="480351126#-yqsvq0_24"><p><span class="control" id="480351126#-yqsvq0_29">Flexibilidad</span>: Configuraci&oacute;n sin deployments mediante metadata</p></li><li class="list-item" id="480351126#-yqsvq0_25"><p><span class="control" id="480351126#-yqsvq0_30">Trazabilidad</span>: Log completo de eventos y transacciones</p></li><li class="list-item" id="480351126#-yqsvq0_26"><p><span class="control" id="480351126#-yqsvq0_31">Escalabilidad</span>: Modelo preparado para m&uacute;ltiples productos</p></li><li class="list-item" id="480351126#-yqsvq0_27"><p><span class="control" id="480351126#-yqsvq0_32">Integraci&oacute;n</span>: Compatibilidad con objetos est&aacute;ndar de Salesforce/Vlocity</p></li></ol><div class="detached code-block" id="480351126#-yqsvq0_21"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────────┐
│                    FOUNDATION DATA MODEL                       │
│                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   TRANSACTION   │  │  CONFIGURATION  │  │     EVENTS      │ │
│  │     DATA        │  │     DATA        │  │     DATA        │ │
│  │                 │  │                 │  │                 │ │
│  │ • Custom Objects│  │ • Custom        │  │ • Platform      │ │
│  │ • Standard      │  │   Metadata      │  │   Events        │ │
│  │   Objects       │  │ • Custom        │  │ • Event Logs    │ │
│  │ • Vlocity       │  │   Settings      │  │                 │ │
│  │   Objects       │  │                 │  │                 │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────────┘</code></pre></div></section></section><section><h2 id="480351126#custom-objects-principales" data-toc="custom-objects-principales#Modelo de Datos.md-custom-objects-principales">📊 Custom Objects Principales</h2><section><h3 id="480351126#1-sffoundation-eventlog-c" data-toc="1-sffoundation-eventlog-c#Modelo de Datos.md-1-sffoundation-eventlog-c">1. SFFoundation_EventLog__c</h3><p id="480351126#-yqsvq0_36"><span class="control" id="480351126#-yqsvq0_40">Prop&oacute;sito</span>: Registro centralizado de eventos del framework</p><div class="table-wrapper detached"><table id="480351126#-yqsvq0_37"><tr class="header-row" id="480351126#-yqsvq0_41"><th id="480351126#-yqsvq0_56"><p>Campo</p></th><th id="480351126#-yqsvq0_57"><p>Tipo</p></th><th id="480351126#-yqsvq0_58"><p>Descripci&oacute;n</p></th></tr><tr class="" id="480351126#-yqsvq0_42"><td id="480351126#-yqsvq0_59"><p><span class="inline-code" id="480351126#-yqsvq0_62">Name</span></p></td><td id="480351126#-yqsvq0_60"><p>Auto Number</p></td><td id="480351126#-yqsvq0_61"><p>Identificador &uacute;nico del evento (EL-{0000})</p></td></tr><tr class="" id="480351126#-yqsvq0_43"><td id="480351126#-yqsvq0_63"><p><span class="inline-code" id="480351126#-yqsvq0_66">EventType__c</span></p></td><td id="480351126#-yqsvq0_64"><p>Picklist</p></td><td id="480351126#-yqsvq0_65"><p>Tipo de evento (Process, Integration, Error, etc.)</p></td></tr><tr class="" id="480351126#-yqsvq0_44"><td id="480351126#-yqsvq0_67"><p><span class="inline-code" id="480351126#-yqsvq0_70">ProcessName__c</span></p></td><td id="480351126#-yqsvq0_68"><p>Text(255)</p></td><td id="480351126#-yqsvq0_69"><p>Nombre del proceso que gener&oacute; el evento</p></td></tr><tr class="" id="480351126#-yqsvq0_45"><td id="480351126#-yqsvq0_71"><p><span class="inline-code" id="480351126#-yqsvq0_74">ProductFamily__c</span></p></td><td id="480351126#-yqsvq0_72"><p>Picklist</p></td><td id="480351126#-yqsvq0_73"><p>Familia de producto (Motos, Autos, Viajes, etc.)</p></td></tr><tr class="" id="480351126#-yqsvq0_46"><td id="480351126#-yqsvq0_75"><p><span class="inline-code" id="480351126#-yqsvq0_78">Stage__c</span></p></td><td id="480351126#-yqsvq0_76"><p>Picklist</p></td><td id="480351126#-yqsvq0_77"><p>Etapa del proceso (Conocimiento, Tarificaci&oacute;n, etc.)</p></td></tr><tr class="" id="480351126#-yqsvq0_47"><td id="480351126#-yqsvq0_79"><p><span class="inline-code" id="480351126#-yqsvq0_82">Status__c</span></p></td><td id="480351126#-yqsvq0_80"><p>Picklist</p></td><td id="480351126#-yqsvq0_81"><p>Estado del evento (Success, Error, Warning, Info)</p></td></tr><tr class="" id="480351126#-yqsvq0_48"><td id="480351126#-yqsvq0_83"><p><span class="inline-code" id="480351126#-yqsvq0_86">Message__c</span></p></td><td id="480351126#-yqsvq0_84"><p>Long Text</p></td><td id="480351126#-yqsvq0_85"><p>Mensaje detallado del evento</p></td></tr><tr class="" id="480351126#-yqsvq0_49"><td id="480351126#-yqsvq0_87"><p><span class="inline-code" id="480351126#-yqsvq0_90">StackTrace__c</span></p></td><td id="480351126#-yqsvq0_88"><p>Long Text</p></td><td id="480351126#-yqsvq0_89"><p>Stack trace en caso de errores</p></td></tr><tr class="" id="480351126#-yqsvq0_50"><td id="480351126#-yqsvq0_91"><p><span class="inline-code" id="480351126#-yqsvq0_94">RecordId__c</span></p></td><td id="480351126#-yqsvq0_92"><p>Text(18)</p></td><td id="480351126#-yqsvq0_93"><p>ID del registro relacionado</p></td></tr><tr class="" id="480351126#-yqsvq0_51"><td id="480351126#-yqsvq0_95"><p><span class="inline-code" id="480351126#-yqsvq0_98">UserId__c</span></p></td><td id="480351126#-yqsvq0_96"><p>Lookup(User)</p></td><td id="480351126#-yqsvq0_97"><p>Usuario que ejecut&oacute; la acci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_52"><td id="480351126#-yqsvq0_99"><p><span class="inline-code" id="480351126#-yqsvq0_102">SessionId__c</span></p></td><td id="480351126#-yqsvq0_100"><p>Text(255)</p></td><td id="480351126#-yqsvq0_101"><p>ID de sesi&oacute;n para trazabilidad</p></td></tr><tr class="" id="480351126#-yqsvq0_53"><td id="480351126#-yqsvq0_103"><p><span class="inline-code" id="480351126#-yqsvq0_106">ExecutionTime__c</span></p></td><td id="480351126#-yqsvq0_104"><p>Number(10,2)</p></td><td id="480351126#-yqsvq0_105"><p>Tiempo de ejecuci&oacute;n en milisegundos</p></td></tr><tr class="" id="480351126#-yqsvq0_54"><td id="480351126#-yqsvq0_107"><p><span class="inline-code" id="480351126#-yqsvq0_110">Payload__c</span></p></td><td id="480351126#-yqsvq0_108"><p>Long Text</p></td><td id="480351126#-yqsvq0_109"><p>Datos de entrada/salida (JSON)</p></td></tr><tr class="" id="480351126#-yqsvq0_55"><td id="480351126#-yqsvq0_111"><p><span class="inline-code" id="480351126#-yqsvq0_114">CreatedDate</span></p></td><td id="480351126#-yqsvq0_112"><p>DateTime</p></td><td id="480351126#-yqsvq0_113"><p>Fecha y hora de creaci&oacute;n</p></td></tr></table></div><p id="480351126#-yqsvq0_38"><span class="control" id="480351126#-yqsvq0_115">&Iacute;ndices:</span></p><ul class="list" id="480351126#-yqsvq0_39" start="1"><li class="list-item" id="480351126#-yqsvq0_116"><p><span class="inline-code" id="480351126#-yqsvq0_119">EventType__c, CreatedDate</span></p></li><li class="list-item" id="480351126#-yqsvq0_117"><p><span class="inline-code" id="480351126#-yqsvq0_120">ProcessName__c, Status__c</span></p></li><li class="list-item" id="480351126#-yqsvq0_118"><p><span class="inline-code" id="480351126#-yqsvq0_121">ProductFamily__c, Stage__c</span></p></li></ul></section><section><h3 id="480351126#2-sffoundation-processexecution-c" data-toc="2-sffoundation-processexecution-c#Modelo de Datos.md-2-sffoundation-processexecution-c">2. SFFoundation_ProcessExecution__c</h3><p id="480351126#-yqsvq0_122"><span class="control" id="480351126#-yqsvq0_124">Prop&oacute;sito</span>: Seguimiento de ejecuciones de procesos</p><div class="table-wrapper detached"><table id="480351126#-yqsvq0_123"><tr class="header-row" id="480351126#-yqsvq0_125"><th id="480351126#-yqsvq0_144"><p>Campo</p></th><th id="480351126#-yqsvq0_145"><p>Tipo</p></th><th id="480351126#-yqsvq0_146"><p>Descripci&oacute;n</p></th></tr><tr class="" id="480351126#-yqsvq0_126"><td id="480351126#-yqsvq0_147"><p><span class="inline-code" id="480351126#-yqsvq0_150">Name</span></p></td><td id="480351126#-yqsvq0_148"><p>Auto Number</p></td><td id="480351126#-yqsvq0_149"><p>N&uacute;mero de ejecuci&oacute;n (PE-{0000})</p></td></tr><tr class="" id="480351126#-yqsvq0_127"><td id="480351126#-yqsvq0_151"><p><span class="inline-code" id="480351126#-yqsvq0_154">ProcessName__c</span></p></td><td id="480351126#-yqsvq0_152"><p>Text(255)</p></td><td id="480351126#-yqsvq0_153"><p>Nombre del proceso ejecutado</p></td></tr><tr class="" id="480351126#-yqsvq0_128"><td id="480351126#-yqsvq0_155"><p><span class="inline-code" id="480351126#-yqsvq0_158">ProductFamily__c</span></p></td><td id="480351126#-yqsvq0_156"><p>Picklist</p></td><td id="480351126#-yqsvq0_157"><p>Familia de producto</p></td></tr><tr class="" id="480351126#-yqsvq0_129"><td id="480351126#-yqsvq0_159"><p><span class="inline-code" id="480351126#-yqsvq0_162">HandlerClass__c</span></p></td><td id="480351126#-yqsvq0_160"><p>Text(255)</p></td><td id="480351126#-yqsvq0_161"><p>Clase handler ejecutada</p></td></tr><tr class="" id="480351126#-yqsvq0_130"><td id="480351126#-yqsvq0_163"><p><span class="inline-code" id="480351126#-yqsvq0_166">Stage__c</span></p></td><td id="480351126#-yqsvq0_164"><p>Picklist</p></td><td id="480351126#-yqsvq0_165"><p>Etapa del proceso</p></td></tr><tr class="" id="480351126#-yqsvq0_131"><td id="480351126#-yqsvq0_167"><p><span class="inline-code" id="480351126#-yqsvq0_170">Phase__c</span></p></td><td id="480351126#-yqsvq0_168"><p>Picklist</p></td><td id="480351126#-yqsvq0_169"><p>Fase (Pre, In, Pos)</p></td></tr><tr class="" id="480351126#-yqsvq0_132"><td id="480351126#-yqsvq0_171"><p><span class="inline-code" id="480351126#-yqsvq0_174">Status__c</span></p></td><td id="480351126#-yqsvq0_172"><p>Picklist</p></td><td id="480351126#-yqsvq0_173"><p>Estado (Running, Completed, Failed)</p></td></tr><tr class="" id="480351126#-yqsvq0_133"><td id="480351126#-yqsvq0_175"><p><span class="inline-code" id="480351126#-yqsvq0_178">StartTime__c</span></p></td><td id="480351126#-yqsvq0_176"><p>DateTime</p></td><td id="480351126#-yqsvq0_177"><p>Hora de inicio</p></td></tr><tr class="" id="480351126#-yqsvq0_134"><td id="480351126#-yqsvq0_179"><p><span class="inline-code" id="480351126#-yqsvq0_182">EndTime__c</span></p></td><td id="480351126#-yqsvq0_180"><p>DateTime</p></td><td id="480351126#-yqsvq0_181"><p>Hora de finalizaci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_135"><td id="480351126#-yqsvq0_183"><p><span class="inline-code" id="480351126#-yqsvq0_186">Duration__c</span></p></td><td id="480351126#-yqsvq0_184"><p>Number(10,2)</p></td><td id="480351126#-yqsvq0_185"><p>Duraci&oacute;n en milisegundos</p></td></tr><tr class="" id="480351126#-yqsvq0_136"><td id="480351126#-yqsvq0_187"><p><span class="inline-code" id="480351126#-yqsvq0_190">InputParameters__c</span></p></td><td id="480351126#-yqsvq0_188"><p>Long Text</p></td><td id="480351126#-yqsvq0_189"><p>Par&aacute;metros de entrada (JSON)</p></td></tr><tr class="" id="480351126#-yqsvq0_137"><td id="480351126#-yqsvq0_191"><p><span class="inline-code" id="480351126#-yqsvq0_194">OutputParameters__c</span></p></td><td id="480351126#-yqsvq0_192"><p>Long Text</p></td><td id="480351126#-yqsvq0_193"><p>Par&aacute;metros de salida (JSON)</p></td></tr><tr class="" id="480351126#-yqsvq0_138"><td id="480351126#-yqsvq0_195"><p><span class="inline-code" id="480351126#-yqsvq0_198">ErrorMessage__c</span></p></td><td id="480351126#-yqsvq0_196"><p>Long Text</p></td><td id="480351126#-yqsvq0_197"><p>Mensaje de error si aplica</p></td></tr><tr class="" id="480351126#-yqsvq0_139"><td id="480351126#-yqsvq0_199"><p><span class="inline-code" id="480351126#-yqsvq0_202">ParentExecution__c</span></p></td><td id="480351126#-yqsvq0_200"><p>Lookup(SFFoundation_ProcessExecution__c)</p></td><td id="480351126#-yqsvq0_201"><p>Ejecuci&oacute;n padre</p></td></tr><tr class="" id="480351126#-yqsvq0_140"><td id="480351126#-yqsvq0_203"><p><span class="inline-code" id="480351126#-yqsvq0_206">LeadId__c</span></p></td><td id="480351126#-yqsvq0_204"><p>Lookup(Lead)</p></td><td id="480351126#-yqsvq0_205"><p>Lead relacionado</p></td></tr><tr class="" id="480351126#-yqsvq0_141"><td id="480351126#-yqsvq0_207"><p><span class="inline-code" id="480351126#-yqsvq0_210">OpportunityId__c</span></p></td><td id="480351126#-yqsvq0_208"><p>Lookup(Opportunity)</p></td><td id="480351126#-yqsvq0_209"><p>Oportunidad relacionada</p></td></tr><tr class="" id="480351126#-yqsvq0_142"><td id="480351126#-yqsvq0_211"><p><span class="inline-code" id="480351126#-yqsvq0_214">QuoteId__c</span></p></td><td id="480351126#-yqsvq0_212"><p>Lookup(Quote)</p></td><td id="480351126#-yqsvq0_213"><p>Cotizaci&oacute;n relacionada</p></td></tr><tr class="" id="480351126#-yqsvq0_143"><td id="480351126#-yqsvq0_215"><p><span class="inline-code" id="480351126#-yqsvq0_218">PolicyId__c</span></p></td><td id="480351126#-yqsvq0_216"><p>Text(255)</p></td><td id="480351126#-yqsvq0_217"><p>ID de p&oacute;liza externa</p></td></tr></table></div></section><section><h3 id="480351126#3-sffoundation-integrationlog-c" data-toc="3-sffoundation-integrationlog-c#Modelo de Datos.md-3-sffoundation-integrationlog-c">3. SFFoundation_IntegrationLog__c</h3><p id="480351126#-yqsvq0_219"><span class="control" id="480351126#-yqsvq0_222">Prop&oacute;sito</span>: Log de integraciones con servicios externos</p><div class="table-wrapper detached"><table id="480351126#-yqsvq0_220"><tr class="header-row" id="480351126#-yqsvq0_223"><th id="480351126#-yqsvq0_242"><p>Campo</p></th><th id="480351126#-yqsvq0_243"><p>Tipo</p></th><th id="480351126#-yqsvq0_244"><p>Descripci&oacute;n</p></th></tr><tr class="" id="480351126#-yqsvq0_224"><td id="480351126#-yqsvq0_245"><p><span class="inline-code" id="480351126#-yqsvq0_248">Name</span></p></td><td id="480351126#-yqsvq0_246"><p>Auto Number</p></td><td id="480351126#-yqsvq0_247"><p>N&uacute;mero de integraci&oacute;n (IL-{0000})</p></td></tr><tr class="" id="480351126#-yqsvq0_225"><td id="480351126#-yqsvq0_249"><p><span class="inline-code" id="480351126#-yqsvq0_252">ServiceName__c</span></p></td><td id="480351126#-yqsvq0_250"><p>Text(255)</p></td><td id="480351126#-yqsvq0_251"><p>Nombre del servicio integrado</p></td></tr><tr class="" id="480351126#-yqsvq0_226"><td id="480351126#-yqsvq0_253"><p><span class="inline-code" id="480351126#-yqsvq0_256">Endpoint__c</span></p></td><td id="480351126#-yqsvq0_254"><p>Text(255)</p></td><td id="480351126#-yqsvq0_255"><p>URL del endpoint</p></td></tr><tr class="" id="480351126#-yqsvq0_227"><td id="480351126#-yqsvq0_257"><p><span class="inline-code" id="480351126#-yqsvq0_260">HttpMethod__c</span></p></td><td id="480351126#-yqsvq0_258"><p>Picklist</p></td><td id="480351126#-yqsvq0_259"><p>M&eacute;todo HTTP (GET, POST, PUT, DELETE)</p></td></tr><tr class="" id="480351126#-yqsvq0_228"><td id="480351126#-yqsvq0_261"><p><span class="inline-code" id="480351126#-yqsvq0_264">RequestHeaders__c</span></p></td><td id="480351126#-yqsvq0_262"><p>Long Text</p></td><td id="480351126#-yqsvq0_263"><p>Headers de la request (JSON)</p></td></tr><tr class="" id="480351126#-yqsvq0_229"><td id="480351126#-yqsvq0_265"><p><span class="inline-code" id="480351126#-yqsvq0_268">RequestBody__c</span></p></td><td id="480351126#-yqsvq0_266"><p>Long Text</p></td><td id="480351126#-yqsvq0_267"><p>Cuerpo de la request</p></td></tr><tr class="" id="480351126#-yqsvq0_230"><td id="480351126#-yqsvq0_269"><p><span class="inline-code" id="480351126#-yqsvq0_272">ResponseStatus__c</span></p></td><td id="480351126#-yqsvq0_270"><p>Number(3,0)</p></td><td id="480351126#-yqsvq0_271"><p>C&oacute;digo de estado HTTP</p></td></tr><tr class="" id="480351126#-yqsvq0_231"><td id="480351126#-yqsvq0_273"><p><span class="inline-code" id="480351126#-yqsvq0_276">ResponseHeaders__c</span></p></td><td id="480351126#-yqsvq0_274"><p>Long Text</p></td><td id="480351126#-yqsvq0_275"><p>Headers de la response (JSON)</p></td></tr><tr class="" id="480351126#-yqsvq0_232"><td id="480351126#-yqsvq0_277"><p><span class="inline-code" id="480351126#-yqsvq0_280">ResponseBody__c</span></p></td><td id="480351126#-yqsvq0_278"><p>Long Text</p></td><td id="480351126#-yqsvq0_279"><p>Cuerpo de la response</p></td></tr><tr class="" id="480351126#-yqsvq0_233"><td id="480351126#-yqsvq0_281"><p><span class="inline-code" id="480351126#-yqsvq0_284">RequestTime__c</span></p></td><td id="480351126#-yqsvq0_282"><p>DateTime</p></td><td id="480351126#-yqsvq0_283"><p>Hora de env&iacute;o</p></td></tr><tr class="" id="480351126#-yqsvq0_234"><td id="480351126#-yqsvq0_285"><p><span class="inline-code" id="480351126#-yqsvq0_288">ResponseTime__c</span></p></td><td id="480351126#-yqsvq0_286"><p>DateTime</p></td><td id="480351126#-yqsvq0_287"><p>Hora de respuesta</p></td></tr><tr class="" id="480351126#-yqsvq0_235"><td id="480351126#-yqsvq0_289"><p><span class="inline-code" id="480351126#-yqsvq0_292">Duration__c</span></p></td><td id="480351126#-yqsvq0_290"><p>Number(10,2)</p></td><td id="480351126#-yqsvq0_291"><p>Duraci&oacute;n en milisegundos</p></td></tr><tr class="" id="480351126#-yqsvq0_236"><td id="480351126#-yqsvq0_293"><p><span class="inline-code" id="480351126#-yqsvq0_296">RetryAttempt__c</span></p></td><td id="480351126#-yqsvq0_294"><p>Number(2,0)</p></td><td id="480351126#-yqsvq0_295"><p>N&uacute;mero de intento</p></td></tr><tr class="" id="480351126#-yqsvq0_237"><td id="480351126#-yqsvq0_297"><p><span class="inline-code" id="480351126#-yqsvq0_300">MaxRetries__c</span></p></td><td id="480351126#-yqsvq0_298"><p>Number(2,0)</p></td><td id="480351126#-yqsvq0_299"><p>M&aacute;ximo n&uacute;mero de reintentos</p></td></tr><tr class="" id="480351126#-yqsvq0_238"><td id="480351126#-yqsvq0_301"><p><span class="inline-code" id="480351126#-yqsvq0_304">IsSuccess__c</span></p></td><td id="480351126#-yqsvq0_302"><p>Checkbox</p></td><td id="480351126#-yqsvq0_303"><p>Indica si fue exitosa</p></td></tr><tr class="" id="480351126#-yqsvq0_239"><td id="480351126#-yqsvq0_305"><p><span class="inline-code" id="480351126#-yqsvq0_308">ErrorCode__c</span></p></td><td id="480351126#-yqsvq0_306"><p>Text(50)</p></td><td id="480351126#-yqsvq0_307"><p>C&oacute;digo de error interno</p></td></tr><tr class="" id="480351126#-yqsvq0_240"><td id="480351126#-yqsvq0_309"><p><span class="inline-code" id="480351126#-yqsvq0_312">ErrorMessage__c</span></p></td><td id="480351126#-yqsvq0_310"><p>Text(255)</p></td><td id="480351126#-yqsvq0_311"><p>Mensaje de error</p></td></tr><tr class="" id="480351126#-yqsvq0_241"><td id="480351126#-yqsvq0_313"><p><span class="inline-code" id="480351126#-yqsvq0_316">ProcessExecutionId__c</span></p></td><td id="480351126#-yqsvq0_314"><p>Lookup(SFFoundation_ProcessExecution__c)</p></td><td id="480351126#-yqsvq0_315"><p>Ejecuci&oacute;n relacionada</p></td></tr></table></div></section></section><section><h2 id="480351126#custom-metadata-types" data-toc="custom-metadata-types#Modelo de Datos.md-custom-metadata-types">⚙️ Custom Metadata Types</h2><section><h3 id="480351126#1-sffoundation-processconfiguration-mdt" data-toc="1-sffoundation-processconfiguration-mdt#Modelo de Datos.md-1-sffoundation-processconfiguration-mdt">1. SFFoundation_ProcessConfiguration__mdt</h3><p id="480351126#-yqsvq0_321"><span class="control" id="480351126#-yqsvq0_325">Prop&oacute;sito</span>: Configuraci&oacute;n de procesos por producto y etapa</p><div class="table-wrapper detached"><table id="480351126#-yqsvq0_322"><tr class="header-row" id="480351126#-yqsvq0_326"><th id="480351126#-yqsvq0_337"><p>Campo</p></th><th id="480351126#-yqsvq0_338"><p>Tipo</p></th><th id="480351126#-yqsvq0_339"><p>Descripci&oacute;n</p></th></tr><tr class="" id="480351126#-yqsvq0_327"><td id="480351126#-yqsvq0_340"><p><span class="inline-code" id="480351126#-yqsvq0_343">DeveloperName</span></p></td><td id="480351126#-yqsvq0_341"><p>Text(40)</p></td><td id="480351126#-yqsvq0_342"><p>Nombre &uacute;nico del proceso</p></td></tr><tr class="" id="480351126#-yqsvq0_328"><td id="480351126#-yqsvq0_344"><p><span class="inline-code" id="480351126#-yqsvq0_347">MasterLabel</span></p></td><td id="480351126#-yqsvq0_345"><p>Text(40)</p></td><td id="480351126#-yqsvq0_346"><p>Etiqueta del proceso</p></td></tr><tr class="" id="480351126#-yqsvq0_329"><td id="480351126#-yqsvq0_348"><p><span class="inline-code" id="480351126#-yqsvq0_351">ProductFamily__c</span></p></td><td id="480351126#-yqsvq0_349"><p>Text(255)</p></td><td id="480351126#-yqsvq0_350"><p>Familia de producto</p></td></tr><tr class="" id="480351126#-yqsvq0_330"><td id="480351126#-yqsvq0_352"><p><span class="inline-code" id="480351126#-yqsvq0_355">Stage__c</span></p></td><td id="480351126#-yqsvq0_353"><p>Text(255)</p></td><td id="480351126#-yqsvq0_354"><p>Etapa del proceso</p></td></tr><tr class="" id="480351126#-yqsvq0_331"><td id="480351126#-yqsvq0_356"><p><span class="inline-code" id="480351126#-yqsvq0_359">HandlerClass__c</span></p></td><td id="480351126#-yqsvq0_357"><p>Text(255)</p></td><td id="480351126#-yqsvq0_358"><p>Clase Apex del handler</p></td></tr><tr class="" id="480351126#-yqsvq0_332"><td id="480351126#-yqsvq0_360"><p><span class="inline-code" id="480351126#-yqsvq0_363">Order__c</span></p></td><td id="480351126#-yqsvq0_361"><p>Number(3,0)</p></td><td id="480351126#-yqsvq0_362"><p>Orden de ejecuci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_333"><td id="480351126#-yqsvq0_364"><p><span class="inline-code" id="480351126#-yqsvq0_367">IsActive__c</span></p></td><td id="480351126#-yqsvq0_365"><p>Checkbox</p></td><td id="480351126#-yqsvq0_366"><p>Indica si est&aacute; activo</p></td></tr><tr class="" id="480351126#-yqsvq0_334"><td id="480351126#-yqsvq0_368"><p><span class="inline-code" id="480351126#-yqsvq0_371">Description__c</span></p></td><td id="480351126#-yqsvq0_369"><p>Text(255)</p></td><td id="480351126#-yqsvq0_370"><p>Descripci&oacute;n del proceso</p></td></tr><tr class="" id="480351126#-yqsvq0_335"><td id="480351126#-yqsvq0_372"><p><span class="inline-code" id="480351126#-yqsvq0_375">ApiName__c</span></p></td><td id="480351126#-yqsvq0_373"><p>Text(255)</p></td><td id="480351126#-yqsvq0_374"><p>Nombre de API para referencias</p></td></tr><tr class="" id="480351126#-yqsvq0_336"><td id="480351126#-yqsvq0_376"><p><span class="inline-code" id="480351126#-yqsvq0_379">ConfigurationJSON__c</span></p></td><td id="480351126#-yqsvq0_377"><p>Long Text</p></td><td id="480351126#-yqsvq0_378"><p>Configuraci&oacute;n adicional (JSON)</p></td></tr></table></div><p id="480351126#-yqsvq0_323"><span class="control" id="480351126#-yqsvq0_380">Ejemplo de registros:</span></p><div class="detached code-block" id="480351126#-yqsvq0_324"><pre><code class="language-none">Lead_Motos_Conocimiento:
  ProductFamily__c: &quot;Seguros de Motos&quot;
  Stage__c: &quot;Conocimiento&quot;
  HandlerClass__c: &quot;MT_Kn_123&quot;
  Order__c: 0
  IsActive__c: true

Rate_Autos_Tarificacion:
  ProductFamily__c: &quot;Seguros de Autos&quot;
  Stage__c: &quot;Tarificación&quot;
  HandlerClass__c: &quot;AU_Rt_456&quot;
  Order__c: 0
  IsActive__c: true</code></pre></div></section><section><h3 id="480351126#2-sffoundation-featureflag-mdt" data-toc="2-sffoundation-featureflag-mdt#Modelo de Datos.md-2-sffoundation-featureflag-mdt">2. SFFoundation_FeatureFlag__mdt</h3><p id="480351126#-yqsvq0_381"><span class="control" id="480351126#-yqsvq0_383">Prop&oacute;sito</span>: Control de funcionalidades por ambiente</p><div class="table-wrapper detached"><table id="480351126#-yqsvq0_382"><tr class="header-row" id="480351126#-yqsvq0_384"><th id="480351126#-yqsvq0_395"><p>Campo</p></th><th id="480351126#-yqsvq0_396"><p>Tipo</p></th><th id="480351126#-yqsvq0_397"><p>Descripci&oacute;n</p></th></tr><tr class="" id="480351126#-yqsvq0_385"><td id="480351126#-yqsvq0_398"><p><span class="inline-code" id="480351126#-yqsvq0_401">DeveloperName</span></p></td><td id="480351126#-yqsvq0_399"><p>Text(40)</p></td><td id="480351126#-yqsvq0_400"><p>Nombre &uacute;nico del feature</p></td></tr><tr class="" id="480351126#-yqsvq0_386"><td id="480351126#-yqsvq0_402"><p><span class="inline-code" id="480351126#-yqsvq0_405">MasterLabel</span></p></td><td id="480351126#-yqsvq0_403"><p>Text(40)</p></td><td id="480351126#-yqsvq0_404"><p>Etiqueta del feature</p></td></tr><tr class="" id="480351126#-yqsvq0_387"><td id="480351126#-yqsvq0_406"><p><span class="inline-code" id="480351126#-yqsvq0_409">IsEnabled__c</span></p></td><td id="480351126#-yqsvq0_407"><p>Checkbox</p></td><td id="480351126#-yqsvq0_408"><p>Indica si est&aacute; habilitado</p></td></tr><tr class="" id="480351126#-yqsvq0_388"><td id="480351126#-yqsvq0_410"><p><span class="inline-code" id="480351126#-yqsvq0_413">Environment__c</span></p></td><td id="480351126#-yqsvq0_411"><p>Text(50)</p></td><td id="480351126#-yqsvq0_412"><p>Ambiente (Sandbox, Production, etc.)</p></td></tr><tr class="" id="480351126#-yqsvq0_389"><td id="480351126#-yqsvq0_414"><p><span class="inline-code" id="480351126#-yqsvq0_417">Scope__c</span></p></td><td id="480351126#-yqsvq0_415"><p>Picklist</p></td><td id="480351126#-yqsvq0_416"><p>Alcance (Global, Product, Process)</p></td></tr><tr class="" id="480351126#-yqsvq0_390"><td id="480351126#-yqsvq0_418"><p><span class="inline-code" id="480351126#-yqsvq0_421">ProductFamily__c</span></p></td><td id="480351126#-yqsvq0_419"><p>Text(255)</p></td><td id="480351126#-yqsvq0_420"><p>Familia de producto espec&iacute;fica</p></td></tr><tr class="" id="480351126#-yqsvq0_391"><td id="480351126#-yqsvq0_422"><p><span class="inline-code" id="480351126#-yqsvq0_425">Description__c</span></p></td><td id="480351126#-yqsvq0_423"><p>Text(255)</p></td><td id="480351126#-yqsvq0_424"><p>Descripci&oacute;n de la funcionalidad</p></td></tr><tr class="" id="480351126#-yqsvq0_392"><td id="480351126#-yqsvq0_426"><p><span class="inline-code" id="480351126#-yqsvq0_429">EffectiveDate__c</span></p></td><td id="480351126#-yqsvq0_427"><p>Date</p></td><td id="480351126#-yqsvq0_428"><p>Fecha de activaci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_393"><td id="480351126#-yqsvq0_430"><p><span class="inline-code" id="480351126#-yqsvq0_433">ExpirationDate__c</span></p></td><td id="480351126#-yqsvq0_431"><p>Date</p></td><td id="480351126#-yqsvq0_432"><p>Fecha de expiraci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_394"><td id="480351126#-yqsvq0_434"><p><span class="inline-code" id="480351126#-yqsvq0_437">ConfigurationJSON__c</span></p></td><td id="480351126#-yqsvq0_435"><p>Long Text</p></td><td id="480351126#-yqsvq0_436"><p>Configuraci&oacute;n espec&iacute;fica (JSON)</p></td></tr></table></div></section><section><h3 id="480351126#3-sffoundation-integrationconfiguration-mdt" data-toc="3-sffoundation-integrationconfiguration-mdt#Modelo de Datos.md-3-sffoundation-integrationconfiguration-mdt">3. SFFoundation_IntegrationConfiguration__mdt</h3><p id="480351126#-yqsvq0_438"><span class="control" id="480351126#-yqsvq0_440">Prop&oacute;sito</span>: Configuraci&oacute;n de integraciones externas</p><div class="table-wrapper detached"><table id="480351126#-yqsvq0_439"><tr class="header-row" id="480351126#-yqsvq0_441"><th id="480351126#-yqsvq0_454"><p>Campo</p></th><th id="480351126#-yqsvq0_455"><p>Tipo</p></th><th id="480351126#-yqsvq0_456"><p>Descripci&oacute;n</p></th></tr><tr class="" id="480351126#-yqsvq0_442"><td id="480351126#-yqsvq0_457"><p><span class="inline-code" id="480351126#-yqsvq0_460">DeveloperName</span></p></td><td id="480351126#-yqsvq0_458"><p>Text(40)</p></td><td id="480351126#-yqsvq0_459"><p>Nombre &uacute;nico de la integraci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_443"><td id="480351126#-yqsvq0_461"><p><span class="inline-code" id="480351126#-yqsvq0_464">MasterLabel</span></p></td><td id="480351126#-yqsvq0_462"><p>Text(40)</p></td><td id="480351126#-yqsvq0_463"><p>Etiqueta de la integraci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_444"><td id="480351126#-yqsvq0_465"><p><span class="inline-code" id="480351126#-yqsvq0_468">ServiceName__c</span></p></td><td id="480351126#-yqsvq0_466"><p>Text(255)</p></td><td id="480351126#-yqsvq0_467"><p>Nombre del servicio</p></td></tr><tr class="" id="480351126#-yqsvq0_445"><td id="480351126#-yqsvq0_469"><p><span class="inline-code" id="480351126#-yqsvq0_472">BaseURL__c</span></p></td><td id="480351126#-yqsvq0_470"><p>Text(255)</p></td><td id="480351126#-yqsvq0_471"><p>URL base del servicio</p></td></tr><tr class="" id="480351126#-yqsvq0_446"><td id="480351126#-yqsvq0_473"><p><span class="inline-code" id="480351126#-yqsvq0_476">AuthMethod__c</span></p></td><td id="480351126#-yqsvq0_474"><p>Picklist</p></td><td id="480351126#-yqsvq0_475"><p>M&eacute;todo de autenticaci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_447"><td id="480351126#-yqsvq0_477"><p><span class="inline-code" id="480351126#-yqsvq0_480">TimeoutMs__c</span></p></td><td id="480351126#-yqsvq0_478"><p>Number(5,0)</p></td><td id="480351126#-yqsvq0_479"><p>Timeout en milisegundos</p></td></tr><tr class="" id="480351126#-yqsvq0_448"><td id="480351126#-yqsvq0_481"><p><span class="inline-code" id="480351126#-yqsvq0_484">MaxRetries__c</span></p></td><td id="480351126#-yqsvq0_482"><p>Number(2,0)</p></td><td id="480351126#-yqsvq0_483"><p>M&aacute;ximo n&uacute;mero de reintentos</p></td></tr><tr class="" id="480351126#-yqsvq0_449"><td id="480351126#-yqsvq0_485"><p><span class="inline-code" id="480351126#-yqsvq0_488">RetryPattern__c</span></p></td><td id="480351126#-yqsvq0_486"><p>Picklist</p></td><td id="480351126#-yqsvq0_487"><p>Patr&oacute;n de reintento (Fixed, Incremental, Fibonacci)</p></td></tr><tr class="" id="480351126#-yqsvq0_450"><td id="480351126#-yqsvq0_489"><p><span class="inline-code" id="480351126#-yqsvq0_492">RetryIntervalMs__c</span></p></td><td id="480351126#-yqsvq0_490"><p>Number(4,0)</p></td><td id="480351126#-yqsvq0_491"><p>Intervalo base de reintento</p></td></tr><tr class="" id="480351126#-yqsvq0_451"><td id="480351126#-yqsvq0_493"><p><span class="inline-code" id="480351126#-yqsvq0_496">RetryOnHttpCodes__c</span></p></td><td id="480351126#-yqsvq0_494"><p>Text(255)</p></td><td id="480351126#-yqsvq0_495"><p>C&oacute;digos HTTP que activan reintento</p></td></tr><tr class="" id="480351126#-yqsvq0_452"><td id="480351126#-yqsvq0_497"><p><span class="inline-code" id="480351126#-yqsvq0_500">IsActive__c</span></p></td><td id="480351126#-yqsvq0_498"><p>Checkbox</p></td><td id="480351126#-yqsvq0_499"><p>Indica si est&aacute; activa</p></td></tr><tr class="" id="480351126#-yqsvq0_453"><td id="480351126#-yqsvq0_501"><p><span class="inline-code" id="480351126#-yqsvq0_504">Description__c</span></p></td><td id="480351126#-yqsvq0_502"><p>Text(255)</p></td><td id="480351126#-yqsvq0_503"><p>Descripci&oacute;n de la integraci&oacute;n</p></td></tr></table></div></section><section><h3 id="480351126#4-sffoundation-eventlogconfiguration-mdt" data-toc="4-sffoundation-eventlogconfiguration-mdt#Modelo de Datos.md-4-sffoundation-eventlogconfiguration-mdt">4. SFFoundation_EventLogConfiguration__mdt</h3><p id="480351126#-yqsvq0_505"><span class="control" id="480351126#-yqsvq0_508">Prop&oacute;sito</span>: Configuraci&oacute;n del sistema de logging</p><div class="table-wrapper detached"><table id="480351126#-yqsvq0_506"><tr class="header-row" id="480351126#-yqsvq0_509"><th id="480351126#-yqsvq0_519"><p>Campo</p></th><th id="480351126#-yqsvq0_520"><p>Tipo</p></th><th id="480351126#-yqsvq0_521"><p>Descripci&oacute;n</p></th></tr><tr class="" id="480351126#-yqsvq0_510"><td id="480351126#-yqsvq0_522"><p><span class="inline-code" id="480351126#-yqsvq0_525">DeveloperName</span></p></td><td id="480351126#-yqsvq0_523"><p>Text(40)</p></td><td id="480351126#-yqsvq0_524"><p>Nombre &uacute;nico de configuraci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_511"><td id="480351126#-yqsvq0_526"><p><span class="inline-code" id="480351126#-yqsvq0_529">MasterLabel</span></p></td><td id="480351126#-yqsvq0_527"><p>Text(40)</p></td><td id="480351126#-yqsvq0_528"><p>Etiqueta de configuraci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_512"><td id="480351126#-yqsvq0_530"><p><span class="inline-code" id="480351126#-yqsvq0_533">LogLevel__c</span></p></td><td id="480351126#-yqsvq0_531"><p>Picklist</p></td><td id="480351126#-yqsvq0_532"><p>Nivel de log (ERROR, WARN, INFO, DEBUG)</p></td></tr><tr class="" id="480351126#-yqsvq0_513"><td id="480351126#-yqsvq0_534"><p><span class="inline-code" id="480351126#-yqsvq0_537">Category__c</span></p></td><td id="480351126#-yqsvq0_535"><p>Text(255)</p></td><td id="480351126#-yqsvq0_536"><p>Categor&iacute;a de eventos</p></td></tr><tr class="" id="480351126#-yqsvq0_514"><td id="480351126#-yqsvq0_538"><p><span class="inline-code" id="480351126#-yqsvq0_541">IsEnabled__c</span></p></td><td id="480351126#-yqsvq0_539"><p>Checkbox</p></td><td id="480351126#-yqsvq0_540"><p>Indica si est&aacute; habilitado</p></td></tr><tr class="" id="480351126#-yqsvq0_515"><td id="480351126#-yqsvq0_542"><p><span class="inline-code" id="480351126#-yqsvq0_545">RetentionDays__c</span></p></td><td id="480351126#-yqsvq0_543"><p>Number(3,0)</p></td><td id="480351126#-yqsvq0_544"><p>D&iacute;as de retenci&oacute;n de logs</p></td></tr><tr class="" id="480351126#-yqsvq0_516"><td id="480351126#-yqsvq0_546"><p><span class="inline-code" id="480351126#-yqsvq0_549">MaxRecordsPerBatch__c</span></p></td><td id="480351126#-yqsvq0_547"><p>Number(4,0)</p></td><td id="480351126#-yqsvq0_548"><p>M&aacute;ximo registros por lote</p></td></tr><tr class="" id="480351126#-yqsvq0_517"><td id="480351126#-yqsvq0_550"><p><span class="inline-code" id="480351126#-yqsvq0_553">CleanupSchedule__c</span></p></td><td id="480351126#-yqsvq0_551"><p>Text(255)</p></td><td id="480351126#-yqsvq0_552"><p>Programaci&oacute;n de limpieza (Cron)</p></td></tr><tr class="" id="480351126#-yqsvq0_518"><td id="480351126#-yqsvq0_554"><p><span class="inline-code" id="480351126#-yqsvq0_557">NotificationEmail__c</span></p></td><td id="480351126#-yqsvq0_555"><p>Email</p></td><td id="480351126#-yqsvq0_556"><p>Email para notificaciones cr&iacute;ticas</p></td></tr></table></div></section></section><section><h2 id="480351126#platform-events" data-toc="platform-events#Modelo de Datos.md-platform-events">📡 Platform Events</h2><section><h3 id="480351126#1-sffoundation-processevent-e" data-toc="1-sffoundation-processevent-e#Modelo de Datos.md-1-sffoundation-processevent-e">1. SFFoundation_ProcessEvent__e</h3><p id="480351126#-yqsvq0_561"><span class="control" id="480351126#-yqsvq0_563">Prop&oacute;sito</span>: Comunicaci&oacute;n de eventos entre procesos</p><div class="table-wrapper detached"><table id="480351126#-yqsvq0_562"><tr class="header-row" id="480351126#-yqsvq0_564"><th id="480351126#-yqsvq0_576"><p>Campo</p></th><th id="480351126#-yqsvq0_577"><p>Tipo</p></th><th id="480351126#-yqsvq0_578"><p>Descripci&oacute;n</p></th></tr><tr class="" id="480351126#-yqsvq0_565"><td id="480351126#-yqsvq0_579"><p><span class="inline-code" id="480351126#-yqsvq0_582">EventType__c</span></p></td><td id="480351126#-yqsvq0_580"><p>Text(255)</p></td><td id="480351126#-yqsvq0_581"><p>Tipo de evento</p></td></tr><tr class="" id="480351126#-yqsvq0_566"><td id="480351126#-yqsvq0_583"><p><span class="inline-code" id="480351126#-yqsvq0_586">ProcessName__c</span></p></td><td id="480351126#-yqsvq0_584"><p>Text(255)</p></td><td id="480351126#-yqsvq0_585"><p>Nombre del proceso</p></td></tr><tr class="" id="480351126#-yqsvq0_567"><td id="480351126#-yqsvq0_587"><p><span class="inline-code" id="480351126#-yqsvq0_590">ProductFamily__c</span></p></td><td id="480351126#-yqsvq0_588"><p>Text(255)</p></td><td id="480351126#-yqsvq0_589"><p>Familia de producto</p></td></tr><tr class="" id="480351126#-yqsvq0_568"><td id="480351126#-yqsvq0_591"><p><span class="inline-code" id="480351126#-yqsvq0_594">Stage__c</span></p></td><td id="480351126#-yqsvq0_592"><p>Text(255)</p></td><td id="480351126#-yqsvq0_593"><p>Etapa del proceso</p></td></tr><tr class="" id="480351126#-yqsvq0_569"><td id="480351126#-yqsvq0_595"><p><span class="inline-code" id="480351126#-yqsvq0_598">Phase__c</span></p></td><td id="480351126#-yqsvq0_596"><p>Text(50)</p></td><td id="480351126#-yqsvq0_597"><p>Fase (Pre, In, Pos)</p></td></tr><tr class="" id="480351126#-yqsvq0_570"><td id="480351126#-yqsvq0_599"><p><span class="inline-code" id="480351126#-yqsvq0_602">Status__c</span></p></td><td id="480351126#-yqsvq0_600"><p>Text(50)</p></td><td id="480351126#-yqsvq0_601"><p>Estado del evento</p></td></tr><tr class="" id="480351126#-yqsvq0_571"><td id="480351126#-yqsvq0_603"><p><span class="inline-code" id="480351126#-yqsvq0_606">RecordId__c</span></p></td><td id="480351126#-yqsvq0_604"><p>Text(18)</p></td><td id="480351126#-yqsvq0_605"><p>ID del registro relacionado</p></td></tr><tr class="" id="480351126#-yqsvq0_572"><td id="480351126#-yqsvq0_607"><p><span class="inline-code" id="480351126#-yqsvq0_610">UserId__c</span></p></td><td id="480351126#-yqsvq0_608"><p>Text(18)</p></td><td id="480351126#-yqsvq0_609"><p>ID del usuario</p></td></tr><tr class="" id="480351126#-yqsvq0_573"><td id="480351126#-yqsvq0_611"><p><span class="inline-code" id="480351126#-yqsvq0_614">SessionId__c</span></p></td><td id="480351126#-yqsvq0_612"><p>Text(255)</p></td><td id="480351126#-yqsvq0_613"><p>ID de sesi&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_574"><td id="480351126#-yqsvq0_615"><p><span class="inline-code" id="480351126#-yqsvq0_618">Payload__c</span></p></td><td id="480351126#-yqsvq0_616"><p>Long Text</p></td><td id="480351126#-yqsvq0_617"><p>Datos del evento (JSON)</p></td></tr><tr class="" id="480351126#-yqsvq0_575"><td id="480351126#-yqsvq0_619"><p><span class="inline-code" id="480351126#-yqsvq0_622">Timestamp__c</span></p></td><td id="480351126#-yqsvq0_620"><p>DateTime</p></td><td id="480351126#-yqsvq0_621"><p>Timestamp del evento</p></td></tr></table></div></section><section><h3 id="480351126#2-sffoundation-integrationevent-e" data-toc="2-sffoundation-integrationevent-e#Modelo de Datos.md-2-sffoundation-integrationevent-e">2. SFFoundation_IntegrationEvent__e</h3><p id="480351126#-yqsvq0_623"><span class="control" id="480351126#-yqsvq0_625">Prop&oacute;sito</span>: Eventos de integraciones con servicios externos</p><div class="table-wrapper detached"><table id="480351126#-yqsvq0_624"><tr class="header-row" id="480351126#-yqsvq0_626"><th id="480351126#-yqsvq0_637"><p>Campo</p></th><th id="480351126#-yqsvq0_638"><p>Tipo</p></th><th id="480351126#-yqsvq0_639"><p>Descripci&oacute;n</p></th></tr><tr class="" id="480351126#-yqsvq0_627"><td id="480351126#-yqsvq0_640"><p><span class="inline-code" id="480351126#-yqsvq0_643">ServiceName__c</span></p></td><td id="480351126#-yqsvq0_641"><p>Text(255)</p></td><td id="480351126#-yqsvq0_642"><p>Nombre del servicio</p></td></tr><tr class="" id="480351126#-yqsvq0_628"><td id="480351126#-yqsvq0_644"><p><span class="inline-code" id="480351126#-yqsvq0_647">EventType__c</span></p></td><td id="480351126#-yqsvq0_645"><p>Text(100)</p></td><td id="480351126#-yqsvq0_646"><p>Tipo de evento (Request, Response, Error)</p></td></tr><tr class="" id="480351126#-yqsvq0_629"><td id="480351126#-yqsvq0_648"><p><span class="inline-code" id="480351126#-yqsvq0_651">Status__c</span></p></td><td id="480351126#-yqsvq0_649"><p>Text(50)</p></td><td id="480351126#-yqsvq0_650"><p>Estado de la integraci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_630"><td id="480351126#-yqsvq0_652"><p><span class="inline-code" id="480351126#-yqsvq0_655">HttpStatus__c</span></p></td><td id="480351126#-yqsvq0_653"><p>Number(3,0)</p></td><td id="480351126#-yqsvq0_654"><p>C&oacute;digo de estado HTTP</p></td></tr><tr class="" id="480351126#-yqsvq0_631"><td id="480351126#-yqsvq0_656"><p><span class="inline-code" id="480351126#-yqsvq0_659">Duration__c</span></p></td><td id="480351126#-yqsvq0_657"><p>Number(10,2)</p></td><td id="480351126#-yqsvq0_658"><p>Duraci&oacute;n en milisegundos</p></td></tr><tr class="" id="480351126#-yqsvq0_632"><td id="480351126#-yqsvq0_660"><p><span class="inline-code" id="480351126#-yqsvq0_663">RecordId__c</span></p></td><td id="480351126#-yqsvq0_661"><p>Text(18)</p></td><td id="480351126#-yqsvq0_662"><p>ID del registro relacionado</p></td></tr><tr class="" id="480351126#-yqsvq0_633"><td id="480351126#-yqsvq0_664"><p><span class="inline-code" id="480351126#-yqsvq0_667">RequestId__c</span></p></td><td id="480351126#-yqsvq0_665"><p>Text(255)</p></td><td id="480351126#-yqsvq0_666"><p>ID &uacute;nico de la request</p></td></tr><tr class="" id="480351126#-yqsvq0_634"><td id="480351126#-yqsvq0_668"><p><span class="inline-code" id="480351126#-yqsvq0_671">ErrorCode__c</span></p></td><td id="480351126#-yqsvq0_669"><p>Text(50)</p></td><td id="480351126#-yqsvq0_670"><p>C&oacute;digo de error</p></td></tr><tr class="" id="480351126#-yqsvq0_635"><td id="480351126#-yqsvq0_672"><p><span class="inline-code" id="480351126#-yqsvq0_675">ErrorMessage__c</span></p></td><td id="480351126#-yqsvq0_673"><p>Text(255)</p></td><td id="480351126#-yqsvq0_674"><p>Mensaje de error</p></td></tr><tr class="" id="480351126#-yqsvq0_636"><td id="480351126#-yqsvq0_676"><p><span class="inline-code" id="480351126#-yqsvq0_679">Payload__c</span></p></td><td id="480351126#-yqsvq0_677"><p>Long Text</p></td><td id="480351126#-yqsvq0_678"><p>Datos de la integraci&oacute;n (JSON)</p></td></tr></table></div></section><section><h3 id="480351126#3-sffoundation-notificationevent-e" data-toc="3-sffoundation-notificationevent-e#Modelo de Datos.md-3-sffoundation-notificationevent-e">3. SFFoundation_NotificationEvent__e</h3><p id="480351126#-yqsvq0_680"><span class="control" id="480351126#-yqsvq0_683">Prop&oacute;sito</span>: Notificaciones del sistema</p><div class="table-wrapper detached"><table id="480351126#-yqsvq0_681"><tr class="header-row" id="480351126#-yqsvq0_684"><th id="480351126#-yqsvq0_695"><p>Campo</p></th><th id="480351126#-yqsvq0_696"><p>Tipo</p></th><th id="480351126#-yqsvq0_697"><p>Descripci&oacute;n</p></th></tr><tr class="" id="480351126#-yqsvq0_685"><td id="480351126#-yqsvq0_698"><p><span class="inline-code" id="480351126#-yqsvq0_701">NotificationType__c</span></p></td><td id="480351126#-yqsvq0_699"><p>Text(100)</p></td><td id="480351126#-yqsvq0_700"><p>Tipo de notificaci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_686"><td id="480351126#-yqsvq0_702"><p><span class="inline-code" id="480351126#-yqsvq0_705">Severity__c</span></p></td><td id="480351126#-yqsvq0_703"><p>Text(50)</p></td><td id="480351126#-yqsvq0_704"><p>Severidad (Critical, High, Medium, Low)</p></td></tr><tr class="" id="480351126#-yqsvq0_687"><td id="480351126#-yqsvq0_706"><p><span class="inline-code" id="480351126#-yqsvq0_709">Title__c</span></p></td><td id="480351126#-yqsvq0_707"><p>Text(255)</p></td><td id="480351126#-yqsvq0_708"><p>T&iacute;tulo de la notificaci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_688"><td id="480351126#-yqsvq0_710"><p><span class="inline-code" id="480351126#-yqsvq0_713">Message__c</span></p></td><td id="480351126#-yqsvq0_711"><p>Long Text</p></td><td id="480351126#-yqsvq0_712"><p>Mensaje de la notificaci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_689"><td id="480351126#-yqsvq0_714"><p><span class="inline-code" id="480351126#-yqsvq0_717">RecipientId__c</span></p></td><td id="480351126#-yqsvq0_715"><p>Text(18)</p></td><td id="480351126#-yqsvq0_716"><p>ID del destinatario</p></td></tr><tr class="" id="480351126#-yqsvq0_690"><td id="480351126#-yqsvq0_718"><p><span class="inline-code" id="480351126#-yqsvq0_721">RecipientType__c</span></p></td><td id="480351126#-yqsvq0_719"><p>Text(50)</p></td><td id="480351126#-yqsvq0_720"><p>Tipo de destinatario (User, Queue, Group)</p></td></tr><tr class="" id="480351126#-yqsvq0_691"><td id="480351126#-yqsvq0_722"><p><span class="inline-code" id="480351126#-yqsvq0_725">RecordId__c</span></p></td><td id="480351126#-yqsvq0_723"><p>Text(18)</p></td><td id="480351126#-yqsvq0_724"><p>ID del registro relacionado</p></td></tr><tr class="" id="480351126#-yqsvq0_692"><td id="480351126#-yqsvq0_726"><p><span class="inline-code" id="480351126#-yqsvq0_729">Category__c</span></p></td><td id="480351126#-yqsvq0_727"><p>Text(100)</p></td><td id="480351126#-yqsvq0_728"><p>Categor&iacute;a de la notificaci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_693"><td id="480351126#-yqsvq0_730"><p><span class="inline-code" id="480351126#-yqsvq0_733">ExpirationDate__c</span></p></td><td id="480351126#-yqsvq0_731"><p>DateTime</p></td><td id="480351126#-yqsvq0_732"><p>Fecha de expiraci&oacute;n</p></td></tr><tr class="" id="480351126#-yqsvq0_694"><td id="480351126#-yqsvq0_734"><p><span class="inline-code" id="480351126#-yqsvq0_737">IsRead__c</span></p></td><td id="480351126#-yqsvq0_735"><p>Checkbox</p></td><td id="480351126#-yqsvq0_736"><p>Indica si fue le&iacute;da</p></td></tr></table></div></section></section><section><h2 id="480351126#relaciones-y-dependencias" data-toc="relaciones-y-dependencias#Modelo de Datos.md-relaciones-y-dependencias">🔗 Relaciones y Dependencias</h2><section><h3 id="480351126#diagrama-de-entidades-principales" data-toc="diagrama-de-entidades-principales#Modelo de Datos.md-diagrama-de-entidades-principales">Diagrama de Entidades Principales</h3><div class="detached code-block" id="480351126#-yqsvq0_740"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────────┐
│                    ENTITY RELATIONSHIP DIAGRAM                 │
│                                                                 │
│  ┌─────────────┐     1:N     ┌─────────────────────────────┐   │
│  │    Lead     │────────────▶│  SFFoundation_ProcessExecution│   │
│  │ (Standard)  │             │           __c               │   │
│  └─────────────┘             └─────────────────────────────┘   │
│         │                                   │                  │
│         │                                   │ 1:N              │
│         │                                   ▼                  │
│         │                     ┌─────────────────────────────┐   │
│         │                     │   SFFoundation_EventLog     │   │
│         │                     │           __c               │   │
│         │                     └─────────────────────────────┘   │
│         │                                   ▲                  │
│         │                                   │ 1:N              │
│         │                     ┌─────────────────────────────┐   │
│         │                     │ SFFoundation_IntegrationLog │   │
│         │                     │           __c               │   │
│         │                     └─────────────────────────────┘   │
│         │                                                      │
│         │ 1:N                                                  │
│         ▼                                                      │
│  ┌─────────────┐     1:N     ┌─────────────────────────────┐   │
│  │Opportunity  │────────────▶│          Quote              │   │
│  │ (Standard)  │             │       (Standard)            │   │
│  └─────────────┘             └─────────────────────────────┘   │
│         │                                   │                  │
│         │ 1:N                               │ 1:N              │
│         ▼                                   ▼                  │
│  ┌─────────────┐                   ┌─────────────────────────┐ │
│  │InsurancePolicy                  │    Asset                │ │
│  │ (Vlocity)   │                   │  (Standard)             │ │
│  └─────────────┘                   └─────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘</code></pre></div></section><section><h3 id="480351126#flujo-de-datos-por-proceso" data-toc="flujo-de-datos-por-proceso#Modelo de Datos.md-flujo-de-datos-por-proceso">Flujo de Datos por Proceso</h3><section><h4 id="480351126#1-conocimiento-lead-management" data-toc="1-conocimiento-lead-management#Modelo de Datos.md-1-conocimiento-lead-management">1. Conocimiento (Lead Management)</h4><div class="detached code-block" id="480351126#-yqsvq0_745"><pre><code class="language-none">Lead Creation ──┬──&gt; ProcessExecution__c
                │
                ├──&gt; EventLog__c (Lead Created)
                │
                ├──&gt; IntegrationLog__c (RUNT/FASECOLDA)
                │
                └──&gt; Platform Event (Lead_Process_Complete)</code></pre></div></section><section><h4 id="480351126#2-tarificaci-n-rating" data-toc="2-tarificaci-n-rating#Modelo de Datos.md-2-tarificaci-n-rating">2. Tarificaci&oacute;n (Rating)</h4><div class="detached code-block" id="480351126#-yqsvq0_746"><pre><code class="language-none">Rate Request ───┬──&gt; ProcessExecution__c
                │
                ├──&gt; EventLog__c (Rating Started)
                │
                ├──&gt; IntegrationLog__c (External Rating Service)
                │
                ├──&gt; EventLog__c (Rating Completed)
                │
                └──&gt; Platform Event (Rating_Complete)</code></pre></div></section><section><h4 id="480351126#3-cotizaci-n-quoting" data-toc="3-cotizaci-n-quoting#Modelo de Datos.md-3-cotizaci-n-quoting">3. Cotizaci&oacute;n (Quoting)</h4><div class="detached code-block" id="480351126#-yqsvq0_747"><pre><code class="language-none">Quote Creation ─┬──&gt; ProcessExecution__c
                │
                ├──&gt; EventLog__c (Quote Generated)
                │
                ├──&gt; IntegrationLog__c (Payment Gateway)
                │
                └──&gt; Platform Event (Quote_Ready)</code></pre></div></section><section><h4 id="480351126#4-emisi-n-issuance" data-toc="4-emisi-n-issuance#Modelo de Datos.md-4-emisi-n-issuance">4. Emisi&oacute;n (Issuance)</h4><div class="detached code-block" id="480351126#-yqsvq0_748"><pre><code class="language-none">Policy Issuance ┬──&gt; ProcessExecution__c
                │
                ├──&gt; EventLog__c (Policy Issued)
                │
                ├──&gt; IntegrationLog__c (Core Insurance System)
                │
                └──&gt; Platform Event (Policy_Issued)</code></pre></div></section></section></section><section><h2 id="480351126#custom-settings" data-toc="custom-settings#Modelo de Datos.md-custom-settings">📋 Custom Settings</h2><section><h3 id="480351126#1-sffoundation-globalsettings-c" data-toc="1-sffoundation-globalsettings-c#Modelo de Datos.md-1-sffoundation-globalsettings-c">1. SFFoundation_GlobalSettings__c</h3><p id="480351126#-yqsvq0_752"><span class="control" id="480351126#-yqsvq0_754">Prop&oacute;sito</span>: Configuraciones globales del framework</p><div class="table-wrapper detached"><table id="480351126#-yqsvq0_753"><tr class="header-row" id="480351126#-yqsvq0_755"><th id="480351126#-yqsvq0_763"><p>Campo</p></th><th id="480351126#-yqsvq0_764"><p>Tipo</p></th><th id="480351126#-yqsvq0_765"><p>Descripci&oacute;n</p></th></tr><tr class="" id="480351126#-yqsvq0_756"><td id="480351126#-yqsvq0_766"><p><span class="inline-code" id="480351126#-yqsvq0_769">Name</span></p></td><td id="480351126#-yqsvq0_767"><p>Text(38)</p></td><td id="480351126#-yqsvq0_768"><p>Nombre del setting</p></td></tr><tr class="" id="480351126#-yqsvq0_757"><td id="480351126#-yqsvq0_770"><p><span class="inline-code" id="480351126#-yqsvq0_773">IsEnabled__c</span></p></td><td id="480351126#-yqsvq0_771"><p>Checkbox</p></td><td id="480351126#-yqsvq0_772"><p>Indica si est&aacute; habilitado</p></td></tr><tr class="" id="480351126#-yqsvq0_758"><td id="480351126#-yqsvq0_774"><p><span class="inline-code" id="480351126#-yqsvq0_777">LogLevel__c</span></p></td><td id="480351126#-yqsvq0_775"><p>Text(10)</p></td><td id="480351126#-yqsvq0_776"><p>Nivel de log global</p></td></tr><tr class="" id="480351126#-yqsvq0_759"><td id="480351126#-yqsvq0_778"><p><span class="inline-code" id="480351126#-yqsvq0_781">DefaultTimeout__c</span></p></td><td id="480351126#-yqsvq0_779"><p>Number(5,0)</p></td><td id="480351126#-yqsvq0_780"><p>Timeout por defecto</p></td></tr><tr class="" id="480351126#-yqsvq0_760"><td id="480351126#-yqsvq0_782"><p><span class="inline-code" id="480351126#-yqsvq0_785">MaxRetries__c</span></p></td><td id="480351126#-yqsvq0_783"><p>Number(2,0)</p></td><td id="480351126#-yqsvq0_784"><p>Reintentos por defecto</p></td></tr><tr class="" id="480351126#-yqsvq0_761"><td id="480351126#-yqsvq0_786"><p><span class="inline-code" id="480351126#-yqsvq0_789">CleanupBatchSize__c</span></p></td><td id="480351126#-yqsvq0_787"><p>Number(4,0)</p></td><td id="480351126#-yqsvq0_788"><p>Tama&ntilde;o de lote para limpieza</p></td></tr><tr class="" id="480351126#-yqsvq0_762"><td id="480351126#-yqsvq0_790"><p><span class="inline-code" id="480351126#-yqsvq0_793">NotificationEmail__c</span></p></td><td id="480351126#-yqsvq0_791"><p>Email</p></td><td id="480351126#-yqsvq0_792"><p>Email para notificaciones</p></td></tr></table></div></section><section><h3 id="480351126#2-sffoundation-productsettings-c" data-toc="2-sffoundation-productsettings-c#Modelo de Datos.md-2-sffoundation-productsettings-c">2. SFFoundation_ProductSettings__c</h3><p id="480351126#-yqsvq0_794"><span class="control" id="480351126#-yqsvq0_797">Prop&oacute;sito</span>: Configuraciones espec&iacute;ficas por producto</p><div class="table-wrapper detached"><table id="480351126#-yqsvq0_795"><tr class="header-row" id="480351126#-yqsvq0_798"><th id="480351126#-yqsvq0_804"><p>Campo</p></th><th id="480351126#-yqsvq0_805"><p>Tipo</p></th><th id="480351126#-yqsvq0_806"><p>Descripci&oacute;n</p></th></tr><tr class="" id="480351126#-yqsvq0_799"><td id="480351126#-yqsvq0_807"><p><span class="inline-code" id="480351126#-yqsvq0_810">Name</span></p></td><td id="480351126#-yqsvq0_808"><p>Text(38)</p></td><td id="480351126#-yqsvq0_809"><p>Nombre del producto</p></td></tr><tr class="" id="480351126#-yqsvq0_800"><td id="480351126#-yqsvq0_811"><p><span class="inline-code" id="480351126#-yqsvq0_814">IsActive__c</span></p></td><td id="480351126#-yqsvq0_812"><p>Checkbox</p></td><td id="480351126#-yqsvq0_813"><p>Indica si est&aacute; activo</p></td></tr><tr class="" id="480351126#-yqsvq0_801"><td id="480351126#-yqsvq0_815"><p><span class="inline-code" id="480351126#-yqsvq0_818">DefaultHandler__c</span></p></td><td id="480351126#-yqsvq0_816"><p>Text(255)</p></td><td id="480351126#-yqsvq0_817"><p>Handler por defecto</p></td></tr><tr class="" id="480351126#-yqsvq0_802"><td id="480351126#-yqsvq0_819"><p><span class="inline-code" id="480351126#-yqsvq0_822">ConfigurationJSON__c</span></p></td><td id="480351126#-yqsvq0_820"><p>Long Text</p></td><td id="480351126#-yqsvq0_821"><p>Configuraci&oacute;n espec&iacute;fica (JSON)</p></td></tr><tr class="" id="480351126#-yqsvq0_803"><td id="480351126#-yqsvq0_823"><p><span class="inline-code" id="480351126#-yqsvq0_826">ValidationRules__c</span></p></td><td id="480351126#-yqsvq0_824"><p>Long Text</p></td><td id="480351126#-yqsvq0_825"><p>Reglas de validaci&oacute;n (JSON)</p></td></tr></table></div></section></section><section><h2 id="480351126#ndices-y-performance" data-toc="ndices-y-performance#Modelo de Datos.md-ndices-y-performance">🔍 &Iacute;ndices y Performance</h2><section><h3 id="480351126#estrategia-de-indexaci-n" data-toc="estrategia-de-indexaci-n#Modelo de Datos.md-estrategia-de-indexaci-n">Estrategia de Indexaci&oacute;n</h3><section><h4 id="480351126#objetos-de-alto-volumen" data-toc="objetos-de-alto-volumen#Modelo de Datos.md-objetos-de-alto-volumen">Objetos de Alto Volumen</h4><p id="480351126#-yqsvq0_830"><span class="control" id="480351126#-yqsvq0_836">SFFoundation_EventLog__c:</span></p><ul class="list" id="480351126#-yqsvq0_831" start="1"><li class="list-item" id="480351126#-yqsvq0_837"><p>&Iacute;ndice compuesto: <span class="inline-code" id="480351126#-yqsvq0_840">(EventType__c, CreatedDate)</span></p></li><li class="list-item" id="480351126#-yqsvq0_838"><p>&Iacute;ndice compuesto: <span class="inline-code" id="480351126#-yqsvq0_841">(ProcessName__c, Status__c)</span></p></li><li class="list-item" id="480351126#-yqsvq0_839"><p>&Iacute;ndice simple: <span class="inline-code" id="480351126#-yqsvq0_842">CreatedDate</span> (para cleanup)</p></li></ul><p id="480351126#-yqsvq0_832"><span class="control" id="480351126#-yqsvq0_843">SFFoundation_ProcessExecution__c:</span></p><ul class="list" id="480351126#-yqsvq0_833" start="1"><li class="list-item" id="480351126#-yqsvq0_844"><p>&Iacute;ndice compuesto: <span class="inline-code" id="480351126#-yqsvq0_847">(ProcessName__c, Status__c, StartTime__c)</span></p></li><li class="list-item" id="480351126#-yqsvq0_845"><p>&Iacute;ndice simple: <span class="inline-code" id="480351126#-yqsvq0_848">LeadId__c</span></p></li><li class="list-item" id="480351126#-yqsvq0_846"><p>&Iacute;ndice simple: <span class="inline-code" id="480351126#-yqsvq0_849">OpportunityId__c</span></p></li></ul><p id="480351126#-yqsvq0_834"><span class="control" id="480351126#-yqsvq0_850">SFFoundation_IntegrationLog__c:</span></p><ul class="list" id="480351126#-yqsvq0_835" start="1"><li class="list-item" id="480351126#-yqsvq0_851"><p>&Iacute;ndice compuesto: <span class="inline-code" id="480351126#-yqsvq0_854">(ServiceName__c, RequestTime__c)</span></p></li><li class="list-item" id="480351126#-yqsvq0_852"><p>&Iacute;ndice simple: <span class="inline-code" id="480351126#-yqsvq0_855">IsSuccess__c</span></p></li><li class="list-item" id="480351126#-yqsvq0_853"><p>&Iacute;ndice simple: <span class="inline-code" id="480351126#-yqsvq0_856">ProcessExecutionId__c</span></p></li></ul></section></section><section><h3 id="480351126#estrategias-de-archivado" data-toc="estrategias-de-archivado#Modelo de Datos.md-estrategias-de-archivado">Estrategias de Archivado</h3><div class="detached code-block" id="480351126#-yqsvq0_857"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────────┐
│                    DATA LIFECYCLE MANAGEMENT                   │
│                                                                 │
│  ┌─────────────┐    30 days    ┌─────────────┐    90 days      │
│  │   Active    │──────────────▶│   Archive   │─────────────▶   │
│  │    Data     │               │    Data     │               │  │
│  └─────────────┘               └─────────────┘               │  │
│         │                             │                     │  │
│         │ Real-time                   │ Batch               │  │
│         │ Access                      │ Access              │  │
│         ▼                             ▼                     ▼  │
│  ┌─────────────┐               ┌─────────────┐      ┌─────────┐ │
│  │ Dashboard   │               │  Reports    │      │ Purge   │ │
│  │   &amp; APIs    │               │ &amp; Analytics │      │         │ │
│  └─────────────┘               └─────────────┘      └─────────┘ │
└─────────────────────────────────────────────────────────────────┘</code></pre></div></section></section><section><h2 id="480351126#ejemplo-de-datos-de-configuraci-n" data-toc="ejemplo-de-datos-de-configuraci-n#Modelo de Datos.md-ejemplo-de-datos-de-configuraci-n">📊 Ejemplo de Datos de Configuraci&oacute;n</h2><section><h3 id="480351126#configuraci-n-de-procesos" data-toc="configuraci-n-de-procesos#Modelo de Datos.md-configuraci-n-de-procesos">Configuraci&oacute;n de Procesos</h3><div class="detached code-block" id="480351126#-yqsvq0_861"><pre><code class="language-json">{
  &quot;processes&quot;: [
    {
      &quot;developerName&quot;: &quot;Lead_Motos_Conocimiento&quot;,
      &quot;productFamily&quot;: &quot;Seguros de Motos&quot;,
      &quot;stage&quot;: &quot;Conocimiento&quot;,
      &quot;handlerClass&quot;: &quot;MT_Kn_123&quot;,
      &quot;order&quot;: 0,
      &quot;isActive&quot;: true,
      &quot;configuration&quot;: {
        &quot;validateRUNT&quot;: true,
        &quot;requireFasecolda&quot;: true,
        &quot;mandatoryFields&quot;: [&quot;VehicleType__c&quot;, &quot;Model__c&quot;, &quot;Year__c&quot;]
      }
    },
    {
      &quot;developerName&quot;: &quot;Rate_Motos_Tarificacion&quot;,
      &quot;productFamily&quot;: &quot;Seguros de Motos&quot;,
      &quot;stage&quot;: &quot;Tarificación&quot;,
      &quot;handlerClass&quot;: &quot;MT_Rt_456&quot;,
      &quot;order&quot;: 0,
      &quot;isActive&quot;: true,
      &quot;configuration&quot;: {
        &quot;externalRatingService&quot;: &quot;SURA_Rating_API&quot;,
        &quot;fallbackMethod&quot;: &quot;internal&quot;,
        &quot;cacheResults&quot;: true
      }
    }
  ]
}</code></pre></div></section><section><h3 id="480351126#configuraci-n-de-feature-flags" data-toc="configuraci-n-de-feature-flags#Modelo de Datos.md-configuraci-n-de-feature-flags">Configuraci&oacute;n de Feature Flags</h3><div class="detached code-block" id="480351126#-yqsvq0_862"><pre><code class="language-json">{
  &quot;featureFlags&quot;: [
    {
      &quot;developerName&quot;: &quot;EnableNewRatingEngine&quot;,
      &quot;isEnabled&quot;: false,
      &quot;environment&quot;: &quot;Production&quot;,
      &quot;scope&quot;: &quot;Global&quot;,
      &quot;effectiveDate&quot;: &quot;2025-06-01&quot;,
      &quot;description&quot;: &quot;Habilita el nuevo motor de tarificación&quot;
    },
    {
      &quot;developerName&quot;: &quot;EnableAdvancedLogging&quot;,
      &quot;isEnabled&quot;: true,
      &quot;environment&quot;: &quot;Sandbox&quot;,
      &quot;scope&quot;: &quot;Product&quot;,
      &quot;productFamily&quot;: &quot;Seguros de Motos&quot;,
      &quot;description&quot;: &quot;Logging avanzado para debugging&quot;
    }
  ]
}</code></pre></div></section></section><section><h2 id="480351126#consideraciones-de-implementaci-n" data-toc="consideraciones-de-implementaci-n#Modelo de Datos.md-consideraciones-de-implementaci-n">🚀 Consideraciones de Implementaci&oacute;n</h2><section><h3 id="480351126#mejores-pr-cticas" data-toc="mejores-pr-cticas#Modelo de Datos.md-mejores-pr-cticas">Mejores Pr&aacute;cticas</h3><ol class="list list-decimal" id="480351126#-yqsvq0_866" type="1" start="1"><li class="list-item" id="480351126#-yqsvq0_867"><p id="480351126#-yqsvq0_871"><span class="control" id="480351126#-yqsvq0_873">Naming Conventions</span>:</p><ul class="list" id="480351126#-yqsvq0_872" start="1"><li class="list-item" id="480351126#-yqsvq0_874"><p>Custom Objects: <span class="inline-code" id="480351126#-yqsvq0_878">SFFoundation_[ObjectName]__c</span></p></li><li class="list-item" id="480351126#-yqsvq0_875"><p>Custom Fields: <span class="inline-code" id="480351126#-yqsvq0_879">[FieldName]__c</span></p></li><li class="list-item" id="480351126#-yqsvq0_876"><p>Metadata Types: <span class="inline-code" id="480351126#-yqsvq0_880">SFFoundation_[TypeName]__mdt</span></p></li><li class="list-item" id="480351126#-yqsvq0_877"><p>Platform Events: <span class="inline-code" id="480351126#-yqsvq0_881">SFFoundation_[EventName]__e</span></p></li></ul></li><li class="list-item" id="480351126#-yqsvq0_868"><p id="480351126#-yqsvq0_882"><span class="control" id="480351126#-yqsvq0_884">Data Governance</span>:</p><ul class="list" id="480351126#-yqsvq0_883" start="1"><li class="list-item" id="480351126#-yqsvq0_885"><p>Configuraci&oacute;n centralizada via Custom Metadata</p></li><li class="list-item" id="480351126#-yqsvq0_886"><p>Logs con retenci&oacute;n autom&aacute;tica</p></li><li class="list-item" id="480351126#-yqsvq0_887"><p>Validaciones a nivel de campo y objeto</p></li></ul></li><li class="list-item" id="480351126#-yqsvq0_869"><p id="480351126#-yqsvq0_888"><span class="control" id="480351126#-yqsvq0_890">Security</span>:</p><ul class="list" id="480351126#-yqsvq0_889" start="1"><li class="list-item" id="480351126#-yqsvq0_891"><p>Field-level security apropiada</p></li><li class="list-item" id="480351126#-yqsvq0_892"><p>Sharing rules para data isolation</p></li><li class="list-item" id="480351126#-yqsvq0_893"><p>Encryption para campos sensibles</p></li></ul></li><li class="list-item" id="480351126#-yqsvq0_870"><p id="480351126#-yqsvq0_894"><span class="control" id="480351126#-yqsvq0_896">Monitoring</span>:</p><ul class="list" id="480351126#-yqsvq0_895" start="1"><li class="list-item" id="480351126#-yqsvq0_897"><p>Dashboards para m&eacute;tricas key</p></li><li class="list-item" id="480351126#-yqsvq0_898"><p>Alertas autom&aacute;ticas para errores</p></li><li class="list-item" id="480351126#-yqsvq0_899"><p>Reports de performance</p></li></ul></li></ol></section><section><h3 id="480351126#l-mites-y-consideraciones" data-toc="l-mites-y-consideraciones#Modelo de Datos.md-l-mites-y-consideraciones">L&iacute;mites y Consideraciones</h3><ul class="list" id="480351126#-yqsvq0_900" start="1"><li class="list-item" id="480351126#-yqsvq0_903"><p><span class="control" id="480351126#-yqsvq0_907">Governor Limits</span>: Considerar l&iacute;mites de DML, SOQL y heap</p></li><li class="list-item" id="480351126#-yqsvq0_904"><p><span class="control" id="480351126#-yqsvq0_908">Storage</span>: Monitorear uso de data storage</p></li><li class="list-item" id="480351126#-yqsvq0_905"><p><span class="control" id="480351126#-yqsvq0_909">API Limits</span>: Gestionar callouts hacia servicios externos</p></li><li class="list-item" id="480351126#-yqsvq0_906"><p><span class="control" id="480351126#-yqsvq0_910">Platform Events</span>: Respetar l&iacute;mites de publicaci&oacute;n</p></li></ul><p id="480351126#-yqsvq0_902"><span class="control" id="480351126#-yqsvq0_911">Fecha de Actualizaci&oacute;n:</span> Mayo 2025<span class="control" id="480351126#-yqsvq0_913">Versi&oacute;n del Documento:</span> 1.0<span class="control" id="480351126#-yqsvq0_915">Arquitectos de Datos:</span> Soulberto Lorenzo, Jean Carlos Melendez<span class="control" id="480351126#-yqsvq0_917">Estado:</span> Documento Vivo - Actualizaci&oacute;n Continua</p></section></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-483439626">`ProductHandler` Apex Class Documentation</h1><p id="-483439626#-s5fsc8_3"><span class="control" id="-483439626#-s5fsc8_80">Author</span>: Jean Carlos Melendez (jean@cloudblue.us (<a href="mailto:jean@cloudblue.us">mailto:jean@cloudblue.us</a>)) <span class="control" id="-483439626#-s5fsc8_83">Last Modified By</span>: Jean Carlos Melendez<span class="control" id="-483439626#-s5fsc8_85">Last Modified On</span>: 2025-04-23</p><section><h2 id="-483439626#overview" data-toc="overview#Documentacion_procesos_foundation.md-overview">📌 Overview</h2><p id="-483439626#-s5fsc8_86"><span class="inline-code" id="-483439626#-s5fsc8_89">ProductHandler</span> es una clase abstracta que define el comportamiento base para una cadena de responsabilidad (Chain of Responsibility) en el procesamiento de productos dentro de una arquitectura basada en eventos, observadores y banderas de caracter&iacute;sticas (<span class="inline-code" id="-483439626#-s5fsc8_90">FeatureFlags</span>).</p><p id="-483439626#-s5fsc8_87">Su objetivo principal es permitir a los desarrolladores extender la l&oacute;gica de procesamiento de productos de manera flexible y desacoplada, implementando manejadores espec&iacute;ficos que heredan de esta clase.</p></section><section><h2 id="-483439626#class-definition" data-toc="class-definition#Documentacion_procesos_foundation.md-class-definition">🔧 Class Definition</h2><div class="detached code-block" id="-483439626#-s5fsc8_91"><pre><code class="language-none">global abstract class ProductHandler extends Subject</code></pre></div><p id="-483439626#-s5fsc8_92">Esta clase:</p><ul class="list" id="-483439626#-s5fsc8_93" start="1"><li class="list-item" id="-483439626#-s5fsc8_95"><p><span class="control" id="-483439626#-s5fsc8_98">Es global</span>: puede ser accedida desde cualquier contexto.</p></li><li class="list-item" id="-483439626#-s5fsc8_96"><p><span class="control" id="-483439626#-s5fsc8_99">Es abstracta</span>: no puede ser instanciada directamente.</p></li><li class="list-item" id="-483439626#-s5fsc8_97"><p><span class="control" id="-483439626#-s5fsc8_100">Extiende <span class="inline-code" id="-483439626#-s5fsc8_101">Subject</span></span>: lo que implica que implementa el patr&oacute;n de observador (Observer pattern).</p></li></ul></section><section><h2 id="-483439626#properties" data-toc="properties#Documentacion_procesos_foundation.md-properties">🧩 Properties</h2><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_102"><tr class="header-row" id="-483439626#-s5fsc8_104"><th id="-483439626#-s5fsc8_112"><p>Propiedad</p></th><th id="-483439626#-s5fsc8_113"><p>Tipo</p></th><th id="-483439626#-s5fsc8_114"><p>Acceso</p></th><th id="-483439626#-s5fsc8_115"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-483439626#-s5fsc8_105"><td id="-483439626#-s5fsc8_116"><p><span class="inline-code" id="-483439626#-s5fsc8_120">productName</span></p></td><td id="-483439626#-s5fsc8_117"><p><span class="inline-code" id="-483439626#-s5fsc8_121">String</span></p></td><td id="-483439626#-s5fsc8_118"><p>global</p></td><td id="-483439626#-s5fsc8_119"><p>Nombre del producto que el handler maneja.</p></td></tr><tr class="" id="-483439626#-s5fsc8_106"><td id="-483439626#-s5fsc8_122"><p><span class="inline-code" id="-483439626#-s5fsc8_126">processName</span></p></td><td id="-483439626#-s5fsc8_123"><p><span class="inline-code" id="-483439626#-s5fsc8_127">String</span></p></td><td id="-483439626#-s5fsc8_124"><p>global</p></td><td id="-483439626#-s5fsc8_125"><p>Nombre del proceso que se est&aacute; ejecutando.</p></td></tr><tr class="" id="-483439626#-s5fsc8_107"><td id="-483439626#-s5fsc8_128"><p><span class="inline-code" id="-483439626#-s5fsc8_132">nextHandler</span></p></td><td id="-483439626#-s5fsc8_129"><p><span class="inline-code" id="-483439626#-s5fsc8_133">ProductHandler</span></p></td><td id="-483439626#-s5fsc8_130"><p>global</p></td><td id="-483439626#-s5fsc8_131"><p>Referencia al siguiente handler en la cadena.</p></td></tr><tr class="" id="-483439626#-s5fsc8_108"><td id="-483439626#-s5fsc8_134"><p><span class="inline-code" id="-483439626#-s5fsc8_138">responseProcess</span></p></td><td id="-483439626#-s5fsc8_135"><p><span class="inline-code" id="-483439626#-s5fsc8_139">Object</span></p></td><td id="-483439626#-s5fsc8_136"><p>public</p></td><td id="-483439626#-s5fsc8_137"><p>Respuesta generada por el proceso del handler.</p></td></tr><tr class="" id="-483439626#-s5fsc8_109"><td id="-483439626#-s5fsc8_140"><p><span class="inline-code" id="-483439626#-s5fsc8_144">requestInput</span></p></td><td id="-483439626#-s5fsc8_141"><p><span class="inline-code" id="-483439626#-s5fsc8_145">Object</span></p></td><td id="-483439626#-s5fsc8_142"><p>global</p></td><td id="-483439626#-s5fsc8_143"><p>Entrada original que recibe el handler.</p></td></tr><tr class="" id="-483439626#-s5fsc8_110"><td id="-483439626#-s5fsc8_146"><p><span class="inline-code" id="-483439626#-s5fsc8_150">state</span></p></td><td id="-483439626#-s5fsc8_147"><p><span class="inline-code" id="-483439626#-s5fsc8_151">String</span></p></td><td id="-483439626#-s5fsc8_148"><p>public</p></td><td id="-483439626#-s5fsc8_149"><p>Estado del procesamiento (<span class="inline-code" id="-483439626#-s5fsc8_152">success</span> o <span class="inline-code" id="-483439626#-s5fsc8_153">error</span>).</p></td></tr><tr class="" id="-483439626#-s5fsc8_111"><td id="-483439626#-s5fsc8_154"><p><span class="inline-code" id="-483439626#-s5fsc8_158">FLAG_PLATFORM_NAME</span></p></td><td id="-483439626#-s5fsc8_155"><p><span class="inline-code" id="-483439626#-s5fsc8_159">String</span> (constante)</p></td><td id="-483439626#-s5fsc8_156"><p>static</p></td><td id="-483439626#-s5fsc8_157"><p>Bandera para habilitar eventos de plataforma.</p></td></tr></table></div></section><section><h2 id="-483439626#constructor" data-toc="constructor#Documentacion_procesos_foundation.md-constructor">🏗️ Constructor</h2><section><h3 id="-483439626#producthandler-string-productname" data-toc="producthandler-string-productname#Documentacion_procesos_foundation.md-producthandler-string-productname">ProductHandler(String productName)</h3><p id="-483439626#-s5fsc8_162">Inicializa una nueva instancia del handler con el nombre del producto que procesar&aacute;.</p></section></section><section><h2 id="-483439626#chain-of-responsibility" data-toc="chain-of-responsibility#Documentacion_procesos_foundation.md-chain-of-responsibility">🔁 Chain of Responsibility</h2><section><h3 id="-483439626#setnext-producthandler-nexthandler" data-toc="setnext-producthandler-nexthandler#Documentacion_procesos_foundation.md-setnext-producthandler-nexthandler">setNext(ProductHandler nextHandler)</h3><p id="-483439626#-s5fsc8_167">Asigna el siguiente handler en la cadena.</p><p id="-483439626#-s5fsc8_168"><span class="control" id="-483439626#-s5fsc8_171">Retorna</span>: <span class="inline-code" id="-483439626#-s5fsc8_172">ProductHandler</span> (el handler siguiente).</p></section></section><section><h2 id="-483439626#m-todos-de-configuraci-n" data-toc="m-todos-de-configuraci-n#Documentacion_procesos_foundation.md-m-todos-de-configuraci-n">⚙️ M&eacute;todos de Configuraci&oacute;n</h2><section><h3 id="-483439626#setprocessname-string-processname" data-toc="setprocessname-string-processname#Documentacion_procesos_foundation.md-setprocessname-string-processname">setProcessName(String processName)</h3><p id="-483439626#-s5fsc8_177">Define el nombre del proceso actual.</p></section><section><h3 id="-483439626#setresponseprocess-object-responseprocess" data-toc="setresponseprocess-object-responseprocess#Documentacion_procesos_foundation.md-setresponseprocess-object-responseprocess">setResponseProcess(Object responseProcess)</h3><p id="-483439626#-s5fsc8_180">Guarda la respuesta generada por el handler.</p></section><section><h3 id="-483439626#setrequestinput-object-requestinput" data-toc="setrequestinput-object-requestinput#Documentacion_procesos_foundation.md-setrequestinput-object-requestinput">setRequestInput(Object requestInput)</h3><p id="-483439626#-s5fsc8_183">Guarda la entrada del request en la propiedad del handler.</p></section></section><section><h2 id="-483439626#observadores" data-toc="observadores#Documentacion_procesos_foundation.md-observadores">👀 Observadores</h2><section><h3 id="-483439626#setobservers" data-toc="setobservers#Documentacion_procesos_foundation.md-setobservers">setObservers()</h3><p id="-483439626#-s5fsc8_188">Agrega observadores al handler. Por defecto, se agrega un <span class="inline-code" id="-483439626#-s5fsc8_191">BaseObserver</span>.</p></section></section><section><h2 id="-483439626#l-gica-de-ejecuci-n" data-toc="l-gica-de-ejecuci-n#Documentacion_procesos_foundation.md-l-gica-de-ejecuci-n">🎯 L&oacute;gica de Ejecuci&oacute;n</h2><section><h3 id="-483439626#shouldskiphandler-map-options-map-input-map-output" data-toc="shouldskiphandler-map-options-map-input-map-output#Documentacion_procesos_foundation.md-shouldskiphandler-map-options-map-input-map-output">shouldSkipHandler(Map options, Map input, Map output)</h3><p id="-483439626#-s5fsc8_194">Eval&uacute;a si el handler debe ser omitido seg&uacute;n:</p><ul class="list" id="-483439626#-s5fsc8_195" start="1"><li class="list-item" id="-483439626#-s5fsc8_200"><p>Si <span class="inline-code" id="-483439626#-s5fsc8_202">productName</span> est&aacute; presente en el <span class="inline-code" id="-483439626#-s5fsc8_203">input</span>.</p></li><li class="list-item" id="-483439626#-s5fsc8_201"><p>Si el <span class="inline-code" id="-483439626#-s5fsc8_204">productName</span> coincide con el que maneja este handler.</p></li></ul><p id="-483439626#-s5fsc8_196"><span class="control" id="-483439626#-s5fsc8_205">Retorna</span>: <span class="inline-code" id="-483439626#-s5fsc8_206">Boolean</span></p><ul class="list" id="-483439626#-s5fsc8_197" start="1"><li class="list-item" id="-483439626#-s5fsc8_207"><p><span class="inline-code" id="-483439626#-s5fsc8_209">true</span> si debe ser omitido.</p></li><li class="list-item" id="-483439626#-s5fsc8_208"><p><span class="inline-code" id="-483439626#-s5fsc8_210">false</span> si debe ejecutar su l&oacute;gica.</p></li></ul></section></section><section><h2 id="-483439626#proceso-principal" data-toc="proceso-principal#Documentacion_procesos_foundation.md-proceso-principal">🔄 Proceso Principal</h2><section><h3 id="-483439626#apply-map-options-map-input-map-output" data-toc="apply-map-options-map-input-map-output#Documentacion_procesos_foundation.md-apply-map-options-map-input-map-output">apply(Map options, Map input, Map output)</h3><p id="-483439626#-s5fsc8_213">Este es el m&eacute;todo principal del handler. Ejecuta las siguientes fases:</p><ol class="list list-decimal" id="-483439626#-s5fsc8_214" type="1" start="1"><li class="list-item" id="-483439626#-s5fsc8_217"><p>Verifica si debe omitir el handler (<span class="inline-code" id="-483439626#-s5fsc8_226">shouldSkipHandler</span>).</p></li><li class="list-item" id="-483439626#-s5fsc8_218"><p>Configura los observadores.</p></li><li class="list-item" id="-483439626#-s5fsc8_219"><p>Eval&uacute;a la <span class="inline-code" id="-483439626#-s5fsc8_227">FeatureFlag</span> para eventos de plataforma.</p></li><li class="list-item" id="-483439626#-s5fsc8_220"><p>Ejecuta el preprocesamiento (<span class="inline-code" id="-483439626#-s5fsc8_228">onPre</span>).</p></li><li class="list-item" id="-483439626#-s5fsc8_221"><p>Ejecuta el procesamiento principal (<span class="inline-code" id="-483439626#-s5fsc8_229">process</span>).</p></li><li class="list-item" id="-483439626#-s5fsc8_222"><p>Ejecuta el posprocesamiento (<span class="inline-code" id="-483439626#-s5fsc8_230">onPos</span>).</p></li><li class="list-item" id="-483439626#-s5fsc8_223"><p>Notifica observadores.</p></li><li class="list-item" id="-483439626#-s5fsc8_224"><p>Publica log del servicio (<span class="inline-code" id="-483439626#-s5fsc8_231">publishServiceEventLog</span>).</p></li><li class="list-item" id="-483439626#-s5fsc8_225"><p>Captura y reporta errores personalizados (<span class="inline-code" id="-483439626#-s5fsc8_232">ProductHandlerImplementationException</span>).</p></li></ol></section></section><section><h2 id="-483439626#m-todos-de-fase-de-proceso" data-toc="m-todos-de-fase-de-proceso#Documentacion_procesos_foundation.md-m-todos-de-fase-de-proceso">🛠️ M&eacute;todos de Fase de Proceso</h2><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_233"><tr class="header-row" id="-483439626#-s5fsc8_236"><th id="-483439626#-s5fsc8_240"><p>M&eacute;todo</p></th><th id="-483439626#-s5fsc8_241"><p>Descripci&oacute;n</p></th><th id="-483439626#-s5fsc8_242"><p>Entrada</p></th><th id="-483439626#-s5fsc8_243"><p>Retorno</p></th></tr><tr class="" id="-483439626#-s5fsc8_237"><td id="-483439626#-s5fsc8_244"><p><span class="inline-code" id="-483439626#-s5fsc8_248">process</span></p></td><td id="-483439626#-s5fsc8_245"><p>Ejecuta la l&oacute;gica principal del handler</p></td><td id="-483439626#-s5fsc8_246"><p><span class="inline-code" id="-483439626#-s5fsc8_249">options</span>, <span class="inline-code" id="-483439626#-s5fsc8_250">input</span>, <span class="inline-code" id="-483439626#-s5fsc8_251">output</span></p></td><td id="-483439626#-s5fsc8_247"><p><span class="inline-code" id="-483439626#-s5fsc8_252">Map&lt;String, Object&gt;</span></p></td></tr><tr class="" id="-483439626#-s5fsc8_238"><td id="-483439626#-s5fsc8_253"><p><span class="inline-code" id="-483439626#-s5fsc8_257">onPre</span></p></td><td id="-483439626#-s5fsc8_254"><p>L&oacute;gica previa al procesamiento principal</p></td><td id="-483439626#-s5fsc8_255"><p><span class="inline-code" id="-483439626#-s5fsc8_258">options</span>, <span class="inline-code" id="-483439626#-s5fsc8_259">input</span>, <span class="inline-code" id="-483439626#-s5fsc8_260">output</span></p></td><td id="-483439626#-s5fsc8_256"><p><span class="inline-code" id="-483439626#-s5fsc8_261">Map&lt;String, Object&gt;</span></p></td></tr><tr class="" id="-483439626#-s5fsc8_239"><td id="-483439626#-s5fsc8_262"><p><span class="inline-code" id="-483439626#-s5fsc8_266">onPos</span></p></td><td id="-483439626#-s5fsc8_263"><p>L&oacute;gica posterior al procesamiento principal</p></td><td id="-483439626#-s5fsc8_264"><p><span class="inline-code" id="-483439626#-s5fsc8_267">options</span>, <span class="inline-code" id="-483439626#-s5fsc8_268">input</span>, <span class="inline-code" id="-483439626#-s5fsc8_269">output</span></p></td><td id="-483439626#-s5fsc8_265"><p><span class="inline-code" id="-483439626#-s5fsc8_270">Map&lt;String, Object&gt;</span></p></td></tr></table></div><blockquote class="prompt flex bordered-element-rounded tip detached">
  <svg xmlns="http://www.w3.org/2000/svg" class="prompt-icon">
    <path d="M12.946 3.552L21.52 18.4c.424.735.33 1.6-.519 1.6H3.855c-.85 0-1.817-.865-1.392-1.6l8.573-14.848a1.103 1.103 0 0 1 1.91 0zm.545 12.948a1.5 1.5 0 1 0-1.5 1.5 1.5 1.5 0 0 0 1.5-1.5zM13 8h-2v5h2z"></path>
  </svg>
  <div class="prompt-content prompt-content-p"><p id="-483439626#-s5fsc8_271">Estos m&eacute;todos son virtuales y deben ser sobreescritos en las clases hijas.</p></div>
</blockquote>
</section><section><h2 id="-483439626#publicaci-n-de-logs" data-toc="publicaci-n-de-logs#Documentacion_procesos_foundation.md-publicaci-n-de-logs">🧾 Publicaci&oacute;n de Logs</h2><section><h3 id="-483439626#publishserviceeventlog-string-executionresult" data-toc="publishserviceeventlog-string-executionresult#Documentacion_procesos_foundation.md-publishserviceeventlog-string-executionresult">publishServiceEventLog(String executionResult)</h3><p id="-483439626#-s5fsc8_274">Publica un log asincr&oacute;nico si la bandera <span class="inline-code" id="-483439626#-s5fsc8_277">sura_foundation_event_logs</span> est&aacute; habilitada. Incluye detalles del producto, respuesta serializada, proceso y plataforma.</p></section></section><section><h2 id="-483439626#excepciones" data-toc="excepciones#Documentacion_procesos_foundation.md-excepciones">⚠️ Excepciones</h2><p id="-483439626#-s5fsc8_278">Manejo espec&iacute;fico para <span class="inline-code" id="-483439626#-s5fsc8_282">ProductHandlerImplementationException</span>, cuyos datos se a&ntilde;aden al <span class="inline-code" id="-483439626#-s5fsc8_283">output</span>:</p><ul class="list" id="-483439626#-s5fsc8_279" start="1"><li class="list-item" id="-483439626#-s5fsc8_284"><p><span class="inline-code" id="-483439626#-s5fsc8_287">errorMsg</span></p></li><li class="list-item" id="-483439626#-s5fsc8_285"><p><span class="inline-code" id="-483439626#-s5fsc8_288">errorCode</span></p></li><li class="list-item" id="-483439626#-s5fsc8_286"><p><span class="inline-code" id="-483439626#-s5fsc8_289">error</span></p></li></ul><p id="-483439626#-s5fsc8_280">Tambi&eacute;n se registra el estado como <span class="inline-code" id="-483439626#-s5fsc8_290">&quot;error&quot;</span> y se serializa el mensaje de error.</p></section><section><h2 id="-483439626#ejemplo-de-cadena-de-handlers" data-toc="ejemplo-de-cadena-de-handlers#Documentacion_procesos_foundation.md-ejemplo-de-cadena-de-handlers">🔄 Ejemplo de Cadena de Handlers</h2><div class="detached code-block" id="-483439626#-s5fsc8_291"><pre><code class="language-none">ProductHandler handlerA = new SomeProductHandler('ProductoA');
ProductHandler handlerB = new SomeProductHandler('ProductoB');

handlerA.setNext(handlerB);

Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{ 'productName' =&gt; 'ProductoA' };
Map&lt;String, Object&gt; output = new Map&lt;String, Object&gt;();

handlerA.apply(new Map&lt;String, Object&gt;(), input, output);</code></pre></div></section><section><h2 id="-483439626#recomendaciones" data-toc="recomendaciones#Documentacion_procesos_foundation.md-recomendaciones">📚 Recomendaciones</h2><ul class="list" id="-483439626#-s5fsc8_293" start="1"><li class="list-item" id="-483439626#-s5fsc8_294"><p>Extiende esta clase e implementa <span class="inline-code" id="-483439626#-s5fsc8_298">process</span>, <span class="inline-code" id="-483439626#-s5fsc8_299">onPre</span> y <span class="inline-code" id="-483439626#-s5fsc8_300">onPos</span> en tus propias clases de producto.</p></li><li class="list-item" id="-483439626#-s5fsc8_295"><p>Utiliza <span class="inline-code" id="-483439626#-s5fsc8_301">FeatureFlags</span> para activar funcionalidades espec&iacute;ficas sin modificar c&oacute;digo productivo.</p></li><li class="list-item" id="-483439626#-s5fsc8_296"><p>Encadena handlers para distribuir la l&oacute;gica por tipo de producto.</p></li><li class="list-item" id="-483439626#-s5fsc8_297"></li></ul></section><section><h2 id="-483439626#leadproducthandler-apex-class-documentation" data-toc="leadproducthandler-apex-class-documentation#Documentacion_procesos_foundation.md-leadproducthandler-apex-class-documentation">LeadProductHandler Apex Class Documentation</h2><p id="-483439626#-s5fsc8_303"><span class="control" id="-483439626#-s5fsc8_305">Author</span>: Soulberto Lorenzo (soulberto@cloudblue.us (<a href="mailto:soulberto@cloudblue.us">mailto:soulberto@cloudblue.us</a>)) <span class="control" id="-483439626#-s5fsc8_308">Last Modified By</span>: Jean Carlos Melendez<span class="control" id="-483439626#-s5fsc8_310">Last Modified On</span>: 2025-04-25</p></section><section><h2 id="-483439626#overview" data-toc="overview#Documentacion_procesos_foundation.md-overview">📌 Overview</h2><p id="-483439626#-s5fsc8_311"><span class="inline-code" id="-483439626#-s5fsc8_314">LeadProductHandler</span> es una clase que extiende <span class="inline-code" id="-483439626#-s5fsc8_315">ProductHandler</span> y representa un manejador espec&iacute;fico para el producto tipo Lead. Esta clase implementa la l&oacute;gica de creaci&oacute;n de registros <span class="inline-code" id="-483439626#-s5fsc8_316">Lead</span> en Salesforce usando un patr&oacute;n de configuraci&oacute;n flexible a trav&eacute;s del constructor <span class="inline-code" id="-483439626#-s5fsc8_317">LeadBuilderFoundation</span>.</p><p id="-483439626#-s5fsc8_312">Tambi&eacute;n define validaciones espec&iacute;ficas y observadores dedicados (<span class="inline-code" id="-483439626#-s5fsc8_318">LeadObserver</span>) para su propio proceso de negocio.</p></section><section><h2 id="-483439626#class-definition" data-toc="class-definition#Documentacion_procesos_foundation.md-class-definition">🔧 Class Definition</h2><div class="detached code-block" id="-483439626#-s5fsc8_319"><pre><code class="language-none">global virtual class LeadProductHandler extends ProductHandler</code></pre></div><p id="-483439626#-s5fsc8_320">Esta clase:</p><ul class="list" id="-483439626#-s5fsc8_321" start="1"><li class="list-item" id="-483439626#-s5fsc8_323"><p><span class="control" id="-483439626#-s5fsc8_325">Es global y virtual</span>: puede ser accedida globalmente y sobreescrita si es necesario.</p></li><li class="list-item" id="-483439626#-s5fsc8_324"><p><span class="control" id="-483439626#-s5fsc8_326">Extiende <span class="inline-code" id="-483439626#-s5fsc8_327">ProductHandler</span></span>: hereda todo el comportamiento de la cadena de responsabilidad.</p></li></ul></section><section><h2 id="-483439626#properties" data-toc="properties#Documentacion_procesos_foundation.md-properties">🧩 Properties</h2><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_328"><tr class="header-row" id="-483439626#-s5fsc8_330"><th id="-483439626#-s5fsc8_332"><p>Propiedad</p></th><th id="-483439626#-s5fsc8_333"><p>Tipo</p></th><th id="-483439626#-s5fsc8_334"><p>Acceso</p></th><th id="-483439626#-s5fsc8_335"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-483439626#-s5fsc8_331"><td id="-483439626#-s5fsc8_336"><p><span class="inline-code" id="-483439626#-s5fsc8_340">PROCESS_NAME</span></p></td><td id="-483439626#-s5fsc8_337"><p><span class="inline-code" id="-483439626#-s5fsc8_341">String</span></p></td><td id="-483439626#-s5fsc8_338"><p>static final</p></td><td id="-483439626#-s5fsc8_339"><p>Constante que define el nombre del proceso: <span class="inline-code" id="-483439626#-s5fsc8_342">&quot;LEAD&quot;</span></p></td></tr></table></div></section><section><h2 id="-483439626#constructor" data-toc="constructor#Documentacion_procesos_foundation.md-constructor">🏗️ Constructor</h2><section><h3 id="-483439626#leadproducthandler-string-productname" data-toc="leadproducthandler-string-productname#Documentacion_procesos_foundation.md-leadproducthandler-string-productname">LeadProductHandler(String productName)</h3><p id="-483439626#-s5fsc8_345">Inicializa una instancia del handler para un producto tipo Lead.</p></section></section><section><h2 id="-483439626#observadores" data-toc="observadores#Documentacion_procesos_foundation.md-observadores">👀 Observadores</h2><section><h3 id="-483439626#setobservers" data-toc="setobservers#Documentacion_procesos_foundation.md-setobservers">setObservers()</h3><p id="-483439626#-s5fsc8_350">Sobrescribe el m&eacute;todo base para asignar el <span class="inline-code" id="-483439626#-s5fsc8_353">LeadObserver</span> como observador del handler.</p></section></section><section><h2 id="-483439626#m-todos-de-configuraci-n" data-toc="m-todos-de-configuraci-n#Documentacion_procesos_foundation.md-m-todos-de-configuraci-n">⚙️ M&eacute;todos de Configuraci&oacute;n</h2><p id="-483439626#-s5fsc8_354">Estos m&eacute;todos sobrescriben los definidos en la clase base para garantizar coherencia:</p><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_355"><tr class="header-row" id="-483439626#-s5fsc8_357"><th id="-483439626#-s5fsc8_361"><p>M&eacute;todo</p></th><th id="-483439626#-s5fsc8_362"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-483439626#-s5fsc8_358"><td id="-483439626#-s5fsc8_363"><p><span class="inline-code" id="-483439626#-s5fsc8_365">setProcessName</span></p></td><td id="-483439626#-s5fsc8_364"><p>Define el nombre del proceso (<span class="inline-code" id="-483439626#-s5fsc8_366">LEAD</span>).</p></td></tr><tr class="" id="-483439626#-s5fsc8_359"><td id="-483439626#-s5fsc8_367"><p><span class="inline-code" id="-483439626#-s5fsc8_369">setResponseProcess</span></p></td><td id="-483439626#-s5fsc8_368"><p>Asigna el objeto de respuesta del handler.</p></td></tr><tr class="" id="-483439626#-s5fsc8_360"><td id="-483439626#-s5fsc8_370"><p><span class="inline-code" id="-483439626#-s5fsc8_372">setRequestInput</span></p></td><td id="-483439626#-s5fsc8_371"><p>Almacena el objeto de entrada que ser&aacute; procesado.</p></td></tr></table></div></section><section><h2 id="-483439626#proceso-principal" data-toc="proceso-principal#Documentacion_procesos_foundation.md-proceso-principal">🔄 Proceso Principal</h2><section><h3 id="-483439626#process-map-options-map-input-map-output" data-toc="process-map-options-map-input-map-output#Documentacion_procesos_foundation.md-process-map-options-map-input-map-output">process(Map options, Map input, Map output)</h3><p id="-483439626#-s5fsc8_375">Este m&eacute;todo ejecuta la l&oacute;gica principal del handler para crear un <span class="inline-code" id="-483439626#-s5fsc8_383">Lead</span> usando <span class="inline-code" id="-483439626#-s5fsc8_384">LeadBuilderFoundation</span>.</p><p id="-483439626#-s5fsc8_376"><span class="control" id="-483439626#-s5fsc8_385">Flujo de ejecuci&oacute;n:</span></p><ol class="list list-decimal" id="-483439626#-s5fsc8_377" type="1" start="1"><li class="list-item" id="-483439626#-s5fsc8_386"><p>Verifica si se debe omitir el comportamiento por defecto con la opci&oacute;n <span class="inline-code" id="-483439626#-s5fsc8_391">skipDefaultBehavior</span>.</p></li><li class="list-item" id="-483439626#-s5fsc8_387"><p>Configura el nombre del proceso como <span class="inline-code" id="-483439626#-s5fsc8_392">&quot;LEAD&quot;</span>.</p></li><li class="list-item" id="-483439626#-s5fsc8_388"><p>Extrae los configuradores (<span class="inline-code" id="-483439626#-s5fsc8_393">LeadConfigurator</span>) del input.</p></li><li class="list-item" id="-483439626#-s5fsc8_389"><p>Construye el objeto <span class="inline-code" id="-483439626#-s5fsc8_394">Lead</span> mediante el patr&oacute;n Builder.</p></li><li class="list-item" id="-483439626#-s5fsc8_390"><p>Agrega el resultado al <span class="inline-code" id="-483439626#-s5fsc8_395">output</span> y lo retorna.</p></li></ol><p id="-483439626#-s5fsc8_378"><span class="control" id="-483439626#-s5fsc8_396">Manejo de errores:</span></p><ul class="list" id="-483439626#-s5fsc8_379" start="1"><li class="list-item" id="-483439626#-s5fsc8_397"><p>Captura y transforma excepciones <span class="inline-code" id="-483439626#-s5fsc8_398">DmlException</span> y <span class="inline-code" id="-483439626#-s5fsc8_399">Exception</span> en <span class="inline-code" id="-483439626#-s5fsc8_400">ProductHandlerImplementationException</span> con c&oacute;digo HTTP 422.</p></li></ul><p id="-483439626#-s5fsc8_380"><span class="control" id="-483439626#-s5fsc8_401">Retorna</span>:  Un <span class="inline-code" id="-483439626#-s5fsc8_403">Map&lt;String, Object&gt;</span> con el resultado del proceso (<span class="inline-code" id="-483439626#-s5fsc8_404">resultProcess</span>).</p></section></section><section><h2 id="-483439626#validaci-n-de-reglas-de-negocio" data-toc="validaci-n-de-reglas-de-negocio#Documentacion_procesos_foundation.md-validaci-n-de-reglas-de-negocio">✅ Validaci&oacute;n de Reglas de Negocio</h2><section><h3 id="-483439626#isvalidforleadrequirements-map-string-object-data" data-toc="isvalidforleadrequirements-map-string-object-data#Documentacion_procesos_foundation.md-isvalidforleadrequirements-map-string-object-data">isValidForLeadRequirements(Map&lt;String, Object&gt; data)</h3><p id="-483439626#-s5fsc8_407">M&eacute;todo virtual para definir las validaciones de negocio espec&iacute;ficas que deben cumplirse antes de crear un <span class="inline-code" id="-483439626#-s5fsc8_411">Lead</span>. En esta implementaci&oacute;n retorna siempre <span class="inline-code" id="-483439626#-s5fsc8_412">true</span>, pero est&aacute; dise&ntilde;ado para ser extendido.</p><p id="-483439626#-s5fsc8_408"><span class="control" id="-483439626#-s5fsc8_413">Retorna</span>: <span class="inline-code" id="-483439626#-s5fsc8_414">Boolean</span></p></section></section><section><h2 id="-483439626#ejemplo-de-uso" data-toc="ejemplo-de-uso#Documentacion_procesos_foundation.md-ejemplo-de-uso">📚 Ejemplo de Uso</h2><div class="detached code-block" id="-483439626#-s5fsc8_415"><pre><code class="language-none">LeadProductHandler leadHandler = new LeadProductHandler('ProductoLead');

Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
  'status' =&gt; 'Nuevo',
  'firstName' =&gt; 'Ana',
  'lastName' =&gt; 'García',
  'email' =&gt; 'ana.garcia@example.com',
  'company' =&gt; 'Empresa XYZ'
};

Map&lt;String, Object&gt; output = new Map&lt;String, Object&gt;();

leadHandler.apply(new Map&lt;String, Object&gt;(), input, output);

System.debug(output.get('resultProcess')); // Muestra el Lead creado</code></pre></div></section><section><h2 id="-483439626#consideraciones" data-toc="consideraciones#Documentacion_procesos_foundation.md-consideraciones">📝 Consideraciones</h2><ul class="list" id="-483439626#-s5fsc8_417" start="1"><li class="list-item" id="-483439626#-s5fsc8_419"><p><span class="inline-code" id="-483439626#-s5fsc8_422">LeadBuilderFoundation</span> encapsula la l&oacute;gica de creaci&oacute;n del <span class="inline-code" id="-483439626#-s5fsc8_423">Lead</span>.</p></li><li class="list-item" id="-483439626#-s5fsc8_420"><p><span class="inline-code" id="-483439626#-s5fsc8_424">LeadConfigurator</span> permite extender din&aacute;micamente la configuraci&oacute;n del Lead.</p></li><li class="list-item" id="-483439626#-s5fsc8_421"><p>Utiliza excepciones personalizadas para controlar errores del proceso.</p></li></ul></section><section><h2 id="-483439626#leadconfigurator-apex-interface-documentation" data-toc="leadconfigurator-apex-interface-documentation#Documentacion_procesos_foundation.md-leadconfigurator-apex-interface-documentation">LeadConfigurator Apex Interface Documentation</h2><p id="-483439626#-s5fsc8_426"><span class="control" id="-483439626#-s5fsc8_428">Author</span>: Jean Carlos Melendez<span class="control" id="-483439626#-s5fsc8_430">Last Modified By</span>: Jean Carlos Melendez<span class="control" id="-483439626#-s5fsc8_432">Last Modified On</span>: 2025-01-30</p></section><section><h2 id="-483439626#overview" data-toc="overview#Documentacion_procesos_foundation.md-overview">📌 Overview</h2><p id="-483439626#-s5fsc8_433"><span class="inline-code" id="-483439626#-s5fsc8_435">LeadConfigurator</span> es una interfaz global en Apex que define un contrato para aplicar configuraciones personalizadas a registros de tipo <span class="inline-code" id="-483439626#-s5fsc8_436">Lead</span>. Su prop&oacute;sito es permitir la extensi&oacute;n modular del proceso de creaci&oacute;n de Leads, brindando flexibilidad y encapsulamiento para adaptar configuraciones espec&iacute;ficas seg&uacute;n el contexto o negocio.</p></section><section><h2 id="-483439626#interface-definition" data-toc="interface-definition#Documentacion_procesos_foundation.md-interface-definition">🔧 Interface Definition</h2><div class="detached code-block" id="-483439626#-s5fsc8_437"><pre><code class="language-none">global interface LeadConfigurator {
  void configure(Lead lead);
}</code></pre></div></section><section><h2 id="-483439626#method-summary" data-toc="method-summary#Documentacion_procesos_foundation.md-method-summary">🧩 Method Summary</h2><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_439"><tr class="header-row" id="-483439626#-s5fsc8_441"><th id="-483439626#-s5fsc8_443"><p>M&eacute;todo</p></th><th id="-483439626#-s5fsc8_444"><p>Tipo de Retorno</p></th><th id="-483439626#-s5fsc8_445"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-483439626#-s5fsc8_442"><td id="-483439626#-s5fsc8_446"><p><span class="inline-code" id="-483439626#-s5fsc8_449">configure</span></p></td><td id="-483439626#-s5fsc8_447"><p><span class="inline-code" id="-483439626#-s5fsc8_450">void</span></p></td><td id="-483439626#-s5fsc8_448"><p>M&eacute;todo obligatorio que implementa la l&oacute;gica de configuraci&oacute;n sobre un objeto <span class="inline-code" id="-483439626#-s5fsc8_451">Lead</span>.</p></td></tr></table></div></section><section><h2 id="-483439626#method-details" data-toc="method-details#Documentacion_procesos_foundation.md-method-details">🧪 Method Details</h2><section><h3 id="-483439626#configure-lead-lead" data-toc="configure-lead-lead#Documentacion_procesos_foundation.md-configure-lead-lead">configure(Lead lead)</h3><p id="-483439626#-s5fsc8_454"><span class="control" id="-483439626#-s5fsc8_460">Descripci&oacute;n</span>:  Este m&eacute;todo debe ser implementado por cualquier clase que desee proporcionar l&oacute;gica personalizada de configuraci&oacute;n sobre un objeto <span class="inline-code" id="-483439626#-s5fsc8_462">Lead</span>. Puede ser utilizado, por ejemplo, para asignar valores a campos adicionales, ejecutar validaciones o asociar datos relacionados al Lead durante su construcci&oacute;n.</p><p id="-483439626#-s5fsc8_455"><span class="control" id="-483439626#-s5fsc8_463">Par&aacute;metros</span>:</p><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_456"><tr class="header-row" id="-483439626#-s5fsc8_464"><th id="-483439626#-s5fsc8_466"><p>Nombre</p></th><th id="-483439626#-s5fsc8_467"><p>Tipo</p></th><th id="-483439626#-s5fsc8_468"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-483439626#-s5fsc8_465"><td id="-483439626#-s5fsc8_469"><p><span class="inline-code" id="-483439626#-s5fsc8_472">lead</span></p></td><td id="-483439626#-s5fsc8_470"><p><span class="inline-code" id="-483439626#-s5fsc8_473">Lead</span></p></td><td id="-483439626#-s5fsc8_471"><p>Instancia de <span class="inline-code" id="-483439626#-s5fsc8_474">Lead</span> sobre la cual se aplicar&aacute;n las configuraciones.</p></td></tr></table></div><p id="-483439626#-s5fsc8_457"><span class="control" id="-483439626#-s5fsc8_475">Retorno</span>:  No retorna ning&uacute;n valor (<span class="inline-code" id="-483439626#-s5fsc8_477">void</span>), pero modifica directamente el objeto <span class="inline-code" id="-483439626#-s5fsc8_478">Lead</span> recibido por referencia.</p></section></section><section><h2 id="-483439626#ejemplo-de-implementaci-n" data-toc="ejemplo-de-implementaci-n#Documentacion_procesos_foundation.md-ejemplo-de-implementaci-n">📚 Ejemplo de Implementaci&oacute;n</h2><div class="detached code-block" id="-483439626#-s5fsc8_479"><pre><code class="language-none">global class CountryConfigurator implements LeadConfigurator {
  public void configure(Lead lead) {
    lead.Country = 'Colombia';
  }
}</code></pre></div></section><section><h2 id="-483439626#consideraciones" data-toc="consideraciones#Documentacion_procesos_foundation.md-consideraciones">📝 Consideraciones</h2><ul class="list" id="-483439626#-s5fsc8_481" start="1"><li class="list-item" id="-483439626#-s5fsc8_483"><p>Esta interfaz permite desacoplar las configuraciones espec&iacute;ficas del proceso de creaci&oacute;n de Leads.</p></li><li class="list-item" id="-483439626#-s5fsc8_484"><p>Es &uacute;til cuando se construyen m&uacute;ltiples leads con diferentes reglas de negocio.</p></li><li class="list-item" id="-483439626#-s5fsc8_485"><p>Puede ser utilizada en conjunto con patrones como Builder o Chain of Responsibility.</p></li></ul></section><section><h2 id="-483439626#recomendaci-n" data-toc="recomendaci-n#Documentacion_procesos_foundation.md-recomendaci-n">🧠 Recomendaci&oacute;n</h2><p id="-483439626#-s5fsc8_486">Implementa m&uacute;ltiples clases <span class="inline-code" id="-483439626#-s5fsc8_488">LeadConfigurator</span> para cubrir distintos aspectos del negocio y agr&uacute;palas como una lista en el <span class="inline-code" id="-483439626#-s5fsc8_489">LeadBuilderFoundation</span> o clases similares, mejorando as&iacute; la mantenibilidad y escalabilidad del sistema.</p></section><section><h2 id="-483439626#rateproducthandler-apex-class-documentation" data-toc="rateproducthandler-apex-class-documentation#Documentacion_procesos_foundation.md-rateproducthandler-apex-class-documentation">RateProductHandler Apex Class Documentation</h2><p id="-483439626#-s5fsc8_491"><span class="control" id="-483439626#-s5fsc8_493">Author</span>: Soulberto Lorenzo (soulberto@cloudblue.us (<a href="mailto:soulberto@cloudblue.us">mailto:soulberto@cloudblue.us</a>)) <span class="control" id="-483439626#-s5fsc8_496">Last Modified By</span>: Jean Carlos Melendez<span class="control" id="-483439626#-s5fsc8_498">Last Modified On</span>: 2025-04-23</p></section><section><h2 id="-483439626#overview" data-toc="overview#Documentacion_procesos_foundation.md-overview">📌 Overview</h2><p id="-483439626#-s5fsc8_499"><span class="inline-code" id="-483439626#-s5fsc8_501">RateProductHandler</span> es una clase que extiende <span class="inline-code" id="-483439626#-s5fsc8_502">ProductHandler</span> y est&aacute; dise&ntilde;ada para manejar la tarificaci&oacute;n de productos en Salesforce. Utiliza un Integration Procedure (IP) para calcular tarifas basadas en par&aacute;metros de entrada, gestionando tanto la validaci&oacute;n como la ejecuci&oacute;n del procedimiento y el formateo de resultados.</p></section><section><h2 id="-483439626#class-definition" data-toc="class-definition#Documentacion_procesos_foundation.md-class-definition">🔧 Class Definition</h2><div class="detached code-block" id="-483439626#-s5fsc8_503"><pre><code class="language-none">global virtual class RateProductHandler extends ProductHandler</code></pre></div></section><section><h2 id="-483439626#properties" data-toc="properties#Documentacion_procesos_foundation.md-properties">🧩 Properties</h2><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_505"><tr class="header-row" id="-483439626#-s5fsc8_507"><th id="-483439626#-s5fsc8_513"><p>Propiedad</p></th><th id="-483439626#-s5fsc8_514"><p>Tipo</p></th><th id="-483439626#-s5fsc8_515"><p>Acceso</p></th><th id="-483439626#-s5fsc8_516"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-483439626#-s5fsc8_508"><td id="-483439626#-s5fsc8_517"><p><span class="inline-code" id="-483439626#-s5fsc8_521">PROCESS_NAME</span></p></td><td id="-483439626#-s5fsc8_518"><p><span class="inline-code" id="-483439626#-s5fsc8_522">String</span></p></td><td id="-483439626#-s5fsc8_519"><p><span class="inline-code" id="-483439626#-s5fsc8_523">static final</span></p></td><td id="-483439626#-s5fsc8_520"><p>Nombre del proceso: <span class="inline-code" id="-483439626#-s5fsc8_524">&quot;TARIFICACION&quot;</span></p></td></tr><tr class="" id="-483439626#-s5fsc8_509"><td id="-483439626#-s5fsc8_525"><p><span class="inline-code" id="-483439626#-s5fsc8_529">OPTION_SKIP_BEHAVIOR</span></p></td><td id="-483439626#-s5fsc8_526"><p><span class="inline-code" id="-483439626#-s5fsc8_530">String</span></p></td><td id="-483439626#-s5fsc8_527"><p><span class="inline-code" id="-483439626#-s5fsc8_531">static final</span></p></td><td id="-483439626#-s5fsc8_528"><p>Opci&oacute;n para omitir la ejecuci&oacute;n normal del handler.</p></td></tr><tr class="" id="-483439626#-s5fsc8_510"><td id="-483439626#-s5fsc8_532"><p><span class="inline-code" id="-483439626#-s5fsc8_536">RATING_IPROCEDURE</span></p></td><td id="-483439626#-s5fsc8_533"><p><span class="inline-code" id="-483439626#-s5fsc8_537">String</span></p></td><td id="-483439626#-s5fsc8_534"><p><span class="inline-code" id="-483439626#-s5fsc8_538">static final</span></p></td><td id="-483439626#-s5fsc8_535"><p>Nombre del Integration Procedure utilizado para la tarificaci&oacute;n.</p></td></tr><tr class="" id="-483439626#-s5fsc8_511"><td id="-483439626#-s5fsc8_539"><p><span class="inline-code" id="-483439626#-s5fsc8_543">EXECUTOR</span></p></td><td id="-483439626#-s5fsc8_540"><p><span class="inline-code" id="-483439626#-s5fsc8_544">IntegrationProcedureExecutor</span></p></td><td id="-483439626#-s5fsc8_541"><p><span class="inline-code" id="-483439626#-s5fsc8_545">global</span></p></td><td id="-483439626#-s5fsc8_542"><p>Ejecuta el procedimiento de integraci&oacute;n.</p></td></tr><tr class="" id="-483439626#-s5fsc8_512"><td id="-483439626#-s5fsc8_546"><p><span class="inline-code" id="-483439626#-s5fsc8_550">REQUIRED_PARAMETERS</span></p></td><td id="-483439626#-s5fsc8_547"><p><span class="inline-code" id="-483439626#-s5fsc8_551">Set&lt;String&gt;</span></p></td><td id="-483439626#-s5fsc8_548"><p><span class="inline-code" id="-483439626#-s5fsc8_552">static final</span></p></td><td id="-483439626#-s5fsc8_549"><p>Par&aacute;metros obligatorios para ejecutar el IP.</p></td></tr></table></div></section><section><h2 id="-483439626#constructores" data-toc="constructores#Documentacion_procesos_foundation.md-constructores">🏗️ Constructores</h2><section><h3 id="-483439626#rateproducthandler-string-productname-integrationprocedureexecutor-executor" data-toc="rateproducthandler-string-productname-integrationprocedureexecutor-executor#Documentacion_procesos_foundation.md-rateproducthandler-string-productname-integrationprocedureexecutor-executor">RateProductHandler(String productName, IntegrationProcedureExecutor executor)</h3><p id="-483439626#-s5fsc8_556">Crea una instancia del handler con un ejecutor personalizado.</p></section><section><h3 id="-483439626#rateproducthandler-string-productname" data-toc="rateproducthandler-string-productname#Documentacion_procesos_foundation.md-rateproducthandler-string-productname">RateProductHandler(String productName)</h3><p id="-483439626#-s5fsc8_559">Crea una instancia con un ejecutor simulado (<span class="inline-code" id="-483439626#-s5fsc8_562">MockIntegrationProcedureExecutor</span>), &uacute;til para pruebas.</p></section></section><section><h2 id="-483439626#m-todos-de-configuraci-n" data-toc="m-todos-de-configuraci-n#Documentacion_procesos_foundation.md-m-todos-de-configuraci-n">⚙️ M&eacute;todos de Configuraci&oacute;n</h2><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_563"><tr class="header-row" id="-483439626#-s5fsc8_565"><th id="-483439626#-s5fsc8_569"><p>M&eacute;todo</p></th><th id="-483439626#-s5fsc8_570"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-483439626#-s5fsc8_566"><td id="-483439626#-s5fsc8_571"><p><span class="inline-code" id="-483439626#-s5fsc8_573">setProcessName(String)</span></p></td><td id="-483439626#-s5fsc8_572"><p>Asigna el nombre del proceso.</p></td></tr><tr class="" id="-483439626#-s5fsc8_567"><td id="-483439626#-s5fsc8_574"><p><span class="inline-code" id="-483439626#-s5fsc8_576">setResponseProcess(Object)</span></p></td><td id="-483439626#-s5fsc8_575"><p>Guarda la respuesta generada.</p></td></tr><tr class="" id="-483439626#-s5fsc8_568"><td id="-483439626#-s5fsc8_577"><p><span class="inline-code" id="-483439626#-s5fsc8_579">setRequestInput(Object)</span></p></td><td id="-483439626#-s5fsc8_578"><p>Guarda los datos de entrada procesados.</p></td></tr></table></div></section><section><h2 id="-483439626#validaci-n-de-par-metros" data-toc="validaci-n-de-par-metros#Documentacion_procesos_foundation.md-validaci-n-de-par-metros">✅ Validaci&oacute;n de Par&aacute;metros</h2><section><h3 id="-483439626#isvalidforratingparameters-map-string-object-data" data-toc="isvalidforratingparameters-map-string-object-data#Documentacion_procesos_foundation.md-isvalidforratingparameters-map-string-object-data">isValidForRatingParameters(Map&lt;String, Object&gt; data)</h3><p id="-483439626#-s5fsc8_582">Verifica que todos los par&aacute;metros definidos en <span class="inline-code" id="-483439626#-s5fsc8_586">REQUIRED_PARAMETERS</span> est&eacute;n presentes en el <span class="inline-code" id="-483439626#-s5fsc8_587">input</span>.</p><p id="-483439626#-s5fsc8_583"><span class="control" id="-483439626#-s5fsc8_588">Retorna</span>: <span class="inline-code" id="-483439626#-s5fsc8_589">true</span> si todos est&aacute;n presentes, <span class="inline-code" id="-483439626#-s5fsc8_590">false</span> si falta alguno.</p></section></section><section><h2 id="-483439626#m-todo-principal" data-toc="m-todo-principal#Documentacion_procesos_foundation.md-m-todo-principal">🔄 M&eacute;todo Principal</h2><section><h3 id="-483439626#process-map-options-map-input-map-output" data-toc="process-map-options-map-input-map-output#Documentacion_procesos_foundation.md-process-map-options-map-input-map-output">process(Map options, Map input, Map output)</h3><p id="-483439626#-s5fsc8_593">Este m&eacute;todo es el n&uacute;cleo de la l&oacute;gica del handler. Valida, construye y ejecuta el IP.</p><p id="-483439626#-s5fsc8_594"><span class="control" id="-483439626#-s5fsc8_598">Retorno</span>: <span class="inline-code" id="-483439626#-s5fsc8_599">Map&lt;String, Object&gt;</span> &mdash; Resultado del proceso de tarificaci&oacute;n.</p><p id="-483439626#-s5fsc8_595"><span class="control" id="-483439626#-s5fsc8_600">Excepci&oacute;n</span>: Lanza <span class="inline-code" id="-483439626#-s5fsc8_601">ProductHandlerImplementationException</span> si la validaci&oacute;n falla.</p></section></section><section><h2 id="-483439626#utilidades" data-toc="utilidades#Documentacion_procesos_foundation.md-utilidades">🔧 Utilidades</h2><section><h3 id="-483439626#buildinputmap-map-input-map-options" data-toc="buildinputmap-map-input-map-options#Documentacion_procesos_foundation.md-buildinputmap-map-input-map-options">buildInputMap(Map input, Map options)</h3><p id="-483439626#-s5fsc8_604">Combina el <span class="inline-code" id="-483439626#-s5fsc8_607">input</span> original con las <span class="inline-code" id="-483439626#-s5fsc8_608">options</span> para generar el mapa que se enviar&aacute; al IP.</p></section></section><section><h2 id="-483439626#ejecuci-n-del-integration-procedure" data-toc="ejecuci-n-del-integration-procedure#Documentacion_procesos_foundation.md-ejecuci-n-del-integration-procedure">⚙️ Ejecuci&oacute;n del Integration Procedure</h2><section><h3 id="-483439626#executeintegrationprocedure-map-ipinput" data-toc="executeintegrationprocedure-map-ipinput#Documentacion_procesos_foundation.md-executeintegrationprocedure-map-ipinput">executeIntegrationProcedure(Map ipInput)</h3><p id="-483439626#-s5fsc8_611">Ejecuta el Integration Procedure definido en <span class="inline-code" id="-483439626#-s5fsc8_614">RATING_IPROCEDURE</span> usando el <span class="inline-code" id="-483439626#-s5fsc8_615">EXECUTOR</span>.</p></section></section><section><h2 id="-483439626#ejemplo-de-uso" data-toc="ejemplo-de-uso#Documentacion_procesos_foundation.md-ejemplo-de-uso">📚 Ejemplo de Uso</h2><div class="detached code-block" id="-483439626#-s5fsc8_616"><pre><code class="language-none">RateProductHandler handler = new RateProductHandler('ProductoX');

Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
  'includeInputKeys' =&gt; true,
  'instanceKey' =&gt; 'INST001',
  'filters' =&gt; new Map&lt;String, Object&gt;{ 'edad' =&gt; 35 }
};

Map&lt;String, Object&gt; output = new Map&lt;String, Object&gt;();

handler.apply(new Map&lt;String, Object&gt;(), input, output);

System.debug(output.get('resultProcess'));</code></pre></div></section><section><h2 id="-483439626#consideraciones" data-toc="consideraciones#Documentacion_procesos_foundation.md-consideraciones">📝 Consideraciones</h2><ul class="list" id="-483439626#-s5fsc8_618" start="1"><li class="list-item" id="-483439626#-s5fsc8_620"><p>Este handler se adapta perfectamente a arquitecturas basadas en IP.</p></li><li class="list-item" id="-483439626#-s5fsc8_621"><p>Recomendado sobrescribir <span class="inline-code" id="-483439626#-s5fsc8_623">setObservers()</span> para agregar <span class="inline-code" id="-483439626#-s5fsc8_624">RateObserver</span>.</p></li><li class="list-item" id="-483439626#-s5fsc8_622"><p>Bien estructurado para mantenibilidad y pruebas.</p></li></ul></section><section><h2 id="-483439626#integrationprocedureexecutor-apex-interface-documentation" data-toc="integrationprocedureexecutor-apex-interface-documentation#Documentacion_procesos_foundation.md-integrationprocedureexecutor-apex-interface-documentation">IntegrationProcedureExecutor Apex Interface Documentation</h2><p id="-483439626#-s5fsc8_626"><span class="control" id="-483439626#-s5fsc8_628">Author</span>: Jean Carlos Melendez<span class="control" id="-483439626#-s5fsc8_630">Last Modified By</span>: Jean Carlos Melendez<span class="control" id="-483439626#-s5fsc8_632">Last Modified On</span>: 2025-01-28</p></section><section><h2 id="-483439626#overview" data-toc="overview#Documentacion_procesos_foundation.md-overview">📌 Overview</h2><p id="-483439626#-s5fsc8_633"><span class="inline-code" id="-483439626#-s5fsc8_635">IntegrationProcedureExecutor</span> es una interfaz global que define el contrato para ejecutar procedimientos de integraci&oacute;n en Salesforce.</p></section><section><h2 id="-483439626#interface-definition" data-toc="interface-definition#Documentacion_procesos_foundation.md-interface-definition">🔧 Interface Definition</h2><div class="detached code-block" id="-483439626#-s5fsc8_636"><pre><code class="language-none">global interface IntegrationProcedureExecutor {
  Map&lt;String, Object&gt; execute(String procedureName, Map&lt;String, Object&gt; input);
}</code></pre></div></section><section><h2 id="-483439626#method-summary" data-toc="method-summary#Documentacion_procesos_foundation.md-method-summary">🧩 Method Summary</h2><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_638"><tr class="header-row" id="-483439626#-s5fsc8_640"><th id="-483439626#-s5fsc8_642"><p>M&eacute;todo</p></th><th id="-483439626#-s5fsc8_643"><p>Tipo de Retorno</p></th><th id="-483439626#-s5fsc8_644"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-483439626#-s5fsc8_641"><td id="-483439626#-s5fsc8_645"><p><span class="inline-code" id="-483439626#-s5fsc8_648">execute</span></p></td><td id="-483439626#-s5fsc8_646"><p><span class="inline-code" id="-483439626#-s5fsc8_649">Map&lt;String, Object&gt;</span></p></td><td id="-483439626#-s5fsc8_647"><p>Ejecuta un Integration Procedure y retorna los resultados.</p></td></tr></table></div></section><section><h2 id="-483439626#method-details" data-toc="method-details#Documentacion_procesos_foundation.md-method-details">📥 Method Details</h2><section><h3 id="-483439626#execute-string-procedurename-map-string-object-input" data-toc="execute-string-procedurename-map-string-object-input#Documentacion_procesos_foundation.md-execute-string-procedurename-map-string-object-input">execute(String procedureName, Map&lt;String, Object&gt; input)</h3><p id="-483439626#-s5fsc8_652">Ejecuta un IP con el nombre y mapa de entrada especificado.</p><p id="-483439626#-s5fsc8_653"><span class="control" id="-483439626#-s5fsc8_658">Par&aacute;metros</span>:</p><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_654"><tr class="header-row" id="-483439626#-s5fsc8_659"><th id="-483439626#-s5fsc8_662"><p>Nombre</p></th><th id="-483439626#-s5fsc8_663"><p>Tipo</p></th><th id="-483439626#-s5fsc8_664"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-483439626#-s5fsc8_660"><td id="-483439626#-s5fsc8_665"><p><span class="inline-code" id="-483439626#-s5fsc8_668">procedureName</span></p></td><td id="-483439626#-s5fsc8_666"><p><span class="inline-code" id="-483439626#-s5fsc8_669">String</span></p></td><td id="-483439626#-s5fsc8_667"><p>Nombre del IP a ejecutar.</p></td></tr><tr class="" id="-483439626#-s5fsc8_661"><td id="-483439626#-s5fsc8_670"><p><span class="inline-code" id="-483439626#-s5fsc8_673">input</span></p></td><td id="-483439626#-s5fsc8_671"><p><span class="inline-code" id="-483439626#-s5fsc8_674">Map&lt;String, Object&gt;</span></p></td><td id="-483439626#-s5fsc8_672"><p>Datos de entrada.</p></td></tr></table></div><p id="-483439626#-s5fsc8_655"><span class="control" id="-483439626#-s5fsc8_675">Retorna</span>: <span class="inline-code" id="-483439626#-s5fsc8_677">Map&lt;String, Object&gt;</span> &mdash; Respuesta del IP.</p></section></section><section><h2 id="-483439626#ejemplo-de-implementaci-n" data-toc="ejemplo-de-implementaci-n#Documentacion_procesos_foundation.md-ejemplo-de-implementaci-n">📚 Ejemplo de Implementaci&oacute;n</h2><div class="detached code-block" id="-483439626#-s5fsc8_678"><pre><code class="language-none">goblal class VlocityIntegrationProcedureExecutor implements IntegrationProcedureExecutor {
  public Map&lt;String, Object&gt; execute(
    String procedureName,
    Map&lt;String, Object&gt; input
  ) {
    
    return (Map&lt;String, Object&gt;) vlocity_ins.IntegrationProcedureService.runIntegrationService(
      procedureName,
      input,
      new Map&lt;String, Object&gt;()
    );
  }
}</code></pre></div></section><section><h2 id="-483439626#consideraciones" data-toc="consideraciones#Documentacion_procesos_foundation.md-consideraciones">📝 Consideraciones</h2><ul class="list" id="-483439626#-s5fsc8_680" start="1"><li class="list-item" id="-483439626#-s5fsc8_682"><p>Ideal para pruebas y desacoplamiento de l&oacute;gica de negocio.</p></li><li class="list-item" id="-483439626#-s5fsc8_683"><p>Facilita el cumplimiento del principio de inversi&oacute;n de dependencias (SOLID).</p></li></ul></section><section><h2 id="-483439626#quoteproducthandler-apex-class-documentation" data-toc="quoteproducthandler-apex-class-documentation#Documentacion_procesos_foundation.md-quoteproducthandler-apex-class-documentation">QuoteProductHandler Apex Class Documentation</h2><p id="-483439626#-s5fsc8_685"><span class="control" id="-483439626#-s5fsc8_687">Author</span>: Soulberto Lorenzo (soulberto@cloudblue.us (<a href="mailto:soulberto@cloudblue.us">mailto:soulberto@cloudblue.us</a>)) <span class="control" id="-483439626#-s5fsc8_690">Last Modified By</span>: Jean Carlos Melendez<span class="control" id="-483439626#-s5fsc8_692">Last Modified On</span>: 2025-04-02</p></section><section><h2 id="-483439626#overview" data-toc="overview#Documentacion_procesos_foundation.md-overview">📌 Overview</h2><p id="-483439626#-s5fsc8_693"><span class="inline-code" id="-483439626#-s5fsc8_695">QuoteProductHandler</span> es una implementaci&oacute;n concreta de <span class="inline-code" id="-483439626#-s5fsc8_696">ProductHandler</span> que permite procesar cotizaciones de productos mediante un <span class="inline-code" id="-483439626#-s5fsc8_697">IntegrationProcedure</span> especializado. Esta clase incluye validaciones estrictas de los datos de entrada, ejecuta un procedimiento de cotizaci&oacute;n y retorna los resultados, integrando observadores y manejando excepciones adecuadamente.</p></section><section><h2 id="-483439626#class-definition" data-toc="class-definition#Documentacion_procesos_foundation.md-class-definition">🔧 Class Definition</h2><div class="detached code-block" id="-483439626#-s5fsc8_698"><pre><code class="language-none">global virtual class QuoteProductHandler extends ProductHandler</code></pre></div><p id="-483439626#-s5fsc8_699">Esta clase:</p><ul class="list" id="-483439626#-s5fsc8_700" start="1"><li class="list-item" id="-483439626#-s5fsc8_702"><p>Es global y virtual, permitiendo su extensi&oacute;n.</p></li><li class="list-item" id="-483439626#-s5fsc8_703"><p>Hereda de <span class="inline-code" id="-483439626#-s5fsc8_705">ProductHandler</span>.</p></li><li class="list-item" id="-483439626#-s5fsc8_704"><p>Est&aacute; dise&ntilde;ada para manejar l&oacute;gica de cotizaci&oacute;n de seguros u otros productos complejos.</p></li></ul></section><section><h2 id="-483439626#properties" data-toc="properties#Documentacion_procesos_foundation.md-properties">🧩 Properties</h2><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_706"><tr class="header-row" id="-483439626#-s5fsc8_708"><th id="-483439626#-s5fsc8_715"><p>Propiedad</p></th><th id="-483439626#-s5fsc8_716"><p>Tipo</p></th><th id="-483439626#-s5fsc8_717"><p>Acceso</p></th><th id="-483439626#-s5fsc8_718"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-483439626#-s5fsc8_709"><td id="-483439626#-s5fsc8_719"><p><span class="inline-code" id="-483439626#-s5fsc8_723">PROCESS_NAME</span></p></td><td id="-483439626#-s5fsc8_720"><p><span class="inline-code" id="-483439626#-s5fsc8_724">String</span></p></td><td id="-483439626#-s5fsc8_721"><p><span class="inline-code" id="-483439626#-s5fsc8_725">static final</span></p></td><td id="-483439626#-s5fsc8_722"><p>Nombre del proceso: <span class="inline-code" id="-483439626#-s5fsc8_726">&quot;COTIZACION&quot;</span></p></td></tr><tr class="" id="-483439626#-s5fsc8_710"><td id="-483439626#-s5fsc8_727"><p><span class="inline-code" id="-483439626#-s5fsc8_731">MAIN_NODE</span></p></td><td id="-483439626#-s5fsc8_728"><p><span class="inline-code" id="-483439626#-s5fsc8_732">String</span></p></td><td id="-483439626#-s5fsc8_729"><p><span class="inline-code" id="-483439626#-s5fsc8_733">static final</span></p></td><td id="-483439626#-s5fsc8_730"><p>Nodo principal esperado en el input: <span class="inline-code" id="-483439626#-s5fsc8_734">&quot;quotepolicyJson&quot;</span></p></td></tr><tr class="" id="-483439626#-s5fsc8_711"><td id="-483439626#-s5fsc8_735"><p><span class="inline-code" id="-483439626#-s5fsc8_739">OPTION_SKIP_BEHAVIOR</span></p></td><td id="-483439626#-s5fsc8_736"><p><span class="inline-code" id="-483439626#-s5fsc8_740">String</span></p></td><td id="-483439626#-s5fsc8_737"><p><span class="inline-code" id="-483439626#-s5fsc8_741">static final</span></p></td><td id="-483439626#-s5fsc8_738"><p>Clave para omitir el procesamiento por defecto.</p></td></tr><tr class="" id="-483439626#-s5fsc8_712"><td id="-483439626#-s5fsc8_742"><p><span class="inline-code" id="-483439626#-s5fsc8_746">RATING_IPROCEDURE</span></p></td><td id="-483439626#-s5fsc8_743"><p><span class="inline-code" id="-483439626#-s5fsc8_747">String</span></p></td><td id="-483439626#-s5fsc8_744"><p><span class="inline-code" id="-483439626#-s5fsc8_748">static final</span></p></td><td id="-483439626#-s5fsc8_745"><p>Nombre del Integration Procedure para cotizaci&oacute;n.</p></td></tr><tr class="" id="-483439626#-s5fsc8_713"><td id="-483439626#-s5fsc8_749"><p><span class="inline-code" id="-483439626#-s5fsc8_753">EXECUTOR</span></p></td><td id="-483439626#-s5fsc8_750"><p><span class="inline-code" id="-483439626#-s5fsc8_754">IntegrationProcedureExecutor</span></p></td><td id="-483439626#-s5fsc8_751"><p><span class="inline-code" id="-483439626#-s5fsc8_755">global</span></p></td><td id="-483439626#-s5fsc8_752"><p>Ejecuta el procedimiento de cotizaci&oacute;n.</p></td></tr><tr class="" id="-483439626#-s5fsc8_714"><td id="-483439626#-s5fsc8_756"><p><span class="inline-code" id="-483439626#-s5fsc8_760">REQUIRED_PARAMETERS</span></p></td><td id="-483439626#-s5fsc8_757"><p><span class="inline-code" id="-483439626#-s5fsc8_761">Set&lt;String&gt;</span></p></td><td id="-483439626#-s5fsc8_758"><p><span class="inline-code" id="-483439626#-s5fsc8_762">static final</span></p></td><td id="-483439626#-s5fsc8_759"><p>Nodos requeridos dentro de <span class="inline-code" id="-483439626#-s5fsc8_763">MAIN_NODE</span>.</p></td></tr></table></div></section><section><h2 id="-483439626#constructores" data-toc="constructores#Documentacion_procesos_foundation.md-constructores">🏗️ Constructores</h2><section><h3 id="-483439626#quoteproducthandler-string-productname-integrationprocedureexecutor-executor" data-toc="quoteproducthandler-string-productname-integrationprocedureexecutor-executor#Documentacion_procesos_foundation.md-quoteproducthandler-string-productname-integrationprocedureexecutor-executor">QuoteProductHandler(String productName, IntegrationProcedureExecutor executor)</h3><p id="-483439626#-s5fsc8_767">Crea una instancia del handler utilizando un executor personalizado para ambientes productivos.</p></section><section><h3 id="-483439626#quoteproducthandler-string-productname" data-toc="quoteproducthandler-string-productname#Documentacion_procesos_foundation.md-quoteproducthandler-string-productname">QuoteProductHandler(String productName)</h3><p id="-483439626#-s5fsc8_770">Crea una instancia usando un <span class="inline-code" id="-483439626#-s5fsc8_773">MockIntegrationProcedureExecutor</span>, ideal para pruebas.</p></section></section><section><h2 id="-483439626#observadores" data-toc="observadores#Documentacion_procesos_foundation.md-observadores">👀 Observadores</h2><section><h3 id="-483439626#setobservers" data-toc="setobservers#Documentacion_procesos_foundation.md-setobservers">setObservers()</h3><p id="-483439626#-s5fsc8_776">Registra el observador <span class="inline-code" id="-483439626#-s5fsc8_779">QuoteObserver</span> para recibir notificaciones sobre el proceso.</p></section></section><section><h2 id="-483439626#m-todos-de-configuraci-n" data-toc="m-todos-de-configuraci-n#Documentacion_procesos_foundation.md-m-todos-de-configuraci-n">⚙️ M&eacute;todos de Configuraci&oacute;n</h2><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_780"><tr class="header-row" id="-483439626#-s5fsc8_782"><th id="-483439626#-s5fsc8_786"><p>M&eacute;todo</p></th><th id="-483439626#-s5fsc8_787"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-483439626#-s5fsc8_783"><td id="-483439626#-s5fsc8_788"><p><span class="inline-code" id="-483439626#-s5fsc8_790">setProcessName(String)</span></p></td><td id="-483439626#-s5fsc8_789"><p>Asigna el nombre del proceso al handler.</p></td></tr><tr class="" id="-483439626#-s5fsc8_784"><td id="-483439626#-s5fsc8_791"><p><span class="inline-code" id="-483439626#-s5fsc8_793">setResponseProcess(Object)</span></p></td><td id="-483439626#-s5fsc8_792"><p>Guarda la respuesta procesada.</p></td></tr><tr class="" id="-483439626#-s5fsc8_785"><td id="-483439626#-s5fsc8_794"><p><span class="inline-code" id="-483439626#-s5fsc8_796">setRequestInput(Object)</span></p></td><td id="-483439626#-s5fsc8_795"><p>Guarda los datos de entrada para el proceso.</p></td></tr></table></div></section><section><h2 id="-483439626#proceso-principal" data-toc="proceso-principal#Documentacion_procesos_foundation.md-proceso-principal">🔄 Proceso Principal</h2><section><h3 id="-483439626#process-map-string-object-options-map-string-object-input-map-string-object-output" data-toc="process-map-string-object-options-map-string-object-input-map-string-object-output#Documentacion_procesos_foundation.md-process-map-string-object-options-map-string-object-input-map-string-object-output">process(Map&lt;String, Object&gt; options, Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; output)</h3><p id="-483439626#-s5fsc8_799">Este m&eacute;todo orquesta el flujo completo del proceso de cotizaci&oacute;n.</p><p id="-483439626#-s5fsc8_800"><span class="control" id="-483439626#-s5fsc8_808">Pasos</span>:</p><ol class="list list-decimal" id="-483439626#-s5fsc8_801" type="1" start="1"><li class="list-item" id="-483439626#-s5fsc8_809"><p>Omite el procesamiento si se incluye la opci&oacute;n <span class="inline-code" id="-483439626#-s5fsc8_814">skipDefaultBehavior</span>.</p></li><li class="list-item" id="-483439626#-s5fsc8_810"><p>Define el nombre del proceso como <span class="inline-code" id="-483439626#-s5fsc8_815">&quot;COTIZACION&quot;</span>.</p></li><li class="list-item" id="-483439626#-s5fsc8_811"><p>Valida que todos los nodos requeridos est&eacute;n presentes.</p></li><li class="list-item" id="-483439626#-s5fsc8_812"><p>Ejecuta el <span class="inline-code" id="-483439626#-s5fsc8_816">IntegrationProcedure</span> para generar la cotizaci&oacute;n.</p></li><li class="list-item" id="-483439626#-s5fsc8_813"><p>Asigna el resultado al mapa <span class="inline-code" id="-483439626#-s5fsc8_817">output</span> y lo serializa como respuesta.</p></li></ol><p id="-483439626#-s5fsc8_802"><span class="control" id="-483439626#-s5fsc8_818">Par&aacute;metros</span>:</p><ul class="list" id="-483439626#-s5fsc8_803" start="1"><li class="list-item" id="-483439626#-s5fsc8_819"><p><span class="inline-code" id="-483439626#-s5fsc8_822">options</span>: Opciones adicionales del proceso.</p></li><li class="list-item" id="-483439626#-s5fsc8_820"><p><span class="inline-code" id="-483439626#-s5fsc8_823">input</span>: Datos de entrada (incluye <span class="inline-code" id="-483439626#-s5fsc8_824">quotepolicyJson</span>).</p></li><li class="list-item" id="-483439626#-s5fsc8_821"><p><span class="inline-code" id="-483439626#-s5fsc8_825">output</span>: Mapa de salida que ser&aacute; completado con el resultado.</p></li></ul><p id="-483439626#-s5fsc8_804"><span class="control" id="-483439626#-s5fsc8_826">Retorna</span>: <span class="inline-code" id="-483439626#-s5fsc8_827">Map&lt;String, Object&gt;</span> &mdash; Resultado del proceso de cotizaci&oacute;n.</p><p id="-483439626#-s5fsc8_805"><span class="control" id="-483439626#-s5fsc8_828">Excepciones</span>: Lanza <span class="inline-code" id="-483439626#-s5fsc8_829">ProductHandlerImplementationException</span> si la validaci&oacute;n falla.</p></section></section><section><h2 id="-483439626#validaci-n-de-entrada" data-toc="validaci-n-de-entrada#Documentacion_procesos_foundation.md-validaci-n-de-entrada">🧪 Validaci&oacute;n de Entrada</h2><section><h3 id="-483439626#validateinputmapforquoting-map-inputmap" data-toc="validateinputmapforquoting-map-inputmap#Documentacion_procesos_foundation.md-validateinputmapforquoting-map-inputmap">validateInputMapForQuoting(Map inputMap)</h3><p id="-483439626#-s5fsc8_832">Verifica que el nodo principal y los nodos internos requeridos est&eacute;n presentes en <span class="inline-code" id="-483439626#-s5fsc8_838">quotepolicyJson</span>.</p><p id="-483439626#-s5fsc8_833"><span class="control" id="-483439626#-s5fsc8_839">Nodos requeridos</span>:</p><ul class="list" id="-483439626#-s5fsc8_834" start="1"><li class="list-item" id="-483439626#-s5fsc8_840"><p><span class="inline-code" id="-483439626#-s5fsc8_845">term</span></p></li><li class="list-item" id="-483439626#-s5fsc8_841"><p><span class="inline-code" id="-483439626#-s5fsc8_846">productConfigurationDetail</span></p></li><li class="list-item" id="-483439626#-s5fsc8_842"><p><span class="inline-code" id="-483439626#-s5fsc8_847">insuredItems</span></p></li><li class="list-item" id="-483439626#-s5fsc8_843"><p><span class="inline-code" id="-483439626#-s5fsc8_848">additionalFields</span></p></li><li class="list-item" id="-483439626#-s5fsc8_844"><p><span class="inline-code" id="-483439626#-s5fsc8_849">OpportunityDetails</span></p></li></ul><p id="-483439626#-s5fsc8_835"><span class="control" id="-483439626#-s5fsc8_850">Retorna</span>: <span class="inline-code" id="-483439626#-s5fsc8_851">Map&lt;Boolean, Object&gt;</span> &mdash; Resultado est&aacute;ndar de validaci&oacute;n con mensaje descriptivo.</p></section></section><section><h2 id="-483439626#utilidades" data-toc="utilidades#Documentacion_procesos_foundation.md-utilidades">🧱 Utilidades</h2><section><h3 id="-483439626#createvalidationresult-boolean-isvalid-string-message" data-toc="createvalidationresult-boolean-isvalid-string-message#Documentacion_procesos_foundation.md-createvalidationresult-boolean-isvalid-string-message">createValidationResult(Boolean isValid, String message)</h3><p id="-483439626#-s5fsc8_854">Crea un resultado de validaci&oacute;n estructurado en forma de mapa.</p><p id="-483439626#-s5fsc8_855"><span class="control" id="-483439626#-s5fsc8_859">Ejemplo de retorno</span>:</p><div class="detached code-block" id="-483439626#-s5fsc8_856"><pre><code class="language-none">{ true =&gt; 'Todos los parámetros requeridos están presentes.' }</code></pre></div></section></section><section><h2 id="-483439626#ejecuci-n-de-integration-procedure" data-toc="ejecuci-n-de-integration-procedure#Documentacion_procesos_foundation.md-ejecuci-n-de-integration-procedure">⚙️ Ejecuci&oacute;n de Integration Procedure</h2><section><h3 id="-483439626#executeintegrationprocedure-map-ipinput" data-toc="executeintegrationprocedure-map-ipinput#Documentacion_procesos_foundation.md-executeintegrationprocedure-map-ipinput">executeIntegrationProcedure(Map ipInput)</h3><p id="-483439626#-s5fsc8_862">Llama al executor con el nombre definido (<span class="inline-code" id="-483439626#-s5fsc8_867">sfcore_quotingprocedure</span>) y los datos de entrada.</p><p id="-483439626#-s5fsc8_863"><span class="control" id="-483439626#-s5fsc8_868">Retorna</span>:</p><div class="detached code-block" id="-483439626#-s5fsc8_864"><pre><code class="language-none">{ 'resultProcess' =&gt; &lt;resultado del executor&gt; }</code></pre></div></section></section><section><h2 id="-483439626#ejemplo-de-uso" data-toc="ejemplo-de-uso#Documentacion_procesos_foundation.md-ejemplo-de-uso">📚 Ejemplo de Uso</h2><div class="detached code-block" id="-483439626#-s5fsc8_869"><pre><code class="language-none">QuoteProductHandler quoteHandler = new QuoteProductHandler('ProductoCotizacion');

Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
  'quotepolicyJson' =&gt; new Map&lt;String, Object&gt;{
    'term' =&gt; '12M',
    'productConfigurationDetail' =&gt; 'PCD001',
    'insuredItems' =&gt; new List&lt;Object&gt;{},
    'additionalFields' =&gt; new Map&lt;String, Object&gt;(),
    'OpportunityDetails' =&gt; new Map&lt;String, Object&gt;()
  }
};

Map&lt;String, Object&gt; output = new Map&lt;String, Object&gt;();

quoteHandler.apply(new Map&lt;String, Object&gt;(), input, output);

System.debug(output.get('resultProcess'));</code></pre></div></section><section><h2 id="-483439626#consideraciones" data-toc="consideraciones#Documentacion_procesos_foundation.md-consideraciones">📝 Consideraciones</h2><ul class="list" id="-483439626#-s5fsc8_871" start="1"><li class="list-item" id="-483439626#-s5fsc8_872"><p>Ideal para procesos de cotizaci&oacute;n que requieren integraci&oacute;n con sistemas externos mediante IPs.</p></li><li class="list-item" id="-483439626#-s5fsc8_873"><p>Es completamente extensible y puede integrarse con distintos observers para monitoreo.</p></li><li class="list-item" id="-483439626#-s5fsc8_874"><p>Utiliza un patr&oacute;n de validaci&oacute;n clara para evitar errores por falta de estructura.</p></li></ul></section><section><h2 id="-483439626#issueproducthandler-apex-class-documentation" data-toc="issueproducthandler-apex-class-documentation#Documentacion_procesos_foundation.md-issueproducthandler-apex-class-documentation">IssueProductHandler Apex Class Documentation</h2><p id="-483439626#-s5fsc8_876"><span class="control" id="-483439626#-s5fsc8_879">Author</span>: Jean Carlos Melendez (jean@cloudblue.us (<a href="mailto:jean@cloudblue.us">mailto:jean@cloudblue.us</a>)) <span class="control" id="-483439626#-s5fsc8_882">Last Modified By</span>: Jean Carlos Melendez<span class="control" id="-483439626#-s5fsc8_884">Last Modified On</span>: 2025-04-02</p></section><section><h2 id="-483439626#overview" data-toc="overview#Documentacion_procesos_foundation.md-overview">📌 Overview</h2><p id="-483439626#-s5fsc8_885"><span class="inline-code" id="-483439626#-s5fsc8_887">IssueProductHandler</span> es una implementaci&oacute;n de <span class="inline-code" id="-483439626#-s5fsc8_888">ProductHandler</span> responsable de manejar el proceso de emisi&oacute;n de productos. Utiliza un Integration Procedure para realizar la l&oacute;gica de negocio asociada a la emisi&oacute;n, validando los datos de entrada, realizando preprocesamiento, ejecutando el IP y actualizando el estado de la oportunidad relacionada.</p></section><section><h2 id="-483439626#class-definition" data-toc="class-definition#Documentacion_procesos_foundation.md-class-definition">🔧 Class Definition</h2><div class="detached code-block" id="-483439626#-s5fsc8_889"><pre><code class="language-none">global virtual class IssueProductHandler extends ProductHandler</code></pre></div></section><section><h2 id="-483439626#properties" data-toc="properties#Documentacion_procesos_foundation.md-properties">🧩 Properties</h2><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_891"><tr class="header-row" id="-483439626#-s5fsc8_893"><th id="-483439626#-s5fsc8_902"><p>Propiedad</p></th><th id="-483439626#-s5fsc8_903"><p>Tipo</p></th><th id="-483439626#-s5fsc8_904"><p>Acceso</p></th><th id="-483439626#-s5fsc8_905"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-483439626#-s5fsc8_894"><td id="-483439626#-s5fsc8_906"><p><span class="inline-code" id="-483439626#-s5fsc8_910">FLAG_PLATFORM_NAME</span></p></td><td id="-483439626#-s5fsc8_907"><p><span class="inline-code" id="-483439626#-s5fsc8_911">String</span></p></td><td id="-483439626#-s5fsc8_908"><p><span class="inline-code" id="-483439626#-s5fsc8_912">static final</span></p></td><td id="-483439626#-s5fsc8_909"><p>Nombre de la Feature Flag para eventos de plataforma.</p></td></tr><tr class="" id="-483439626#-s5fsc8_895"><td id="-483439626#-s5fsc8_913"><p><span class="inline-code" id="-483439626#-s5fsc8_917">IP_PREPROCESS</span></p></td><td id="-483439626#-s5fsc8_914"><p><span class="inline-code" id="-483439626#-s5fsc8_918">String</span></p></td><td id="-483439626#-s5fsc8_915"><p><span class="inline-code" id="-483439626#-s5fsc8_919">static final</span></p></td><td id="-483439626#-s5fsc8_916"><p>Nombre del IP de preprocesamiento.</p></td></tr><tr class="" id="-483439626#-s5fsc8_896"><td id="-483439626#-s5fsc8_920"><p><span class="inline-code" id="-483439626#-s5fsc8_924">PROCESS_NAME</span></p></td><td id="-483439626#-s5fsc8_921"><p><span class="inline-code" id="-483439626#-s5fsc8_925">String</span></p></td><td id="-483439626#-s5fsc8_922"><p><span class="inline-code" id="-483439626#-s5fsc8_926">static final</span></p></td><td id="-483439626#-s5fsc8_923"><p>Nombre del proceso manejado: <span class="inline-code" id="-483439626#-s5fsc8_927">&quot;TARIFICACION&quot;</span></p></td></tr><tr class="" id="-483439626#-s5fsc8_897"><td id="-483439626#-s5fsc8_928"><p><span class="inline-code" id="-483439626#-s5fsc8_932">OPTION_SKIP_BEHAVIOR</span></p></td><td id="-483439626#-s5fsc8_929"><p><span class="inline-code" id="-483439626#-s5fsc8_933">String</span></p></td><td id="-483439626#-s5fsc8_930"><p><span class="inline-code" id="-483439626#-s5fsc8_934">static final</span></p></td><td id="-483439626#-s5fsc8_931"><p>Clave para omitir comportamiento por defecto.</p></td></tr><tr class="" id="-483439626#-s5fsc8_898"><td id="-483439626#-s5fsc8_935"><p><span class="inline-code" id="-483439626#-s5fsc8_939">ISSUING_IPROCEDURE</span></p></td><td id="-483439626#-s5fsc8_936"><p><span class="inline-code" id="-483439626#-s5fsc8_940">String</span></p></td><td id="-483439626#-s5fsc8_937"><p><span class="inline-code" id="-483439626#-s5fsc8_941">static final</span></p></td><td id="-483439626#-s5fsc8_938"><p>Nombre del IP utilizado para la emisi&oacute;n.</p></td></tr><tr class="" id="-483439626#-s5fsc8_899"><td id="-483439626#-s5fsc8_942"><p><span class="inline-code" id="-483439626#-s5fsc8_946">ERROR_REQUIRED_FIELD</span></p></td><td id="-483439626#-s5fsc8_943"><p><span class="inline-code" id="-483439626#-s5fsc8_947">String</span></p></td><td id="-483439626#-s5fsc8_944"><p><span class="inline-code" id="-483439626#-s5fsc8_948">static final</span></p></td><td id="-483439626#-s5fsc8_945"><p>Mensaje de error usado en validaci&oacute;n de campos.</p></td></tr><tr class="" id="-483439626#-s5fsc8_900"><td id="-483439626#-s5fsc8_949"><p><span class="inline-code" id="-483439626#-s5fsc8_953">EXECUTOR</span></p></td><td id="-483439626#-s5fsc8_950"><p><span class="inline-code" id="-483439626#-s5fsc8_954">IntegrationProcedureExecutor</span></p></td><td id="-483439626#-s5fsc8_951"><p><span class="inline-code" id="-483439626#-s5fsc8_955">global</span></p></td><td id="-483439626#-s5fsc8_952"><p>Objeto encargado de ejecutar el Integration Procedure.</p></td></tr><tr class="" id="-483439626#-s5fsc8_901"><td id="-483439626#-s5fsc8_956"><p><span class="inline-code" id="-483439626#-s5fsc8_960">REQUIRED_FIELD_FOR_ISSUE_CORE</span></p></td><td id="-483439626#-s5fsc8_957"><p><span class="inline-code" id="-483439626#-s5fsc8_961">List&lt;String&gt;</span></p></td><td id="-483439626#-s5fsc8_958"><p><span class="inline-code" id="-483439626#-s5fsc8_962">static final</span></p></td><td id="-483439626#-s5fsc8_959"><p>Lista de campos obligatorios para ejecutar la emisi&oacute;n.</p></td></tr></table></div></section><section><h2 id="-483439626#constructores" data-toc="constructores#Documentacion_procesos_foundation.md-constructores">🏗️ Constructores</h2><section><h3 id="-483439626#issueproducthandler-string-productname-integrationprocedureexecutor-executor" data-toc="issueproducthandler-string-productname-integrationprocedureexecutor-executor#Documentacion_procesos_foundation.md-issueproducthandler-string-productname-integrationprocedureexecutor-executor">IssueProductHandler(String productName, IntegrationProcedureExecutor executor)</h3><p id="-483439626#-s5fsc8_966">Inicializa el handler con un ejecutor personalizado.</p></section><section><h3 id="-483439626#issueproducthandler-string-productname" data-toc="issueproducthandler-string-productname#Documentacion_procesos_foundation.md-issueproducthandler-string-productname">IssueProductHandler(String productName)</h3><p id="-483439626#-s5fsc8_969">Inicializa con un <span class="inline-code" id="-483439626#-s5fsc8_972">MockIntegrationProcedureExecutor</span>.</p></section></section><section><h2 id="-483439626#m-todos-de-configuraci-n" data-toc="m-todos-de-configuraci-n#Documentacion_procesos_foundation.md-m-todos-de-configuraci-n">⚙️ M&eacute;todos de Configuraci&oacute;n</h2><div class="table-wrapper detached"><table id="-483439626#-s5fsc8_973"><tr class="header-row" id="-483439626#-s5fsc8_975"><th id="-483439626#-s5fsc8_979"><p>M&eacute;todo</p></th><th id="-483439626#-s5fsc8_980"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-483439626#-s5fsc8_976"><td id="-483439626#-s5fsc8_981"><p><span class="inline-code" id="-483439626#-s5fsc8_983">setProcessName(String)</span></p></td><td id="-483439626#-s5fsc8_982"><p>Define el nombre del proceso.</p></td></tr><tr class="" id="-483439626#-s5fsc8_977"><td id="-483439626#-s5fsc8_984"><p><span class="inline-code" id="-483439626#-s5fsc8_986">setResponseProcess(Object)</span></p></td><td id="-483439626#-s5fsc8_985"><p>Guarda la respuesta del proceso.</p></td></tr><tr class="" id="-483439626#-s5fsc8_978"><td id="-483439626#-s5fsc8_987"><p><span class="inline-code" id="-483439626#-s5fsc8_989">setRequestInput(Object)</span></p></td><td id="-483439626#-s5fsc8_988"><p>Guarda los datos de entrada originales.</p></td></tr></table></div></section><section><h2 id="-483439626#m-todos-del-proceso" data-toc="m-todos-del-proceso#Documentacion_procesos_foundation.md-m-todos-del-proceso">🔄 M&eacute;todos del Proceso</h2><section><h3 id="-483439626#onpre-map-options-map-input-map-output" data-toc="onpre-map-options-map-input-map-output#Documentacion_procesos_foundation.md-onpre-map-options-map-input-map-output">onPre(Map options, Map input, Map output)</h3><p id="-483439626#-s5fsc8_995">Realiza validaciones previas y asigna las cuentas aseguradas a la cotizaci&oacute;n.</p></section><section><h3 id="-483439626#process-map-options-map-input-map-output" data-toc="process-map-options-map-input-map-output#Documentacion_procesos_foundation.md-process-map-options-map-input-map-output">process(Map options, Map input, Map output)</h3><p id="-483439626#-s5fsc8_998">Valida los datos requeridos, ejecuta la validaci&oacute;n previa (<span class="inline-code" id="-483439626#-s5fsc8_1000">preIssuingValidation</span>) y llama al IP de emisi&oacute;n.</p></section><section><h3 id="-483439626#onpos-map-options-map-input-map-output" data-toc="onpos-map-options-map-input-map-output#Documentacion_procesos_foundation.md-onpos-map-options-map-input-map-output">onPos(Map options, Map input, Map output)</h3><p id="-483439626#-s5fsc8_1002">Actualiza la etapa de la oportunidad relacionada a <span class="inline-code" id="-483439626#-s5fsc8_1004">'Poliza emitida'</span>.</p></section><section><h3 id="-483439626#executeintegrationprocedure-map-ipinput" data-toc="executeintegrationprocedure-map-ipinput#Documentacion_procesos_foundation.md-executeintegrationprocedure-map-ipinput">executeIntegrationProcedure(Map ipInput)</h3><p id="-483439626#-s5fsc8_1006">Ejecuta el IP configurado (<span class="inline-code" id="-483439626#-s5fsc8_1009">SURAFoundation_IssuingProcedure</span>) con los datos de entrada validados.</p></section></section><section><h2 id="-483439626#validaciones" data-toc="validaciones#Documentacion_procesos_foundation.md-validaciones">✅ Validaciones</h2><section><h3 id="-483439626#validateinput-map-input-list-string-requiredfields" data-toc="validateinput-map-input-list-string-requiredfields#Documentacion_procesos_foundation.md-validateinput-map-input-list-string-requiredfields">validateInput(Map input, List&lt;String&gt; requiredFields)</h3><p id="-483439626#-s5fsc8_1013">Valida que los campos obligatorios est&eacute;n presentes en el mapa <span class="inline-code" id="-483439626#-s5fsc8_1015">input</span>. Lanza excepci&oacute;n si alguno est&aacute; ausente.</p></section><section><h3 id="-483439626#preissuingvalidation-map-input" data-toc="preissuingvalidation-map-input#Documentacion_procesos_foundation.md-preissuingvalidation-map-input">preIssuingValidation(Map input)</h3><p id="-483439626#-s5fsc8_1017">Valida los campos clave para emisi&oacute;n (<span class="inline-code" id="-483439626#-s5fsc8_1020">quoteId</span>, <span class="inline-code" id="-483439626#-s5fsc8_1021">effectiveDate</span>, <span class="inline-code" id="-483439626#-s5fsc8_1022">producerId</span>) y garantiza que la cotizaci&oacute;n y la oportunidad asociada existan y est&eacute;n completas.</p></section></section><section><h2 id="-483439626#m-todos-auxiliares" data-toc="m-todos-auxiliares#Documentacion_procesos_foundation.md-m-todos-auxiliares">🔧 M&eacute;todos Auxiliares</h2><section><h3 id="-483439626#assignaccountstoquote-list-map-string-object-parties-id-quoteid" data-toc="assignaccountstoquote-list-map-string-object-parties-id-quoteid#Documentacion_procesos_foundation.md-assignaccountstoquote-list-map-string-object-parties-id-quoteid">assignAccountsToQuote(List&lt;Map&lt;String, Object&gt;&gt; parties, Id quoteId)</h3><p id="-483439626#-s5fsc8_1026">Asocia las cuentas aseguradas al objeto Quote y su oportunidad.</p></section><section><h3 id="-483439626#listinsuredpartyaccounts-map-string-object-input" data-toc="listinsuredpartyaccounts-map-string-object-input#Documentacion_procesos_foundation.md-listinsuredpartyaccounts-map-string-object-input">listInsuredPartyAccounts(Map&lt;String, Object&gt; input)</h3><p id="-483439626#-s5fsc8_1029">Convierte la informaci&oacute;n del lead a cuentas aseguradas mediante <span class="inline-code" id="-483439626#-s5fsc8_1032">LeadUtils</span>.</p></section></section><section><h2 id="-483439626#ejemplo-de-ejecuci-n" data-toc="ejemplo-de-ejecuci-n#Documentacion_procesos_foundation.md-ejemplo-de-ejecuci-n">📚 Ejemplo de Ejecuci&oacute;n</h2><div class="detached code-block" id="-483439626#-s5fsc8_1033"><pre><code class="language-none">IssueProductHandler handler = new IssueProductHandler('ProductoX');

Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
  'leadId' =&gt; '00Qxx0000001abc',
  'quoteId' =&gt; '0Q0xx0000002def',
  'effectiveDate' =&gt; '2025-04-15',
  'producerId' =&gt; '001xx000003xyzA'
};

Map&lt;String, Object&gt; output = new Map&lt;String, Object&gt;();

handler.apply(new Map&lt;String, Object&gt;(), input, output);

System.debug(output.get('resultProcess'));</code></pre></div></section><section><h2 id="-483439626#consideraciones" data-toc="consideraciones#Documentacion_procesos_foundation.md-consideraciones">📝 Consideraciones</h2><ul class="list" id="-483439626#-s5fsc8_1035" start="1"><li class="list-item" id="-483439626#-s5fsc8_1036"><p>El m&eacute;todo <span class="inline-code" id="-483439626#-s5fsc8_1040">onPre</span> asegura que las cuentas est&eacute;n correctamente asociadas antes de emitir.</p></li><li class="list-item" id="-483439626#-s5fsc8_1037"><p><span class="inline-code" id="-483439626#-s5fsc8_1041">onPos</span> actualiza autom&aacute;ticamente el estado de la oportunidad una vez finalizada la emisi&oacute;n.</p></li><li class="list-item" id="-483439626#-s5fsc8_1038"><p>Utiliza validaciones s&oacute;lidas para garantizar que los datos est&eacute;n completos antes de ejecutar el IP.</p></li><li class="list-item" id="-483439626#-s5fsc8_1039"><p>El handler puede ser f&aacute;cilmente extendido o simulado en pruebas gracias al uso de <span class="inline-code" id="-483439626#-s5fsc8_1042">IntegrationProcedureExecutor</span>.</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-172468156">ResponsabilityHandler</h1><section><h2 id="-172468156#descripci-n-general" data-toc="descripci-n-general#ResponsabilityHandler.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-172468156#z3b5ovu_15"><span class="inline-code" id="-172468156#z3b5ovu_16">ResponsabilityHandler</span> es una clase abstracta que implementa el patr&oacute;n de dise&ntilde;o Chain of Responsibility (Cadena de Responsabilidad). Esta clase extiende <span class="inline-code" id="-172468156#z3b5ovu_17">Subject</span>, lo que sugiere que tambi&eacute;n implementa el patr&oacute;n Observer. La clase est&aacute; dise&ntilde;ada para procesar objetos <span class="inline-code" id="-172468156#z3b5ovu_18">Lead</span> seg&uacute;n planes seleccionados, permitiendo encadenar m&uacute;ltiples handlers para formar un flujo de procesamiento.</p></section><section><h2 id="-172468156#autor" data-toc="autor#ResponsabilityHandler.md-autor">Autor</h2><p id="-172468156#z3b5ovu_19">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="-172468156#ltima-modificaci-n" data-toc="ltima-modificaci-n#ResponsabilityHandler.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="-172468156#z3b5ovu_20">2 de septiembre de 2024</p></section><section><h2 id="-172468156#caracter-sticas-de-accesibilidad" data-toc="caracter-sticas-de-accesibilidad#ResponsabilityHandler.md-caracter-sticas-de-accesibilidad">Caracter&iacute;sticas de Accesibilidad</h2><p id="-172468156#z3b5ovu_21">La clase y todos sus miembros est&aacute;n anotados con <span class="inline-code" id="-172468156#z3b5ovu_22">@namespaceAccessible</span>, lo que permite que sean accesibles desde otros namespaces en organizaciones con paquetes gestionados.</p></section><section><h2 id="-172468156#atributos" data-toc="atributos#ResponsabilityHandler.md-atributos">Atributos</h2><section><h3 id="-172468156#handlername" data-toc="handlername#ResponsabilityHandler.md-handlername">handlerName</h3><ul class="list" id="-172468156#z3b5ovu_26" start="1"><li class="list-item" id="-172468156#z3b5ovu_28"><p><span class="control" id="-172468156#z3b5ovu_31">Tipo</span>: <span class="inline-code" id="-172468156#z3b5ovu_32">String</span></p></li><li class="list-item" id="-172468156#z3b5ovu_29"><p><span class="control" id="-172468156#z3b5ovu_33">Accesibilidad</span>: <span class="inline-code" id="-172468156#z3b5ovu_34">public</span></p></li><li class="list-item" id="-172468156#z3b5ovu_30"><p><span class="control" id="-172468156#z3b5ovu_35">Descripci&oacute;n</span>: Nombre identificativo del handler.</p></li></ul></section><section><h3 id="-172468156#nexthandler" data-toc="nexthandler#ResponsabilityHandler.md-nexthandler">nextHandler</h3><ul class="list" id="-172468156#z3b5ovu_37" start="1"><li class="list-item" id="-172468156#z3b5ovu_39"><p><span class="control" id="-172468156#z3b5ovu_42">Tipo</span>: <span class="inline-code" id="-172468156#z3b5ovu_43">ResponsabilityHandler</span></p></li><li class="list-item" id="-172468156#z3b5ovu_40"><p><span class="control" id="-172468156#z3b5ovu_44">Accesibilidad</span>: <span class="inline-code" id="-172468156#z3b5ovu_45">public</span></p></li><li class="list-item" id="-172468156#z3b5ovu_41"><p><span class="control" id="-172468156#z3b5ovu_46">Descripci&oacute;n</span>: Referencia al siguiente handler en la cadena de responsabilidad.</p></li></ul></section></section><section><h2 id="-172468156#constructor" data-toc="constructor#ResponsabilityHandler.md-constructor">Constructor</h2><section><h3 id="-172468156#responsabilityhandler-string-handlername" data-toc="responsabilityhandler-string-handlername#ResponsabilityHandler.md-responsabilityhandler-string-handlername">ResponsabilityHandler(String handlerName)</h3><section><h4 id="-172468156#descripci-n" data-toc="descripci-n#ResponsabilityHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-172468156#z3b5ovu_53">Constructor que inicializa un nuevo handler con un nombre espec&iacute;fico.</p></section><section><h4 id="-172468156#par-metros" data-toc="par-metros#ResponsabilityHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-172468156#z3b5ovu_54" start="1"><li class="list-item" id="-172468156#z3b5ovu_55"><p><span class="inline-code" id="-172468156#z3b5ovu_56">handlerName</span> (String): Nombre identificativo para el handler.</p></li></ul></section><section><h4 id="-172468156#c-digo" data-toc="c-digo#ResponsabilityHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-172468156#z3b5ovu_57"><pre><code class="language-none">@namespaceAccessible
public ResponsabilityHandler(String handlerName) {
  this.handlerName = handlerName;
}</code></pre></div></section></section></section><section><h2 id="-172468156#m-todos" data-toc="m-todos#ResponsabilityHandler.md-m-todos">M&eacute;todos</h2><section><h3 id="-172468156#setnext-responsabilityhandler-nexthandler" data-toc="setnext-responsabilityhandler-nexthandler#ResponsabilityHandler.md-setnext-responsabilityhandler-nexthandler">setNext(ResponsabilityHandler nextHandler)</h3><section><h4 id="-172468156#descripci-n" data-toc="descripci-n#ResponsabilityHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-172468156#z3b5ovu_66">Establece el siguiente handler en la cadena de responsabilidad y lo devuelve, permitiendo un encadenamiento fluido de m&eacute;todos.</p></section><section><h4 id="-172468156#par-metros" data-toc="par-metros#ResponsabilityHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-172468156#z3b5ovu_67" start="1"><li class="list-item" id="-172468156#z3b5ovu_68"><p><span class="inline-code" id="-172468156#z3b5ovu_69">nextHandler</span> (ResponsabilityHandler): El siguiente handler en la cadena.</p></li></ul></section><section><h4 id="-172468156#retorno" data-toc="retorno#ResponsabilityHandler.md-retorno">Retorno</h4><ul class="list" id="-172468156#z3b5ovu_70" start="1"><li class="list-item" id="-172468156#z3b5ovu_71"><p><span class="inline-code" id="-172468156#z3b5ovu_72">ResponsabilityHandler</span>: El handler proporcionado, permitiendo encadenamiento de m&eacute;todos.</p></li></ul></section><section><h4 id="-172468156#c-digo" data-toc="c-digo#ResponsabilityHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-172468156#z3b5ovu_73"><pre><code class="language-none">@namespaceAccessible
public ResponsabilityHandler setNext(ResponsabilityHandler nextHandler) {
  this.nextHandler = nextHandler;
  return nextHandler;
}</code></pre></div></section></section><section><h3 id="-172468156#apply-lead-lead-string-selectedplan" data-toc="apply-lead-lead-string-selectedplan#ResponsabilityHandler.md-apply-lead-lead-string-selectedplan">apply(Lead lead, String selectedPlan)</h3><section><h4 id="-172468156#descripci-n" data-toc="descripci-n#ResponsabilityHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-172468156#z3b5ovu_81">M&eacute;todo virtual que debe ser implementado por las clases concretas derivadas. Este m&eacute;todo aplicar&aacute; la l&oacute;gica de procesamiento espec&iacute;fica del handler a un objeto Lead y un plan seleccionado.</p></section><section><h4 id="-172468156#par-metros" data-toc="par-metros#ResponsabilityHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-172468156#z3b5ovu_82" start="1"><li class="list-item" id="-172468156#z3b5ovu_83"><p><span class="inline-code" id="-172468156#z3b5ovu_85">lead</span> (Lead): El objeto Lead a procesar.</p></li><li class="list-item" id="-172468156#z3b5ovu_84"><p><span class="inline-code" id="-172468156#z3b5ovu_86">selectedPlan</span> (String): El plan seleccionado que puede determinar el tipo de procesamiento.</p></li></ul></section><section><h4 id="-172468156#retorno" data-toc="retorno#ResponsabilityHandler.md-retorno">Retorno</h4><ul class="list" id="-172468156#z3b5ovu_87" start="1"><li class="list-item" id="-172468156#z3b5ovu_88"><p><span class="inline-code" id="-172468156#z3b5ovu_89">void</span></p></li></ul></section><section><h4 id="-172468156#comportamiento-por-defecto" data-toc="comportamiento-por-defecto#ResponsabilityHandler.md-comportamiento-por-defecto">Comportamiento por Defecto</h4><p id="-172468156#z3b5ovu_90">En la implementaci&oacute;n base, este m&eacute;todo lanza una excepci&oacute;n <span class="inline-code" id="-172468156#z3b5ovu_91">ProductHandlerNotImplementedException</span>, indicando que las clases derivadas deben sobrescribir este m&eacute;todo con su implementaci&oacute;n espec&iacute;fica.</p></section><section><h4 id="-172468156#c-digo" data-toc="c-digo#ResponsabilityHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-172468156#z3b5ovu_92"><pre><code class="language-none">@namespaceAccessible
public virtual void apply(Lead lead, String selectedPlan) {
  throw new ProductHandlerNotImplementedException(
    'Product Handler must be implemented!'
  );
}</code></pre></div></section></section></section><section><h2 id="-172468156#excepciones" data-toc="excepciones#ResponsabilityHandler.md-excepciones">Excepciones</h2><section><h3 id="-172468156#producthandlernotimplementedexception" data-toc="producthandlernotimplementedexception#ResponsabilityHandler.md-producthandlernotimplementedexception">ProductHandlerNotImplementedException</h3><p id="-172468156#z3b5ovu_95">Esta excepci&oacute;n se lanza cuando una clase derivada no ha implementado correctamente el m&eacute;todo <span class="inline-code" id="-172468156#z3b5ovu_97">apply()</span>. Indica un error en el dise&ntilde;o o implementaci&oacute;n de la cadena de responsabilidad.</p></section></section><section><h2 id="-172468156#patrones-de-dise-o-implementados" data-toc="patrones-de-dise-o-implementados#ResponsabilityHandler.md-patrones-de-dise-o-implementados">Patrones de Dise&ntilde;o Implementados</h2><section><h3 id="-172468156#chain-of-responsibility-cadena-de-responsabilidad" data-toc="chain-of-responsibility-cadena-de-responsabilidad#ResponsabilityHandler.md-chain-of-responsibility-cadena-de-responsabilidad">Chain of Responsibility (Cadena de Responsabilidad)</h3><p id="-172468156#z3b5ovu_100">Este patr&oacute;n permite que m&uacute;ltiples objetos procesen una solicitud. La clase <span class="inline-code" id="-172468156#z3b5ovu_101">ResponsabilityHandler</span> establece la estructura b&aacute;sica para crear una cadena de handlers, donde cada uno puede procesar la solicitud o pasarla al siguiente en la cadena.</p></section><section><h3 id="-172468156#observer-observador" data-toc="observer-observador#ResponsabilityHandler.md-observer-observador">Observer (Observador)</h3><p id="-172468156#z3b5ovu_102">Al extender la clase <span class="inline-code" id="-172468156#z3b5ovu_103">Subject</span>, <span class="inline-code" id="-172468156#z3b5ovu_104">ResponsabilityHandler</span> hereda la capacidad de notificar a los objetos observadores sobre cambios o eventos durante el procesamiento.</p></section></section><section><h2 id="-172468156#dependencias" data-toc="dependencias#ResponsabilityHandler.md-dependencias">Dependencias</h2><ul class="list" id="-172468156#z3b5ovu_105" start="1"><li class="list-item" id="-172468156#z3b5ovu_106"><p><span class="inline-code" id="-172468156#z3b5ovu_109">Subject</span>: Clase base que implementa el patr&oacute;n Observer.</p></li><li class="list-item" id="-172468156#z3b5ovu_107"><p><span class="inline-code" id="-172468156#z3b5ovu_110">ProductHandlerNotImplementedException</span>: Excepci&oacute;n personalizada lanzada cuando el m&eacute;todo <span class="inline-code" id="-172468156#z3b5ovu_111">apply()</span> no est&aacute; implementado.</p></li><li class="list-item" id="-172468156#z3b5ovu_108"><p><span class="inline-code" id="-172468156#z3b5ovu_112">Lead</span>: Objeto est&aacute;ndar de Salesforce utilizado en el m&eacute;todo <span class="inline-code" id="-172468156#z3b5ovu_113">apply()</span>.</p></li></ul></section><section><h2 id="-172468156#ejemplo-de-uso" data-toc="ejemplo-de-uso#ResponsabilityHandler.md-ejemplo-de-uso">Ejemplo de Uso</h2><div class="detached code-block" id="-172468156#z3b5ovu_114"><pre><code class="language-none">// Definir handlers concretos
public class LeadQualificationHandler extends ResponsabilityHandler {
    public LeadQualificationHandler() {
        super('LeadQualification');
    }
    
    public override void apply(Lead lead, String selectedPlan) {
        // Lógica para calificar el lead
        lead.Status = 'Qualified';
        lead.Rating = 'Hot';
        
        // Notificar a los observadores
        this.notifyObservers(lead);
        
        // Continuar con el siguiente handler si existe
        if (this.nextHandler != null) {
            this.nextHandler.apply(lead, selectedPlan);
        }
    }
}

public class LeadAssignmentHandler extends ResponsabilityHandler {
    public LeadAssignmentHandler() {
        super('LeadAssignment');
    }
    
    public override void apply(Lead lead, String selectedPlan) {
        // Lógica para asignar el lead según el plan
        if (selectedPlan == 'Premium') {
            lead.OwnerId = UserInfo.getUserId(); // Asignar al usuario actual como ejemplo
        }
        
        // Notificar a los observadores
        this.notifyObservers(lead);
        
        // Continuar con el siguiente handler si existe
        if (this.nextHandler != null) {
            this.nextHandler.apply(lead, selectedPlan);
        }
    }
}

// Configurar y utilizar la cadena de responsabilidad
ResponsabilityHandler qualificationHandler = new LeadQualificationHandler();
ResponsabilityHandler assignmentHandler = new LeadAssignmentHandler();

// Encadenar los handlers
qualificationHandler.setNext(assignmentHandler);

// Procesar un lead
Lead newLead = new Lead(
    FirstName = 'John',
    LastName = 'Doe',
    Company = 'ACME Inc.'
);
qualificationHandler.apply(newLead, 'Premium');</code></pre></div></section><section><h2 id="-172468156#notas-adicionales" data-toc="notas-adicionales#ResponsabilityHandler.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-172468156#z3b5ovu_115" type="1" start="1"><li class="list-item" id="-172468156#z3b5ovu_116"><p>Esta clase abstracta est&aacute; dise&ntilde;ada para ser extendida por clases concretas que implementen la l&oacute;gica espec&iacute;fica de procesamiento.</p></li><li class="list-item" id="-172468156#z3b5ovu_117"><p>El patr&oacute;n Chain of Responsibility implementado aqu&iacute; permite una separaci&oacute;n clara de responsabilidades y facilita la adici&oacute;n de nuevos handlers sin modificar el c&oacute;digo existente.</p></li><li class="list-item" id="-172468156#z3b5ovu_118"><p>La combinaci&oacute;n con el patr&oacute;n Observer (a trav&eacute;s de la herencia de <span class="inline-code" id="-172468156#z3b5ovu_121">Subject</span>) permite que otros objetos sean notificados durante el procesamiento, facilitando acciones adicionales o registro de eventos.</p></li><li class="list-item" id="-172468156#z3b5ovu_119"><p>Aunque el m&eacute;todo <span class="inline-code" id="-172468156#z3b5ovu_122">apply()</span> lanza una excepci&oacute;n por defecto, se espera que las clases derivadas sobrescriban este m&eacute;todo con su propia implementaci&oacute;n.</p></li><li class="list-item" id="-172468156#z3b5ovu_120"><p>La anotaci&oacute;n <span class="inline-code" id="-172468156#z3b5ovu_123">@namespaceAccessible</span> en todos los elementos de la clase indica que est&aacute; dise&ntilde;ada para ser utilizada en un contexto de paquetes gestionados, permitiendo que clases en otros namespaces puedan extenderla y utilizarla.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1707928647">FoundationEventLogController</h1><section><h2 id="-1707928647#descripci-n-general" data-toc="descripci-n-general#FoundationEventLogController.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-1707928647#-r5qh9p_14"><span class="inline-code" id="-1707928647#-r5qh9p_15">FoundationEventLogController</span> es una clase que act&uacute;a como controlador para componentes Lightning Web Components (LWC) o Aura Components, proporcionando funcionalidad de gesti&oacute;n de registros de eventos y trabajos programados. Esta clase expone m&eacute;todos anotados con <span class="inline-code" id="-1707928647#-r5qh9p_16">@AuraEnabled</span> para permitir la interacci&oacute;n desde el frontend con las funcionalidades de an&aacute;lisis de eventos y programaci&oacute;n de tareas de limpieza.</p></section><section><h2 id="-1707928647#autor" data-toc="autor#FoundationEventLogController.md-autor">Autor</h2><p id="-1707928647#-r5qh9p_17">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="-1707928647#ltima-modificaci-n" data-toc="ltima-modificaci-n#FoundationEventLogController.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="-1707928647#-r5qh9p_18">7 de marzo de 2025 por &quot;ChangeMeIn@UserSettingsUnder.SFDoc&quot;</p></section><section><h2 id="-1707928647#estructura-de-la-clase" data-toc="estructura-de-la-clase#FoundationEventLogController.md-estructura-de-la-clase">Estructura de la Clase</h2><div class="detached code-block" id="-1707928647#-r5qh9p_19"><pre><code class="language-none">public class FoundationEventLogController {
  @AuraEnabled public static Boolean refreshAnalytics(Datetime startAt, Datetime endAt);
  @AuraEnabled public static Boolean cleanAnalytics();
  @AuraEnabled public static eventInfoWrapper loadScheduleInfo();
  @AuraEnabled public static void refreshScheduleInfo(String cronExp, List&lt;String&gt; timeParts);
  @AuraEnabled public static boolean enabledScheduleInfo(Boolean enabled);
  
  public class eventInfoWrapper {
    @AuraEnabled public Boolean isActive;
    @AuraEnabled public Datetime nextFireTime;
    @AuraEnabled public Datetime previousFireTime;
    @AuraEnabled public String cronExp;
    @AuraEnabled public Integer numberOfExecutions;
  }
}</code></pre></div></section><section><h2 id="-1707928647#m-todos" data-toc="m-todos#FoundationEventLogController.md-m-todos">M&eacute;todos</h2><section><h3 id="-1707928647#refreshanalytics-datetime-startat-datetime-endat" data-toc="refreshanalytics-datetime-startat-datetime-endat#FoundationEventLogController.md-refreshanalytics-datetime-startat-datetime-endat">refreshAnalytics(Datetime startAt, Datetime endAt)</h3><section><h4 id="-1707928647#descripci-n" data-toc="descripci-n#FoundationEventLogController.md-descripci-n">Descripci&oacute;n</h4><p id="-1707928647#-r5qh9p_32">M&eacute;todo que inicia el proceso de actualizaci&oacute;n de an&aacute;lisis de eventos de forma as&iacute;ncrona para un rango de fechas espec&iacute;fico.</p></section><section><h4 id="-1707928647#par-metros" data-toc="par-metros#FoundationEventLogController.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1707928647#-r5qh9p_33" start="1"><li class="list-item" id="-1707928647#-r5qh9p_34"><p><span class="inline-code" id="-1707928647#-r5qh9p_36">startAt</span> (Datetime): Fecha y hora de inicio del rango para el an&aacute;lisis.</p></li><li class="list-item" id="-1707928647#-r5qh9p_35"><p><span class="inline-code" id="-1707928647#-r5qh9p_37">endAt</span> (Datetime): Fecha y hora de fin del rango para el an&aacute;lisis.</p></li></ul></section><section><h4 id="-1707928647#retorno" data-toc="retorno#FoundationEventLogController.md-retorno">Retorno</h4><ul class="list" id="-1707928647#-r5qh9p_38" start="1"><li class="list-item" id="-1707928647#-r5qh9p_39"><p><span class="inline-code" id="-1707928647#-r5qh9p_40">Boolean</span>: <span class="inline-code" id="-1707928647#-r5qh9p_41">true</span> si el proceso se inici&oacute; exitosamente, <span class="inline-code" id="-1707928647#-r5qh9p_42">false</span> en caso de error.</p></li></ul></section><section><h4 id="-1707928647#proceso" data-toc="proceso#FoundationEventLogController.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1707928647#-r5qh9p_43" type="1" start="1"><li class="list-item" id="-1707928647#-r5qh9p_44"><p>Valida que las fechas de inicio y fin no sean nulas.</p></li><li class="list-item" id="-1707928647#-r5qh9p_45"><p>Si alguna fecha es nula, registra un mensaje de depuraci&oacute;n y usa la fecha/hora actual como valor por defecto.</p></li><li class="list-item" id="-1707928647#-r5qh9p_46"><p>Llama al m&eacute;todo <span class="inline-code" id="-1707928647#-r5qh9p_48">refreshAnalyticsAsync</span> de <span class="inline-code" id="-1707928647#-r5qh9p_49">EventLogManager</span>.</p></li><li class="list-item" id="-1707928647#-r5qh9p_47"><p>Maneja excepciones y retorna el resultado.</p></li></ol></section><section><h4 id="-1707928647#c-digo" data-toc="c-digo#FoundationEventLogController.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1707928647#-r5qh9p_50"><pre><code class="language-none">@AuraEnabled
public static Boolean refreshAnalytics(Datetime startAt, Datetime endAt) {
  try {
    if (startAt == null || endAt == null)
      Core.debug('start Date or End Date is coming null');
    EventLogManager.refreshAnalyticsAsync(
      startAt ?? Datetime.now(),
      endAt ?? Datetime.now(),
      false
    );
  } catch (Exception e) {
    Core.debug('Something has failed refreshing Analytics' + e.getMessage());
    return false;
  }
  return true;
}</code></pre></div></section></section><section><h3 id="-1707928647#cleananalytics" data-toc="cleananalytics#FoundationEventLogController.md-cleananalytics">cleanAnalytics()</h3><section><h4 id="-1707928647#descripci-n" data-toc="descripci-n#FoundationEventLogController.md-descripci-n">Descripci&oacute;n</h4><p id="-1707928647#-r5qh9p_58">M&eacute;todo que ejecuta la limpieza de datos anal&iacute;ticos eliminando registros del objeto <span class="inline-code" id="-1707928647#-r5qh9p_59">EventLog_Subset__c</span>.</p></section><section><h4 id="-1707928647#par-metros" data-toc="par-metros#FoundationEventLogController.md-par-metros">Par&aacute;metros</h4><p id="-1707928647#-r5qh9p_60">Ninguno.</p></section><section><h4 id="-1707928647#retorno" data-toc="retorno#FoundationEventLogController.md-retorno">Retorno</h4><ul class="list" id="-1707928647#-r5qh9p_61" start="1"><li class="list-item" id="-1707928647#-r5qh9p_62"><p><span class="inline-code" id="-1707928647#-r5qh9p_63">Boolean</span>: <span class="inline-code" id="-1707928647#-r5qh9p_64">true</span> si la limpieza fue exitosa, <span class="inline-code" id="-1707928647#-r5qh9p_65">false</span> en caso contrario.</p></li></ul></section><section><h4 id="-1707928647#proceso" data-toc="proceso#FoundationEventLogController.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1707928647#-r5qh9p_66" type="1" start="1"><li class="list-item" id="-1707928647#-r5qh9p_67"><p>Llama al m&eacute;todo <span class="inline-code" id="-1707928647#-r5qh9p_69">clearAnalytics</span> de <span class="inline-code" id="-1707928647#-r5qh9p_70">EventLogManager</span>.</p></li><li class="list-item" id="-1707928647#-r5qh9p_68"><p>Retorna el resultado de la operaci&oacute;n directamente.</p></li></ol></section><section><h4 id="-1707928647#c-digo" data-toc="c-digo#FoundationEventLogController.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1707928647#-r5qh9p_71"><pre><code class="language-none">@AuraEnabled
public static Boolean cleanAnalytics() {
  Boolean result = false;
  result = EventLogManager.clearAnalytics();
  return result;
}</code></pre></div></section></section><section><h3 id="-1707928647#loadscheduleinfo" data-toc="loadscheduleinfo#FoundationEventLogController.md-loadscheduleinfo">loadScheduleInfo()</h3><section><h4 id="-1707928647#descripci-n" data-toc="descripci-n#FoundationEventLogController.md-descripci-n">Descripci&oacute;n</h4><p id="-1707928647#-r5qh9p_79">M&eacute;todo que carga y retorna informaci&oacute;n sobre la configuraci&oacute;n del trabajo programado de limpieza de eventos, incluyendo detalles del cronograma y estado de ejecuci&oacute;n.</p></section><section><h4 id="-1707928647#par-metros" data-toc="par-metros#FoundationEventLogController.md-par-metros">Par&aacute;metros</h4><p id="-1707928647#-r5qh9p_80">Ninguno.</p></section><section><h4 id="-1707928647#retorno" data-toc="retorno#FoundationEventLogController.md-retorno">Retorno</h4><ul class="list" id="-1707928647#-r5qh9p_81" start="1"><li class="list-item" id="-1707928647#-r5qh9p_82"><p><span class="inline-code" id="-1707928647#-r5qh9p_83">eventInfoWrapper</span>: Objeto wrapper que contiene informaci&oacute;n completa sobre el trabajo programado.</p></li></ul></section><section><h4 id="-1707928647#proceso" data-toc="proceso#FoundationEventLogController.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1707928647#-r5qh9p_84" type="1" start="1"><li class="list-item" id="-1707928647#-r5qh9p_85"><p>Crea una instancia del wrapper de informaci&oacute;n de eventos.</p></li><li class="list-item" id="-1707928647#-r5qh9p_86"><p>Si se ejecuta en contexto de prueba, crea configuraci&oacute;n mock.</p></li><li class="list-item" id="-1707928647#-r5qh9p_87"><p>Si no es prueba, consulta la configuraci&oacute;n desde metadatos personalizados.</p></li><li class="list-item" id="-1707928647#-r5qh9p_88"><p>Extrae informaci&oacute;n b&aacute;sica (estado activo, expresi&oacute;n cron).</p></li><li class="list-item" id="-1707928647#-r5qh9p_89"><p>Si existe un ID de trabajo programado, consulta detalles del CronTrigger.</p></li><li class="list-item" id="-1707928647#-r5qh9p_90"><p>Retorna toda la informaci&oacute;n encapsulada en el wrapper.</p></li></ol></section><section><h4 id="-1707928647#c-digo" data-toc="c-digo#FoundationEventLogController.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1707928647#-r5qh9p_91"><pre><code class="language-none">@AuraEnabled
public static eventInfoWrapper loadScheduleInfo() {
  eventInfoWrapper info = new eventInfoWrapper();

  Suratech_Foundation_Schedule_Event__mdt config;
  if (Test.isRunningTest()) {
    Id testJobId = System.schedule(
      'Test Event Log Cleanup',
      '0 00 02 ? * WED,THU,FRI *',
      new EventLog_Subset_CleanupScheduleClass()
    );
    config = new Suratech_Foundation_Schedule_Event__mdt(
      MasterLabel = 'DefaultConfig',
      DeveloperName = 'DefaultConfig',
      Frequency__c = '0 00 02 ? * WED,THU,FRI *',
      Is_Active__c = true,
      Schedule_Job_Id__c = testJobId
    );
  } else {
    config = [
      SELECT
        Id,
        Frequency__c,
        Schedule_Job_Id__c,
        MasterLabel,
        DeveloperName,
        Is_Active__c
      FROM Suratech_Foundation_Schedule_Event__mdt
      WHERE DeveloperName = 'DefaultConfig'
      LIMIT 1
    ];
  }

  info.isActive = config.Is_Active__c;
  info.cronExp = config.Frequency__c;

  if (!Test.isRunningTest() &amp;&amp; config.Id == null) {
    throw new MetadataNotFoundException(
      'No Suratech_Foundation_Schedule_Event__mdt Custom Metadata found for &quot;config&quot;'
    );
  }

  if (config.Schedule_Job_Id__c != null) {
    CronTrigger ct = [
      SELECT
        Id,
        CronExpression,
        TimesTriggered,
        NextFireTime,
        PreviousFireTime
      FROM CronTrigger
      WHERE Id = :config.Schedule_Job_Id__c
    ];
    info.previousFireTime = ct.PreviousFireTime;
    info.nextFireTime = ct.NextFireTime;
    info.numberOfExecutions = ct.TimesTriggered;
  }
  return info;
}</code></pre></div></section></section><section><h3 id="-1707928647#refreshscheduleinfo-string-cronexp-list-string-timeparts" data-toc="refreshscheduleinfo-string-cronexp-list-string-timeparts#FoundationEventLogController.md-refreshscheduleinfo-string-cronexp-list-string-timeparts">refreshScheduleInfo(String cronExp, List&lt;String&gt; timeParts)</h3><section><h4 id="-1707928647#descripci-n" data-toc="descripci-n#FoundationEventLogController.md-descripci-n">Descripci&oacute;n</h4><p id="-1707928647#-r5qh9p_99">M&eacute;todo que actualiza la configuraci&oacute;n del trabajo programado, incluyendo la reprogramaci&oacute;n con una nueva expresi&oacute;n cron.</p></section><section><h4 id="-1707928647#par-metros" data-toc="par-metros#FoundationEventLogController.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1707928647#-r5qh9p_100" start="1"><li class="list-item" id="-1707928647#-r5qh9p_101"><p><span class="inline-code" id="-1707928647#-r5qh9p_103">cronExp</span> (String): Nueva expresi&oacute;n cron para la programaci&oacute;n del trabajo.</p></li><li class="list-item" id="-1707928647#-r5qh9p_102"><p><span class="inline-code" id="-1707928647#-r5qh9p_104">timeParts</span> (List</p><p>): Partes de tiempo (no utilizado en la implementaci&oacute;n actual).</p></li></ul></section><section><h4 id="-1707928647#retorno" data-toc="retorno#FoundationEventLogController.md-retorno">Retorno</h4><ul class="list" id="-1707928647#-r5qh9p_106" start="1"><li class="list-item" id="-1707928647#-r5qh9p_107"><p><span class="inline-code" id="-1707928647#-r5qh9p_108">void</span>: Este m&eacute;todo no devuelve ning&uacute;n valor.</p></li></ul></section><section><h4 id="-1707928647#proceso" data-toc="proceso#FoundationEventLogController.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1707928647#-r5qh9p_109" type="1" start="1"><li class="list-item" id="-1707928647#-r5qh9p_110"><p>Obtiene la configuraci&oacute;n actual de metadatos personalizados.</p></li><li class="list-item" id="-1707928647#-r5qh9p_111"><p>Actualiza la frecuencia con la nueva expresi&oacute;n cron.</p></li><li class="list-item" id="-1707928647#-r5qh9p_112"><p>Si existe un trabajo programado anterior, lo cancela.</p></li><li class="list-item" id="-1707928647#-r5qh9p_113"><p>Programa un nuevo trabajo con la nueva expresi&oacute;n cron.</p></li><li class="list-item" id="-1707928647#-r5qh9p_114"><p>Actualiza la configuraci&oacute;n con el nuevo ID de trabajo.</p></li><li class="list-item" id="-1707928647#-r5qh9p_115"><p>Guarda los cambios en metadatos (excepto en pruebas).</p></li></ol></section><section><h4 id="-1707928647#c-digo" data-toc="c-digo#FoundationEventLogController.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1707928647#-r5qh9p_116"><pre><code class="language-none">@AuraEnabled
public static void refreshScheduleInfo(
  String cronExp,
  List&lt;String&gt; timeParts
) {
  System.debug('Eventos');

  Suratech_Foundation_Schedule_Event__mdt config;
  if (Test.isRunningTest()) {
    Id testJobId = System.schedule(
      'Test Event Log Cleanup',
      cronExp,
      new EventLog_Subset_CleanupScheduleClass()
    );
    config = new Suratech_Foundation_Schedule_Event__mdt(
      MasterLabel = 'DefaultConfig',
      DeveloperName = 'DefaultConfig',
      Frequency__c = '',
      Is_Active__c = true,
      Schedule_Job_Id__c = ''
    );
  } else {
    config = [
      SELECT
        Id,
        Frequency__c,
        Schedule_Job_Id__c,
        MasterLabel,
        DeveloperName,
        Is_Active__c
      FROM Suratech_Foundation_Schedule_Event__mdt
      WHERE DeveloperName = 'DefaultConfig'
      LIMIT 1
    ];
  }

  config.Frequency__c = cronExp;

  if (config.Id == null) {
    config.MasterLabel = 'DefaultConfig';
    config.DeveloperName = 'DefaultConfig';
  }

  if (config.Schedule_Job_Id__c != null || config.Schedule_Job_Id__c == '') {
    try {
      System.abortJob(config.Schedule_Job_Id__c);
    } catch (Exception e) {
      System.debug('ERROR with Abbort Job: ' + e.getMessage());
    }
  }

  String jobName = Test.isRunningTest()
    ? 'Old Event Log Cleanup'
    : 'Test Event Log Cleanup';
  String jobId = System.schedule(
    jobName,
    cronExp,
    new EventLog_Subset_CleanupScheduleClass()
  );
  config.Is_Active__c = true;
  config.Schedule_Job_Id__c = jobId;

  if (!Test.isRunningTest())
    MetadataUtils.upsertMetadata(config);

  System.debug('Job rescheduled with ID: ' + jobId);
}</code></pre></div></section></section><section><h3 id="-1707928647#enabledscheduleinfo-boolean-enabled" data-toc="enabledscheduleinfo-boolean-enabled#FoundationEventLogController.md-enabledscheduleinfo-boolean-enabled">enabledScheduleInfo(Boolean enabled)</h3><section><h4 id="-1707928647#descripci-n" data-toc="descripci-n#FoundationEventLogController.md-descripci-n">Descripci&oacute;n</h4><p id="-1707928647#-r5qh9p_123">M&eacute;todo que habilita o deshabilita la configuraci&oacute;n del trabajo programado (m&eacute;todo incompleto en la implementaci&oacute;n actual).</p></section><section><h4 id="-1707928647#par-metros" data-toc="par-metros#FoundationEventLogController.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1707928647#-r5qh9p_124" start="1"><li class="list-item" id="-1707928647#-r5qh9p_125"><p><span class="inline-code" id="-1707928647#-r5qh9p_126">enabled</span> (Boolean): Indica si el trabajo debe estar habilitado o deshabilitado.</p></li></ul></section><section><h4 id="-1707928647#retorno" data-toc="retorno#FoundationEventLogController.md-retorno">Retorno</h4><ul class="list" id="-1707928647#-r5qh9p_127" start="1"><li class="list-item" id="-1707928647#-r5qh9p_128"><p><span class="inline-code" id="-1707928647#-r5qh9p_129">Boolean</span>: <span class="inline-code" id="-1707928647#-r5qh9p_130">true</span> si la operaci&oacute;n fue exitosa, <span class="inline-code" id="-1707928647#-r5qh9p_131">false</span> en caso de error.</p></li></ul></section><section><h4 id="-1707928647#proceso" data-toc="proceso#FoundationEventLogController.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1707928647#-r5qh9p_132" type="1" start="1"><li class="list-item" id="-1707928647#-r5qh9p_134"><p>Obtiene la configuraci&oacute;n de metadatos personalizados.</p></li><li class="list-item" id="-1707928647#-r5qh9p_135"><p>Intenta actualizar la configuraci&oacute;n (implementaci&oacute;n incompleta).</p></li><li class="list-item" id="-1707928647#-r5qh9p_136"><p>Maneja excepciones y retorna el resultado.</p></li></ol><p id="-1707928647#-r5qh9p_133"><span class="control" id="-1707928647#-r5qh9p_137">Nota</span>: Este m&eacute;todo parece estar incompleto, ya que no actualiza realmente el estado habilitado/deshabilitado.</p></section></section></section><section><h2 id="-1707928647#clase-wrapper" data-toc="clase-wrapper#FoundationEventLogController.md-clase-wrapper">Clase Wrapper</h2><section><h3 id="-1707928647#eventinfowrapper" data-toc="eventinfowrapper#FoundationEventLogController.md-eventinfowrapper">eventInfoWrapper</h3><section><h4 id="-1707928647#descripci-n" data-toc="descripci-n#FoundationEventLogController.md-descripci-n">Descripci&oacute;n</h4><p id="-1707928647#-r5qh9p_143">Clase interna que encapsula informaci&oacute;n sobre el trabajo programado de eventos para ser utilizada por componentes del frontend.</p></section><section><h4 id="-1707928647#propiedades" data-toc="propiedades#FoundationEventLogController.md-propiedades">Propiedades</h4><ul class="list" id="-1707928647#-r5qh9p_144" start="1"><li class="list-item" id="-1707928647#-r5qh9p_145"><p><span class="inline-code" id="-1707928647#-r5qh9p_150">isActive</span> (Boolean): Indica si el trabajo programado est&aacute; activo.</p></li><li class="list-item" id="-1707928647#-r5qh9p_146"><p><span class="inline-code" id="-1707928647#-r5qh9p_151">nextFireTime</span> (Datetime): Pr&oacute;xima fecha y hora de ejecuci&oacute;n del trabajo.</p></li><li class="list-item" id="-1707928647#-r5qh9p_147"><p><span class="inline-code" id="-1707928647#-r5qh9p_152">previousFireTime</span> (Datetime): &Uacute;ltima fecha y hora de ejecuci&oacute;n del trabajo.</p></li><li class="list-item" id="-1707928647#-r5qh9p_148"><p><span class="inline-code" id="-1707928647#-r5qh9p_153">cronExp</span> (String): Expresi&oacute;n cron que define la programaci&oacute;n.</p></li><li class="list-item" id="-1707928647#-r5qh9p_149"><p><span class="inline-code" id="-1707928647#-r5qh9p_154">numberOfExecutions</span> (Integer): N&uacute;mero de veces que el trabajo ha sido ejecutado.</p></li></ul></section></section></section><section><h2 id="-1707928647#dependencias" data-toc="dependencias#FoundationEventLogController.md-dependencias">Dependencias</h2><ul class="list" id="-1707928647#-r5qh9p_155" start="1"><li class="list-item" id="-1707928647#-r5qh9p_156"><p><span class="control" id="-1707928647#-r5qh9p_162"><span class="inline-code" id="-1707928647#-r5qh9p_163">EventLogManager</span></span>: Clase que proporciona la funcionalidad principal de gesti&oacute;n de eventos.</p></li><li class="list-item" id="-1707928647#-r5qh9p_157"><p><span class="control" id="-1707928647#-r5qh9p_164"><span class="inline-code" id="-1707928647#-r5qh9p_165">EventLog_Subset_CleanupScheduleClass</span></span>: Clase que implementa la l&oacute;gica del trabajo programado.</p></li><li class="list-item" id="-1707928647#-r5qh9p_158"><p><span class="control" id="-1707928647#-r5qh9p_166"><span class="inline-code" id="-1707928647#-r5qh9p_167">Suratech_Foundation_Schedule_Event__mdt</span></span>: Tipo de metadatos personalizados para configuraci&oacute;n.</p></li><li class="list-item" id="-1707928647#-r5qh9p_159"><p><span class="control" id="-1707928647#-r5qh9p_168"><span class="inline-code" id="-1707928647#-r5qh9p_169">MetadataUtils</span></span>: Clase utilitaria para operaciones con metadatos.</p></li><li class="list-item" id="-1707928647#-r5qh9p_160"><p><span class="control" id="-1707928647#-r5qh9p_170"><span class="inline-code" id="-1707928647#-r5qh9p_171">Core</span></span>: Clase utilitaria para registro de depuraci&oacute;n.</p></li><li class="list-item" id="-1707928647#-r5qh9p_161"><p><span class="control" id="-1707928647#-r5qh9p_172"><span class="inline-code" id="-1707928647#-r5qh9p_173">MetadataNotFoundException</span></span>: Excepci&oacute;n personalizada para casos donde no se encuentra la configuraci&oacute;n.</p></li></ul></section><section><h2 id="-1707928647#ejemplos-de-uso" data-toc="ejemplos-de-uso#FoundationEventLogController.md-ejemplos-de-uso">Ejemplos de Uso</h2><section><h3 id="-1707928647#ejemplo-1-uso-desde-lightning-web-component" data-toc="ejemplo-1-uso-desde-lightning-web-component#FoundationEventLogController.md-ejemplo-1-uso-desde-lightning-web-component">Ejemplo 1: Uso desde Lightning Web Component</h3><div class="detached code-block" id="-1707928647#-r5qh9p_177"><pre><code class="language-javascript">// foundationEventLogManager.js
import { LightningElement, track, wire } from 'lwc';
import refreshAnalytics from '@salesforce/apex/FoundationEventLogController.refreshAnalytics';
import cleanAnalytics from '@salesforce/apex/FoundationEventLogController.cleanAnalytics';
import loadScheduleInfo from '@salesforce/apex/FoundationEventLogController.loadScheduleInfo';
import refreshScheduleInfo from '@salesforce/apex/FoundationEventLogController.refreshScheduleInfo';

export default class FoundationEventLogManager extends LightningElement {
    @track scheduleInfo = {};
    @track isLoading = false;
    @track startDate;
    @track endDate;
    @track cronExpression;

    connectedCallback() {
        this.loadScheduleInformation();
    }

    async loadScheduleInformation() {
        try {
            this.isLoading = true;
            this.scheduleInfo = await loadScheduleInfo();
            this.cronExpression = this.scheduleInfo.cronExp;
        } catch (error) {
            console.error('Error loading schedule info:', error);
        } finally {
            this.isLoading = false;
        }
    }

    async handleRefreshAnalytics() {
        if (!this.startDate || !this.endDate) {
            // Mostrar error de validación
            return;
        }

        try {
            this.isLoading = true;
            const result = await refreshAnalytics({
                startAt: new Date(this.startDate),
                endAt: new Date(this.endDate)
            });

            if (result) {
                // Mostrar mensaje de éxito
                this.showToast('Success', 'Analytics refresh started successfully', 'success');
            } else {
                // Mostrar mensaje de error
                this.showToast('Error', 'Failed to start analytics refresh', 'error');
            }
        } catch (error) {
            console.error('Error refreshing analytics:', error);
            this.showToast('Error', error.body.message, 'error');
        } finally {
            this.isLoading = false;
        }
    }

    async handleCleanAnalytics() {
        try {
            this.isLoading = true;
            const result = await cleanAnalytics();

            if (result) {
                this.showToast('Success', 'Analytics cleaned successfully', 'success');
            } else {
                this.showToast('Error', 'Failed to clean analytics', 'error');
            }
        } catch (error) {
            console.error('Error cleaning analytics:', error);
            this.showToast('Error', error.body.message, 'error');
        } finally {
            this.isLoading = false;
        }
    }

    async handleUpdateSchedule() {
        if (!this.cronExpression) {
            this.showToast('Error', 'Please provide a valid cron expression', 'error');
            return;
        }

        try {
            this.isLoading = true;
            await refreshScheduleInfo({
                cronExp: this.cronExpression,
                timeParts: []
            });

            this.showToast('Success', 'Schedule updated successfully', 'success');
            await this.loadScheduleInformation(); // Reload info
        } catch (error) {
            console.error('Error updating schedule:', error);
            this.showToast('Error', error.body.message, 'error');
        } finally {
            this.isLoading = false;
        }
    }

    handleStartDateChange(event) {
        this.startDate = event.target.value;
    }

    handleEndDateChange(event) {
        this.endDate = event.target.value;
    }

    handleCronExpressionChange(event) {
        this.cronExpression = event.target.value;
    }

    showToast(title, message, variant) {
        const event = new ShowToastEvent({
            title: title,
            message: message,
            variant: variant
        });
        this.dispatchEvent(event);
    }
}</code></pre></div><div class="detached code-block" id="-1707928647#-r5qh9p_178"><pre><code class="language-markup">&lt;!-- foundationEventLogManager.html --&gt;
&lt;template&gt;
    &lt;lightning-card title=&quot;Foundation Event Log Manager&quot; icon-name=&quot;standard:logging&quot;&gt;
        &lt;div class=&quot;slds-p-horizontal_small&quot;&gt;
            &lt;!-- Analytics Section --&gt;
            &lt;div class=&quot;slds-section slds-is-open&quot;&gt;
                &lt;h3 class=&quot;slds-section__title&quot;&gt;
                    &lt;span class=&quot;slds-truncate slds-p-horizontal_small&quot; title=&quot;Analytics Management&quot;&gt;
                        Analytics Management
                    &lt;/span&gt;
                &lt;/h3&gt;
                &lt;div class=&quot;slds-section__content slds-p-around_medium&quot;&gt;
                    &lt;div class=&quot;slds-grid slds-gutters&quot;&gt;
                        &lt;div class=&quot;slds-col slds-size_1-of-2&quot;&gt;
                            &lt;lightning-input
                                type=&quot;datetime-local&quot;
                                label=&quot;Start Date&quot;
                                value={startDate}
                                onchange={handleStartDateChange}&gt;
                            &lt;/lightning-input&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;slds-col slds-size_1-of-2&quot;&gt;
                            &lt;lightning-input
                                type=&quot;datetime-local&quot;
                                label=&quot;End Date&quot;
                                value={endDate}
                                onchange={handleEndDateChange}&gt;
                            &lt;/lightning-input&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    
                    &lt;div class=&quot;slds-m-top_medium&quot;&gt;
                        &lt;lightning-button
                            variant=&quot;brand&quot;
                            label=&quot;Refresh Analytics&quot;
                            onclick={handleRefreshAnalytics}
                            disabled={isLoading}&gt;
                        &lt;/lightning-button&gt;
                        
                        &lt;lightning-button
                            variant=&quot;destructive&quot;
                            label=&quot;Clean Analytics&quot;
                            onclick={handleCleanAnalytics}
                            disabled={isLoading}
                            class=&quot;slds-m-left_small&quot;&gt;
                        &lt;/lightning-button&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;!-- Schedule Section --&gt;
            &lt;div class=&quot;slds-section slds-is-open slds-m-top_large&quot;&gt;
                &lt;h3 class=&quot;slds-section__title&quot;&gt;
                    &lt;span class=&quot;slds-truncate slds-p-horizontal_small&quot; title=&quot;Schedule Management&quot;&gt;
                        Schedule Management
                    &lt;/span&gt;
                &lt;/h3&gt;
                &lt;div class=&quot;slds-section__content slds-p-around_medium&quot;&gt;
                    &lt;div class=&quot;slds-grid slds-gutters&quot;&gt;
                        &lt;div class=&quot;slds-col slds-size_1-of-2&quot;&gt;
                            &lt;lightning-input
                                label=&quot;Cron Expression&quot;
                                value={cronExpression}
                                onchange={handleCronExpressionChange}
                                help=&quot;Example: 0 0 2 * * ? (Daily at 2 AM)&quot;&gt;
                            &lt;/lightning-input&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;slds-col slds-size_1-of-2&quot;&gt;
                            &lt;div class=&quot;slds-form-element&quot;&gt;
                                &lt;label class=&quot;slds-form-element__label&quot;&gt;Schedule Status&lt;/label&gt;
                                &lt;div class=&quot;slds-form-element__control&quot;&gt;
                                    &lt;lightning-badge
                                        label={scheduleInfo.isActive ? 'Active' : 'Inactive'}
                                        variant={scheduleInfo.isActive ? 'success' : 'error'}&gt;
                                    &lt;/lightning-badge&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;

                    &lt;template if:true={scheduleInfo.nextFireTime}&gt;
                        &lt;div class=&quot;slds-grid slds-gutters slds-m-top_medium&quot;&gt;
                            &lt;div class=&quot;slds-col slds-size_1-of-3&quot;&gt;
                                &lt;div class=&quot;slds-form-element&quot;&gt;
                                    &lt;label class=&quot;slds-form-element__label&quot;&gt;Next Execution&lt;/label&gt;
                                    &lt;div class=&quot;slds-form-element__control&quot;&gt;
                                        &lt;lightning-formatted-date-time
                                            value={scheduleInfo.nextFireTime}&gt;
                                        &lt;/lightning-formatted-date-time&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;slds-col slds-size_1-of-3&quot;&gt;
                                &lt;div class=&quot;slds-form-element&quot;&gt;
                                    &lt;label class=&quot;slds-form-element__label&quot;&gt;Last Execution&lt;/label&gt;
                                    &lt;div class=&quot;slds-form-element__control&quot;&gt;
                                        &lt;lightning-formatted-date-time
                                            value={scheduleInfo.previousFireTime}&gt;
                                        &lt;/lightning-formatted-date-time&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;slds-col slds-size_1-of-3&quot;&gt;
                                &lt;div class=&quot;slds-form-element&quot;&gt;
                                    &lt;label class=&quot;slds-form-element__label&quot;&gt;Executions Count&lt;/label&gt;
                                    &lt;div class=&quot;slds-form-element__control&quot;&gt;
                                        &lt;span class=&quot;slds-text-heading_small&quot;&gt;
                                            {scheduleInfo.numberOfExecutions}
                                        &lt;/span&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/template&gt;

                    &lt;div class=&quot;slds-m-top_medium&quot;&gt;
                        &lt;lightning-button
                            variant=&quot;brand&quot;
                            label=&quot;Update Schedule&quot;
                            onclick={handleUpdateSchedule}
                            disabled={isLoading}&gt;
                        &lt;/lightning-button&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;!-- Loading Spinner --&gt;
            &lt;template if:true={isLoading}&gt;
                &lt;lightning-spinner
                    alternative-text=&quot;Processing...&quot;
                    size=&quot;medium&quot;&gt;
                &lt;/lightning-spinner&gt;
            &lt;/template&gt;
        &lt;/div&gt;
    &lt;/lightning-card&gt;
&lt;/template&gt;</code></pre></div></section><section><h3 id="-1707928647#ejemplo-2-uso-desde-apex-para-administraci-n-program-tica" data-toc="ejemplo-2-uso-desde-apex-para-administraci-n-program-tica#FoundationEventLogController.md-ejemplo-2-uso-desde-apex-para-administraci-n-program-tica">Ejemplo 2: Uso desde Apex para Administraci&oacute;n Program&aacute;tica</h3><div class="detached code-block" id="-1707928647#-r5qh9p_179"><pre><code class="language-none">public class EventLogAdministration {
    
    // Método para refrescar análisis para el último mes
    public static void refreshLastMonthAnalytics() {
        Datetime lastMonth = Datetime.now().addDays(-30);
        Datetime now = Datetime.now();
        
        Boolean success = FoundationEventLogController.refreshAnalytics(lastMonth, now);
        
        if (success) {
            System.debug('Analytics refresh for last month initiated successfully');
        } else {
            System.debug('Failed to initiate analytics refresh');
        }
    }
    
    // Método para programar limpieza diaria
    public static void scheduleDailyCleanup() {
        String dailyCronExp = '0 0 2 * * ?'; // Todos los días a las 2 AM
        
        try {
            FoundationEventLogController.refreshScheduleInfo(dailyCronExp, new List&lt;String&gt;());
            System.debug('Daily cleanup scheduled successfully');
        } catch (Exception e) {
            System.debug('Error scheduling daily cleanup: ' + e.getMessage());
        }
    }
    
    // Método para obtener información del cronograma
    public static void displayScheduleInfo() {
        try {
            FoundationEventLogController.eventInfoWrapper info = 
                FoundationEventLogController.loadScheduleInfo();
            
            System.debug('Schedule Status: ' + (info.isActive ? 'Active' : 'Inactive'));
            System.debug('Cron Expression: ' + info.cronExp);
            System.debug('Next Fire Time: ' + info.nextFireTime);
            System.debug('Previous Fire Time: ' + info.previousFireTime);
            System.debug('Number of Executions: ' + info.numberOfExecutions);
        } catch (Exception e) {
            System.debug('Error loading schedule info: ' + e.getMessage());
        }
    }
    
    // Método para limpiar análisis
    public static void performAnalyticsCleanup() {
        Boolean success = FoundationEventLogController.cleanAnalytics();
        
        if (success) {
            System.debug('Analytics cleaned successfully');
        } else {
            System.debug('Failed to clean analytics');
        }
    }
}

// Uso de los métodos
EventLogAdministration.refreshLastMonthAnalytics();
EventLogAdministration.scheduleDailyCleanup();
EventLogAdministration.displayScheduleInfo();
EventLogAdministration.performAnalyticsCleanup();</code></pre></div></section><section><h3 id="-1707928647#ejemplo-3-configuraci-n-de-expresiones-cron-comunes" data-toc="ejemplo-3-configuraci-n-de-expresiones-cron-comunes#FoundationEventLogController.md-ejemplo-3-configuraci-n-de-expresiones-cron-comunes">Ejemplo 3: Configuraci&oacute;n de Expresiones Cron Comunes</h3><div class="detached code-block" id="-1707928647#-r5qh9p_180"><pre><code class="language-none">public class CronExpressionHelper {
    
    // Expresiones cron comunes para la limpieza de eventos
    public static final Map&lt;String, String&gt; COMMON_SCHEDULES = new Map&lt;String, String&gt;{
        'DAILY_2AM' =&gt; '0 0 2 * * ?',           // Todos los días a las 2 AM
        'WEEKLY_SUNDAY' =&gt; '0 0 2 ? * SUN',     // Domingos a las 2 AM
        'MONTHLY_FIRST' =&gt; '0 0 2 1 * ?',       // Primer día del mes a las 2 AM
        'WEEKDAYS_ONLY' =&gt; '0 0 2 ? * MON-FRI', // Días laborables a las 2 AM
        'TWICE_DAILY' =&gt; '0 0 2,14 * * ?'       // Dos veces al día (2 AM y 2 PM)
    };
    
    public static void setupWeeklyCleanup() {
        FoundationEventLogController.refreshScheduleInfo(
            COMMON_SCHEDULES.get('WEEKLY_SUNDAY'), 
            new List&lt;String&gt;()
        );
    }
    
    public static void setupDailyCleanup() {
        FoundationEventLogController.refreshScheduleInfo(
            COMMON_SCHEDULES.get('DAILY_2AM'), 
            new List&lt;String&gt;()
        );
    }
    
    public static void setupMonthlyCleanup() {
        FoundationEventLogController.refreshScheduleInfo(
            COMMON_SCHEDULES.get('MONTHLY_FIRST'), 
            new List&lt;String&gt;()
        );
    }
}</code></pre></div></section></section><section><h2 id="-1707928647#mejores-pr-cticas-implementadas" data-toc="mejores-pr-cticas-implementadas#FoundationEventLogController.md-mejores-pr-cticas-implementadas">Mejores Pr&aacute;cticas Implementadas</h2><ol class="list list-decimal" id="-1707928647#-r5qh9p_181" type="1" start="1"><li class="list-item" id="-1707928647#-r5qh9p_182"><p id="-1707928647#-r5qh9p_187"><span class="control" id="-1707928647#-r5qh9p_188">Separaci&oacute;n de Responsabilidades</span>: El controlador act&uacute;a como una capa de interfaz entre el frontend y la l&oacute;gica de negocio.</p></li><li class="list-item" id="-1707928647#-r5qh9p_183"><p id="-1707928647#-r5qh9p_189"><span class="control" id="-1707928647#-r5qh9p_190">Manejo de Contexto de Pruebas</span>: Incluye l&oacute;gica espec&iacute;fica para contextos de prueba.</p></li><li class="list-item" id="-1707928647#-r5qh9p_184"><p id="-1707928647#-r5qh9p_191"><span class="control" id="-1707928647#-r5qh9p_192">Validaci&oacute;n de Datos</span>: Valida par&aacute;metros de entrada y maneja casos nulos.</p></li><li class="list-item" id="-1707928647#-r5qh9p_185"><p id="-1707928647#-r5qh9p_193"><span class="control" id="-1707928647#-r5qh9p_194">Manejo de Excepciones</span>: Incluye bloques try-catch para manejar errores.</p></li><li class="list-item" id="-1707928647#-r5qh9p_186"><p id="-1707928647#-r5qh9p_195"><span class="control" id="-1707928647#-r5qh9p_196">Uso de Wrapper Classes</span>: Utiliza clases wrapper para estructurar datos complejos para el frontend.</p></li></ol></section><section><h2 id="-1707928647#consideraciones-y-mejoras-potenciales" data-toc="consideraciones-y-mejoras-potenciales#FoundationEventLogController.md-consideraciones-y-mejoras-potenciales">Consideraciones y Mejoras Potenciales</h2><section><h3 id="-1707928647#observaciones-sobre-el-c-digo" data-toc="observaciones-sobre-el-c-digo#FoundationEventLogController.md-observaciones-sobre-el-c-digo">Observaciones sobre el C&oacute;digo</h3><ol class="list list-decimal" id="-1707928647#-r5qh9p_199" type="1" start="1"><li class="list-item" id="-1707928647#-r5qh9p_200"><p id="-1707928647#-r5qh9p_204"><span class="control" id="-1707928647#-r5qh9p_205">M&eacute;todo Incompleto</span>: El m&eacute;todo <span class="inline-code" id="-1707928647#-r5qh9p_206">enabledScheduleInfo</span> parece estar incompleto y no actualiza realmente el estado del trabajo programado.</p></li><li class="list-item" id="-1707928647#-r5qh9p_201"><p id="-1707928647#-r5qh9p_207"><span class="control" id="-1707928647#-r5qh9p_208">Par&aacute;metro No Utilizado</span>: El par&aacute;metro <span class="inline-code" id="-1707928647#-r5qh9p_209">timeParts</span> en <span class="inline-code" id="-1707928647#-r5qh9p_210">refreshScheduleInfo</span> no se utiliza en la implementaci&oacute;n.</p></li><li class="list-item" id="-1707928647#-r5qh9p_202"><p id="-1707928647#-r5qh9p_211"><span class="control" id="-1707928647#-r5qh9p_212">Inconsistencia en Nombres de Trabajos</span>: Los nombres de trabajos en las pruebas est&aacute;n intercambiados.</p></li><li class="list-item" id="-1707928647#-r5qh9p_203"><p id="-1707928647#-r5qh9p_213"><span class="control" id="-1707928647#-r5qh9p_214">L&oacute;gica de Cancelaci&oacute;n</span>: La l&oacute;gica para cancelar trabajos programados podr&iacute;a mejorarse.</p></li></ol></section><section><h3 id="-1707928647#mejoras-sugeridas" data-toc="mejoras-sugeridas#FoundationEventLogController.md-mejoras-sugeridas">Mejoras Sugeridas</h3><div class="detached code-block" id="-1707928647#-r5qh9p_215"><pre><code class="language-none">// Versión mejorada del método enabledScheduleInfo
@AuraEnabled
public static boolean enabledScheduleInfo(Boolean enabled) {
    try {
        Suratech_Foundation_Schedule_Event__mdt config;
        if (Test.isRunningTest()) {
            config = new Suratech_Foundation_Schedule_Event__mdt(
                MasterLabel = 'DefaultConfig',
                DeveloperName = 'DefaultConfig',
                Frequency__c = '0 0 2 * * ?',
                Is_Active__c = enabled,
                Schedule_Job_Id__c = ''
            );
        } else {
            config = [
                SELECT Id, Frequency__c, Schedule_Job_Id__c, MasterLabel, DeveloperName, Is_Active__c
                FROM Suratech_Foundation_Schedule_Event__mdt
                WHERE DeveloperName = 'DefaultConfig'
                LIMIT 1
            ];
        }

        // Actualizar el estado
        config.Is_Active__c = enabled;
        
        // Si se está deshabilitando y hay un trabajo programado, cancelarlo
        if (!enabled &amp;&amp; String.isNotBlank(config.Schedule_Job_Id__c)) {
            try {
                System.abortJob(config.Schedule_Job_Id__c);
                config.Schedule_Job_Id__c = null;
            } catch (Exception e) {
                System.debug('Error aborting job: ' + e.getMessage());
            }
        }
        
        if (!Test.isRunningTest()) {
            MetadataUtils.upsertMetadata(config);
        }
        
        return true;
    } catch (Exception e) {
        System.debug('Error in enabledScheduleInfo: ' + e.getMessage());
        return false;
    }
}</code></pre></div></section></section><section><h2 id="-1707928647#notas-adicionales" data-toc="notas-adicionales#FoundationEventLogController.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-1707928647#-r5qh9p_216" type="1" start="1"><li class="list-item" id="-1707928647#-r5qh9p_217"><p id="-1707928647#-r5qh9p_222"><span class="control" id="-1707928647#-r5qh9p_223">Interfaz de Usuario</span>: Esta clase est&aacute; dise&ntilde;ada espec&iacute;ficamente para proporcionar una interfaz entre componentes Lightning y la funcionalidad de gesti&oacute;n de eventos.</p></li><li class="list-item" id="-1707928647#-r5qh9p_218"><p id="-1707928647#-r5qh9p_224"><span class="control" id="-1707928647#-r5qh9p_225">Configuraci&oacute;n Centralizada</span>: Utiliza metadatos personalizados para mantener la configuraci&oacute;n centralizada y modificable sin cambios de c&oacute;digo.</p></li><li class="list-item" id="-1707928647#-r5qh9p_219"><p id="-1707928647#-r5qh9p_226"><span class="control" id="-1707928647#-r5qh9p_227">Soporte para Testing</span>: Incluye l&oacute;gica robusta para manejar contextos de prueba.</p></li><li class="list-item" id="-1707928647#-r5qh9p_220"><p id="-1707928647#-r5qh9p_228"><span class="control" id="-1707928647#-r5qh9p_229">Flexibilidad de Programaci&oacute;n</span>: Permite programaci&oacute;n flexible de trabajos usando expresiones cron.</p></li><li class="list-item" id="-1707928647#-r5qh9p_221"><p id="-1707928647#-r5qh9p_230"><span class="control" id="-1707928647#-r5qh9p_231">Monitoreo de Trabajos</span>: Proporciona informaci&oacute;n detallada sobre el estado y historial de ejecuci&oacute;n de trabajos programados.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="2106303">Core</h1><section><h2 id="2106303#descripci-n-general" data-toc="descripci-n-general#Core.md-descripci-n-general">Descripci&oacute;n General</h2><p id="2106303#-ywvjcj_16"><span class="inline-code" id="2106303#-ywvjcj_17">Core</span> es una clase global utilitaria fundamental que proporciona funcionalidades b&aacute;sicas de debugging y monitoreo de l&iacute;mites del sistema Salesforce. Esta clase act&uacute;a como una biblioteca central de utilidades que es ampliamente utilizada en todo el framework Foundation de Suratech para registro de depuraci&oacute;n y seguimiento del rendimiento del sistema.</p></section><section><h2 id="2106303#autor" data-toc="autor#Core.md-autor">Autor</h2><p id="2106303#-ywvjcj_18">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="2106303#ltima-modificaci-n" data-toc="ltima-modificaci-n#Core.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="2106303#-ywvjcj_19">4 de febrero de 2025 por Jean Carlos Melendez</p></section><section><h2 id="2106303#estructura-de-la-clase" data-toc="estructura-de-la-clase#Core.md-estructura-de-la-clase">Estructura de la Clase</h2><div class="detached code-block" id="2106303#-ywvjcj_20"><pre><code class="language-none">global without sharing class Core {
  global static void debug(String message);
  global static String getCalloutStatistics();
  global static String getCPUTimeStatistics();
  global static String getSOQLStatistics();
  global static String getSOSLStatistics();
  global static void getSymmaryLimits();
}</code></pre></div></section><section><h2 id="2106303#caracter-sticas-clave" data-toc="caracter-sticas-clave#Core.md-caracter-sticas-clave">Caracter&iacute;sticas Clave</h2><ul class="list" id="2106303#-ywvjcj_21" start="1"><li class="list-item" id="2106303#-ywvjcj_22"><p><span class="control" id="2106303#-ywvjcj_24">Modificador <span class="inline-code" id="2106303#-ywvjcj_25">without sharing</span></span>: La clase no hereda reglas de compartici&oacute;n, permitiendo acceso completo a datos del sistema para funciones de monitoreo.</p></li><li class="list-item" id="2106303#-ywvjcj_23"><p><span class="control" id="2106303#-ywvjcj_26">M&eacute;todos est&aacute;ticos globales</span>: Todos los m&eacute;todos son est&aacute;ticos y globales, permitiendo su uso desde cualquier contexto sin necesidad de instanciaci&oacute;n.</p></li></ul></section><section><h2 id="2106303#m-todos" data-toc="m-todos#Core.md-m-todos">M&eacute;todos</h2><section><h3 id="2106303#debug-string-message" data-toc="debug-string-message#Core.md-debug-string-message">debug(String message)</h3><section><h4 id="2106303#descripci-n" data-toc="descripci-n#Core.md-descripci-n">Descripci&oacute;n</h4><p id="2106303#-ywvjcj_40">M&eacute;todo est&aacute;tico global que proporciona funcionalidad de debugging estandarizada para todo el framework. Registra mensajes con un nivel de logging espec&iacute;fico y un prefijo identificador.</p></section><section><h4 id="2106303#par-metros" data-toc="par-metros#Core.md-par-metros">Par&aacute;metros</h4><ul class="list" id="2106303#-ywvjcj_41" start="1"><li class="list-item" id="2106303#-ywvjcj_42"><p><span class="inline-code" id="2106303#-ywvjcj_43">message</span> (String): Mensaje a registrar en los logs de depuraci&oacute;n.</p></li></ul></section><section><h4 id="2106303#retorno" data-toc="retorno#Core.md-retorno">Retorno</h4><ul class="list" id="2106303#-ywvjcj_44" start="1"><li class="list-item" id="2106303#-ywvjcj_45"><p><span class="inline-code" id="2106303#-ywvjcj_46">void</span>: Este m&eacute;todo no devuelve ning&uacute;n valor.</p></li></ul></section><section><h4 id="2106303#caracter-sticas" data-toc="caracter-sticas#Core.md-caracter-sticas">Caracter&iacute;sticas</h4><ul class="list" id="2106303#-ywvjcj_47" start="1"><li class="list-item" id="2106303#-ywvjcj_48"><p><span class="control" id="2106303#-ywvjcj_51">Nivel de Logging</span>: Utiliza <span class="inline-code" id="2106303#-ywvjcj_52">LoggingLevel.FINEST</span> para registros de depuraci&oacute;n detallados.</p></li><li class="list-item" id="2106303#-ywvjcj_49"><p><span class="control" id="2106303#-ywvjcj_53">Prefijo Est&aacute;ndar</span>: A&ntilde;ade el prefijo &quot;Core: &quot; a todos los mensajes para facilitar la identificaci&oacute;n.</p></li><li class="list-item" id="2106303#-ywvjcj_50"><p><span class="control" id="2106303#-ywvjcj_54">Uso Universal</span>: Es utilizado por m&uacute;ltiples clases del framework como m&eacute;todo central de debugging.</p></li></ul></section><section><h4 id="2106303#c-digo" data-toc="c-digo#Core.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="2106303#-ywvjcj_55"><pre><code class="language-none">global static void debug(String message) {
  System.debug(LoggingLevel.FINEST, 'Core: ' + message);
}</code></pre></div></section></section><section><h3 id="2106303#getcalloutstatistics" data-toc="getcalloutstatistics#Core.md-getcalloutstatistics">getCalloutStatistics()</h3><section><h4 id="2106303#descripci-n" data-toc="descripci-n#Core.md-descripci-n">Descripci&oacute;n</h4><p id="2106303#-ywvjcj_63">M&eacute;todo que retorna estad&iacute;sticas de uso de callouts HTTP, mostrando cu&aacute;ntos callouts se han realizado versus el l&iacute;mite permitido.</p></section><section><h4 id="2106303#par-metros" data-toc="par-metros#Core.md-par-metros">Par&aacute;metros</h4><p id="2106303#-ywvjcj_64">Ninguno.</p></section><section><h4 id="2106303#retorno" data-toc="retorno#Core.md-retorno">Retorno</h4><ul class="list" id="2106303#-ywvjcj_65" start="1"><li class="list-item" id="2106303#-ywvjcj_66"><p><span class="inline-code" id="2106303#-ywvjcj_67">String</span>: Cadena formateada que muestra &quot;Callouts statistics=X/Y&quot; donde X es el n&uacute;mero actual de callouts y Y es el l&iacute;mite m&aacute;ximo.</p></li></ul></section><section><h4 id="2106303#uso" data-toc="uso#Core.md-uso">Uso</h4><p id="2106303#-ywvjcj_68">&Uacute;til para monitorear el consumo de callouts y prevenir que se alcancen los l&iacute;mites del sistema.</p></section><section><h4 id="2106303#c-digo" data-toc="c-digo#Core.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="2106303#-ywvjcj_69"><pre><code class="language-none">global static String getCalloutStatistics() {
  return 'Callouts statistics=' +
    System.Limits.getCallouts() +
    '/' +
    System.Limits.getLimitCallouts();
}</code></pre></div></section></section><section><h3 id="2106303#getcputimestatistics" data-toc="getcputimestatistics#Core.md-getcputimestatistics">getCPUTimeStatistics()</h3><section><h4 id="2106303#descripci-n" data-toc="descripci-n#Core.md-descripci-n">Descripci&oacute;n</h4><p id="2106303#-ywvjcj_77">M&eacute;todo que retorna estad&iacute;sticas de uso de tiempo de CPU, mostrando el tiempo consumido versus el l&iacute;mite permitido.</p></section><section><h4 id="2106303#par-metros" data-toc="par-metros#Core.md-par-metros">Par&aacute;metros</h4><p id="2106303#-ywvjcj_78">Ninguno.</p></section><section><h4 id="2106303#retorno" data-toc="retorno#Core.md-retorno">Retorno</h4><ul class="list" id="2106303#-ywvjcj_79" start="1"><li class="list-item" id="2106303#-ywvjcj_80"><p><span class="inline-code" id="2106303#-ywvjcj_81">String</span>: Cadena formateada que muestra &quot;CPU time usage=X/Y&quot; donde X es el tiempo de CPU utilizado en milisegundos y Y es el l&iacute;mite m&aacute;ximo.</p></li></ul></section><section><h4 id="2106303#uso" data-toc="uso#Core.md-uso">Uso</h4><p id="2106303#-ywvjcj_82">Cr&iacute;tico para monitorear el rendimiento y prevenir timeouts por exceso de procesamiento.</p></section><section><h4 id="2106303#c-digo" data-toc="c-digo#Core.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="2106303#-ywvjcj_83"><pre><code class="language-none">global static String getCPUTimeStatistics() {
  return 'CPU time usage=' +
    System.Limits.getCpuTime() +
    '/' +
    System.Limits.getLimitCpuTime();
}</code></pre></div></section></section><section><h3 id="2106303#getsoqlstatistics" data-toc="getsoqlstatistics#Core.md-getsoqlstatistics">getSOQLStatistics()</h3><section><h4 id="2106303#descripci-n" data-toc="descripci-n#Core.md-descripci-n">Descripci&oacute;n</h4><p id="2106303#-ywvjcj_91">M&eacute;todo que retorna estad&iacute;sticas de uso de consultas SOQL, mostrando cu&aacute;ntas consultas se han ejecutado versus el l&iacute;mite permitido.</p></section><section><h4 id="2106303#par-metros" data-toc="par-metros#Core.md-par-metros">Par&aacute;metros</h4><p id="2106303#-ywvjcj_92">Ninguno.</p></section><section><h4 id="2106303#retorno" data-toc="retorno#Core.md-retorno">Retorno</h4><ul class="list" id="2106303#-ywvjcj_93" start="1"><li class="list-item" id="2106303#-ywvjcj_94"><p><span class="inline-code" id="2106303#-ywvjcj_95">String</span>: Cadena formateada que muestra &quot;SOQL queries usage=X/Y&quot; donde X es el n&uacute;mero de consultas SOQL ejecutadas y Y es el l&iacute;mite m&aacute;ximo.</p></li></ul></section><section><h4 id="2106303#uso" data-toc="uso#Core.md-uso">Uso</h4><p id="2106303#-ywvjcj_96">Esencial para prevenir excepciones por exceso de consultas SOQL en una transacci&oacute;n.</p></section><section><h4 id="2106303#c-digo" data-toc="c-digo#Core.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="2106303#-ywvjcj_97"><pre><code class="language-none">global static String getSOQLStatistics() {
  return 'SOQL queries usage=' +
    System.Limits.getQueries() +
    '/' +
    System.Limits.getLimitQueries();
}</code></pre></div></section></section><section><h3 id="2106303#getsoslstatistics" data-toc="getsoslstatistics#Core.md-getsoslstatistics">getSOSLStatistics()</h3><section><h4 id="2106303#descripci-n" data-toc="descripci-n#Core.md-descripci-n">Descripci&oacute;n</h4><p id="2106303#-ywvjcj_105">M&eacute;todo que retorna estad&iacute;sticas de uso de consultas SOSL, mostrando cu&aacute;ntas b&uacute;squedas se han ejecutado versus el l&iacute;mite permitido.</p></section><section><h4 id="2106303#par-metros" data-toc="par-metros#Core.md-par-metros">Par&aacute;metros</h4><p id="2106303#-ywvjcj_106">Ninguno.</p></section><section><h4 id="2106303#retorno" data-toc="retorno#Core.md-retorno">Retorno</h4><ul class="list" id="2106303#-ywvjcj_107" start="1"><li class="list-item" id="2106303#-ywvjcj_108"><p><span class="inline-code" id="2106303#-ywvjcj_109">String</span>: Cadena formateada que muestra &quot;SOSL queries usage=X/Y&quot; donde X es el n&uacute;mero de consultas SOSL ejecutadas y Y es el l&iacute;mite m&aacute;ximo.</p></li></ul></section><section><h4 id="2106303#uso" data-toc="uso#Core.md-uso">Uso</h4><p id="2106303#-ywvjcj_110">&Uacute;til para monitorear el uso de b&uacute;squedas SOSL y evitar alcanzar los l&iacute;mites del sistema.</p></section><section><h4 id="2106303#c-digo" data-toc="c-digo#Core.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="2106303#-ywvjcj_111"><pre><code class="language-none">global static String getSOSLStatistics() {
  return 'SOSL queries usage=' +
    System.Limits.getSoslQueries() +
    '/' +
    System.Limits.getLimitSoslQueries();
}</code></pre></div></section></section><section><h3 id="2106303#getsymmarylimits" data-toc="getsymmarylimits#Core.md-getsymmarylimits">getSymmaryLimits()</h3><section><h4 id="2106303#descripci-n" data-toc="descripci-n#Core.md-descripci-n">Descripci&oacute;n</h4><p id="2106303#-ywvjcj_119">M&eacute;todo que registra un resumen completo de todas las estad&iacute;sticas de l&iacute;mites del sistema de forma formateada.</p><p id="2106303#-ywvjcj_120"><span class="control" id="2106303#-ywvjcj_121">Nota</span>: Existe un error tipogr&aacute;fico en el nombre del m&eacute;todo (deber&iacute;a ser <span class="inline-code" id="2106303#-ywvjcj_122">getSummaryLimits</span>).</p></section><section><h4 id="2106303#par-metros" data-toc="par-metros#Core.md-par-metros">Par&aacute;metros</h4><p id="2106303#-ywvjcj_123">Ninguno.</p></section><section><h4 id="2106303#retorno" data-toc="retorno#Core.md-retorno">Retorno</h4><ul class="list" id="2106303#-ywvjcj_124" start="1"><li class="list-item" id="2106303#-ywvjcj_125"><p><span class="inline-code" id="2106303#-ywvjcj_126">void</span>: Este m&eacute;todo no devuelve ning&uacute;n valor, sino que registra la informaci&oacute;n.</p></li></ul></section><section><h4 id="2106303#proceso" data-toc="proceso#Core.md-proceso">Proceso</h4><ol class="list list-decimal" id="2106303#-ywvjcj_127" type="1" start="1"><li class="list-item" id="2106303#-ywvjcj_128"><p>Obtiene estad&iacute;sticas de CPU, SOQL, SOSL y Callouts.</p></li><li class="list-item" id="2106303#-ywvjcj_129"><p>Formatea toda la informaci&oacute;n en una sola cadena.</p></li><li class="list-item" id="2106303#-ywvjcj_130"><p>Registra el resumen usando el m&eacute;todo <span class="inline-code" id="2106303#-ywvjcj_131">debug</span>.</p></li></ol></section><section><h4 id="2106303#c-digo" data-toc="c-digo#Core.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="2106303#-ywvjcj_132"><pre><code class="language-none">global static void getSymmaryLimits() {
  Core.debug(
    '===== Statistics(' +
      Core.getCPUTimeStatistics() +
      ',' +
      Core.getSOQLStatistics() +
      ',' +
      Core.getSOSLStatistics() +
      ',' +
      Core.getCalloutStatistics() +
      ') ====='
  );
}</code></pre></div></section></section></section><section><h2 id="2106303#l-mites-del-sistema-salesforce-monitoreados" data-toc="l-mites-del-sistema-salesforce-monitoreados#Core.md-l-mites-del-sistema-salesforce-monitoreados">L&iacute;mites del Sistema Salesforce Monitoreados</h2><div class="table-wrapper detached"><table id="2106303#-ywvjcj_133"><tr class="header-row" id="2106303#-ywvjcj_134"><th id="2106303#-ywvjcj_139"><p>Tipo de L&iacute;mite</p></th><th id="2106303#-ywvjcj_140"><p>M&eacute;todo de Acceso</p></th><th id="2106303#-ywvjcj_141"><p>L&iacute;mite T&iacute;pico</p></th><th id="2106303#-ywvjcj_142"><p>Descripci&oacute;n</p></th></tr><tr class="" id="2106303#-ywvjcj_135"><td id="2106303#-ywvjcj_143"><p><span class="control" id="2106303#-ywvjcj_147">Callouts HTTP</span></p></td><td id="2106303#-ywvjcj_144"><p><span class="inline-code" id="2106303#-ywvjcj_148">getCallouts()</span></p></td><td id="2106303#-ywvjcj_145"><p>100 por transacci&oacute;n</p></td><td id="2106303#-ywvjcj_146"><p>Llamadas a servicios externos</p></td></tr><tr class="" id="2106303#-ywvjcj_136"><td id="2106303#-ywvjcj_149"><p><span class="control" id="2106303#-ywvjcj_153">Tiempo de CPU</span></p></td><td id="2106303#-ywvjcj_150"><p><span class="inline-code" id="2106303#-ywvjcj_154">getCpuTime()</span></p></td><td id="2106303#-ywvjcj_151"><p>10,000ms (s&iacute;ncr.) / 60,000ms (as&iacute;ncr.)</p></td><td id="2106303#-ywvjcj_152"><p>Tiempo de procesamiento</p></td></tr><tr class="" id="2106303#-ywvjcj_137"><td id="2106303#-ywvjcj_155"><p><span class="control" id="2106303#-ywvjcj_159">Consultas SOQL</span></p></td><td id="2106303#-ywvjcj_156"><p><span class="inline-code" id="2106303#-ywvjcj_160">getQueries()</span></p></td><td id="2106303#-ywvjcj_157"><p>100 por transacci&oacute;n</p></td><td id="2106303#-ywvjcj_158"><p>Consultas a la base de datos</p></td></tr><tr class="" id="2106303#-ywvjcj_138"><td id="2106303#-ywvjcj_161"><p><span class="control" id="2106303#-ywvjcj_165">Consultas SOSL</span></p></td><td id="2106303#-ywvjcj_162"><p><span class="inline-code" id="2106303#-ywvjcj_166">getSoslQueries()</span></p></td><td id="2106303#-ywvjcj_163"><p>20 por transacci&oacute;n</p></td><td id="2106303#-ywvjcj_164"><p>B&uacute;squedas de texto</p></td></tr></table></div></section><section><h2 id="2106303#ejemplos-de-uso" data-toc="ejemplos-de-uso#Core.md-ejemplos-de-uso">Ejemplos de Uso</h2><section><h3 id="2106303#ejemplo-1-debugging-b-sico" data-toc="ejemplo-1-debugging-b-sico#Core.md-ejemplo-1-debugging-b-sico">Ejemplo 1: Debugging B&aacute;sico</h3><div class="detached code-block" id="2106303#-ywvjcj_172"><pre><code class="language-none">public class ExampleService {
    
    public static void processData(List&lt;Account&gt; accounts) {
        Core.debug('Starting data processing for ' + accounts.size() + ' accounts');
        
        try {
            for (Account acc : accounts) {
                // Procesar cada cuenta
                processAccount(acc);
                Core.debug('Processed account: ' + acc.Name);
            }
            
            Core.debug('Data processing completed successfully');
        } catch (Exception e) {
            Core.debug('Error in data processing: ' + e.getMessage());
            throw e;
        }
    }
    
    private static void processAccount(Account acc) {
        // Lógica de procesamiento
        Core.debug('Processing account with ID: ' + acc.Id);
    }
}

// Uso
List&lt;Account&gt; accounts = [SELECT Id, Name FROM Account LIMIT 10];
ExampleService.processData(accounts);</code></pre></div></section><section><h3 id="2106303#ejemplo-2-monitoreo-de-l-mites-en-procesamiento-por-lotes" data-toc="ejemplo-2-monitoreo-de-l-mites-en-procesamiento-por-lotes#Core.md-ejemplo-2-monitoreo-de-l-mites-en-procesamiento-por-lotes">Ejemplo 2: Monitoreo de L&iacute;mites en Procesamiento por Lotes</h3><div class="detached code-block" id="2106303#-ywvjcj_173"><pre><code class="language-none">public class BatchProcessorWithMonitoring implements Database.Batchable&lt;SObject&gt; {
    
    public Database.QueryLocator start(Database.BatchableContext bc) {
        Core.debug('Starting batch processing');
        Core.getSymmaryLimits(); // Registrar límites iniciales
        
        return Database.getQueryLocator('SELECT Id, Name FROM Account WHERE IsActive__c = true');
    }
    
    public void execute(Database.BatchableContext bc, List&lt;Account&gt; scope) {
        Core.debug('Processing batch of ' + scope.size() + ' records');
        
        // Registrar límites antes del procesamiento
        Core.debug('Limits before processing:');
        Core.debug(Core.getCPUTimeStatistics());
        Core.debug(Core.getSOQLStatistics());
        
        try {
            // Procesar registros
            for (Account acc : scope) {
                processAccount(acc);
                
                // Verificar límites periódicamente
                if (System.Limits.getCpuTime() &gt; 8000) { // 80% del límite
                    Core.debug('CPU time approaching limit: ' + Core.getCPUTimeStatistics());
                }
            }
            
            // Actualizar registros
            update scope;
            
        } catch (Exception e) {
            Core.debug('Error in batch execution: ' + e.getMessage());
            
            // Registrar límites en caso de error
            Core.getSymmaryLimits();
            throw e;
        }
        
        // Registrar límites después del procesamiento
        Core.debug('Limits after processing:');
        Core.getSymmaryLimits();
    }
    
    public void finish(Database.BatchableContext bc) {
        Core.debug('Batch processing completed');
        Core.getSymmaryLimits(); // Registrar límites finales
    }
    
    private void processAccount(Account acc) {
        // Simular procesamiento
        acc.Description = 'Processed at ' + System.now();
    }
}

// Ejecutar el batch
Database.executeBatch(new BatchProcessorWithMonitoring(), 200);</code></pre></div></section><section><h3 id="2106303#ejemplo-3-monitoreo-en-integraciones" data-toc="ejemplo-3-monitoreo-en-integraciones#Core.md-ejemplo-3-monitoreo-en-integraciones">Ejemplo 3: Monitoreo en Integraciones</h3><div class="detached code-block" id="2106303#-ywvjcj_174"><pre><code class="language-none">public class IntegrationServiceWithMonitoring {
    
    public static Map&lt;String, Object&gt; callExternalService(String endpoint, Map&lt;String, Object&gt; payload) {
        Core.debug('Starting external service call to: ' + endpoint);
        
        // Verificar límites antes de la llamada
        Core.debug('Pre-callout limits: ' + Core.getCalloutStatistics());
        
        try {
            // Configurar la solicitud HTTP
            HttpRequest request = new HttpRequest();
            request.setEndpoint(endpoint);
            request.setMethod('POST');
            request.setBody(JSON.serialize(payload));
            request.setHeader('Content-Type', 'application/json');
            
            // Realizar la llamada
            Http http = new Http();
            HttpResponse response = http.send(request);
            
            Core.debug('External service response received. Status: ' + response.getStatusCode());
            
            // Verificar límites después de la llamada
            Core.debug('Post-callout limits: ' + Core.getCalloutStatistics());
            
            // Procesar respuesta
            Map&lt;String, Object&gt; result = new Map&lt;String, Object&gt;{
                'statusCode' =&gt; response.getStatusCode(),
                'body' =&gt; response.getBody(),
                'success' =&gt; response.getStatusCode() == 200
            };
            
            return result;
            
        } catch (Exception e) {
            Core.debug('Error in external service call: ' + e.getMessage());
            
            // Registrar todos los límites en caso de error
            Core.getSymmaryLimits();
            
            throw new IntegrationException('Failed to call external service: ' + e.getMessage(), e);
        }
    }
    
    public class IntegrationException extends Exception {}
}

// Uso
Map&lt;String, Object&gt; payload = new Map&lt;String, Object&gt;{
    'action' =&gt; 'create',
    'data' =&gt; new Map&lt;String, Object&gt;{'name' =&gt; 'Test', 'value' =&gt; 123}
};

Map&lt;String, Object&gt; result = IntegrationServiceWithMonitoring.callExternalService(
    'https://api.example.com/data', 
    payload
);</code></pre></div></section><section><h3 id="2106303#ejemplo-4-utility-class-para-monitoreo-avanzado" data-toc="ejemplo-4-utility-class-para-monitoreo-avanzado#Core.md-ejemplo-4-utility-class-para-monitoreo-avanzado">Ejemplo 4: Utility Class para Monitoreo Avanzado</h3><div class="detached code-block" id="2106303#-ywvjcj_175"><pre><code class="language-none">public class PerformanceMonitor {
    
    private static Map&lt;String, Long&gt; startTimes = new Map&lt;String, Long&gt;();
    
    // Iniciar monitoreo de una operación
    public static void startOperation(String operationName) {
        startTimes.put(operationName, System.currentTimeMillis());
        Core.debug('Started operation: ' + operationName);
        Core.getSymmaryLimits();
    }
    
    // Finalizar monitoreo de una operación
    public static void endOperation(String operationName) {
        Long startTime = startTimes.get(operationName);
        if (startTime != null) {
            Long duration = System.currentTimeMillis() - startTime;
            Core.debug('Completed operation: ' + operationName + ' in ' + duration + 'ms');
            startTimes.remove(operationName);
        }
        Core.getSymmaryLimits();
    }
    
    // Verificar si estamos cerca de los límites
    public static Boolean isApproachingLimits() {
        Boolean approaching = false;
        
        // Verificar CPU (80% del límite)
        if (System.Limits.getCpuTime() &gt; (System.Limits.getLimitCpuTime() * 0.8)) {
            Core.debug('WARNING: Approaching CPU time limit');
            approaching = true;
        }
        
        // Verificar SOQL (80% del límite)
        if (System.Limits.getQueries() &gt; (System.Limits.getLimitQueries() * 0.8)) {
            Core.debug('WARNING: Approaching SOQL queries limit');
            approaching = true;
        }
        
        // Verificar Callouts (80% del límite)
        if (System.Limits.getCallouts() &gt; (System.Limits.getLimitCallouts() * 0.8)) {
            Core.debug('WARNING: Approaching callouts limit');
            approaching = true;
        }
        
        return approaching;
    }
    
    // Generar reporte detallado de uso
    public static String generateUsageReport() {
        List&lt;String&gt; report = new List&lt;String&gt;();
        
        report.add('=== PERFORMANCE USAGE REPORT ===');
        report.add('CPU Time: ' + Core.getCPUTimeStatistics());
        report.add('SOQL Queries: ' + Core.getSOQLStatistics());
        report.add('SOSL Queries: ' + Core.getSOSLStatistics());
        report.add('Callouts: ' + Core.getCalloutStatistics());
        
        // Calcular porcentajes de uso
        Decimal cpuUsagePercent = (Decimal.valueOf(System.Limits.getCpuTime()) / 
                                  System.Limits.getLimitCpuTime() * 100).setScale(2);
        Decimal soqlUsagePercent = (Decimal.valueOf(System.Limits.getQueries()) / 
                                   System.Limits.getLimitQueries() * 100).setScale(2);
        
        report.add('CPU Usage: ' + cpuUsagePercent + '%');
        report.add('SOQL Usage: ' + soqlUsagePercent + '%');
        report.add('================================');
        
        String fullReport = String.join(report, '\n');
        Core.debug(fullReport);
        
        return fullReport;
    }
}

// Uso del monitor de rendimiento
PerformanceMonitor.startOperation('DataMigration');

try {
    // Realizar operaciones
    List&lt;Account&gt; accounts = [SELECT Id, Name FROM Account LIMIT 1000];
    
    for (Account acc : accounts) {
        acc.Description = 'Updated at ' + System.now();
        
        // Verificar límites periódicamente
        if (PerformanceMonitor.isApproachingLimits()) {
            Core.debug('Pausing operation due to approaching limits');
            break;
        }
    }
    
    update accounts;
    
} finally {
    PerformanceMonitor.endOperation('DataMigration');
    PerformanceMonitor.generateUsageReport();
}</code></pre></div></section><section><h3 id="2106303#ejemplo-5-debugging-en-triggers" data-toc="ejemplo-5-debugging-en-triggers#Core.md-ejemplo-5-debugging-en-triggers">Ejemplo 5: Debugging en Triggers</h3><div class="detached code-block" id="2106303#-ywvjcj_176"><pre><code class="language-none">public class AccountTriggerHandler {
    
    public static void handleAfterInsert(List&lt;Account&gt; newAccounts) {
        Core.debug('AccountTriggerHandler.handleAfterInsert started for ' + newAccounts.size() + ' accounts');
        
        try {
            // Verificar límites antes del procesamiento
            if (System.Limits.getQueries() &gt; 80) { // Cerca del límite de 100
                Core.debug('WARNING: High SOQL usage detected: ' + Core.getSOQLStatistics());
            }
            
            // Procesar cuentas
            for (Account acc : newAccounts) {
                processNewAccount(acc);
            }
            
            Core.debug('AccountTriggerHandler.handleAfterInsert completed successfully');
            
        } catch (Exception e) {
            Core.debug('Error in AccountTriggerHandler.handleAfterInsert: ' + e.getMessage());
            
            // Registrar límites en caso de error para debugging
            Core.getSymmaryLimits();
            
            throw e;
        }
    }
    
    private static void processNewAccount(Account acc) {
        Core.debug('Processing new account: ' + acc.Name + ' (ID: ' + acc.Id + ')');
        
        // Lógica de procesamiento específica
        // ...
    }
}</code></pre></div></section></section><section><h2 id="2106303#uso-en-el-framework-foundation" data-toc="uso-en-el-framework-foundation#Core.md-uso-en-el-framework-foundation">Uso en el Framework Foundation</h2><p id="2106303#-ywvjcj_177">La clase <span class="inline-code" id="2106303#-ywvjcj_179">Core</span> es utilizada extensivamente en todo el framework Foundation de Suratech:</p><ul class="list" id="2106303#-ywvjcj_178" start="1"><li class="list-item" id="2106303#-ywvjcj_180"><p><span class="control" id="2106303#-ywvjcj_185">EventLogManager</span>: Para debugging de operaciones de logs</p></li><li class="list-item" id="2106303#-ywvjcj_181"><p><span class="control" id="2106303#-ywvjcj_186">GenerateURLServiceHandler</span>: Para debugging de procesos de integraci&oacute;n</p></li><li class="list-item" id="2106303#-ywvjcj_182"><p><span class="control" id="2106303#-ywvjcj_187">CCMServiceHandler</span>: Para debugging de comunicaciones CCM</p></li><li class="list-item" id="2106303#-ywvjcj_183"><p><span class="control" id="2106303#-ywvjcj_188">FoundationEventLogController</span>: Para debugging de operaciones del controlador</p></li><li class="list-item" id="2106303#-ywvjcj_184"><p><span class="control" id="2106303#-ywvjcj_189">QuoteUtils</span>: Para debugging de operaciones de cotizaci&oacute;n</p></li></ul></section><section><h2 id="2106303#mejores-pr-cticas-para-su-uso" data-toc="mejores-pr-cticas-para-su-uso#Core.md-mejores-pr-cticas-para-su-uso">Mejores Pr&aacute;cticas para su Uso</h2><ol class="list list-decimal" id="2106303#-ywvjcj_190" type="1" start="1"><li class="list-item" id="2106303#-ywvjcj_191"><p id="2106303#-ywvjcj_196"><span class="control" id="2106303#-ywvjcj_197">Debugging Consistente</span>: Utilizar <span class="inline-code" id="2106303#-ywvjcj_198">Core.debug()</span> en lugar de <span class="inline-code" id="2106303#-ywvjcj_199">System.debug()</span> directo para mantener consistencia en el formato de logs.</p></li><li class="list-item" id="2106303#-ywvjcj_192"><p id="2106303#-ywvjcj_200"><span class="control" id="2106303#-ywvjcj_201">Monitoreo Proactivo</span>: Usar los m&eacute;todos de estad&iacute;sticas para monitorear l&iacute;mites antes de que se alcancen.</p></li><li class="list-item" id="2106303#-ywvjcj_193"><p id="2106303#-ywvjcj_202"><span class="control" id="2106303#-ywvjcj_203">Logging en Puntos Cr&iacute;ticos</span>: Registrar estad&iacute;sticas al inicio y fin de operaciones complejas.</p></li><li class="list-item" id="2106303#-ywvjcj_194"><p id="2106303#-ywvjcj_204"><span class="control" id="2106303#-ywvjcj_205">Manejo de Errores</span>: Incluir <span class="inline-code" id="2106303#-ywvjcj_206">Core.getSymmaryLimits()</span> en bloques catch para facilitar el debugging.</p></li><li class="list-item" id="2106303#-ywvjcj_195"><p id="2106303#-ywvjcj_207"><span class="control" id="2106303#-ywvjcj_208">Verificaci&oacute;n Peri&oacute;dica</span>: En bucles largos, verificar l&iacute;mites peri&oacute;dicamente para evitar excepciones.</p></li></ol></section><section><h2 id="2106303#consideraciones-de-rendimiento" data-toc="consideraciones-de-rendimiento#Core.md-consideraciones-de-rendimiento">Consideraciones de Rendimiento</h2><ol class="list list-decimal" id="2106303#-ywvjcj_209" type="1" start="1"><li class="list-item" id="2106303#-ywvjcj_210"><p id="2106303#-ywvjcj_213"><span class="control" id="2106303#-ywvjcj_214">Overhead M&iacute;nimo</span>: Los m&eacute;todos de la clase <span class="inline-code" id="2106303#-ywvjcj_215">Core</span> tienen overhead m&iacute;nimo y pueden usarse liberalmente.</p></li><li class="list-item" id="2106303#-ywvjcj_211"><p id="2106303#-ywvjcj_216"><span class="control" id="2106303#-ywvjcj_217">Frecuencia de Llamadas</span>: Los m&eacute;todos de estad&iacute;sticas pueden llamarse frecuentemente sin impacto significativo.</p></li><li class="list-item" id="2106303#-ywvjcj_212"><p id="2106303#-ywvjcj_218"><span class="control" id="2106303#-ywvjcj_219">Nivel de Logging</span>: <span class="inline-code" id="2106303#-ywvjcj_220">LoggingLevel.FINEST</span> puede ser filtrado en producci&oacute;n seg&uacute;n la configuraci&oacute;n de logging.</p></li></ol></section><section><h2 id="2106303#posibles-mejoras" data-toc="posibles-mejoras#Core.md-posibles-mejoras">Posibles Mejoras</h2><section><h3 id="2106303#correcci-n-del-error-tipogr-fico" data-toc="correcci-n-del-error-tipogr-fico#Core.md-correcci-n-del-error-tipogr-fico">Correcci&oacute;n del Error Tipogr&aacute;fico</h3><div class="detached code-block" id="2106303#-ywvjcj_223"><pre><code class="language-none">// Método corregido
global static void getSummaryLimits() {
  Core.debug(
    '===== Statistics(' +
      Core.getCPUTimeStatistics() +
      ',' +
      Core.getSOQLStatistics() +
      ',' +
      Core.getSOSLStatistics() +
      ',' +
      Core.getCalloutStatistics() +
      ') ====='
  );
}</code></pre></div></section><section><h3 id="2106303#extensi-n-con-m-todos-adicionales" data-toc="extensi-n-con-m-todos-adicionales#Core.md-extensi-n-con-m-todos-adicionales">Extensi&oacute;n con M&eacute;todos Adicionales</h3><div class="detached code-block" id="2106303#-ywvjcj_224"><pre><code class="language-none">// Métodos adicionales que podrían añadirse
global static String getDMLStatistics() {
  return 'DML statements usage=' +
    System.Limits.getDMLStatements() +
    '/' +
    System.Limits.getLimitDMLStatements();
}

global static String getHeapSizeStatistics() {
  return 'Heap size usage=' +
    System.Limits.getHeapSize() +
    '/' +
    System.Limits.getLimitHeapSize();
}

global static Boolean isApproachingAnyLimit(Integer thresholdPercent) {
  // Lógica para verificar si algún límite está cerca del threshold
  return false; // Implementación simplificada
}</code></pre></div></section></section><section><h2 id="2106303#notas-adicionales" data-toc="notas-adicionales#Core.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="2106303#-ywvjcj_225" type="1" start="1"><li class="list-item" id="2106303#-ywvjcj_226"><p id="2106303#-ywvjcj_231"><span class="control" id="2106303#-ywvjcj_232">Clase Fundamental</span>: Esta es una clase fundamental del framework que es utilizada por pr&aacute;cticamente todas las dem&aacute;s clases del sistema.</p></li><li class="list-item" id="2106303#-ywvjcj_227"><p id="2106303#-ywvjcj_233"><span class="control" id="2106303#-ywvjcj_234">Logging Centralizado</span>: Proporciona un punto central para el logging, facilitando cambios futuros en la estrategia de logging.</p></li><li class="list-item" id="2106303#-ywvjcj_228"><p id="2106303#-ywvjcj_235"><span class="control" id="2106303#-ywvjcj_236">Monitoreo de Rendimiento</span>: Esencial para el monitoreo de rendimiento y la prevenci&oacute;n de errores por l&iacute;mites del sistema.</p></li><li class="list-item" id="2106303#-ywvjcj_229"><p id="2106303#-ywvjcj_237"><span class="control" id="2106303#-ywvjcj_238">Simplicidad Intencional</span>: La simplicidad de la clase es intencional, proporcionando funcionalidad b&aacute;sica pero esencial de forma confiable.</p></li><li class="list-item" id="2106303#-ywvjcj_230"><p id="2106303#-ywvjcj_239"><span class="control" id="2106303#-ywvjcj_240">Sin Dependencias</span>: No depende de otras clases del framework, asegurando que siempre est&eacute; disponible para uso.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-149877873">BaseProcessManager</h1><section><h2 id="-149877873#descripci-n-general" data-toc="descripci-n-general#BaseProcessManager.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-149877873#okrlml_14">Clase global que act&uacute;a como el gestor principal de procesos en el sistema Foundation. Implementa el patr&oacute;n Chain of Responsibility para ejecutar secuencias de <span class="inline-code" id="-149877873#okrlml_15">ProductHandler</span> organizados por etapas (stages), con soporte opcional para cache y manejo din&aacute;mico de configuraciones.</p></section><section><h2 id="-149877873#informaci-n-de-la-clase" data-toc="informaci-n-de-la-clase#BaseProcessManager.md-informaci-n-de-la-clase">Informaci&oacute;n de la Clase</h2><ul class="list" id="-149877873#okrlml_16" start="1"><li class="list-item" id="-149877873#okrlml_17"><p><span class="control" id="-149877873#okrlml_22">Autor:</span> Jean Carlos Melendez</p></li><li class="list-item" id="-149877873#okrlml_18"><p><span class="control" id="-149877873#okrlml_23">&Uacute;ltima modificaci&oacute;n:</span> 04-01-2025</p></li><li class="list-item" id="-149877873#okrlml_19"><p><span class="control" id="-149877873#okrlml_24">Modificado por:</span> fabian.lopez@nespon.com</p></li><li class="list-item" id="-149877873#okrlml_20"><p><span class="control" id="-149877873#okrlml_25">Tipo:</span> Clase global con sharing</p></li><li class="list-item" id="-149877873#okrlml_21"><p><span class="control" id="-149877873#okrlml_26">Prop&oacute;sito:</span> Gestor centralizado de procesos y cadenas de responsabilidad</p></li></ul></section><section><h2 id="-149877873#m-todo-principal" data-toc="m-todo-principal#BaseProcessManager.md-m-todo-principal">M&eacute;todo Principal</h2><section><h3 id="-149877873#invoke-m-todo-est-tico-global" data-toc="invoke-m-todo-est-tico-global#BaseProcessManager.md-invoke-m-todo-est-tico-global">invoke (M&eacute;todo Est&aacute;tico Global)</h3><div class="detached code-block" id="-149877873#okrlml_28"><pre><code class="language-none">global static Boolean invoke(
    String stage,
    Map&lt;String, Object&gt; options,
    Map&lt;String, Object&gt; input,
    Map&lt;String, Object&gt; output
)</code></pre></div><p id="-149877873#okrlml_29"><span class="control" id="-149877873#okrlml_36">Descripci&oacute;n:</span> M&eacute;todo principal que ejecuta una cadena de procesos para una etapa espec&iacute;fica, construyendo din&aacute;micamente la cadena de responsabilidad y ejecut&aacute;ndola.</p><p id="-149877873#okrlml_30"><span class="control" id="-149877873#okrlml_37">Par&aacute;metros:</span></p><ul class="list" id="-149877873#okrlml_31" start="1"><li class="list-item" id="-149877873#okrlml_38"><p><span class="inline-code" id="-149877873#okrlml_42">stage</span> (String): Etapa del proceso a ejecutar, debe existir en <span class="inline-code" id="-149877873#okrlml_43">SF_MainProcess__mdt.Stage__c</span></p></li><li class="list-item" id="-149877873#okrlml_39"><p><span class="inline-code" id="-149877873#okrlml_44">options</span> (Map&lt;String, Object&gt;): Opciones de configuraci&oacute;n para el proceso</p></li><li class="list-item" id="-149877873#okrlml_40"><p><span class="inline-code" id="-149877873#okrlml_45">input</span> (Map&lt;String, Object&gt;): Datos de entrada para el proceso</p></li><li class="list-item" id="-149877873#okrlml_41"><p><span class="inline-code" id="-149877873#okrlml_46">output</span> (Map&lt;String, Object&gt;): Mapa donde se almacenar&aacute;n los resultados del proceso</p></li></ul><p id="-149877873#okrlml_32"><span class="control" id="-149877873#okrlml_47">Retorna:</span></p><ul class="list" id="-149877873#okrlml_33" start="1"><li class="list-item" id="-149877873#okrlml_48"><p><span class="inline-code" id="-149877873#okrlml_49">Boolean</span>: Siempre retorna <span class="inline-code" id="-149877873#okrlml_50">true</span> si la ejecuci&oacute;n es exitosa</p></li></ul><p id="-149877873#okrlml_34"><span class="control" id="-149877873#okrlml_51">Excepciones:</span></p><ul class="list" id="-149877873#okrlml_35" start="1"><li class="list-item" id="-149877873#okrlml_52"><p><span class="inline-code" id="-149877873#okrlml_53">ProcessManagerNotFoundException</span>: Se lanza cuando el stage no existe en los metadatos</p></li></ul></section></section><section><h2 id="-149877873#flujo-de-ejecuci-n-detallado" data-toc="flujo-de-ejecuci-n-detallado#BaseProcessManager.md-flujo-de-ejecuci-n-detallado">Flujo de Ejecuci&oacute;n Detallado</h2><section><h3 id="-149877873#1-validaci-n-de-stage" data-toc="1-validaci-n-de-stage#BaseProcessManager.md-1-validaci-n-de-stage">1. Validaci&oacute;n de Stage</h3><div class="detached code-block" id="-149877873#okrlml_60"><pre><code class="language-none">if (!CorePicklistUtils.containsVal(SF_MainProcess__mdt.Stage__c, stage))</code></pre></div><ul class="list" id="-149877873#okrlml_61" start="1"><li class="list-item" id="-149877873#okrlml_62"><p>Valida que el stage exista en el Custom Metadata Type <span class="inline-code" id="-149877873#okrlml_65">SF_MainProcess__mdt</span></p></li><li class="list-item" id="-149877873#okrlml_63"><p>Utiliza <span class="inline-code" id="-149877873#okrlml_66">CorePicklistUtils</span> para verificar valores v&aacute;lidos</p></li><li class="list-item" id="-149877873#okrlml_64"><p>Lanza excepci&oacute;n si el stage no es v&aacute;lido</p></li></ul></section><section><h3 id="-149877873#2-evaluaci-n-de-cache" data-toc="2-evaluaci-n-de-cache#BaseProcessManager.md-2-evaluaci-n-de-cache">2. Evaluaci&oacute;n de Cache</h3><div class="detached code-block" id="-149877873#okrlml_67"><pre><code class="language-none">FeatureFlag__mdt flag = [
    SELECT Is_Active__c
    FROM FeatureFlag__mdt
    WHERE DeveloperName = 'sura_foundation_cache'
    LIMIT 1
];
cacheEnabled = flag.Is_Active__c;</code></pre></div><p id="-149877873#okrlml_68"><span class="control" id="-149877873#okrlml_70">Comportamiento:</span></p><ul class="list" id="-149877873#okrlml_69" start="1"><li class="list-item" id="-149877873#okrlml_71"><p>Consulta el feature flag <span class="inline-code" id="-149877873#okrlml_75">sura_foundation_cache</span></p></li><li class="list-item" id="-149877873#okrlml_72"><p>Si existe y est&aacute; activo, habilita el cache</p></li><li class="list-item" id="-149877873#okrlml_73"><p>En caso de excepci&oacute;n (flag no existe), deshabilita el cache</p></li><li class="list-item" id="-149877873#okrlml_74"><p>Establece <span class="inline-code" id="-149877873#okrlml_76">ignoreCache = !cacheEnabled</span></p></li></ul></section><section><h3 id="-149877873#3-construcci-n-de-la-cadena-de-responsabilidad" data-toc="3-construcci-n-de-la-cadena-de-responsabilidad#BaseProcessManager.md-3-construcci-n-de-la-cadena-de-responsabilidad">3. Construcci&oacute;n de la Cadena de Responsabilidad</h3><div class="detached code-block" id="-149877873#okrlml_77"><pre><code class="language-none">ReverseIterator reverseIterator = new ReverseIterator(
    ((List&lt;ProductHandler&gt;) ProcessFactory.newInstances(
        ProcessFactory.getAllDefinitionsByStage(stage, ignoreCache)
    ))
);</code></pre></div><p id="-149877873#okrlml_78"><span class="control" id="-149877873#okrlml_80">Proceso:</span></p><ol class="list list-decimal" id="-149877873#okrlml_79" type="1" start="1"><li class="list-item" id="-149877873#okrlml_81"><p><span class="inline-code" id="-149877873#okrlml_84">ProcessFactory.getAllDefinitionsByStage(stage, ignoreCache)</span> obtiene definiciones</p></li><li class="list-item" id="-149877873#okrlml_82"><p><span class="inline-code" id="-149877873#okrlml_85">ProcessFactory.newInstances()</span> crea instancias de <span class="inline-code" id="-149877873#okrlml_86">ProductHandler</span></p></li><li class="list-item" id="-149877873#okrlml_83"><p><span class="inline-code" id="-149877873#okrlml_87">ReverseIterator</span> invierte el orden para construcci&oacute;n correcta de la cadena</p></li></ol></section><section><h3 id="-149877873#4-enlazado-de-handlers-chain-building" data-toc="4-enlazado-de-handlers-chain-building#BaseProcessManager.md-4-enlazado-de-handlers-chain-building">4. Enlazado de Handlers (Chain Building)</h3><div class="detached code-block" id="-149877873#okrlml_88"><pre><code class="language-none">ProductHandler previous = (ProductHandler) reverseIterator.next();

while (reverseIterator.hasNext()) {
    ProductHandler current = (ProductHandler) reverseIterator.next();
    current.setNext(previous);
    previous = current;
}</code></pre></div><p id="-149877873#okrlml_89"><span class="control" id="-149877873#okrlml_91">Algoritmo:</span></p><ul class="list" id="-149877873#okrlml_90" start="1"><li class="list-item" id="-149877873#okrlml_92"><p>Itera en reversa para construir la cadena correctamente</p></li><li class="list-item" id="-149877873#okrlml_93"><p>Cada handler actual apunta al anterior como <span class="inline-code" id="-149877873#okrlml_95">next</span></p></li><li class="list-item" id="-149877873#okrlml_94"><p>El resultado es una cadena donde el primer handler procesar&aacute; toda la secuencia</p></li></ul></section><section><h3 id="-149877873#5-ejecuci-n-de-la-cadena" data-toc="5-ejecuci-n-de-la-cadena#BaseProcessManager.md-5-ejecuci-n-de-la-cadena">5. Ejecuci&oacute;n de la Cadena</h3><div class="detached code-block" id="-149877873#okrlml_96"><pre><code class="language-none">((ProductHandler) reverseIterator.first()).apply(options, input, output);</code></pre></div><ul class="list" id="-149877873#okrlml_97" start="1"><li class="list-item" id="-149877873#okrlml_98"><p>Ejecuta el primer handler de la cadena</p></li><li class="list-item" id="-149877873#okrlml_99"><p>Cada handler decide si procesar y/o pasar al siguiente</p></li><li class="list-item" id="-149877873#okrlml_100"><p>Los datos fluyen a trav&eacute;s de <span class="inline-code" id="-149877873#okrlml_101">options</span>, <span class="inline-code" id="-149877873#okrlml_102">input</span> y <span class="inline-code" id="-149877873#okrlml_103">output</span></p></li></ul></section><section><h3 id="-149877873#6-finalizaci-n-y-logging" data-toc="6-finalizaci-n-y-logging#BaseProcessManager.md-6-finalizaci-n-y-logging">6. Finalizaci&oacute;n y Logging</h3><div class="detached code-block" id="-149877873#okrlml_104"><pre><code class="language-none">System.debug(output);
System.debug('finalizar proceso baseprocess');
Core.getSymmaryLimits();</code></pre></div><ul class="list" id="-149877873#okrlml_105" start="1"><li class="list-item" id="-149877873#okrlml_106"><p>Registra el output final en debug</p></li><li class="list-item" id="-149877873#okrlml_107"><p>Ejecuta <span class="inline-code" id="-149877873#okrlml_109">Core.getSymmaryLimits()</span> para monitoreo de l&iacute;mites</p></li><li class="list-item" id="-149877873#okrlml_108"><p>Retorna <span class="inline-code" id="-149877873#okrlml_110">true</span> indicando ejecuci&oacute;n exitosa</p></li></ul></section></section><section><h2 id="-149877873#patrones-de-dise-o-implementados" data-toc="patrones-de-dise-o-implementados#BaseProcessManager.md-patrones-de-dise-o-implementados">Patrones de Dise&ntilde;o Implementados</h2><section><h3 id="-149877873#chain-of-responsibility" data-toc="chain-of-responsibility#BaseProcessManager.md-chain-of-responsibility">Chain of Responsibility</h3><ul class="list" id="-149877873#okrlml_114" start="1"><li class="list-item" id="-149877873#okrlml_115"><p><span class="control" id="-149877873#okrlml_118">Prop&oacute;sito:</span> Permite que m&uacute;ltiples objetos manejen una solicitud sin acoplar el emisor con los receptores</p></li><li class="list-item" id="-149877873#okrlml_116"><p><span class="control" id="-149877873#okrlml_119">Implementaci&oacute;n:</span> Cada <span class="inline-code" id="-149877873#okrlml_120">ProductHandler</span> puede procesar la solicitud y/o pasarla al siguiente</p></li><li class="list-item" id="-149877873#okrlml_117"><p><span class="control" id="-149877873#okrlml_121">Ventajas:</span> Flexibilidad para agregar/remover handlers din&aacute;micamente</p></li></ul></section><section><h3 id="-149877873#factory-pattern" data-toc="factory-pattern#BaseProcessManager.md-factory-pattern">Factory Pattern</h3><ul class="list" id="-149877873#okrlml_122" start="1"><li class="list-item" id="-149877873#okrlml_123"><p><span class="control" id="-149877873#okrlml_125">Uso:</span> <span class="inline-code" id="-149877873#okrlml_126">ProcessFactory</span> para crear instancias de handlers</p></li><li class="list-item" id="-149877873#okrlml_124"><p><span class="control" id="-149877873#okrlml_127">Beneficio:</span> Centraliza la l&oacute;gica de creaci&oacute;n e instanciaci&oacute;n</p></li></ul></section><section><h3 id="-149877873#iterator-pattern" data-toc="iterator-pattern#BaseProcessManager.md-iterator-pattern">Iterator Pattern</h3><ul class="list" id="-149877873#okrlml_128" start="1"><li class="list-item" id="-149877873#okrlml_129"><p><span class="control" id="-149877873#okrlml_131">Implementaci&oacute;n:</span> <span class="inline-code" id="-149877873#okrlml_132">ReverseIterator</span> para navegaci&oacute;n controlada</p></li><li class="list-item" id="-149877873#okrlml_130"><p><span class="control" id="-149877873#okrlml_133">Prop&oacute;sito:</span> Facilita la construcci&oacute;n correcta de la cadena</p></li></ul></section></section><section><h2 id="-149877873#componentes-y-dependencias" data-toc="componentes-y-dependencias#BaseProcessManager.md-componentes-y-dependencias">Componentes y Dependencias</h2><section><h3 id="-149877873#dependencias-principales" data-toc="dependencias-principales#BaseProcessManager.md-dependencias-principales">Dependencias Principales</h3><ul class="list" id="-149877873#okrlml_136" start="1"><li class="list-item" id="-149877873#okrlml_137"><p><span class="control" id="-149877873#okrlml_144">SF_MainProcess__mdt:</span> Custom Metadata Type para definici&oacute;n de stages</p></li><li class="list-item" id="-149877873#okrlml_138"><p><span class="control" id="-149877873#okrlml_145">FeatureFlag__mdt:</span> Para control de cache (<span class="inline-code" id="-149877873#okrlml_146">sura_foundation_cache</span>)</p></li><li class="list-item" id="-149877873#okrlml_139"><p><span class="control" id="-149877873#okrlml_147">ProcessFactory:</span> Factory para creaci&oacute;n de handlers</p></li><li class="list-item" id="-149877873#okrlml_140"><p><span class="control" id="-149877873#okrlml_148">ProductHandler:</span> Clase base para handlers de la cadena</p></li><li class="list-item" id="-149877873#okrlml_141"><p><span class="control" id="-149877873#okrlml_149">ReverseIterator:</span> Iterador personalizado para construcci&oacute;n de cadena</p></li><li class="list-item" id="-149877873#okrlml_142"><p><span class="control" id="-149877873#okrlml_150">CorePicklistUtils:</span> Utilidades para validaci&oacute;n de picklist values</p></li><li class="list-item" id="-149877873#okrlml_143"><p><span class="control" id="-149877873#okrlml_151">Core:</span> Utilidades del sistema (l&iacute;mites, debugging)</p></li></ul></section><section><h3 id="-149877873#excepciones-personalizadas" data-toc="excepciones-personalizadas#BaseProcessManager.md-excepciones-personalizadas">Excepciones Personalizadas</h3><ul class="list" id="-149877873#okrlml_152" start="1"><li class="list-item" id="-149877873#okrlml_153"><p><span class="control" id="-149877873#okrlml_154">ProcessManagerNotFoundException:</span> Excepci&oacute;n espec&iacute;fica para stages no encontrados</p></li></ul></section></section><section><h2 id="-149877873#configuraci-n-del-sistema" data-toc="configuraci-n-del-sistema#BaseProcessManager.md-configuraci-n-del-sistema">Configuraci&oacute;n del Sistema</h2><section><h3 id="-149877873#feature-flags-utilizados" data-toc="feature-flags-utilizados#BaseProcessManager.md-feature-flags-utilizados">Feature Flags Utilizados</h3><ul class="list" id="-149877873#okrlml_157" start="1"><li class="list-item" id="-149877873#okrlml_158"><p><span class="inline-code" id="-149877873#okrlml_159">sura_foundation_cache</span>: Controla si el cache est&aacute; habilitado para el sistema</p></li></ul></section><section><h3 id="-149877873#custom-metadata-types" data-toc="custom-metadata-types#BaseProcessManager.md-custom-metadata-types">Custom Metadata Types</h3><ul class="list" id="-149877873#okrlml_160" start="1"><li class="list-item" id="-149877873#okrlml_161"><p><span class="inline-code" id="-149877873#okrlml_163">SF_MainProcess__mdt</span>: Define los stages disponibles y sus configuraciones</p></li><li class="list-item" id="-149877873#okrlml_162"><p><span class="inline-code" id="-149877873#okrlml_164">FeatureFlag__mdt</span>: Configuraci&oacute;n de feature flags del sistema</p></li></ul></section></section><section><h2 id="-149877873#casos-de-uso" data-toc="casos-de-uso#BaseProcessManager.md-casos-de-uso">Casos de Uso</h2><section><h3 id="-149877873#procesamiento-de-rdenes" data-toc="procesamiento-de-rdenes#BaseProcessManager.md-procesamiento-de-rdenes">Procesamiento de &Oacute;rdenes</h3><div class="detached code-block" id="-149877873#okrlml_168"><pre><code class="language-none">Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{'orderId' =&gt; '123'};
Map&lt;String, Object&gt; output = new Map&lt;String, Object&gt;();
Map&lt;String, Object&gt; options = new Map&lt;String, Object&gt;{'validateOnly' =&gt; false};

BaseProcessManager.invoke('ORDER_PROCESSING', options, input, output);</code></pre></div></section><section><h3 id="-149877873#validaci-n-de-datos" data-toc="validaci-n-de-datos#BaseProcessManager.md-validaci-n-de-datos">Validaci&oacute;n de Datos</h3><div class="detached code-block" id="-149877873#okrlml_169"><pre><code class="language-none">BaseProcessManager.invoke('DATA_VALIDATION', options, inputData, results);</code></pre></div></section><section><h3 id="-149877873#integraci-n-con-sistemas-externos" data-toc="integraci-n-con-sistemas-externos#BaseProcessManager.md-integraci-n-con-sistemas-externos">Integraci&oacute;n con Sistemas Externos</h3><div class="detached code-block" id="-149877873#okrlml_170"><pre><code class="language-none">BaseProcessManager.invoke('EXTERNAL_INTEGRATION', config, requestData, responseData);</code></pre></div></section></section><section><h2 id="-149877873#ventajas-del-dise-o" data-toc="ventajas-del-dise-o#BaseProcessManager.md-ventajas-del-dise-o">Ventajas del Dise&ntilde;o</h2><section><h3 id="-149877873#flexibilidad" data-toc="flexibilidad#BaseProcessManager.md-flexibilidad">Flexibilidad</h3><ul class="list" id="-149877873#okrlml_175" start="1"><li class="list-item" id="-149877873#okrlml_176"><p>Configuraci&oacute;n din&aacute;mica de handlers por stage</p></li><li class="list-item" id="-149877873#okrlml_177"><p>Soporte para cache configurable</p></li><li class="list-item" id="-149877873#okrlml_178"><p>F&aacute;cil adici&oacute;n/remoci&oacute;n de pasos del proceso</p></li></ul></section><section><h3 id="-149877873#mantenibilidad" data-toc="mantenibilidad#BaseProcessManager.md-mantenibilidad">Mantenibilidad</h3><ul class="list" id="-149877873#okrlml_179" start="1"><li class="list-item" id="-149877873#okrlml_180"><p>Separaci&oacute;n clara de responsabilidades</p></li><li class="list-item" id="-149877873#okrlml_181"><p>Configuraci&oacute;n basada en metadata</p></li><li class="list-item" id="-149877873#okrlml_182"><p>Logging integrado para debugging</p></li></ul></section><section><h3 id="-149877873#performance" data-toc="performance#BaseProcessManager.md-performance">Performance</h3><ul class="list" id="-149877873#okrlml_183" start="1"><li class="list-item" id="-149877873#okrlml_184"><p>Cache opcional para mejorar rendimiento</p></li><li class="list-item" id="-149877873#okrlml_185"><p>Factory pattern para optimizaci&oacute;n de instanciaci&oacute;n</p></li><li class="list-item" id="-149877873#okrlml_186"><p>Monitoreo de l&iacute;mites integrado</p></li></ul></section><section><h3 id="-149877873#escalabilidad" data-toc="escalabilidad#BaseProcessManager.md-escalabilidad">Escalabilidad</h3><ul class="list" id="-149877873#okrlml_187" start="1"><li class="list-item" id="-149877873#okrlml_188"><p>Soporte para m&uacute;ltiples stages</p></li><li class="list-item" id="-149877873#okrlml_189"><p>Handlers reutilizables entre diferentes procesos</p></li><li class="list-item" id="-149877873#okrlml_190"><p>Configuraci&oacute;n sin c&oacute;digo a trav&eacute;s de metadata</p></li></ul></section></section><section><h2 id="-149877873#consideraciones-de-performance" data-toc="consideraciones-de-performance#BaseProcessManager.md-consideraciones-de-performance">Consideraciones de Performance</h2><section><h3 id="-149877873#cache-management" data-toc="cache-management#BaseProcessManager.md-cache-management">Cache Management</h3><ul class="list" id="-149877873#okrlml_193" start="1"><li class="list-item" id="-149877873#okrlml_194"><p>Feature flag <span class="inline-code" id="-149877873#okrlml_197">sura_foundation_cache</span> controla el uso de cache</p></li><li class="list-item" id="-149877873#okrlml_195"><p>Cache puede mejorar significativamente la performance en procesos frecuentes</p></li><li class="list-item" id="-149877873#okrlml_196"><p>Considerar el impacto de memory vs. processing time</p></li></ul></section><section><h3 id="-149877873#l-mites-de-salesforce" data-toc="l-mites-de-salesforce#BaseProcessManager.md-l-mites-de-salesforce">L&iacute;mites de Salesforce</h3><ul class="list" id="-149877873#okrlml_198" start="1"><li class="list-item" id="-149877873#okrlml_199"><p><span class="inline-code" id="-149877873#okrlml_202">Core.getSymmaryLimits()</span> monitorea el uso de l&iacute;mites</p></li><li class="list-item" id="-149877873#okrlml_200"><p>Importante para procesos que consumen muchos recursos</p></li><li class="list-item" id="-149877873#okrlml_201"><p>Permite identificar cuellos de botella</p></li></ul></section></section><section><h2 id="-149877873#mejoras-potenciales" data-toc="mejoras-potenciales#BaseProcessManager.md-mejoras-potenciales">Mejoras Potenciales</h2><ul class="list" id="-149877873#okrlml_203" start="1"><li class="list-item" id="-149877873#okrlml_204"><p>Implementar retry logic para procesos fallidos</p></li><li class="list-item" id="-149877873#okrlml_205"><p>Agregar m&eacute;tricas de performance por handler</p></li><li class="list-item" id="-149877873#okrlml_206"><p>Soporte para procesamiento as&iacute;ncrono (Queueable/Batch)</p></li><li class="list-item" id="-149877873#okrlml_207"><p>Implementar circuit breaker pattern para handlers problem&aacute;ticos</p></li><li class="list-item" id="-149877873#okrlml_208"><p>Agregar validaci&oacute;n de tipos para input/output maps</p></li><li class="list-item" id="-149877873#okrlml_209"><p>Soporte para handlers condicionales basados en datos de entrada</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1701264068">BaseProcessFoundationVlocityAdapter</h1><section><h2 id="-1701264068#descripci-n-general" data-toc="descripci-n-general#BaseProcessFoundationVlocityAdapter.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-1701264068#nzvxxe_12">Clase abstracta global que act&uacute;a como adaptador entre el framework de Vlocity y el sistema de gesti&oacute;n de procesos base (<span class="inline-code" id="-1701264068#nzvxxe_13">BaseProcessManager</span>). Proporciona una interfaz estandarizada para invocar procesos a trav&eacute;s de diferentes etapas del flujo de trabajo.</p></section><section><h2 id="-1701264068#informaci-n-de-la-clase" data-toc="informaci-n-de-la-clase#BaseProcessFoundationVlocityAdapter.md-informaci-n-de-la-clase">Informaci&oacute;n de la Clase</h2><ul class="list" id="-1701264068#nzvxxe_14" start="1"><li class="list-item" id="-1701264068#nzvxxe_15"><p><span class="control" id="-1701264068#nzvxxe_20">Autor:</span> Jean Carlos Melendez</p></li><li class="list-item" id="-1701264068#nzvxxe_16"><p><span class="control" id="-1701264068#nzvxxe_21">&Uacute;ltima modificaci&oacute;n:</span> 03-31-2025</p></li><li class="list-item" id="-1701264068#nzvxxe_17"><p><span class="control" id="-1701264068#nzvxxe_22">Modificado por:</span> Jean Carlos Melendez</p></li><li class="list-item" id="-1701264068#nzvxxe_18"><p><span class="control" id="-1701264068#nzvxxe_23">Tipo:</span> Clase abstracta global</p></li><li class="list-item" id="-1701264068#nzvxxe_19"><p><span class="control" id="-1701264068#nzvxxe_24">Prop&oacute;sito:</span> Adaptador para integraci&oacute;n Vlocity-BaseProcessManager</p></li></ul></section><section><h2 id="-1701264068#m-todos" data-toc="m-todos#BaseProcessFoundationVlocityAdapter.md-m-todos">M&eacute;todos</h2><section><h3 id="-1701264068#applyinvoke-m-todo-est-tico" data-toc="applyinvoke-m-todo-est-tico#BaseProcessFoundationVlocityAdapter.md-applyinvoke-m-todo-est-tico">applyInvoke (M&eacute;todo Est&aacute;tico)</h3><div class="detached code-block" id="-1701264068#nzvxxe_27"><pre><code class="language-none">global static Boolean applyInvoke(
    Map&lt;String, Object&gt; inputMap,
    Map&lt;String, Object&gt; outputMap,
    Map&lt;String, Object&gt; optionMap
)</code></pre></div><p id="-1701264068#nzvxxe_28"><span class="control" id="-1701264068#nzvxxe_37">Descripci&oacute;n:</span> M&eacute;todo est&aacute;tico global que act&uacute;a como punto de entrada principal para invocar procesos a trav&eacute;s del BaseProcessManager.</p><p id="-1701264068#nzvxxe_29"><span class="control" id="-1701264068#nzvxxe_38">Par&aacute;metros:</span></p><ul class="list" id="-1701264068#nzvxxe_30" start="1"><li class="list-item" id="-1701264068#nzvxxe_39"><p><span class="inline-code" id="-1701264068#nzvxxe_42">inputMap</span> (Map&lt;String, Object&gt;): Mapa de datos de entrada para el proceso</p></li><li class="list-item" id="-1701264068#nzvxxe_40"><p><span class="inline-code" id="-1701264068#nzvxxe_43">outputMap</span> (Map&lt;String, Object&gt;): Mapa donde se almacenar&aacute;n los resultados del proceso</p></li><li class="list-item" id="-1701264068#nzvxxe_41"><p><span class="inline-code" id="-1701264068#nzvxxe_44">optionMap</span> (Map&lt;String, Object&gt;): Mapa de opciones de configuraci&oacute;n para el proceso</p></li></ul><p id="-1701264068#nzvxxe_31"><span class="control" id="-1701264068#nzvxxe_45">Retorna:</span></p><ul class="list" id="-1701264068#nzvxxe_32" start="1"><li class="list-item" id="-1701264068#nzvxxe_46"><p><span class="inline-code" id="-1701264068#nzvxxe_47">Boolean</span>: <span class="inline-code" id="-1701264068#nzvxxe_48">true</span> si el proceso se ejecut&oacute; exitosamente, <span class="inline-code" id="-1701264068#nzvxxe_49">false</span> en caso contrario</p></li></ul><p id="-1701264068#nzvxxe_33"><span class="control" id="-1701264068#nzvxxe_50">Comportamiento:</span></p><ol class="list list-decimal" id="-1701264068#nzvxxe_34" type="1" start="1"><li class="list-item" id="-1701264068#nzvxxe_51"><p>Extrae el valor de 'Stage' del inputMap para determinar la etapa del proceso</p></li><li class="list-item" id="-1701264068#nzvxxe_52"><p>Registra la etapa en el debug log</p></li><li class="list-item" id="-1701264068#nzvxxe_53"><p>Delega la ejecuci&oacute;n al <span class="inline-code" id="-1701264068#nzvxxe_55">BaseProcessManager.invoke()</span> con los par&aacute;metros reorganizados</p></li><li class="list-item" id="-1701264068#nzvxxe_54"><p>Retorna el resultado de la invocaci&oacute;n</p></li></ol><p id="-1701264068#nzvxxe_35"><span class="control" id="-1701264068#nzvxxe_56">Flujo de Datos:</span></p><div class="detached code-block" id="-1701264068#nzvxxe_36"><pre><code class="language-none">inputMap['Stage'] → stage → BaseProcessManager.invoke(stage, optionMap, inputMap, outputMap)</code></pre></div></section><section><h3 id="-1701264068#invokemethod" data-toc="invokemethod#BaseProcessFoundationVlocityAdapter.md-invokemethod">invokeMethod</h3><div class="detached code-block" id="-1701264068#nzvxxe_57"><pre><code class="language-none">public Boolean invokeMethod(
    String methodName,
    Map&lt;String, Object&gt; inputMap,
    Map&lt;String, Object&gt; outputMap,
    Map&lt;String, Object&gt; optionMap
)</code></pre></div><p id="-1701264068#nzvxxe_58"><span class="control" id="-1701264068#nzvxxe_67">Descripci&oacute;n:</span> M&eacute;todo p&uacute;blico que proporciona un mecanismo de invocaci&oacute;n din&aacute;mica basado en el nombre del m&eacute;todo.</p><p id="-1701264068#nzvxxe_59"><span class="control" id="-1701264068#nzvxxe_68">Par&aacute;metros:</span></p><ul class="list" id="-1701264068#nzvxxe_60" start="1"><li class="list-item" id="-1701264068#nzvxxe_69"><p><span class="inline-code" id="-1701264068#nzvxxe_73">methodName</span> (String): Nombre del m&eacute;todo a ejecutar (case-insensitive)</p></li><li class="list-item" id="-1701264068#nzvxxe_70"><p><span class="inline-code" id="-1701264068#nzvxxe_74">inputMap</span> (Map&lt;String, Object&gt;): Mapa de datos de entrada</p></li><li class="list-item" id="-1701264068#nzvxxe_71"><p><span class="inline-code" id="-1701264068#nzvxxe_75">outputMap</span> (Map&lt;String, Object&gt;): Mapa de datos de salida</p></li><li class="list-item" id="-1701264068#nzvxxe_72"><p><span class="inline-code" id="-1701264068#nzvxxe_76">optionMap</span> (Map&lt;String, Object&gt;): Mapa de opciones de configuraci&oacute;n</p></li></ul><p id="-1701264068#nzvxxe_61"><span class="control" id="-1701264068#nzvxxe_77">Retorna:</span></p><ul class="list" id="-1701264068#nzvxxe_62" start="1"><li class="list-item" id="-1701264068#nzvxxe_78"><p><span class="inline-code" id="-1701264068#nzvxxe_79">Boolean</span>: Resultado de la ejecuci&oacute;n del m&eacute;todo solicitado</p></li></ul><p id="-1701264068#nzvxxe_63"><span class="control" id="-1701264068#nzvxxe_80">Comportamiento:</span></p><ul class="list" id="-1701264068#nzvxxe_64" start="1"><li class="list-item" id="-1701264068#nzvxxe_81"><p>Utiliza una estructura <span class="inline-code" id="-1701264068#nzvxxe_85">switch on</span> para determinar qu&eacute; m&eacute;todo ejecutar</p></li><li class="list-item" id="-1701264068#nzvxxe_82"><p>Convierte el nombre del m&eacute;todo a may&uacute;sculas para comparaci&oacute;n case-insensitive</p></li><li class="list-item" id="-1701264068#nzvxxe_83"><p>Actualmente soporta &uacute;nicamente 'APPLYINVOKE'</p></li><li class="list-item" id="-1701264068#nzvxxe_84"><p>Registra m&eacute;todos no soportados en el debug log y retorna <span class="inline-code" id="-1701264068#nzvxxe_86">false</span></p></li></ul><p id="-1701264068#nzvxxe_65"><span class="control" id="-1701264068#nzvxxe_87">M&eacute;todos Soportados:</span></p><ul class="list" id="-1701264068#nzvxxe_66" start="1"><li class="list-item" id="-1701264068#nzvxxe_88"><p><span class="inline-code" id="-1701264068#nzvxxe_89">'APPLYINVOKE'</span>: Invoca el m&eacute;todo <span class="inline-code" id="-1701264068#nzvxxe_90">applyInvoke()</span></p></li></ul></section></section><section><h2 id="-1701264068#patr-n-de-dise-o" data-toc="patr-n-de-dise-o#BaseProcessFoundationVlocityAdapter.md-patr-n-de-dise-o">Patr&oacute;n de Dise&ntilde;o</h2><section><h3 id="-1701264068#adapter-pattern" data-toc="adapter-pattern#BaseProcessFoundationVlocityAdapter.md-adapter-pattern">Adapter Pattern</h3><p id="-1701264068#nzvxxe_93">Esta clase implementa el <span class="control" id="-1701264068#nzvxxe_95">patr&oacute;n Adapter</span>, actuando como:</p><ul class="list" id="-1701264068#nzvxxe_94" start="1"><li class="list-item" id="-1701264068#nzvxxe_96"><p><span class="control" id="-1701264068#nzvxxe_99">Adaptador:</span> Entre Vlocity framework y BaseProcessManager</p></li><li class="list-item" id="-1701264068#nzvxxe_97"><p><span class="control" id="-1701264068#nzvxxe_100">Interfaz unificada:</span> Para diferentes tipos de invocaciones de procesos</p></li><li class="list-item" id="-1701264068#nzvxxe_98"><p><span class="control" id="-1701264068#nzvxxe_101">Punto de entrada:</span> Centralizado para operaciones de proceso</p></li></ul></section><section><h3 id="-1701264068#command-pattern" data-toc="command-pattern#BaseProcessFoundationVlocityAdapter.md-command-pattern">Command Pattern</h3><p id="-1701264068#nzvxxe_102">El m&eacute;todo <span class="inline-code" id="-1701264068#nzvxxe_104">invokeMethod</span> implementa aspectos del <span class="control" id="-1701264068#nzvxxe_105">patr&oacute;n Command</span>:</p><ul class="list" id="-1701264068#nzvxxe_103" start="1"><li class="list-item" id="-1701264068#nzvxxe_106"><p>Encapsula la invocaci&oacute;n de m&eacute;todos como objetos</p></li><li class="list-item" id="-1701264068#nzvxxe_107"><p>Permite invocar m&eacute;todos din&aacute;micamente por nombre</p></li><li class="list-item" id="-1701264068#nzvxxe_108"><p>Facilita la extensi&oacute;n con nuevos comandos</p></li></ul></section></section><section><h2 id="-1701264068#integraci-n-con-vlocity" data-toc="integraci-n-con-vlocity#BaseProcessFoundationVlocityAdapter.md-integraci-n-con-vlocity">Integraci&oacute;n con Vlocity</h2><section><h3 id="-1701264068#prop-sito-en-el-ecosistema" data-toc="prop-sito-en-el-ecosistema#BaseProcessFoundationVlocityAdapter.md-prop-sito-en-el-ecosistema">Prop&oacute;sito en el Ecosistema</h3><ul class="list" id="-1701264068#nzvxxe_111" start="1"><li class="list-item" id="-1701264068#nzvxxe_112"><p><span class="control" id="-1701264068#nzvxxe_115">Bridge:</span> Conecta componentes Vlocity con l&oacute;gica de negocio personalizada</p></li><li class="list-item" id="-1701264068#nzvxxe_113"><p><span class="control" id="-1701264068#nzvxxe_116">Abstracci&oacute;n:</span> Oculta la complejidad del BaseProcessManager de Vlocity</p></li><li class="list-item" id="-1701264068#nzvxxe_114"><p><span class="control" id="-1701264068#nzvxxe_117">Estandarizaci&oacute;n:</span> Proporciona interfaz consistente para invocaciones</p></li></ul></section><section><h3 id="-1701264068#flujo-de-integraci-n" data-toc="flujo-de-integraci-n#BaseProcessFoundationVlocityAdapter.md-flujo-de-integraci-n">Flujo de Integraci&oacute;n</h3><div class="detached code-block" id="-1701264068#nzvxxe_118"><pre><code class="language-none">Vlocity Component → BaseProcessFoundationVlocityAdapter → BaseProcessManager → Business Logic</code></pre></div></section></section><section><h2 id="-1701264068#consideraciones-t-cnicas" data-toc="consideraciones-t-cnicas#BaseProcessFoundationVlocityAdapter.md-consideraciones-t-cnicas">Consideraciones T&eacute;cnicas</h2><section><h3 id="-1701264068#visibilidad-global" data-toc="visibilidad-global#BaseProcessFoundationVlocityAdapter.md-visibilidad-global">Visibilidad Global</h3><ul class="list" id="-1701264068#nzvxxe_122" start="1"><li class="list-item" id="-1701264068#nzvxxe_123"><p>Declarada como <span class="inline-code" id="-1701264068#nzvxxe_125">global</span> para permitir acceso desde paquetes Vlocity</p></li><li class="list-item" id="-1701264068#nzvxxe_124"><p>M&eacute;todos est&aacute;ticos globales para invocaci&oacute;n directa sin instanciaci&oacute;n</p></li></ul></section><section><h3 id="-1701264068#manejo-de-par-metros" data-toc="manejo-de-par-metros#BaseProcessFoundationVlocityAdapter.md-manejo-de-par-metros">Manejo de Par&aacute;metros</h3><ul class="list" id="-1701264068#nzvxxe_126" start="1"><li class="list-item" id="-1701264068#nzvxxe_127"><p>Utiliza casting expl&iacute;cito para asegurar tipos correctos</p></li><li class="list-item" id="-1701264068#nzvxxe_128"><p>Usa operador de navegaci&oacute;n segura (<span class="inline-code" id="-1701264068#nzvxxe_129">?.</span>) para prevenir null pointer exceptions</p></li></ul></section><section><h3 id="-1701264068#extensibilidad" data-toc="extensibilidad#BaseProcessFoundationVlocityAdapter.md-extensibilidad">Extensibilidad</h3><ul class="list" id="-1701264068#nzvxxe_130" start="1"><li class="list-item" id="-1701264068#nzvxxe_131"><p>Estructura switch permite agregar nuevos m&eacute;todos f&aacute;cilmente</p></li><li class="list-item" id="-1701264068#nzvxxe_132"><p>Clase abstracta permite herencia para especializaciones</p></li></ul></section></section><section><h2 id="-1701264068#dependencias" data-toc="dependencias#BaseProcessFoundationVlocityAdapter.md-dependencias">Dependencias</h2><ul class="list" id="-1701264068#nzvxxe_133" start="1"><li class="list-item" id="-1701264068#nzvxxe_134"><p><span class="control" id="-1701264068#nzvxxe_137">BaseProcessManager:</span> Clase principal que maneja la l&oacute;gica de procesos</p></li><li class="list-item" id="-1701264068#nzvxxe_135"><p><span class="control" id="-1701264068#nzvxxe_138">Vlocity Framework:</span> Para integraci&oacute;n con componentes Vlocity</p></li><li class="list-item" id="-1701264068#nzvxxe_136"><p><span class="control" id="-1701264068#nzvxxe_139">System.debug:</span> Para logging y diagn&oacute;stico</p></li></ul></section><section><h2 id="-1701264068#casos-de-uso" data-toc="casos-de-uso#BaseProcessFoundationVlocityAdapter.md-casos-de-uso">Casos de Uso</h2><ol class="list list-decimal" id="-1701264068#nzvxxe_140" type="1" start="1"><li class="list-item" id="-1701264068#nzvxxe_141"><p><span class="control" id="-1701264068#nzvxxe_145">Procesos Vlocity:</span> Ejecutar l&oacute;gica de negocio desde flows o components Vlocity</p></li><li class="list-item" id="-1701264068#nzvxxe_142"><p><span class="control" id="-1701264068#nzvxxe_146">Integraci&oacute;n de Etapas:</span> Manejar diferentes etapas de procesos complejos</p></li><li class="list-item" id="-1701264068#nzvxxe_143"><p><span class="control" id="-1701264068#nzvxxe_147">Invocaci&oacute;n Din&aacute;mica:</span> Ejecutar m&eacute;todos espec&iacute;ficos basado en configuraci&oacute;n</p></li><li class="list-item" id="-1701264068#nzvxxe_144"><p><span class="control" id="-1701264068#nzvxxe_148">Punto de Entrada Unificado:</span> Centralizar invocaciones desde m&uacute;ltiples fuentes</p></li></ol></section><section><h2 id="-1701264068#mejoras-potenciales" data-toc="mejoras-potenciales#BaseProcessFoundationVlocityAdapter.md-mejoras-potenciales">Mejoras Potenciales</h2><ul class="list" id="-1701264068#nzvxxe_149" start="1"><li class="list-item" id="-1701264068#nzvxxe_150"><p>Implementar manejo de excepciones m&aacute;s robusto</p></li><li class="list-item" id="-1701264068#nzvxxe_151"><p>Agregar validaci&oacute;n de par&aacute;metros de entrada</p></li><li class="list-item" id="-1701264068#nzvxxe_152"><p>Incluir logging m&aacute;s detallado para auditor&iacute;a</p></li><li class="list-item" id="-1701264068#nzvxxe_153"><p>Expandir m&eacute;todos soportados en <span class="inline-code" id="-1701264068#nzvxxe_155">invokeMethod</span></p></li><li class="list-item" id="-1701264068#nzvxxe_154"><p>Implementar cach&eacute; para mejorar performance en invocaciones frecuentes</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1156337433">BaseObserver</h1><section><h2 id="-1156337433#descripci-n-general" data-toc="descripci-n-general#BaseObserver.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-1156337433#-vuldcr_9">Clase base virtual que implementa la interfaz <span class="inline-code" id="-1156337433#-vuldcr_10">IObserver</span> para el patr&oacute;n Observer. Proporciona implementaciones base para la observaci&oacute;n de eventos y publicaci&oacute;n de eventos de plataforma.</p></section><section><h2 id="-1156337433#informaci-n-de-la-clase" data-toc="informaci-n-de-la-clase#BaseObserver.md-informaci-n-de-la-clase">Informaci&oacute;n de la Clase</h2><ul class="list" id="-1156337433#-vuldcr_11" start="1"><li class="list-item" id="-1156337433#-vuldcr_12"><p><span class="control" id="-1156337433#-vuldcr_17">Autor:</span> Soulberto Lorenzo soulberto@cloudblue.us (<a href="mailto:soulberto@cloudblue.us">mailto:soulberto@cloudblue.us</a>)</p></li><li class="list-item" id="-1156337433#-vuldcr_13"><p><span class="control" id="-1156337433#-vuldcr_19">&Uacute;ltima modificaci&oacute;n:</span> 10-11-2024</p></li><li class="list-item" id="-1156337433#-vuldcr_14"><p><span class="control" id="-1156337433#-vuldcr_20">Modificado por:</span> Jean Carlos Melendez</p></li><li class="list-item" id="-1156337433#-vuldcr_15"><p><span class="control" id="-1156337433#-vuldcr_21">Tipo:</span> Clase virtual p&uacute;blica</p></li><li class="list-item" id="-1156337433#-vuldcr_16"><p><span class="control" id="-1156337433#-vuldcr_22">Implementa:</span> IObserver</p></li></ul></section><section><h2 id="-1156337433#m-todos" data-toc="m-todos#BaseObserver.md-m-todos">M&eacute;todos</h2><section><h3 id="-1156337433#updateobserver" data-toc="updateobserver#BaseObserver.md-updateobserver">updateObserver</h3><div class="detached code-block" id="-1156337433#-vuldcr_25"><pre><code class="language-none">public virtual void updateObserver(String flag, Object data)</code></pre></div><p id="-1156337433#-vuldcr_26"><span class="control" id="-1156337433#-vuldcr_32">Descripci&oacute;n:</span> M&eacute;todo virtual para actualizar el observador cuando se produce un evento.</p><p id="-1156337433#-vuldcr_27"><span class="control" id="-1156337433#-vuldcr_33">Par&aacute;metros:</span></p><ul class="list" id="-1156337433#-vuldcr_28" start="1"><li class="list-item" id="-1156337433#-vuldcr_34"><p><span class="inline-code" id="-1156337433#-vuldcr_36">flag</span> (String): Bandera que identifica el tipo de evento o acci&oacute;n</p></li><li class="list-item" id="-1156337433#-vuldcr_35"><p><span class="inline-code" id="-1156337433#-vuldcr_37">data</span> (Object): Datos asociados al evento</p></li></ul><p id="-1156337433#-vuldcr_29"><span class="control" id="-1156337433#-vuldcr_38">Comportamiento:</span></p><ul class="list" id="-1156337433#-vuldcr_30" start="1"><li class="list-item" id="-1156337433#-vuldcr_39"><p>Registra un mensaje de debug con el valor de la bandera</p></li><li class="list-item" id="-1156337433#-vuldcr_40"><p>Al ser virtual, puede ser sobrescrito en clases herederas</p></li></ul><p id="-1156337433#-vuldcr_31"><span class="control" id="-1156337433#-vuldcr_41">Autor:</span> Soulberto Lorenzo soulberto@cloudblue.us (<a href="mailto:soulberto@cloudblue.us">mailto:soulberto@cloudblue.us</a>) | 08-16-2024</p></section><section><h3 id="-1156337433#publishplatformevent" data-toc="publishplatformevent#BaseObserver.md-publishplatformevent">publishPlatFormEvent</h3><div class="detached code-block" id="-1156337433#-vuldcr_43"><pre><code class="language-none">public virtual void publishPlatFormEvent(String flag, String productName)</code></pre></div><p id="-1156337433#-vuldcr_44"><span class="control" id="-1156337433#-vuldcr_50">Descripci&oacute;n:</span> M&eacute;todo virtual para publicar eventos de plataforma relacionados con productos.</p><p id="-1156337433#-vuldcr_45"><span class="control" id="-1156337433#-vuldcr_51">Par&aacute;metros:</span></p><ul class="list" id="-1156337433#-vuldcr_46" start="1"><li class="list-item" id="-1156337433#-vuldcr_52"><p><span class="inline-code" id="-1156337433#-vuldcr_54">flag</span> (String): Bandera que identifica el tipo de evento</p></li><li class="list-item" id="-1156337433#-vuldcr_53"><p><span class="inline-code" id="-1156337433#-vuldcr_55">productName</span> (String): Nombre del producto asociado al evento</p></li></ul><p id="-1156337433#-vuldcr_47"><span class="control" id="-1156337433#-vuldcr_56">Comportamiento:</span></p><ul class="list" id="-1156337433#-vuldcr_48" start="1"><li class="list-item" id="-1156337433#-vuldcr_57"><p>Registra un mensaje de debug indicando la publicaci&oacute;n del evento para el producto especificado</p></li><li class="list-item" id="-1156337433#-vuldcr_58"><p>Al ser virtual, puede ser sobrescrito en clases herederas para implementar l&oacute;gica espec&iacute;fica</p></li></ul><p id="-1156337433#-vuldcr_49"><span class="control" id="-1156337433#-vuldcr_59">Autor:</span> Soulberto Lorenzo soulberto@cloudblue.us (<a href="mailto:soulberto@cloudblue.us">mailto:soulberto@cloudblue.us</a>) | 08-22-2024</p></section></section><section><h2 id="-1156337433#patr-n-de-dise-o" data-toc="patr-n-de-dise-o#BaseObserver.md-patr-n-de-dise-o">Patr&oacute;n de Dise&ntilde;o</h2><p id="-1156337433#-vuldcr_61">Esta clase implementa el <span class="control" id="-1156337433#-vuldcr_63">patr&oacute;n Observer</span>, donde:</p><ul class="list" id="-1156337433#-vuldcr_62" start="1"><li class="list-item" id="-1156337433#-vuldcr_64"><p>Act&uacute;a como observador base que puede recibir notificaciones</p></li><li class="list-item" id="-1156337433#-vuldcr_65"><p>Proporciona m&eacute;todos virtuales que permiten a las clases herederas personalizar el comportamiento</p></li><li class="list-item" id="-1156337433#-vuldcr_66"><p>Facilita la publicaci&oacute;n de eventos de plataforma</p></li></ul></section><section><h2 id="-1156337433#uso-recomendado" data-toc="uso-recomendado#BaseObserver.md-uso-recomendado">Uso Recomendado</h2><ol class="list list-decimal" id="-1156337433#-vuldcr_67" type="1" start="1"><li class="list-item" id="-1156337433#-vuldcr_68"><p>Extender esta clase para crear observadores espec&iacute;ficos</p></li><li class="list-item" id="-1156337433#-vuldcr_69"><p>Sobrescribir los m&eacute;todos virtuales seg&uacute;n las necesidades del negocio</p></li><li class="list-item" id="-1156337433#-vuldcr_70"><p>Utilizar para implementar comunicaci&oacute;n desacoplada entre componentes</p></li></ol></section><section><h2 id="-1156337433#consideraciones" data-toc="consideraciones#BaseObserver.md-consideraciones">Consideraciones</h2><ul class="list" id="-1156337433#-vuldcr_71" start="1"><li class="list-item" id="-1156337433#-vuldcr_72"><p>Los m&eacute;todos son virtuales, por lo que deben ser sobrescritos para funcionalidad completa</p></li><li class="list-item" id="-1156337433#-vuldcr_73"><p>La implementaci&oacute;n actual solo incluye logging para prop&oacute;sitos de debug</p></li><li class="list-item" id="-1156337433#-vuldcr_74"><p>Requiere la implementaci&oacute;n completa de la interfaz <span class="inline-code" id="-1156337433#-vuldcr_75">IObserver</span></p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="514145071">Adapter</h1><section><h2 id="514145071#descripci-n-general" data-toc="descripci-n-general#Adapter.md-descripci-n-general">Descripci&oacute;n General</h2><p id="514145071#-phw7gx_18"><span class="inline-code" id="514145071#-phw7gx_19">Adapter</span> es una interfaz p&uacute;blica que define el contrato fundamental para el patr&oacute;n de dise&ntilde;o Adaptador en el framework Foundation de Suratech. Esta interfaz establece un m&eacute;todo est&aacute;ndar que permite adaptar diferentes tipos de servicios, APIs o sistemas externos a una estructura com&uacute;n de datos, facilitando la integraci&oacute;n y el intercambio de informaci&oacute;n entre componentes heterog&eacute;neos.</p></section><section><h2 id="514145071#autor" data-toc="autor#Adapter.md-autor">Autor</h2><p id="514145071#-phw7gx_20">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="514145071#ltima-modificaci-n" data-toc="ltima-modificaci-n#Adapter.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="514145071#-phw7gx_21">2 de septiembre de 2024</p></section><section><h2 id="514145071#definici-n-de-la-interfaz" data-toc="definici-n-de-la-interfaz#Adapter.md-definici-n-de-la-interfaz">Definici&oacute;n de la Interfaz</h2><div class="detached code-block" id="514145071#-phw7gx_22"><pre><code class="language-none">@namespaceAccessible
public interface Adapter {
  Map&lt;String, Object&gt; adaptee();
}</code></pre></div></section><section><h2 id="514145071#decoradores-y-accesibilidad" data-toc="decoradores-y-accesibilidad#Adapter.md-decoradores-y-accesibilidad">Decoradores y Accesibilidad</h2><section><h3 id="514145071#namespaceaccessible" data-toc="namespaceaccessible#Adapter.md-namespaceaccessible">@namespaceAccessible</h3><p id="514145071#-phw7gx_25">La interfaz est&aacute; marcada con <span class="inline-code" id="514145071#-phw7gx_27">@namespaceAccessible</span>, lo que indica que est&aacute; dise&ntilde;ada para ser accesible desde diferentes espacios de nombres (namespaces). Esto es especialmente relevante en contextos de paquetes gestionados donde se necesita que la interfaz sea accesible desde fuera del namespace del paquete.</p></section></section><section><h2 id="514145071#m-todos" data-toc="m-todos#Adapter.md-m-todos">M&eacute;todos</h2><section><h3 id="514145071#adaptee" data-toc="adaptee#Adapter.md-adaptee">adaptee()</h3><section><h4 id="514145071#descripci-n" data-toc="descripci-n#Adapter.md-descripci-n">Descripci&oacute;n</h4><p id="514145071#-phw7gx_34">M&eacute;todo que debe ser implementado por todas las clases que implementen esta interfaz. Su prop&oacute;sito es adaptar la funcionalidad espec&iacute;fica de un servicio, API o sistema a un formato est&aacute;ndar de mapa de datos.</p></section><section><h4 id="514145071#par-metros" data-toc="par-metros#Adapter.md-par-metros">Par&aacute;metros</h4><p id="514145071#-phw7gx_35">Ninguno.</p></section><section><h4 id="514145071#retorno" data-toc="retorno#Adapter.md-retorno">Retorno</h4><ul class="list" id="514145071#-phw7gx_36" start="1"><li class="list-item" id="514145071#-phw7gx_37"><p><span class="inline-code" id="514145071#-phw7gx_38">Map&lt;String, Object&gt;</span>: Mapa que contiene los datos adaptados en un formato est&aacute;ndar que puede ser procesado de manera uniforme por otros componentes del sistema.</p></li></ul></section></section></section><section><h2 id="514145071#prop-sito-y-aplicaciones" data-toc="prop-sito-y-aplicaciones#Adapter.md-prop-sito-y-aplicaciones">Prop&oacute;sito y Aplicaciones</h2><p id="514145071#-phw7gx_39">El prop&oacute;sito principal de esta interfaz es implementar el patr&oacute;n de dise&ntilde;o Adaptador, que permite:</p><ol class="list list-decimal" id="514145071#-phw7gx_40" type="1" start="1"><li class="list-item" id="514145071#-phw7gx_43"><p><span class="control" id="514145071#-phw7gx_48">Integraci&oacute;n de Sistemas Heterog&eacute;neos</span>: Adaptar diferentes APIs, servicios o sistemas a una interfaz com&uacute;n.</p></li><li class="list-item" id="514145071#-phw7gx_44"><p><span class="control" id="514145071#-phw7gx_49">Desacoplamiento</span>: Separar la l&oacute;gica espec&iacute;fica de integraci&oacute;n de la l&oacute;gica de negocio principal.</p></li><li class="list-item" id="514145071#-phw7gx_45"><p><span class="control" id="514145071#-phw7gx_50">Flexibilidad</span>: Permitir el intercambio de diferentes implementaciones sin afectar el c&oacute;digo cliente.</p></li><li class="list-item" id="514145071#-phw7gx_46"><p><span class="control" id="514145071#-phw7gx_51">Estandarizaci&oacute;n</span>: Proporcionar un formato com&uacute;n de datos para sistemas diversos.</p></li><li class="list-item" id="514145071#-phw7gx_47"><p><span class="control" id="514145071#-phw7gx_52">Extensibilidad</span>: Facilitar la adici&oacute;n de nuevos tipos de adaptadores sin modificar c&oacute;digo existente.</p></li></ol><p id="514145071#-phw7gx_41">Esta interfaz es especialmente &uacute;til en escenarios como:</p><ul class="list" id="514145071#-phw7gx_42" start="1"><li class="list-item" id="514145071#-phw7gx_53"><p><span class="control" id="514145071#-phw7gx_57">Integraciones con APIs Externas</span>: Adaptar respuestas de diferentes APIs a un formato com&uacute;n.</p></li><li class="list-item" id="514145071#-phw7gx_54"><p><span class="control" id="514145071#-phw7gx_58">Migraci&oacute;n de Sistemas</span>: Facilitar la transici&oacute;n entre diferentes sistemas o versiones.</p></li><li class="list-item" id="514145071#-phw7gx_55"><p><span class="control" id="514145071#-phw7gx_59">Compatibilidad con M&uacute;ltiples Proveedores</span>: Permitir trabajar con diferentes proveedores de servicios usando la misma interfaz.</p></li><li class="list-item" id="514145071#-phw7gx_56"><p><span class="control" id="514145071#-phw7gx_60">Transformaci&oacute;n de Datos</span>: Convertir datos de un formato a otro de manera consistente.</p></li></ul></section><section><h2 id="514145071#patr-n-de-dise-o-adapter" data-toc="patr-n-de-dise-o-adapter#Adapter.md-patr-n-de-dise-o-adapter">Patr&oacute;n de Dise&ntilde;o: Adapter</h2><section><h3 id="514145071#estructura-del-patr-n" data-toc="estructura-del-patr-n#Adapter.md-estructura-del-patr-n">Estructura del Patr&oacute;n</h3><div class="detached code-block" id="514145071#-phw7gx_63"><pre><code class="language-none">Client -&gt; Target Interface (Adapter) -&gt; Adaptee (Specific Implementation)</code></pre></div><p id="514145071#-phw7gx_64">En este caso:</p><ul class="list" id="514145071#-phw7gx_65" start="1"><li class="list-item" id="514145071#-phw7gx_66"><p><span class="control" id="514145071#-phw7gx_69">Client</span>: C&oacute;digo que utiliza el adaptador</p></li><li class="list-item" id="514145071#-phw7gx_67"><p><span class="control" id="514145071#-phw7gx_70">Target Interface</span>: La interfaz <span class="inline-code" id="514145071#-phw7gx_71">Adapter</span></p></li><li class="list-item" id="514145071#-phw7gx_68"><p><span class="control" id="514145071#-phw7gx_72">Adaptee</span>: Las implementaciones espec&iacute;ficas que adaptan diferentes servicios</p></li></ul></section><section><h3 id="514145071#beneficios-del-patr-n" data-toc="beneficios-del-patr-n#Adapter.md-beneficios-del-patr-n">Beneficios del Patr&oacute;n</h3><ol class="list list-decimal" id="514145071#-phw7gx_73" type="1" start="1"><li class="list-item" id="514145071#-phw7gx_74"><p><span class="control" id="514145071#-phw7gx_77">Reutilizaci&oacute;n de C&oacute;digo</span>: Permite reutilizar clases existentes con interfaces incompatibles.</p></li><li class="list-item" id="514145071#-phw7gx_75"><p><span class="control" id="514145071#-phw7gx_78">Separaci&oacute;n de Responsabilidades</span>: Separa la l&oacute;gica de adaptaci&oacute;n de la l&oacute;gica de negocio.</p></li><li class="list-item" id="514145071#-phw7gx_76"><p><span class="control" id="514145071#-phw7gx_79">Flexibilidad</span>: Facilita el cambio de implementaciones sin afectar el c&oacute;digo cliente.</p></li></ol></section></section><section><h2 id="514145071#implementaciones-existentes" data-toc="implementaciones-existentes#Adapter.md-implementaciones-existentes">Implementaciones Existentes</h2><section><h3 id="514145071#insserviceadapter" data-toc="insserviceadapter#Adapter.md-insserviceadapter">InsServiceAdapter</h3><p id="514145071#-phw7gx_82">Una implementaci&oacute;n conocida de esta interfaz que se utiliza para adaptar servicios de Vlocity Insurance:</p><div class="detached code-block" id="514145071#-phw7gx_83"><pre><code class="language-none">@namespaceAccessible
public class InsServiceAdapter implements Adapter {
  @namespaceAccessible
  public Map&lt;String, Object&gt; adaptee() {
    // return new URLGenerationNotificationHandler();
    return new Map&lt;String, Object&gt;();
  }
}</code></pre></div></section></section><section><h2 id="514145071#ejemplos-de-implementaci-n" data-toc="ejemplos-de-implementaci-n#Adapter.md-ejemplos-de-implementaci-n">Ejemplos de Implementaci&oacute;n</h2><section><h3 id="514145071#ejemplo-1-adaptador-para-servicios-de-pago" data-toc="ejemplo-1-adaptador-para-servicios-de-pago#Adapter.md-ejemplo-1-adaptador-para-servicios-de-pago">Ejemplo 1: Adaptador para Servicios de Pago</h3><div class="detached code-block" id="514145071#-phw7gx_88"><pre><code class="language-none">public class PaymentServiceAdapter implements Adapter {
    
    private String paymentProvider;
    private Map&lt;String, Object&gt; configuration;
    
    public PaymentServiceAdapter(String paymentProvider, Map&lt;String, Object&gt; configuration) {
        this.paymentProvider = paymentProvider;
        this.configuration = configuration;
    }
    
    public Map&lt;String, Object&gt; adaptee() {
        try {
            switch on paymentProvider.toLowerCase() {
                when 'stripe' {
                    return adaptStripeService();
                }
                when 'paypal' {
                    return adaptPayPalService();
                }
                when 'square' {
                    return adaptSquareService();
                }
                when else {
                    throw new AdapterException('Unsupported payment provider: ' + paymentProvider);
                }
            }
        } catch (Exception e) {
            return new Map&lt;String, Object&gt;{
                'success' =&gt; false,
                'error' =&gt; e.getMessage(),
                'provider' =&gt; paymentProvider
            };
        }
    }
    
    private Map&lt;String, Object&gt; adaptStripeService() {
        // Lógica específica para adaptar Stripe
        return new Map&lt;String, Object&gt;{
            'provider' =&gt; 'stripe',
            'apiVersion' =&gt; '2023-10-16',
            'supportedMethods' =&gt; new List&lt;String&gt;{'card', 'bank_transfer', 'apple_pay'},
            'configuration' =&gt; new Map&lt;String, Object&gt;{
                'publicKey' =&gt; configuration.get('stripe_public_key'),
                'webhookEndpoint' =&gt; configuration.get('stripe_webhook_url')
            },
            'capabilities' =&gt; new Map&lt;String, Object&gt;{
                'subscriptions' =&gt; true,
                'refunds' =&gt; true,
                'disputes' =&gt; true,
                'payouts' =&gt; true
            }
        };
    }
    
    private Map&lt;String, Object&gt; adaptPayPalService() {
        // Lógica específica para adaptar PayPal
        return new Map&lt;String, Object&gt;{
            'provider' =&gt; 'paypal',
            'apiVersion' =&gt; 'v2',
            'supportedMethods' =&gt; new List&lt;String&gt;{'paypal', 'card', 'venmo'},
            'configuration' =&gt; new Map&lt;String, Object&gt;{
                'clientId' =&gt; configuration.get('paypal_client_id'),
                'webhookId' =&gt; configuration.get('paypal_webhook_id')
            },
            'capabilities' =&gt; new Map&lt;String, Object&gt;{
                'subscriptions' =&gt; true,
                'refunds' =&gt; true,
                'disputes' =&gt; true,
                'payouts' =&gt; false
            }
        };
    }
    
    private Map&lt;String, Object&gt; adaptSquareService() {
        // Lógica específica para adaptar Square
        return new Map&lt;String, Object&gt;{
            'provider' =&gt; 'square',
            'apiVersion' =&gt; '2023-12-13',
            'supportedMethods' =&gt; new List&lt;String&gt;{'card', 'cash_app', 'afterpay'},
            'configuration' =&gt; new Map&lt;String, Object&gt;{
                'applicationId' =&gt; configuration.get('square_application_id'),
                'locationId' =&gt; configuration.get('square_location_id')
            },
            'capabilities' =&gt; new Map&lt;String, Object&gt;{
                'subscriptions' =&gt; false,
                'refunds' =&gt; true,
                'disputes' =&gt; true,
                'payouts' =&gt; true
            }
        };
    }
    
    public class AdapterException extends Exception {}
}</code></pre></div></section><section><h3 id="514145071#ejemplo-2-adaptador-para-apis-de-notificaci-n" data-toc="ejemplo-2-adaptador-para-apis-de-notificaci-n#Adapter.md-ejemplo-2-adaptador-para-apis-de-notificaci-n">Ejemplo 2: Adaptador para APIs de Notificaci&oacute;n</h3><div class="detached code-block" id="514145071#-phw7gx_89"><pre><code class="language-none">public class NotificationServiceAdapter implements Adapter {
    
    private String notificationService;
    private Map&lt;String, Object&gt; serviceConfig;
    
    public NotificationServiceAdapter(String notificationService, Map&lt;String, Object&gt; serviceConfig) {
        this.notificationService = notificationService;
        this.serviceConfig = serviceConfig;
    }
    
    public Map&lt;String, Object&gt; adaptee() {
        Map&lt;String, Object&gt; adapterInfo = new Map&lt;String, Object&gt;{
            'service' =&gt; notificationService,
            'timestamp' =&gt; System.now(),
            'isAvailable' =&gt; checkServiceAvailability()
        };
        
        switch on notificationService.toLowerCase() {
            when 'sendgrid' {
                adapterInfo.putAll(adaptSendGridService());
            }
            when 'twilio' {
                adapterInfo.putAll(adaptTwilioService());
            }
            when 'slack' {
                adapterInfo.putAll(adaptSlackService());
            }
            when 'teams' {
                adapterInfo.putAll(adaptTeamsService());
            }
            when else {
                adapterInfo.put('error', 'Unsupported notification service: ' + notificationService);
                adapterInfo.put('isAvailable', false);
            }
        }
        
        return adapterInfo;
    }
    
    private Map&lt;String, Object&gt; adaptSendGridService() {
        return new Map&lt;String, Object&gt;{
            'type' =&gt; 'email',
            'endpoint' =&gt; 'https://api.sendgrid.com/v3/mail/send',
            'authentication' =&gt; 'api_key',
            'maxBatchSize' =&gt; 1000,
            'supportedFeatures' =&gt; new List&lt;String&gt;{
                'html_content', 'attachments', 'templates', 'scheduling'
            },
            'rateLimits' =&gt; new Map&lt;String, Object&gt;{
                'requests_per_second' =&gt; 600,
                'emails_per_month' =&gt; getEmailQuota()
            }
        };
    }
    
    private Map&lt;String, Object&gt; adaptTwilioService() {
        return new Map&lt;String, Object&gt;{
            'type' =&gt; 'sms',
            'endpoint' =&gt; 'https://api.twilio.com/2010-04-01/Accounts/' + serviceConfig.get('account_sid') + '/Messages.json',
            'authentication' =&gt; 'basic_auth',
            'maxBatchSize' =&gt; 1,
            'supportedFeatures' =&gt; new List&lt;String&gt;{
                'sms', 'mms', 'whatsapp', 'voice_calls'
            },
            'rateLimits' =&gt; new Map&lt;String, Object&gt;{
                'requests_per_second' =&gt; 10,
                'messages_per_day' =&gt; getSMSQuota()
            }
        };
    }
    
    private Map&lt;String, Object&gt; adaptSlackService() {
        return new Map&lt;String, Object&gt;{
            'type' =&gt; 'chat',
            'endpoint' =&gt; 'https://slack.com/api/chat.postMessage',
            'authentication' =&gt; 'bearer_token',
            'maxBatchSize' =&gt; 1,
            'supportedFeatures' =&gt; new List&lt;String&gt;{
                'rich_text', 'attachments', 'blocks', 'threads'
            },
            'rateLimits' =&gt; new Map&lt;String, Object&gt;{
                'requests_per_minute' =&gt; 50,
                'messages_per_channel_per_second' =&gt; 1
            }
        };
    }
    
    private Map&lt;String, Object&gt; adaptTeamsService() {
        return new Map&lt;String, Object&gt;{
            'type' =&gt; 'chat',
            'endpoint' =&gt; serviceConfig.get('webhook_url'),
            'authentication' =&gt; 'webhook',
            'maxBatchSize' =&gt; 1,
            'supportedFeatures' =&gt; new List&lt;String&gt;{
                'adaptive_cards', 'mentions', 'attachments'
            },
            'rateLimits' =&gt; new Map&lt;String, Object&gt;{
                'requests_per_second' =&gt; 4,
                'requests_per_app_per_second' =&gt; 4
            }
        };
    }
    
    private Boolean checkServiceAvailability() {
        // Lógica para verificar disponibilidad del servicio
        // Podría hacer una llamada de ping o verificar configuración
        return serviceConfig != null &amp;&amp; !serviceConfig.isEmpty();
    }
    
    private Integer getEmailQuota() {
        // Obtener cuota de emails basada en el plan
        return (Integer) serviceConfig.get('email_quota') ?? 40000;
    }
    
    private Integer getSMSQuota() {
        // Obtener cuota de SMS basada en el plan
        return (Integer) serviceConfig.get('sms_quota') ?? 1000;
    }
}</code></pre></div></section><section><h3 id="514145071#ejemplo-3-adaptador-para-servicios-de-almacenamiento" data-toc="ejemplo-3-adaptador-para-servicios-de-almacenamiento#Adapter.md-ejemplo-3-adaptador-para-servicios-de-almacenamiento">Ejemplo 3: Adaptador para Servicios de Almacenamiento</h3><div class="detached code-block" id="514145071#-phw7gx_90"><pre><code class="language-none">public class StorageServiceAdapter implements Adapter {
    
    private String storageProvider;
    private Map&lt;String, Object&gt; credentials;
    
    public StorageServiceAdapter(String storageProvider, Map&lt;String, Object&gt; credentials) {
        this.storageProvider = storageProvider;
        this.credentials = credentials;
    }
    
    public Map&lt;String, Object&gt; adaptee() {
        Map&lt;String, Object&gt; storageInfo = new Map&lt;String, Object&gt;{
            'provider' =&gt; storageProvider,
            'adaptedAt' =&gt; System.now()
        };
        
        try {
            switch on storageProvider.toLowerCase() {
                when 'aws_s3' {
                    storageInfo.putAll(adaptAWSS3());
                }
                when 'azure_blob' {
                    storageInfo.putAll(adaptAzureBlob());
                }
                when 'google_cloud' {
                    storageInfo.putAll(adaptGoogleCloud());
                }
                when 'salesforce_files' {
                    storageInfo.putAll(adaptSalesforceFiles());
                }
                when else {
                    throw new UnsupportedStorageException('Provider not supported: ' + storageProvider);
                }
            }
            
            storageInfo.put('isConfigured', true);
            
        } catch (Exception e) {
            storageInfo.put('isConfigured', false);
            storageInfo.put('error', e.getMessage());
        }
        
        return storageInfo;
    }
    
    private Map&lt;String, Object&gt; adaptAWSS3() {
        return new Map&lt;String, Object&gt;{
            'baseUrl' =&gt; 'https://s3.amazonaws.com',
            'region' =&gt; credentials.get('aws_region') ?? 'us-east-1',
            'bucketName' =&gt; credentials.get('bucket_name'),
            'accessKeyId' =&gt; credentials.get('access_key_id'),
            'supportedOperations' =&gt; new List&lt;String&gt;{
                'upload', 'download', 'delete', 'list', 'copy'
            },
            'maxFileSize' =&gt; 5368709120, // 5GB
            'supportedFormats' =&gt; new List&lt;String&gt;{
                'pdf', 'jpg', 'png', 'docx', 'xlsx', 'zip'
            },
            'encryption' =&gt; new Map&lt;String, Object&gt;{
                'supported' =&gt; true,
                'types' =&gt; new List&lt;String&gt;{'AES256', 'aws:kms'}
            }
        };
    }
    
    private Map&lt;String, Object&gt; adaptAzureBlob() {
        return new Map&lt;String, Object&gt;{
            'baseUrl' =&gt; 'https://' + credentials.get('account_name') + '.blob.core.windows.net',
            'containerName' =&gt; credentials.get('container_name'),
            'accountName' =&gt; credentials.get('account_name'),
            'supportedOperations' =&gt; new List&lt;String&gt;{
                'upload', 'download', 'delete', 'list', 'snapshot'
            },
            'maxFileSize' =&gt; 4398046511104, // 4TB
            'supportedFormats' =&gt; new List&lt;String&gt;{
                'pdf', 'jpg', 'png', 'docx', 'xlsx', 'zip', 'mp4'
            },
            'encryption' =&gt; new Map&lt;String, Object&gt;{
                'supported' =&gt; true,
                'types' =&gt; new List&lt;String&gt;{'Microsoft Managed', 'Customer Managed'}
            }
        };
    }
    
    private Map&lt;String, Object&gt; adaptGoogleCloud() {
        return new Map&lt;String, Object&gt;{
            'baseUrl' =&gt; 'https://storage.googleapis.com',
            'bucketName' =&gt; credentials.get('bucket_name'),
            'projectId' =&gt; credentials.get('project_id'),
            'supportedOperations' =&gt; new List&lt;String&gt;{
                'upload', 'download', 'delete', 'list', 'versioning'
            },
            'maxFileSize' =&gt; 5497558138880, // 5TB
            'supportedFormats' =&gt; new List&lt;String&gt;{
                'pdf', 'jpg', 'png', 'docx', 'xlsx', 'zip', 'mp4', 'csv'
            },
            'encryption' =&gt; new Map&lt;String, Object&gt;{
                'supported' =&gt; true,
                'types' =&gt; new List&lt;String&gt;{'Google-managed', 'Customer-managed', 'Customer-supplied'}
            }
        };
    }
    
    private Map&lt;String, Object&gt; adaptSalesforceFiles() {
        return new Map&lt;String, Object&gt;{
            'baseUrl' =&gt; URL.getSalesforceBaseUrl().toExternalForm(),
            'supportedOperations' =&gt; new List&lt;String&gt;{
                'upload', 'download', 'delete', 'share', 'version'
            },
            'maxFileSize' =&gt; 2147483648, // 2GB
            'supportedFormats' =&gt; new List&lt;String&gt;{
                'pdf', 'jpg', 'png', 'docx', 'xlsx', 'pptx', 'txt'
            },
            'encryption' =&gt; new Map&lt;String, Object&gt;{
                'supported' =&gt; true,
                'types' =&gt; new List&lt;String&gt;{'Platform Encryption'}
            },
            'sharingModel' =&gt; 'Salesforce Security Model'
        };
    }
    
    public class UnsupportedStorageException extends Exception {}
}</code></pre></div></section></section><section><h2 id="514145071#uso-con-factory-pattern" data-toc="uso-con-factory-pattern#Adapter.md-uso-con-factory-pattern">Uso con Factory Pattern</h2><div class="detached code-block" id="514145071#-phw7gx_91"><pre><code class="language-none">public class AdapterFactory {
    
    public static Adapter createAdapter(String adapterType, Map&lt;String, Object&gt; configuration) {
        switch on adapterType.toLowerCase() {
            when 'payment' {
                String provider = (String) configuration.get('provider');
                return new PaymentServiceAdapter(provider, configuration);
            }
            when 'notification' {
                String service = (String) configuration.get('service');
                return new NotificationServiceAdapter(service, configuration);
            }
            when 'storage' {
                String provider = (String) configuration.get('provider');
                return new StorageServiceAdapter(provider, configuration);
            }
            when 'insurance' {
                return new InsServiceAdapter();
            }
            when else {
                throw new UnsupportedAdapterException('Unsupported adapter type: ' + adapterType);
            }
        }
    }
    
    public class UnsupportedAdapterException extends Exception {}
}

// Uso del factory
Map&lt;String, Object&gt; paymentConfig = new Map&lt;String, Object&gt;{
    'provider' =&gt; 'stripe',
    'stripe_public_key' =&gt; 'pk_test_...',
    'stripe_webhook_url' =&gt; 'https://myapp.com/webhooks/stripe'
};

Adapter paymentAdapter = AdapterFactory.createAdapter('payment', paymentConfig);
Map&lt;String, Object&gt; paymentInfo = paymentAdapter.adaptee();</code></pre></div></section><section><h2 id="514145071#ejemplo-de-uso-en-servicios-de-integraci-n" data-toc="ejemplo-de-uso-en-servicios-de-integraci-n#Adapter.md-ejemplo-de-uso-en-servicios-de-integraci-n">Ejemplo de Uso en Servicios de Integraci&oacute;n</h2><div class="detached code-block" id="514145071#-phw7gx_92"><pre><code class="language-none">public class IntegrationOrchestrator {
    
    private List&lt;Adapter&gt; adapters;
    
    public IntegrationOrchestrator() {
        this.adapters = new List&lt;Adapter&gt;();
    }
    
    public void addAdapter(Adapter adapter) {
        adapters.add(adapter);
    }
    
    public Map&lt;String, Object&gt; executeIntegration() {
        Map&lt;String, Object&gt; integrationResults = new Map&lt;String, Object&gt;{
            'totalAdapters' =&gt; adapters.size(),
            'results' =&gt; new List&lt;Map&lt;String, Object&gt;&gt;(),
            'executedAt' =&gt; System.now()
        };
        
        List&lt;Map&lt;String, Object&gt;&gt; results = new List&lt;Map&lt;String, Object&gt;&gt;();
        
        for (Integer i = 0; i &lt; adapters.size(); i++) {
            try {
                Adapter adapter = adapters[i];
                Map&lt;String, Object&gt; adapterResult = adapter.adaptee();
                
                results.add(new Map&lt;String, Object&gt;{
                    'adapterIndex' =&gt; i,
                    'success' =&gt; true,
                    'data' =&gt; adapterResult
                });
                
            } catch (Exception e) {
                results.add(new Map&lt;String, Object&gt;{
                    'adapterIndex' =&gt; i,
                    'success' =&gt; false,
                    'error' =&gt; e.getMessage()
                });
            }
        }
        
        integrationResults.put('results', results);
        return integrationResults;
    }
}

// Uso del orquestador
IntegrationOrchestrator orchestrator = new IntegrationOrchestrator();

// Añadir múltiples adaptadores
orchestrator.addAdapter(AdapterFactory.createAdapter('payment', paymentConfig));
orchestrator.addAdapter(AdapterFactory.createAdapter('notification', notificationConfig));
orchestrator.addAdapter(AdapterFactory.createAdapter('storage', storageConfig));

// Ejecutar todas las integraciones
Map&lt;String, Object&gt; results = orchestrator.executeIntegration();</code></pre></div></section><section><h2 id="514145071#mejores-pr-cticas-para-implementaci-n" data-toc="mejores-pr-cticas-para-implementaci-n#Adapter.md-mejores-pr-cticas-para-implementaci-n">Mejores Pr&aacute;cticas para Implementaci&oacute;n</h2><ol class="list list-decimal" id="514145071#-phw7gx_93" type="1" start="1"><li class="list-item" id="514145071#-phw7gx_94"><p id="514145071#-phw7gx_99"><span class="control" id="514145071#-phw7gx_100">Consistencia en el Formato de Retorno</span>: Mantener una estructura consistente en el mapa de retorno para facilitar el procesamiento.</p></li><li class="list-item" id="514145071#-phw7gx_95"><p id="514145071#-phw7gx_101"><span class="control" id="514145071#-phw7gx_102">Manejo de Errores</span>: Incluir informaci&oacute;n de errores en el mapa de retorno en lugar de lanzar excepciones cuando sea posible.</p></li><li class="list-item" id="514145071#-phw7gx_96"><p id="514145071#-phw7gx_103"><span class="control" id="514145071#-phw7gx_104">Informaci&oacute;n de Metadatos</span>: Incluir metadatos &uacute;tiles como timestamps, versiones de API, y informaci&oacute;n de configuraci&oacute;n.</p></li><li class="list-item" id="514145071#-phw7gx_97"><p id="514145071#-phw7gx_105"><span class="control" id="514145071#-phw7gx_106">Validaci&oacute;n de Configuraci&oacute;n</span>: Validar la configuraci&oacute;n requerida antes de intentar adaptar el servicio.</p></li><li class="list-item" id="514145071#-phw7gx_98"><p id="514145071#-phw7gx_107"><span class="control" id="514145071#-phw7gx_108">Documentaci&oacute;n Clara</span>: Documentar claramente qu&eacute; estructura de datos devuelve cada implementaci&oacute;n.</p></li></ol></section><section><h2 id="514145071#consideraciones-de-dise-o" data-toc="consideraciones-de-dise-o#Adapter.md-consideraciones-de-dise-o">Consideraciones de Dise&ntilde;o</h2><section><h3 id="514145071#ventajas" data-toc="ventajas#Adapter.md-ventajas">Ventajas</h3><ol class="list list-decimal" id="514145071#-phw7gx_111" type="1" start="1"><li class="list-item" id="514145071#-phw7gx_112"><p><span class="control" id="514145071#-phw7gx_116">Flexibilidad</span>: Permite trabajar con m&uacute;ltiples servicios usando la misma interfaz.</p></li><li class="list-item" id="514145071#-phw7gx_113"><p><span class="control" id="514145071#-phw7gx_117">Mantenibilidad</span>: Facilita el mantenimiento al encapsular la l&oacute;gica espec&iacute;fica de cada servicio.</p></li><li class="list-item" id="514145071#-phw7gx_114"><p><span class="control" id="514145071#-phw7gx_118">Testabilidad</span>: Permite crear implementaciones mock f&aacute;cilmente para pruebas.</p></li><li class="list-item" id="514145071#-phw7gx_115"><p><span class="control" id="514145071#-phw7gx_119">Extensibilidad</span>: Nuevos adaptadores pueden a&ntilde;adirse sin modificar c&oacute;digo existente.</p></li></ol></section><section><h3 id="514145071#consideraciones" data-toc="consideraciones#Adapter.md-consideraciones">Consideraciones</h3><ol class="list list-decimal" id="514145071#-phw7gx_120" type="1" start="1"><li class="list-item" id="514145071#-phw7gx_121"><p><span class="control" id="514145071#-phw7gx_124">Complejidad</span>: Puede a&ntilde;adir complejidad al sistema si se abusa del patr&oacute;n.</p></li><li class="list-item" id="514145071#-phw7gx_122"><p><span class="control" id="514145071#-phw7gx_125">Overhead</span>: Puede introducir overhead si la adaptaci&oacute;n es muy simple.</p></li><li class="list-item" id="514145071#-phw7gx_123"><p><span class="control" id="514145071#-phw7gx_126">Consistencia</span>: Requiere disciplina para mantener consistencia entre implementaciones.</p></li></ol></section></section><section><h2 id="514145071#notas-adicionales" data-toc="notas-adicionales#Adapter.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="514145071#-phw7gx_127" type="1" start="1"><li class="list-item" id="514145071#-phw7gx_128"><p>La anotaci&oacute;n <span class="inline-code" id="514145071#-phw7gx_132">@namespaceAccessible</span> indica que esta interfaz est&aacute; dise&ntilde;ada para ser utilizada en contextos de paquetes gestionados.</p></li><li class="list-item" id="514145071#-phw7gx_129"><p>El comentario en la documentaci&oacute;n del m&eacute;todo muestra un par&aacute;metro vac&iacute;o, lo que sugiere que originalmente se plane&oacute; que el m&eacute;todo tuviera par&aacute;metros.</p></li><li class="list-item" id="514145071#-phw7gx_130"><p>Esta interfaz forma parte de un sistema m&aacute;s amplio de adaptadores en el framework Foundation de Suratech.</p></li><li class="list-item" id="514145071#-phw7gx_131"><p>La simplicidad de la interfaz es intencional, proporcionando m&aacute;xima flexibilidad para las implementaciones.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="374953083">RateProductHandler</h1><section><h2 id="374953083#descripci-n-general" data-toc="descripci-n-general#RateProductHandler.md-descripci-n-general">Descripci&oacute;n General</h2><p id="374953083#-kopz5b_10"><span class="inline-code" id="374953083#-kopz5b_11">RateProductHandler</span> es una clase virtual global que extiende <span class="inline-code" id="374953083#-kopz5b_12">ProductHandler</span> y se encarga de gestionar el proceso de calificaci&oacute;n (rating) de un producto utilizando Integration Procedures.</p></section><section><h2 id="374953083#autor-y-proyecto" data-toc="autor-y-proyecto#RateProductHandler.md-autor-y-proyecto">Autor y Proyecto</h2><ul class="list" id="374953083#-kopz5b_13" start="1"><li class="list-item" id="374953083#-kopz5b_14"><p><span class="control" id="374953083#-kopz5b_17">Autor</span>: Soulberto Lorenzo soulberto@cloudblue.us (<a href="mailto:soulberto@cloudblue.us">mailto:soulberto@cloudblue.us</a>)</p></li><li class="list-item" id="374953083#-kopz5b_15"><p><span class="control" id="374953083#-kopz5b_19">&Uacute;ltima modificaci&oacute;n</span>: 21 de febrero de 2025</p></li><li class="list-item" id="374953083#-kopz5b_16"><p><span class="control" id="374953083#-kopz5b_20">&Uacute;ltimo modificador</span>: Jean Carlos Melendez</p></li></ul></section><section><h2 id="374953083#constantes-y-variables" data-toc="constantes-y-variables#RateProductHandler.md-constantes-y-variables">Constantes y Variables</h2><div class="detached code-block" id="374953083#-kopz5b_21"><pre><code class="language-none">public static final String PROCESS_NAME = 'Rating';
public static final String OPTION_SKIP_BEHAVIOR = 'skipDefaultBehavior';
public static final String RATING_IPROCEDURE = 'sfcore_ratingprocedure';
global IntegrationProcedureExecutor EXECUTOR;
public static final Set&lt;String&gt; REQUIRED_PARAMETERS = new Set&lt;String&gt;{
  'includeInputKeys',
  'instanceKey',
  'filters'
};</code></pre></div></section><section><h2 id="374953083#constructores" data-toc="constructores#RateProductHandler.md-constructores">Constructores</h2><div class="detached code-block" id="374953083#-kopz5b_22"><pre><code class="language-none">global RateProductHandler(String productName, IntegrationProcedureExecutor executor)</code></pre></div><p id="374953083#-kopz5b_23">Constructor que recibe el nombre del producto y un ejecutor de Integration Procedure.</p><div class="detached code-block" id="374953083#-kopz5b_24"><pre><code class="language-none">global RateProductHandler(String productName)</code></pre></div><p id="374953083#-kopz5b_25">Constructor que recibe solo el nombre del producto e inicializa un ejecutor mock.</p></section><section><h2 id="374953083#m-todos-principales" data-toc="m-todos-principales#RateProductHandler.md-m-todos-principales">M&eacute;todos Principales</h2><section><h3 id="374953083#setobservers" data-toc="setobservers#RateProductHandler.md-setobservers">setObservers</h3><div class="detached code-block" id="374953083#-kopz5b_31"><pre><code class="language-none">public override void setObservers()</code></pre></div><p id="374953083#-kopz5b_32">Sobrescribe el m&eacute;todo de la clase padre para a&ntilde;adir un observador de tipo <span class="inline-code" id="374953083#-kopz5b_33">RateObserver</span>.</p></section><section><h3 id="374953083#isvalidforratingparameters" data-toc="isvalidforratingparameters#RateProductHandler.md-isvalidforratingparameters">isValidForRatingParameters</h3><div class="detached code-block" id="374953083#-kopz5b_34"><pre><code class="language-none">global Boolean isValidForRatingParameters(Map&lt;String, Object&gt; data)</code></pre></div><p id="374953083#-kopz5b_35">Verifica que todos los par&aacute;metros requeridos est&eacute;n presentes en el mapa de datos:</p><ul class="list" id="374953083#-kopz5b_36" start="1"><li class="list-item" id="374953083#-kopz5b_37"><p>Recorre los par&aacute;metros requeridos definidos en <span class="inline-code" id="374953083#-kopz5b_40">REQUIRED_PARAMETERS</span></p></li><li class="list-item" id="374953083#-kopz5b_38"><p>Devuelve <span class="inline-code" id="374953083#-kopz5b_41">false</span> si falta alg&uacute;n par&aacute;metro</p></li><li class="list-item" id="374953083#-kopz5b_39"><p>Devuelve <span class="inline-code" id="374953083#-kopz5b_42">true</span> si todos los par&aacute;metros est&aacute;n presentes</p></li></ul></section><section><h3 id="374953083#process" data-toc="process#RateProductHandler.md-process">process</h3><div class="detached code-block" id="374953083#-kopz5b_43"><pre><code class="language-none">public override Map&lt;String, Object&gt; process(
  Map&lt;String, Object&gt; options,
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; output
)</code></pre></div><p id="374953083#-kopz5b_44">M&eacute;todo principal que procesa el producto:</p><ul class="list" id="374953083#-kopz5b_45" start="1"><li class="list-item" id="374953083#-kopz5b_46"><p>Verifica si debe omitir el comportamiento predeterminado</p></li><li class="list-item" id="374953083#-kopz5b_47"><p>Establece el nombre del proceso como 'Rating'</p></li><li class="list-item" id="374953083#-kopz5b_48"><p>Valida los par&aacute;metros de entrada</p></li><li class="list-item" id="374953083#-kopz5b_49"><p>Construye el mapa de entrada para el Integration Procedure</p></li><li class="list-item" id="374953083#-kopz5b_50"><p>Ejecuta el Integration Procedure</p></li><li class="list-item" id="374953083#-kopz5b_51"><p>Actualiza el mapa de salida con los resultados</p></li><li class="list-item" id="374953083#-kopz5b_52"><p>Devuelve el mapa de salida actualizado</p></li></ul></section><section><h3 id="374953083#buildinputmap" data-toc="buildinputmap#RateProductHandler.md-buildinputmap">buildInputMap</h3><div class="detached code-block" id="374953083#-kopz5b_53"><pre><code class="language-none">public Map&lt;String, Object&gt; buildInputMap(
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; options
)</code></pre></div><p id="374953083#-kopz5b_54">Construye el mapa de entrada para el Integration Procedure:</p><ul class="list" id="374953083#-kopz5b_55" start="1"><li class="list-item" id="374953083#-kopz5b_56"><p>Crea una copia del mapa de entrada</p></li><li class="list-item" id="374953083#-kopz5b_57"><p>Agrega todas las opciones si no est&aacute;n vac&iacute;as</p></li><li class="list-item" id="374953083#-kopz5b_58"><p>Devuelve el mapa combinado</p></li></ul></section><section><h3 id="374953083#executeintegrationprocedure" data-toc="executeintegrationprocedure#RateProductHandler.md-executeintegrationprocedure">executeIntegrationProcedure</h3><div class="detached code-block" id="374953083#-kopz5b_59"><pre><code class="language-none">public Map&lt;String, Object&gt; executeIntegrationProcedure(
  Map&lt;String, Object&gt; ipInput
)</code></pre></div><p id="374953083#-kopz5b_60">Ejecuta el Integration Procedure definido en <span class="inline-code" id="374953083#-kopz5b_62">RATING_IPROCEDURE</span>:</p><ul class="list" id="374953083#-kopz5b_61" start="1"><li class="list-item" id="374953083#-kopz5b_63"><p>Utiliza el ejecutor para invocar el procedimiento</p></li><li class="list-item" id="374953083#-kopz5b_64"><p>Devuelve un mapa con la clave 'resultProcess' conteniendo el resultado</p></li></ul></section></section><section><h2 id="374953083#dependencias" data-toc="dependencias#RateProductHandler.md-dependencias">Dependencias</h2><ul class="list" id="374953083#-kopz5b_65" start="1"><li class="list-item" id="374953083#-kopz5b_66"><p><span class="inline-code" id="374953083#-kopz5b_71">ProductHandler</span>: Clase padre que extiende</p></li><li class="list-item" id="374953083#-kopz5b_67"><p><span class="inline-code" id="374953083#-kopz5b_72">IntegrationProcedureExecutor</span>: Interfaz o clase para ejecutar Integration Procedures</p></li><li class="list-item" id="374953083#-kopz5b_68"><p><span class="inline-code" id="374953083#-kopz5b_73">MockIntegrationProcedureExecutor</span>: Implementaci&oacute;n mock del ejecutor</p></li><li class="list-item" id="374953083#-kopz5b_69"><p><span class="inline-code" id="374953083#-kopz5b_74">RateObserver</span>: Clase observadora para el proceso de rating</p></li><li class="list-item" id="374953083#-kopz5b_70"><p><span class="inline-code" id="374953083#-kopz5b_75">ProductHandlerImplementationException</span>: Excepci&oacute;n personalizada para errores de implementaci&oacute;n</p></li></ul></section><section><h2 id="374953083#notas-t-cnicas" data-toc="notas-t-cnicas#RateProductHandler.md-notas-t-cnicas">Notas T&eacute;cnicas</h2><ul class="list" id="374953083#-kopz5b_76" start="1"><li class="list-item" id="374953083#-kopz5b_77"><p>La clase utiliza el patr&oacute;n Observer con <span class="inline-code" id="374953083#-kopz5b_82">addObserver</span></p></li><li class="list-item" id="374953083#-kopz5b_78"><p>Implementa validaci&oacute;n de par&aacute;metros requeridos</p></li><li class="list-item" id="374953083#-kopz5b_79"><p>Utiliza el patr&oacute;n Strategy para la ejecuci&oacute;n de procedimientos de integraci&oacute;n</p></li><li class="list-item" id="374953083#-kopz5b_80"><p>Gestiona opciones para omitir comportamientos predeterminados</p></li><li class="list-item" id="374953083#-kopz5b_81"><p>Proporciona manejo de errores con excepciones personalizadas</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1920880855">QuoteProductHandler</h1><section><h2 id="1920880855#descripci-n-general" data-toc="descripci-n-general#QuoteProductHandler.md-descripci-n-general">Descripci&oacute;n General</h2><p id="1920880855#-f0xf5l_18"><span class="inline-code" id="1920880855#-f0xf5l_19">QuoteProductHandler</span> es una clase virtual global que extiende <span class="inline-code" id="1920880855#-f0xf5l_20">ProductHandler</span>. Esta clase est&aacute; dise&ntilde;ada para gestionar el proceso de cotizaci&oacute;n de productos mediante la ejecuci&oacute;n de procedimientos de integraci&oacute;n, validando la estructura de los datos de entrada y gestionando los resultados.</p></section><section><h2 id="1920880855#autor" data-toc="autor#QuoteProductHandler.md-autor">Autor</h2><p id="1920880855#-f0xf5l_21">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="1920880855#ltima-modificaci-n" data-toc="ltima-modificaci-n#QuoteProductHandler.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="1920880855#-f0xf5l_22">21 de febrero de 2025 por Jean Carlos Melendez</p></section><section><h2 id="1920880855#constantes" data-toc="constantes#QuoteProductHandler.md-constantes">Constantes</h2><div class="table-wrapper detached"><table id="1920880855#-f0xf5l_23"><tr class="header-row" id="1920880855#-f0xf5l_24"><th id="1920880855#-f0xf5l_30"><p>Nombre</p></th><th id="1920880855#-f0xf5l_31"><p>Tipo</p></th><th id="1920880855#-f0xf5l_32"><p>Descripci&oacute;n</p></th></tr><tr class="" id="1920880855#-f0xf5l_25"><td id="1920880855#-f0xf5l_33"><p><span class="inline-code" id="1920880855#-f0xf5l_36">PROCESS_NAME</span></p></td><td id="1920880855#-f0xf5l_34"><p><span class="inline-code" id="1920880855#-f0xf5l_37">String</span></p></td><td id="1920880855#-f0xf5l_35"><p>Nombre del proceso: 'QUOTING'</p></td></tr><tr class="" id="1920880855#-f0xf5l_26"><td id="1920880855#-f0xf5l_38"><p><span class="inline-code" id="1920880855#-f0xf5l_41">MAIN_NODE</span></p></td><td id="1920880855#-f0xf5l_39"><p><span class="inline-code" id="1920880855#-f0xf5l_42">String</span></p></td><td id="1920880855#-f0xf5l_40"><p>Clave del nodo principal en los datos de entrada: 'quotepolicyJson'</p></td></tr><tr class="" id="1920880855#-f0xf5l_27"><td id="1920880855#-f0xf5l_43"><p><span class="inline-code" id="1920880855#-f0xf5l_46">OPTION_SKIP_BEHAVIOR</span></p></td><td id="1920880855#-f0xf5l_44"><p><span class="inline-code" id="1920880855#-f0xf5l_47">String</span></p></td><td id="1920880855#-f0xf5l_45"><p>Opci&oacute;n para omitir el comportamiento predeterminado: 'skipDefaultBehavior'</p></td></tr><tr class="" id="1920880855#-f0xf5l_28"><td id="1920880855#-f0xf5l_48"><p><span class="inline-code" id="1920880855#-f0xf5l_51">RATING_IPROCEDURE</span></p></td><td id="1920880855#-f0xf5l_49"><p><span class="inline-code" id="1920880855#-f0xf5l_52">String</span></p></td><td id="1920880855#-f0xf5l_50"><p>Nombre del procedimiento de integraci&oacute;n para cotizaci&oacute;n: 'sfcore_quotingprocedure'</p></td></tr><tr class="" id="1920880855#-f0xf5l_29"><td id="1920880855#-f0xf5l_53"><p><span class="inline-code" id="1920880855#-f0xf5l_56">REQUIRED_PARAMETERS</span></p></td><td id="1920880855#-f0xf5l_54"><p><span class="inline-code" id="1920880855#-f0xf5l_57">Set&lt;String&gt;</span></p></td><td id="1920880855#-f0xf5l_55"><p>Conjunto de par&aacute;metros requeridos para la cotizaci&oacute;n: 'term', 'productConfigurationDetail', 'insuredItems', 'additionalFields', 'OpportunityDetails'</p></td></tr></table></div></section><section><h2 id="1920880855#variables-globales" data-toc="variables-globales#QuoteProductHandler.md-variables-globales">Variables Globales</h2><div class="table-wrapper detached"><table id="1920880855#-f0xf5l_58"><tr class="header-row" id="1920880855#-f0xf5l_59"><th id="1920880855#-f0xf5l_61"><p>Nombre</p></th><th id="1920880855#-f0xf5l_62"><p>Tipo</p></th><th id="1920880855#-f0xf5l_63"><p>Descripci&oacute;n</p></th></tr><tr class="" id="1920880855#-f0xf5l_60"><td id="1920880855#-f0xf5l_64"><p><span class="inline-code" id="1920880855#-f0xf5l_67">EXECUTOR</span></p></td><td id="1920880855#-f0xf5l_65"><p><span class="inline-code" id="1920880855#-f0xf5l_68">IntegrationProcedureExecutor</span></p></td><td id="1920880855#-f0xf5l_66"><p>Ejecutor de procedimientos de integraci&oacute;n</p></td></tr></table></div></section><section><h2 id="1920880855#constructores" data-toc="constructores#QuoteProductHandler.md-constructores">Constructores</h2><section><h3 id="1920880855#quoteproducthandler-string-productname-integrationprocedureexecutor-executor" data-toc="quoteproducthandler-string-productname-integrationprocedureexecutor-executor#QuoteProductHandler.md-quoteproducthandler-string-productname-integrationprocedureexecutor-executor">QuoteProductHandler(String productName, IntegrationProcedureExecutor executor)</h3><section><h4 id="1920880855#descripci-n" data-toc="descripci-n#QuoteProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1920880855#-f0xf5l_76">Constructor que inicializa el handler con un nombre de producto espec&iacute;fico y un ejecutor de procedimientos de integraci&oacute;n personalizado.</p></section><section><h4 id="1920880855#par-metros" data-toc="par-metros#QuoteProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1920880855#-f0xf5l_77" start="1"><li class="list-item" id="1920880855#-f0xf5l_78"><p><span class="inline-code" id="1920880855#-f0xf5l_80">productName</span> (String): Nombre del producto a gestionar.</p></li><li class="list-item" id="1920880855#-f0xf5l_79"><p><span class="inline-code" id="1920880855#-f0xf5l_81">executor</span> (IntegrationProcedureExecutor): Ejecutor personalizado para los procedimientos de integraci&oacute;n.</p></li></ul></section><section><h4 id="1920880855#c-digo" data-toc="c-digo#QuoteProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1920880855#-f0xf5l_82"><pre><code class="language-none">global QuoteProductHandler(
  String productName,
  IntegrationProcedureExecutor executor
) {
  super(productName);
  this.EXECUTOR = executor;
}</code></pre></div></section></section><section><h3 id="1920880855#quoteproducthandler-string-productname" data-toc="quoteproducthandler-string-productname#QuoteProductHandler.md-quoteproducthandler-string-productname">QuoteProductHandler(String productName)</h3><section><h4 id="1920880855#descripci-n" data-toc="descripci-n#QuoteProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1920880855#-f0xf5l_88">Constructor alternativo que inicializa el handler con un nombre de producto espec&iacute;fico y un ejecutor mock por defecto.</p></section><section><h4 id="1920880855#par-metros" data-toc="par-metros#QuoteProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1920880855#-f0xf5l_89" start="1"><li class="list-item" id="1920880855#-f0xf5l_90"><p><span class="inline-code" id="1920880855#-f0xf5l_91">productName</span> (String): Nombre del producto a gestionar.</p></li></ul></section><section><h4 id="1920880855#c-digo" data-toc="c-digo#QuoteProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1920880855#-f0xf5l_92"><pre><code class="language-none">global QuoteProductHandler(String productName) {
  super(productName);
  this.EXECUTOR = new MockIntegrationProcedureExecutor();
}</code></pre></div></section></section></section><section><h2 id="1920880855#m-todos" data-toc="m-todos#QuoteProductHandler.md-m-todos">M&eacute;todos</h2><section><h3 id="1920880855#setobservers" data-toc="setobservers#QuoteProductHandler.md-setobservers">setObservers()</h3><section><h4 id="1920880855#descripci-n" data-toc="descripci-n#QuoteProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1920880855#-f0xf5l_103">M&eacute;todo sobrescrito que configura los observadores para el handler, espec&iacute;ficamente a&ntilde;adiendo un <span class="inline-code" id="1920880855#-f0xf5l_104">QuoteObserver</span>.</p></section><section><h4 id="1920880855#retorno" data-toc="retorno#QuoteProductHandler.md-retorno">Retorno</h4><ul class="list" id="1920880855#-f0xf5l_105" start="1"><li class="list-item" id="1920880855#-f0xf5l_106"><p><span class="inline-code" id="1920880855#-f0xf5l_107">void</span></p></li></ul></section><section><h4 id="1920880855#c-digo" data-toc="c-digo#QuoteProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1920880855#-f0xf5l_108"><pre><code class="language-none">public override void setObservers() {
  this.addObserver(new QuoteObserver());
}</code></pre></div></section></section><section><h3 id="1920880855#process-map-string-object-options-map-string-object-input-map-string-object-output" data-toc="process-map-string-object-options-map-string-object-input-map-string-object-output#QuoteProductHandler.md-process-map-string-object-options-map-string-object-input-map-string-object-output">process(Map&lt;String, Object&gt; options, Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; output)</h3><section><h4 id="1920880855#descripci-n" data-toc="descripci-n#QuoteProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1920880855#-f0xf5l_116">M&eacute;todo principal sobrescrito que procesa la cotizaci&oacute;n del producto utilizando un procedimiento de integraci&oacute;n y gestiona los resultados.</p></section><section><h4 id="1920880855#par-metros" data-toc="par-metros#QuoteProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1920880855#-f0xf5l_117" start="1"><li class="list-item" id="1920880855#-f0xf5l_118"><p><span class="inline-code" id="1920880855#-f0xf5l_121">options</span> (Map&lt;String, Object&gt;): Opciones adicionales para el proceso.</p></li><li class="list-item" id="1920880855#-f0xf5l_119"><p><span class="inline-code" id="1920880855#-f0xf5l_122">input</span> (Map&lt;String, Object&gt;): Datos de entrada para el proceso.</p></li><li class="list-item" id="1920880855#-f0xf5l_120"><p><span class="inline-code" id="1920880855#-f0xf5l_123">output</span> (Map&lt;String, Object&gt;): Mapa de salida donde se guardar&aacute;n los resultados.</p></li></ul></section><section><h4 id="1920880855#retorno" data-toc="retorno#QuoteProductHandler.md-retorno">Retorno</h4><ul class="list" id="1920880855#-f0xf5l_124" start="1"><li class="list-item" id="1920880855#-f0xf5l_125"><p><span class="inline-code" id="1920880855#-f0xf5l_126">Map&lt;String, Object&gt;</span>: Mapa con los datos de la cotizaci&oacute;n creada.</p></li></ul></section><section><h4 id="1920880855#proceso" data-toc="proceso#QuoteProductHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="1920880855#-f0xf5l_127" type="1" start="1"><li class="list-item" id="1920880855#-f0xf5l_128"><p>Verifica si se debe omitir el comportamiento predeterminado seg&uacute;n las opciones.</p></li><li class="list-item" id="1920880855#-f0xf5l_129"><p>Valida la estructura de los datos de entrada utilizando <span class="inline-code" id="1920880855#-f0xf5l_137">validateInputMapForQuoting</span>.</p></li><li class="list-item" id="1920880855#-f0xf5l_130"><p>Si la validaci&oacute;n falla, lanza una excepci&oacute;n con el mensaje de error.</p></li><li class="list-item" id="1920880855#-f0xf5l_131"><p>Establece el nombre del proceso como 'Quoting'.</p></li><li class="list-item" id="1920880855#-f0xf5l_132"><p>Ejecuta el procedimiento de integraci&oacute;n.</p></li><li class="list-item" id="1920880855#-f0xf5l_133"><p>Actualiza el mapa de salida con los resultados.</p></li><li class="list-item" id="1920880855#-f0xf5l_134"><p>Establece el proceso de respuesta.</p></li><li class="list-item" id="1920880855#-f0xf5l_135"><p>A&ntilde;ade los datos de entrada originales al mapa de salida.</p></li><li class="list-item" id="1920880855#-f0xf5l_136"><p>Devuelve el mapa de salida completo.</p></li></ol></section><section><h4 id="1920880855#c-digo" data-toc="c-digo#QuoteProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1920880855#-f0xf5l_138"><pre><code class="language-none">public override Map&lt;String, Object&gt; process(
  Map&lt;String, Object&gt; options,
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; output
) {
  if (options?.containsKey(OPTION_SKIP_BEHAVIOR)) {
    return input;
  }

  Map&lt;Boolean, Object&gt; validation = QuoteProductHandler.validateInputMapForQuoting(
    input
  );
  if (validation.containsKey(false)) {
    throw new ProductHandlerImplementationException(
      validation.get(false).toString(),
      'UNPROCESSABLE_ENTITY',
      422
    );
  }

  this.setProcessName('Quoting');

  Map&lt;String, Object&gt; resultProcess = executeIntegrationProcedure(input);
  Core.getSymmaryLimits();
  output.clear();
  output.putAll(resultProcess);
  this.setResponseProcess(output);
  output.putAll(input);

  return output;
}</code></pre></div></section></section><section><h3 id="1920880855#executeintegrationprocedure-map-string-object-ipinput" data-toc="executeintegrationprocedure-map-string-object-ipinput#QuoteProductHandler.md-executeintegrationprocedure-map-string-object-ipinput">executeIntegrationProcedure(Map&lt;String, Object&gt; ipInput)</h3><section><h4 id="1920880855#descripci-n" data-toc="descripci-n#QuoteProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1920880855#-f0xf5l_145">Ejecuta el procedimiento de integraci&oacute;n para la cotizaci&oacute;n del producto.</p></section><section><h4 id="1920880855#par-metros" data-toc="par-metros#QuoteProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1920880855#-f0xf5l_146" start="1"><li class="list-item" id="1920880855#-f0xf5l_147"><p><span class="inline-code" id="1920880855#-f0xf5l_148">ipInput</span> (Map&lt;String, Object&gt;): Datos de entrada para el procedimiento de integraci&oacute;n.</p></li></ul></section><section><h4 id="1920880855#retorno" data-toc="retorno#QuoteProductHandler.md-retorno">Retorno</h4><ul class="list" id="1920880855#-f0xf5l_149" start="1"><li class="list-item" id="1920880855#-f0xf5l_150"><p><span class="inline-code" id="1920880855#-f0xf5l_151">Map&lt;String, Object&gt;</span>: Mapa con los resultados del procedimiento de integraci&oacute;n.</p></li></ul></section><section><h4 id="1920880855#c-digo" data-toc="c-digo#QuoteProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1920880855#-f0xf5l_152"><pre><code class="language-none">public Map&lt;String, Object&gt; executeIntegrationProcedure(
  Map&lt;String, Object&gt; ipInput
) {
  return new Map&lt;String, Object&gt;{
    'resultProcess' =&gt; EXECUTOR.execute(RATING_IPROCEDURE, ipInput)
  };
}</code></pre></div></section></section><section><h3 id="1920880855#validateinputmapforquoting-map-string-object-inputmap" data-toc="validateinputmapforquoting-map-string-object-inputmap#QuoteProductHandler.md-validateinputmapforquoting-map-string-object-inputmap">validateInputMapForQuoting(Map&lt;String, Object&gt; inputMap)</h3><section><h4 id="1920880855#descripci-n" data-toc="descripci-n#QuoteProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1920880855#-f0xf5l_160">M&eacute;todo est&aacute;tico que verifica si todos los nodos principales requeridos est&aacute;n presentes en el mapa de entrada.</p></section><section><h4 id="1920880855#par-metros" data-toc="par-metros#QuoteProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1920880855#-f0xf5l_161" start="1"><li class="list-item" id="1920880855#-f0xf5l_162"><p><span class="inline-code" id="1920880855#-f0xf5l_163">inputMap</span> (Map&lt;String, Object&gt;): Mapa de entrada que contiene los datos a validar.</p></li></ul></section><section><h4 id="1920880855#retorno" data-toc="retorno#QuoteProductHandler.md-retorno">Retorno</h4><ul class="list" id="1920880855#-f0xf5l_164" start="1"><li class="list-item" id="1920880855#-f0xf5l_165"><p><span class="inline-code" id="1920880855#-f0xf5l_166">Map&lt;Boolean, Object&gt;</span>: Mapa con el resultado de la validaci&oacute;n. La clave es un booleano que indica si la validaci&oacute;n fue exitosa, y el valor es un mensaje descriptivo.</p></li></ul></section><section><h4 id="1920880855#proceso" data-toc="proceso#QuoteProductHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="1920880855#-f0xf5l_167" type="1" start="1"><li class="list-item" id="1920880855#-f0xf5l_168"><p>Verifica la existencia del nodo principal (<span class="inline-code" id="1920880855#-f0xf5l_172">MAIN_NODE</span>).</p></li><li class="list-item" id="1920880855#-f0xf5l_169"><p>Obtiene el mapa correspondiente al nodo principal.</p></li><li class="list-item" id="1920880855#-f0xf5l_170"><p>Verifica la existencia de cada uno de los par&aacute;metros requeridos definidos en <span class="inline-code" id="1920880855#-f0xf5l_173">REQUIRED_PARAMETERS</span>.</p></li><li class="list-item" id="1920880855#-f0xf5l_171"><p>Devuelve un mapa con el resultado de la validaci&oacute;n y un mensaje descriptivo.</p></li></ol></section><section><h4 id="1920880855#c-digo" data-toc="c-digo#QuoteProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1920880855#-f0xf5l_174"><pre><code class="language-none">public static Map&lt;Boolean, Object&gt; validateInputMapForQuoting(
  Map&lt;String, Object&gt; inputMap
) {
  if (!inputMap.containsKey(MAIN_NODE) || inputMap?.get(MAIN_NODE) == null) {
    return createValidationResult(
      false,
      'Falta el nodo principal requerido: ' + MAIN_NODE
    );
  }
  Map&lt;String, Object&gt; mainNode = (Map&lt;String, Object&gt;) inputMap.get(
    MAIN_NODE
  );

  for (String node : REQUIRED_PARAMETERS) {
    if (!mainNode.containsKey(node)) {
      return createValidationResult(
        false,
        'Falta el nodo requerido: ' + node
      );
    }
  }
  System.debug('Todos los nodos requeridos están presentes.');
  return createValidationResult(
    true,
    'Todos los parámetros requeridos están presentes.'
  );
}</code></pre></div></section></section><section><h3 id="1920880855#createvalidationresult-boolean-isvalid-string-message" data-toc="createvalidationresult-boolean-isvalid-string-message#QuoteProductHandler.md-createvalidationresult-boolean-isvalid-string-message">createValidationResult(Boolean isValid, String message)</h3><section><h4 id="1920880855#descripci-n" data-toc="descripci-n#QuoteProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1920880855#-f0xf5l_181">M&eacute;todo privado est&aacute;tico que crea un mapa est&aacute;ndar para representar el resultado de una validaci&oacute;n.</p></section><section><h4 id="1920880855#par-metros" data-toc="par-metros#QuoteProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1920880855#-f0xf5l_182" start="1"><li class="list-item" id="1920880855#-f0xf5l_183"><p><span class="inline-code" id="1920880855#-f0xf5l_185">isValid</span> (Boolean): Indicador de si la validaci&oacute;n fue exitosa.</p></li><li class="list-item" id="1920880855#-f0xf5l_184"><p><span class="inline-code" id="1920880855#-f0xf5l_186">message</span> (String): Mensaje descriptivo del resultado.</p></li></ul></section><section><h4 id="1920880855#retorno" data-toc="retorno#QuoteProductHandler.md-retorno">Retorno</h4><ul class="list" id="1920880855#-f0xf5l_187" start="1"><li class="list-item" id="1920880855#-f0xf5l_188"><p><span class="inline-code" id="1920880855#-f0xf5l_189">Map&lt;Boolean, Object&gt;</span>: Mapa con el estado de validaci&oacute;n y el mensaje.</p></li></ul></section><section><h4 id="1920880855#c-digo" data-toc="c-digo#QuoteProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1920880855#-f0xf5l_190"><pre><code class="language-none">private static Map&lt;Boolean, Object&gt; createValidationResult(
  Boolean isValid,
  String message
) {
  return new Map&lt;Boolean, Object&gt;{ isValid =&gt; message };
}</code></pre></div></section></section></section><section><h2 id="1920880855#excepciones" data-toc="excepciones#QuoteProductHandler.md-excepciones">Excepciones</h2><section><h3 id="1920880855#producthandlerimplementationexception" data-toc="producthandlerimplementationexception#QuoteProductHandler.md-producthandlerimplementationexception">ProductHandlerImplementationException</h3><p id="1920880855#-f0xf5l_193">Esta excepci&oacute;n se lanza cuando la validaci&oacute;n de los datos de entrada falla, indicando qu&eacute; nodo requerido est&aacute; faltando. Se lanza con el c&oacute;digo HTTP 422 (UNPROCESSABLE_ENTITY).</p></section></section><section><h2 id="1920880855#dependencias" data-toc="dependencias#QuoteProductHandler.md-dependencias">Dependencias</h2><ul class="list" id="1920880855#-f0xf5l_195" start="1"><li class="list-item" id="1920880855#-f0xf5l_196"><p><span class="inline-code" id="1920880855#-f0xf5l_202">ProductHandler</span>: Clase base que <span class="inline-code" id="1920880855#-f0xf5l_203">QuoteProductHandler</span> extiende.</p></li><li class="list-item" id="1920880855#-f0xf5l_197"><p><span class="inline-code" id="1920880855#-f0xf5l_204">IntegrationProcedureExecutor</span>: Interfaz o clase que define el m&eacute;todo <span class="inline-code" id="1920880855#-f0xf5l_205">execute</span> para ejecutar procedimientos de integraci&oacute;n.</p></li><li class="list-item" id="1920880855#-f0xf5l_198"><p><span class="inline-code" id="1920880855#-f0xf5l_206">MockIntegrationProcedureExecutor</span>: Implementaci&oacute;n mock de <span class="inline-code" id="1920880855#-f0xf5l_207">IntegrationProcedureExecutor</span> utilizada en el constructor alternativo.</p></li><li class="list-item" id="1920880855#-f0xf5l_199"><p><span class="inline-code" id="1920880855#-f0xf5l_208">QuoteObserver</span>: Clase observadora a&ntilde;adida en el m&eacute;todo <span class="inline-code" id="1920880855#-f0xf5l_209">setObservers()</span>.</p></li><li class="list-item" id="1920880855#-f0xf5l_200"><p><span class="inline-code" id="1920880855#-f0xf5l_210">Core</span>: Clase utilitaria que proporciona m&eacute;todos como <span class="inline-code" id="1920880855#-f0xf5l_211">getSymmaryLimits()</span>.</p></li><li class="list-item" id="1920880855#-f0xf5l_201"><p><span class="inline-code" id="1920880855#-f0xf5l_212">ProductHandlerImplementationException</span>: Excepci&oacute;n personalizada lanzada cuando hay errores en el proceso.</p></li></ul></section><section><h2 id="1920880855#patrones-de-dise-o-implementados" data-toc="patrones-de-dise-o-implementados#QuoteProductHandler.md-patrones-de-dise-o-implementados">Patrones de Dise&ntilde;o Implementados</h2><section><h3 id="1920880855#observer" data-toc="observer#QuoteProductHandler.md-observer">Observer</h3><p id="1920880855#-f0xf5l_215">A trav&eacute;s del m&eacute;todo <span class="inline-code" id="1920880855#-f0xf5l_216">setObservers()</span>, la clase implementa el patr&oacute;n Observer, permitiendo que otros objetos (espec&iacute;ficamente, <span class="inline-code" id="1920880855#-f0xf5l_217">QuoteObserver</span>) sean notificados de eventos durante el procesamiento.</p></section><section><h3 id="1920880855#strategy" data-toc="strategy#QuoteProductHandler.md-strategy">Strategy</h3><p id="1920880855#-f0xf5l_218">La clase utiliza el patr&oacute;n Strategy al recibir un <span class="inline-code" id="1920880855#-f0xf5l_219">IntegrationProcedureExecutor</span> que puede tener diferentes implementaciones, permitiendo cambiar el comportamiento de ejecuci&oacute;n de procedimientos de integraci&oacute;n sin modificar el c&oacute;digo de la clase.</p></section></section><section><h2 id="1920880855#flujo-de-proceso" data-toc="flujo-de-proceso#QuoteProductHandler.md-flujo-de-proceso">Flujo de Proceso</h2><p id="1920880855#-f0xf5l_220">El proceso de cotizaci&oacute;n sigue el siguiente flujo:</p><ol class="list list-decimal" id="1920880855#-f0xf5l_221" type="1" start="1"><li class="list-item" id="1920880855#-f0xf5l_222"><p><span class="control" id="1920880855#-f0xf5l_227">Validaci&oacute;n</span>: Verifica que todos los nodos y par&aacute;metros requeridos est&eacute;n presentes en los datos de entrada.</p></li><li class="list-item" id="1920880855#-f0xf5l_223"><p><span class="control" id="1920880855#-f0xf5l_228">Preparaci&oacute;n</span>: Establece el nombre del proceso como 'Quoting'.</p></li><li class="list-item" id="1920880855#-f0xf5l_224"><p><span class="control" id="1920880855#-f0xf5l_229">Ejecuci&oacute;n</span>: Llama al procedimiento de integraci&oacute;n a trav&eacute;s del executor.</p></li><li class="list-item" id="1920880855#-f0xf5l_225"><p><span class="control" id="1920880855#-f0xf5l_230">Gesti&oacute;n de Resultados</span>: Actualiza el mapa de salida con los resultados y a&ntilde;ade los datos de entrada originales.</p></li><li class="list-item" id="1920880855#-f0xf5l_226"><p><span class="control" id="1920880855#-f0xf5l_231">Notificaci&oacute;n</span>: Notifica a los observadores registrados a trav&eacute;s del m&eacute;todo heredado <span class="inline-code" id="1920880855#-f0xf5l_232">setResponseProcess</span>.</p></li></ol></section><section><h2 id="1920880855#estructura-de-datos-de-entrada" data-toc="estructura-de-datos-de-entrada#QuoteProductHandler.md-estructura-de-datos-de-entrada">Estructura de Datos de Entrada</h2><p id="1920880855#-f0xf5l_233">Para que el proceso de cotizaci&oacute;n funcione correctamente, los datos de entrada deben tener la siguiente estructura:</p><div class="detached code-block" id="1920880855#-f0xf5l_234"><pre><code class="language-json">{
  &quot;quotepolicyJson&quot;: {
    &quot;term&quot;: { /* ... */ },
    &quot;productConfigurationDetail&quot;: { /* ... */ },
    &quot;insuredItems&quot;: [ /* ... */ ],
    &quot;additionalFields&quot;: { /* ... */ },
    &quot;OpportunityDetails&quot;: { /* ... */ }
  },
  /* Otros campos opcionales */
}</code></pre></div></section><section><h2 id="1920880855#ejemplo-de-uso" data-toc="ejemplo-de-uso#QuoteProductHandler.md-ejemplo-de-uso">Ejemplo de Uso</h2><div class="detached code-block" id="1920880855#-f0xf5l_235"><pre><code class="language-none">// Crear el ejecutor de procedimientos de integración
IntegrationProcedureExecutor executor = new SomeIntegrationProcedureExecutor();

// Instanciar el handler
QuoteProductHandler handler = new QuoteProductHandler('AutoInsurance', executor);

// Preparar los datos de entrada
Map&lt;String, Object&gt; term = new Map&lt;String, Object&gt;{
  'startDate' =&gt; Date.today(),
  'endDate' =&gt; Date.today().addYears(1)
};

Map&lt;String, Object&gt; productConfigDetail = new Map&lt;String, Object&gt;{
  'productCode' =&gt; 'AUTO-001',
  'coverageLevel' =&gt; 'Premium'
};

List&lt;Map&lt;String, Object&gt;&gt; insuredItems = new List&lt;Map&lt;String, Object&gt;&gt;{
  new Map&lt;String, Object&gt;{
    'type' =&gt; 'Vehicle',
    'make' =&gt; 'Toyota',
    'model' =&gt; 'Corolla',
    'year' =&gt; 2020
  }
};

Map&lt;String, Object&gt; additionalFields = new Map&lt;String, Object&gt;{
  'discountCode' =&gt; 'NEWCUST10'
};

Map&lt;String, Object&gt; opportunityDetails = new Map&lt;String, Object&gt;{
  'opportunityId' =&gt; '0061x00000AbCdEf',
  'accountId' =&gt; '0011x00000GhIjKl'
};

Map&lt;String, Object&gt; quotepolicyJson = new Map&lt;String, Object&gt;{
  'term' =&gt; term,
  'productConfigurationDetail' =&gt; productConfigDetail,
  'insuredItems' =&gt; insuredItems,
  'additionalFields' =&gt; additionalFields,
  'OpportunityDetails' =&gt; opportunityDetails
};

Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
  'quotepolicyJson' =&gt; quotepolicyJson
};

// Mapas para opciones y salida
Map&lt;String, Object&gt; options = new Map&lt;String, Object&gt;();
Map&lt;String, Object&gt; output = new Map&lt;String, Object&gt;();

try {
  // Procesar la cotización
  Map&lt;String, Object&gt; result = handler.process(options, input, output);
  
  // Obtener los resultados
  Map&lt;String, Object&gt; resultProcess = (Map&lt;String, Object&gt;)result.get('resultProcess');
  System.debug('Cotización completada. Resultado: ' + resultProcess);
} catch (ProductHandlerImplementationException e) {
  System.debug('Error en el proceso de cotización: ' + e.getMessage());
}</code></pre></div></section><section><h2 id="1920880855#extensi-n-de-la-clase" data-toc="extensi-n-de-la-clase#QuoteProductHandler.md-extensi-n-de-la-clase">Extensi&oacute;n de la Clase</h2><div class="detached code-block" id="1920880855#-f0xf5l_236"><pre><code class="language-none">public class SpecializedQuoteHandler extends QuoteProductHandler {
    
    public SpecializedQuoteHandler(String productName) {
        super(productName);
    }
    
    // Sobrescribir el método para añadir validaciones adicionales
    public override Map&lt;String, Object&gt; process(
        Map&lt;String, Object&gt; options,
        Map&lt;String, Object&gt; input,
        Map&lt;String, Object&gt; output
    ) {
        // Realizar validaciones adicionales específicas
        Map&lt;String, Object&gt; quotepolicyJson = (Map&lt;String, Object&gt;)input.get(MAIN_NODE);
        if (quotepolicyJson != null) {
            Map&lt;String, Object&gt; term = (Map&lt;String, Object&gt;)quotepolicyJson.get('term');
            if (term != null) {
                Date startDate = (Date)term.get('startDate');
                Date endDate = (Date)term.get('endDate');
                
                if (startDate != null &amp;&amp; endDate != null &amp;&amp; startDate &gt; endDate) {
                    throw new ProductHandlerImplementationException(
                        'La fecha de inicio no puede ser posterior a la fecha de fin',
                        'UNPROCESSABLE_ENTITY',
                        422
                    );
                }
            }
        }
        
        // Llamar al método base para continuar con el procesamiento estándar
        return super.process(options, input, output);
    }
    
    // Sobrescribir el método para personalizar la ejecución del procedimiento
    public override Map&lt;String, Object&gt; executeIntegrationProcedure(
        Map&lt;String, Object&gt; ipInput
    ) {
        // Agregar datos adicionales al input antes de ejecutar
        Map&lt;String, Object&gt; quotepolicyJson = (Map&lt;String, Object&gt;)ipInput.get(MAIN_NODE);
        Map&lt;String, Object&gt; additionalFields = (Map&lt;String, Object&gt;)quotepolicyJson.get('additionalFields');
        
        // Añadir un campo adicional
        additionalFields.put('handlerType', 'Specialized');
        
        // Ejecutar el procedimiento y procesar los resultados
        Map&lt;String, Object&gt; results = super.executeIntegrationProcedure(ipInput);
        
        // Realizar procesamientos adicionales en los resultados si es necesario
        
        return results;
    }
}</code></pre></div></section><section><h2 id="1920880855#notas-adicionales" data-toc="notas-adicionales#QuoteProductHandler.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="1920880855#-f0xf5l_237" type="1" start="1"><li class="list-item" id="1920880855#-f0xf5l_238"><p>La clase utiliza el operador de navegaci&oacute;n segura (<span class="inline-code" id="1920880855#-f0xf5l_244">?.</span>) para evitar excepciones de referencia nula al acceder a valores en mapas.</p></li><li class="list-item" id="1920880855#-f0xf5l_239"><p>La clase implementa un mecanismo para omitir su comportamiento predeterminado si la opci&oacute;n <span class="inline-code" id="1920880855#-f0xf5l_245">skipDefaultBehavior</span> est&aacute; presente.</p></li><li class="list-item" id="1920880855#-f0xf5l_240"><p>El m&eacute;todo <span class="inline-code" id="1920880855#-f0xf5l_246">executeIntegrationProcedure</span> encapsula la ejecuci&oacute;n del procedimiento de integraci&oacute;n, facilitando la prueba unitaria y la extensibilidad.</p></li><li class="list-item" id="1920880855#-f0xf5l_241"><p>La validaci&oacute;n de la estructura de datos de entrada se realiza a trav&eacute;s de un m&eacute;todo est&aacute;tico, lo que permite su reutilizaci&oacute;n en otras partes del c&oacute;digo.</p></li><li class="list-item" id="1920880855#-f0xf5l_242"><p>La salida del proceso incluye tanto los resultados del procedimiento de integraci&oacute;n como los datos de entrada originales, proporcionando un contexto completo.</p></li><li class="list-item" id="1920880855#-f0xf5l_243"><p>La llamada a <span class="inline-code" id="1920880855#-f0xf5l_247">Core.getSymmaryLimits()</span> sugiere que se est&aacute; realizando alg&uacute;n tipo de monitoreo o registro de los l&iacute;mites de recursos durante el proceso.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-2130585883">ProductHandlerNotImplementedException</h1><section><h2 id="-2130585883#descripci-n-general" data-toc="descripci-n-general#ProductHandlerNotImplementedException.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-2130585883#-xt4pon_17"><span class="inline-code" id="-2130585883#-xt4pon_18">ProductHandlerNotImplementedException</span> es una clase de excepci&oacute;n personalizada que extiende la clase <span class="inline-code" id="-2130585883#-xt4pon_19">Exception</span> est&aacute;ndar de Apex. Esta clase est&aacute; dise&ntilde;ada para representar errores espec&iacute;ficos que ocurren cuando se intenta utilizar un manejador de productos que no ha sido implementado correctamente o cuando se intenta acceder a funcionalidades no implementadas dentro de un manejador de productos.</p></section><section><h2 id="-2130585883#autor" data-toc="autor#ProductHandlerNotImplementedException.md-autor">Autor</h2><p id="-2130585883#-xt4pon_20">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="-2130585883#ltima-modificaci-n" data-toc="ltima-modificaci-n#ProductHandlerNotImplementedException.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="-2130585883#-xt4pon_21">20 de agosto de 2024</p></section><section><h2 id="-2130585883#estructura" data-toc="estructura#ProductHandlerNotImplementedException.md-estructura">Estructura</h2><div class="detached code-block" id="-2130585883#-xt4pon_22"><pre><code class="language-none">public with sharing class ProductHandlerNotImplementedException extends Exception {
}</code></pre></div><p id="-2130585883#-xt4pon_23">La clase tiene una implementaci&oacute;n minimalista, sin agregar m&eacute;todos o propiedades adicionales m&aacute;s all&aacute; de los heredados de la clase base <span class="inline-code" id="-2130585883#-xt4pon_24">Exception</span>.</p></section><section><h2 id="-2130585883#herencia" data-toc="herencia#ProductHandlerNotImplementedException.md-herencia">Herencia</h2><ul class="list" id="-2130585883#-xt4pon_25" start="1"><li class="list-item" id="-2130585883#-xt4pon_26"><p><span class="control" id="-2130585883#-xt4pon_28">Clase Base</span>: <span class="inline-code" id="-2130585883#-xt4pon_29">Exception</span></p></li><li class="list-item" id="-2130585883#-xt4pon_27"><p><span class="control" id="-2130585883#-xt4pon_30">Modificadores</span>: <span class="inline-code" id="-2130585883#-xt4pon_31">public with sharing</span></p></li></ul></section><section><h2 id="-2130585883#prop-sito" data-toc="prop-sito#ProductHandlerNotImplementedException.md-prop-sito">Prop&oacute;sito</h2><p id="-2130585883#-xt4pon_32">El prop&oacute;sito principal de esta clase es proporcionar un tipo de excepci&oacute;n espec&iacute;fico para errores relacionados con implementaciones faltantes o incompletas en manejadores de productos, permitiendo:</p><ol class="list list-decimal" id="-2130585883#-xt4pon_33" type="1" start="1"><li class="list-item" id="-2130585883#-xt4pon_34"><p><span class="control" id="-2130585883#-xt4pon_38">Especificidad del Error</span>: Distinguir claramente los errores de &quot;no implementado&quot; de otros tipos de excepciones en el sistema de manejo de productos.</p></li><li class="list-item" id="-2130585883#-xt4pon_35"><p><span class="control" id="-2130585883#-xt4pon_39">Manejo Espec&iacute;fico</span>: Permitir que el c&oacute;digo que captura excepciones pueda identificar y manejar espec&iacute;ficamente casos donde una funcionalidad requerida no est&aacute; implementada.</p></li><li class="list-item" id="-2130585883#-xt4pon_36"><p><span class="control" id="-2130585883#-xt4pon_40">Claridad en el C&oacute;digo</span>: Mejorar la legibilidad del c&oacute;digo al indicar expl&iacute;citamente cuando se est&aacute; tratando con un caso de funcionalidad no implementada.</p></li><li class="list-item" id="-2130585883#-xt4pon_37"><p><span class="control" id="-2130585883#-xt4pon_41">Documentaci&oacute;n Impl&iacute;cita</span>: Servir como recordatorio para los desarrolladores de que ciertas funcionalidades a&uacute;n necesitan ser implementadas.</p></li></ol></section><section><h2 id="-2130585883#m-todos-heredados" data-toc="m-todos-heredados#ProductHandlerNotImplementedException.md-m-todos-heredados">M&eacute;todos Heredados</h2><p id="-2130585883#-xt4pon_42">Al extender la clase <span class="inline-code" id="-2130585883#-xt4pon_45">Exception</span> est&aacute;ndar, <span class="inline-code" id="-2130585883#-xt4pon_46">ProductHandlerNotImplementedException</span> hereda los siguientes m&eacute;todos y propiedades:</p><section><h3 id="-2130585883#constructores" data-toc="constructores#ProductHandlerNotImplementedException.md-constructores">Constructores</h3><ul class="list" id="-2130585883#-xt4pon_47" start="1"><li class="list-item" id="-2130585883#-xt4pon_48"><p><span class="control" id="-2130585883#-xt4pon_52"><span class="inline-code" id="-2130585883#-xt4pon_53">ProductHandlerNotImplementedException()</span></span>: Constructor por defecto.</p></li><li class="list-item" id="-2130585883#-xt4pon_49"><p><span class="control" id="-2130585883#-xt4pon_54"><span class="inline-code" id="-2130585883#-xt4pon_55">ProductHandlerNotImplementedException(String message)</span></span>: Constructor que acepta un mensaje de error.</p></li><li class="list-item" id="-2130585883#-xt4pon_50"><p><span class="control" id="-2130585883#-xt4pon_56"><span class="inline-code" id="-2130585883#-xt4pon_57">ProductHandlerNotImplementedException(Exception cause)</span></span>: Constructor que acepta otra excepci&oacute;n como causa.</p></li><li class="list-item" id="-2130585883#-xt4pon_51"><p><span class="control" id="-2130585883#-xt4pon_58"><span class="inline-code" id="-2130585883#-xt4pon_59">ProductHandlerNotImplementedException(String message, Exception cause)</span></span>: Constructor que acepta un mensaje y otra excepci&oacute;n como causa.</p></li></ul></section><section><h3 id="-2130585883#m-todos" data-toc="m-todos#ProductHandlerNotImplementedException.md-m-todos">M&eacute;todos</h3><ul class="list" id="-2130585883#-xt4pon_60" start="1"><li class="list-item" id="-2130585883#-xt4pon_61"><p><span class="control" id="-2130585883#-xt4pon_67"><span class="inline-code" id="-2130585883#-xt4pon_68">getMessage()</span></span>: Devuelve el mensaje de error asociado con la excepci&oacute;n.</p></li><li class="list-item" id="-2130585883#-xt4pon_62"><p><span class="control" id="-2130585883#-xt4pon_69"><span class="inline-code" id="-2130585883#-xt4pon_70">getCause()</span></span>: Devuelve la excepci&oacute;n que caus&oacute; esta excepci&oacute;n, si existe.</p></li><li class="list-item" id="-2130585883#-xt4pon_63"><p><span class="control" id="-2130585883#-xt4pon_71"><span class="inline-code" id="-2130585883#-xt4pon_72">getTypeName()</span></span>: Devuelve el nombre del tipo de excepci&oacute;n.</p></li><li class="list-item" id="-2130585883#-xt4pon_64"><p><span class="control" id="-2130585883#-xt4pon_73"><span class="inline-code" id="-2130585883#-xt4pon_74">setMessage(String message)</span></span>: Establece el mensaje de error para la excepci&oacute;n.</p></li><li class="list-item" id="-2130585883#-xt4pon_65"><p><span class="control" id="-2130585883#-xt4pon_75"><span class="inline-code" id="-2130585883#-xt4pon_76">getLineNumber()</span></span>: Devuelve el n&uacute;mero de l&iacute;nea donde se gener&oacute; la excepci&oacute;n.</p></li><li class="list-item" id="-2130585883#-xt4pon_66"><p><span class="control" id="-2130585883#-xt4pon_77"><span class="inline-code" id="-2130585883#-xt4pon_78">getStackTraceString()</span></span>: Devuelve una representaci&oacute;n de texto del seguimiento de la pila.</p></li></ul></section></section><section><h2 id="-2130585883#ejemplos-de-uso" data-toc="ejemplos-de-uso#ProductHandlerNotImplementedException.md-ejemplos-de-uso">Ejemplos de Uso</h2><section><h3 id="-2130585883#ejemplo-1-m-todo-abstracto-no-implementado" data-toc="ejemplo-1-m-todo-abstracto-no-implementado#ProductHandlerNotImplementedException.md-ejemplo-1-m-todo-abstracto-no-implementado">Ejemplo 1: M&eacute;todo Abstracto No Implementado</h3><div class="detached code-block" id="-2130585883#-xt4pon_82"><pre><code class="language-none">public abstract class AbstractProductHandler {
    
    public abstract void processProduct(Product2 product);
    
    public void validateAndProcess(Product2 product) {
        // Validar el producto
        if (product == null) {
            throw new IllegalArgumentException('El producto no puede ser nulo');
        }
        
        // Ejecutar el procesamiento específico del producto
        try {
            processProduct(product);
        } catch (System.MethodNotImplementedException e) {
            // Capturar la excepción estándar y lanzar nuestra excepción personalizada
            throw new ProductHandlerNotImplementedException(
                'El método processProduct no está implementado para el manejador ' + 
                this.getClass().getName(), e
            );
        }
    }
}

public class IncompleteProductHandler extends AbstractProductHandler {
    // Nota: No se implementa el método abstracto processProduct
    // Esto generará un error en tiempo de ejecución
}

// Uso
try {
    AbstractProductHandler handler = new IncompleteProductHandler();
    Product2 product = [SELECT Id, Name FROM Product2 LIMIT 1];
    handler.validateAndProcess(product);
} catch (ProductHandlerNotImplementedException e) {
    System.debug('Error: ' + e.getMessage());
    // Manejar el caso específico de método no implementado
}</code></pre></div></section><section><h3 id="-2130585883#ejemplo-2-funcionalidad-no-implementada" data-toc="ejemplo-2-funcionalidad-no-implementada#ProductHandlerNotImplementedException.md-ejemplo-2-funcionalidad-no-implementada">Ejemplo 2: Funcionalidad No Implementada</h3><div class="detached code-block" id="-2130585883#-xt4pon_83"><pre><code class="language-none">public class GenericProductHandler {
    
    public void processProduct(String productType, Map&lt;String, Object&gt; productData) {
        switch on productType.toUpperCase() {
            when 'HARDWARE' {
                processHardwareProduct(productData);
            }
            when 'SOFTWARE' {
                processSoftwareProduct(productData);
            }
            when 'SERVICE' {
                // Esta funcionalidad aún no está implementada
                throw new ProductHandlerNotImplementedException(
                    'El procesamiento de productos de tipo SERVICE no está implementado todavía'
                );
            }
            when else {
                throw new IllegalArgumentException('Tipo de producto no reconocido: ' + productType);
            }
        }
    }
    
    private void processHardwareProduct(Map&lt;String, Object&gt; productData) {
        // Implementación para productos de hardware
    }
    
    private void processSoftwareProduct(Map&lt;String, Object&gt; productData) {
        // Implementación para productos de software
    }
}

// Uso
try {
    GenericProductHandler handler = new GenericProductHandler();
    Map&lt;String, Object&gt; productData = new Map&lt;String, Object&gt;{ 
        'name' =&gt; 'Servicio de Mantenimiento',
        'price' =&gt; 1200.00
    };
    handler.processProduct('SERVICE', productData);
} catch (ProductHandlerNotImplementedException e) {
    System.debug('Error: ' + e.getMessage());
    // Informar al usuario que la funcionalidad no está disponible
    ApexPages.addMessage(new ApexPages.Message(
        ApexPages.Severity.WARNING,
        'Esta funcionalidad estará disponible próximamente. Error: ' + e.getMessage()
    ));
}</code></pre></div></section><section><h3 id="-2130585883#ejemplo-3-implementaci-n-parcial-con-m-todo-placeholder" data-toc="ejemplo-3-implementaci-n-parcial-con-m-todo-placeholder#ProductHandlerNotImplementedException.md-ejemplo-3-implementaci-n-parcial-con-m-todo-placeholder">Ejemplo 3: Implementaci&oacute;n Parcial con M&eacute;todo Placeholder</h3><div class="detached code-block" id="-2130585883#-xt4pon_84"><pre><code class="language-none">public interface ProductHandler {
    void initialize();
    void process();
    void finalize();
}

public abstract class BaseProductHandler implements ProductHandler {
    
    public void initialize() {
        // Implementación común de inicialización
    }
    
    public abstract void process();
    
    public void finalize() {
        // Implementación común de finalización
    }
}

public class PartialProductHandler extends BaseProductHandler {
    
    // Implementación del método abstracto requerido, pero no completamente funcional
    public override void process() {
        // Esto es solo un placeholder, no una implementación completa
        throw new ProductHandlerNotImplementedException(
            'La implementación de process() está en desarrollo. Por favor, consulte la documentación para alternativas.'
        );
    }
}

// Uso
try {
    ProductHandler handler = new PartialProductHandler();
    handler.initialize();
    handler.process(); // Esto lanzará ProductHandlerNotImplementedException
    handler.finalize();
} catch (ProductHandlerNotImplementedException e) {
    System.debug('Error: ' + e.getMessage());
    // Redirigir a una implementación alternativa o documentación
}</code></pre></div></section></section><section><h2 id="-2130585883#relaci-n-con-otras-clases-en-el-sistema" data-toc="relaci-n-con-otras-clases-en-el-sistema#ProductHandlerNotImplementedException.md-relaci-n-con-otras-clases-en-el-sistema">Relaci&oacute;n con Otras Clases en el Sistema</h2><p id="-2130585883#-xt4pon_85">Esta excepci&oacute;n est&aacute; dise&ntilde;ada para trabajar en conjunto con:</p><ol class="list list-decimal" id="-2130585883#-xt4pon_86" type="1" start="1"><li class="list-item" id="-2130585883#-xt4pon_87"><p><span class="control" id="-2130585883#-xt4pon_91">ProductHandler</span>: Interfaz o clase base que define el contrato para manejadores de productos.</p></li><li class="list-item" id="-2130585883#-xt4pon_88"><p><span class="control" id="-2130585883#-xt4pon_92">Implementaciones Concretas de ProductHandler</span>: Clases que implementan <span class="inline-code" id="-2130585883#-xt4pon_93">ProductHandler</span> para tipos espec&iacute;ficos de productos.</p></li><li class="list-item" id="-2130585883#-xt4pon_89"><p><span class="control" id="-2130585883#-xt4pon_94">QuoteProductHandler</span>: Manejador especializado para productos en cotizaciones.</p></li><li class="list-item" id="-2130585883#-xt4pon_90"><p><span class="control" id="-2130585883#-xt4pon_95">ProductHandlerImplementationException</span>: Otra excepci&oacute;n personalizada que puede ser utilizada para errores diferentes a &quot;no implementado&quot;.</p></li></ol></section><section><h2 id="-2130585883#mejores-pr-cticas-para-su-uso" data-toc="mejores-pr-cticas-para-su-uso#ProductHandlerNotImplementedException.md-mejores-pr-cticas-para-su-uso">Mejores Pr&aacute;cticas para su Uso</h2><ol class="list list-decimal" id="-2130585883#-xt4pon_96" type="1" start="1"><li class="list-item" id="-2130585883#-xt4pon_97"><p><span class="control" id="-2130585883#-xt4pon_101">Mensajes Descriptivos</span>: Proporcionar mensajes de error claros y descriptivos que indiquen qu&eacute; funcionalidad espec&iacute;fica no est&aacute; implementada.</p></li><li class="list-item" id="-2130585883#-xt4pon_98"><p><span class="control" id="-2130585883#-xt4pon_102">Documentaci&oacute;n Adicional</span>: Cuando sea posible, incluir en el mensaje informaci&oacute;n sobre cu&aacute;ndo estar&aacute; disponible la funcionalidad o alternativas.</p></li><li class="list-item" id="-2130585883#-xt4pon_99"><p><span class="control" id="-2130585883#-xt4pon_103">Uso Selectivo</span>: Utilizar esta excepci&oacute;n espec&iacute;ficamente para casos de &quot;no implementado&quot;, no para errores generales de implementaci&oacute;n.</p></li><li class="list-item" id="-2130585883#-xt4pon_100"><p><span class="control" id="-2130585883#-xt4pon_104">Captura Espec&iacute;fica</span>: Al capturar excepciones, manejar esta excepci&oacute;n espec&iacute;ficamente para proporcionar informaci&oacute;n adecuada al usuario.</p></li></ol></section><section><h2 id="-2130585883#implementaci-n-extendida-propuesta" data-toc="implementaci-n-extendida-propuesta#ProductHandlerNotImplementedException.md-implementaci-n-extendida-propuesta">Implementaci&oacute;n Extendida Propuesta</h2><p id="-2130585883#-xt4pon_105">Aunque la implementaci&oacute;n actual es minimalista, podr&iacute;a extenderse para incluir informaci&oacute;n adicional:</p><div class="detached code-block" id="-2130585883#-xt4pon_106"><pre><code class="language-none">public with sharing class ProductHandlerNotImplementedException extends Exception {
    
    private String featureName;
    private String expectedAvailability;
    private String alternativePath;
    
    /**
     * Constructor por defecto
     */
    public ProductHandlerNotImplementedException() {
        super();
    }
    
    /**
     * Constructor con mensaje de error
     * @param message Mensaje descriptivo del error
     */
    public ProductHandlerNotImplementedException(String message) {
        super(message);
    }
    
    /**
     * Constructor con información detallada
     * @param message Mensaje descriptivo del error
     * @param featureName Nombre de la característica no implementada
     * @param expectedAvailability Fecha o versión esperada para la disponibilidad
     * @param alternativePath Ruta o método alternativo a utilizar mientras tanto
     */
    public ProductHandlerNotImplementedException(
        String message, 
        String featureName, 
        String expectedAvailability, 
        String alternativePath
    ) {
        super(message);
        this.featureName = featureName;
        this.expectedAvailability = expectedAvailability;
        this.alternativePath = alternativePath;
    }
    
    /**
     * Constructor con excepción causa
     * @param message Mensaje descriptivo del error
     * @param cause Excepción que causó esta excepción
     */
    public ProductHandlerNotImplementedException(String message, Exception cause) {
        super(message, cause);
    }
    
    /**
     * Obtiene el nombre de la característica no implementada
     * @return Nombre de la característica
     */
    public String getFeatureName() {
        return this.featureName;
    }
    
    /**
     * Obtiene la fecha o versión esperada para la disponibilidad
     * @return Fecha o versión esperada
     */
    public String getExpectedAvailability() {
        return this.expectedAvailability;
    }
    
    /**
     * Obtiene la ruta o método alternativo sugerido
     * @return Ruta o método alternativo
     */
    public String getAlternativePath() {
        return this.alternativePath;
    }
    
    /**
     * Genera un mensaje completo con toda la información disponible
     * @return Mensaje completo
     */
    public String getFullMessage() {
        String fullMessage = getMessage();
        
        if (String.isNotBlank(featureName)) {
            fullMessage += '\nCaracterística: ' + featureName;
        }
        
        if (String.isNotBlank(expectedAvailability)) {
            fullMessage += '\nDisponibilidad esperada: ' + expectedAvailability;
        }
        
        if (String.isNotBlank(alternativePath)) {
            fullMessage += '\nAlternativa: ' + alternativePath;
        }
        
        return fullMessage;
    }
}</code></pre></div></section><section><h2 id="-2130585883#ejemplo-de-uso-de-la-implementaci-n-extendida" data-toc="ejemplo-de-uso-de-la-implementaci-n-extendida#ProductHandlerNotImplementedException.md-ejemplo-de-uso-de-la-implementaci-n-extendida">Ejemplo de Uso de la Implementaci&oacute;n Extendida</h2><div class="detached code-block" id="-2130585883#-xt4pon_107"><pre><code class="language-none">try {
    throw new ProductHandlerNotImplementedException(
        'La generación automática de cotizaciones para productos de servicio no está implementada',
        'AutoQuoteService',
        'Q3 2023',
        'Utilizar el proceso manual a través de QuoteWizardController.generateManualQuote()'
    );
} catch (ProductHandlerNotImplementedException e) {
    // Registrar el error completo para depuración
    System.debug(e.getFullMessage());
    
    // Mostrar un mensaje amigable al usuario
    String userMessage = 'La funcionalidad solicitada aún no está disponible';
    
    if (String.isNotBlank(e.getExpectedAvailability())) {
        userMessage += ' (esperada para ' + e.getExpectedAvailability() + ')';
    }
    
    if (String.isNotBlank(e.getAlternativePath())) {
        userMessage += '. Mientras tanto, puede ' + e.getAlternativePath();
    }
    
    ApexPages.addMessage(new ApexPages.Message(
        ApexPages.Severity.INFO,
        userMessage
    ));
}</code></pre></div></section><section><h2 id="-2130585883#consideraciones-de-dise-o" data-toc="consideraciones-de-dise-o#ProductHandlerNotImplementedException.md-consideraciones-de-dise-o">Consideraciones de Dise&ntilde;o</h2><section><h3 id="-2130585883#ventajas-de-la-implementaci-n-actual" data-toc="ventajas-de-la-implementaci-n-actual#ProductHandlerNotImplementedException.md-ventajas-de-la-implementaci-n-actual">Ventajas de la Implementaci&oacute;n Actual</h3><ol class="list list-decimal" id="-2130585883#-xt4pon_110" type="1" start="1"><li class="list-item" id="-2130585883#-xt4pon_111"><p><span class="control" id="-2130585883#-xt4pon_114">Simplicidad</span>: La implementaci&oacute;n minimalista es f&aacute;cil de entender y utilizar.</p></li><li class="list-item" id="-2130585883#-xt4pon_112"><p><span class="control" id="-2130585883#-xt4pon_115">Enfoque Espec&iacute;fico</span>: Se centra exclusivamente en representar un error de &quot;no implementado&quot;.</p></li><li class="list-item" id="-2130585883#-xt4pon_113"><p><span class="control" id="-2130585883#-xt4pon_116">Integraci&oacute;n con el Manejo de Excepciones Existente</span>: Se integra perfectamente con los mecanismos est&aacute;ndar de manejo de excepciones de Apex.</p></li></ol></section><section><h3 id="-2130585883#posibles-mejoras" data-toc="posibles-mejoras#ProductHandlerNotImplementedException.md-posibles-mejoras">Posibles Mejoras</h3><ol class="list list-decimal" id="-2130585883#-xt4pon_117" type="1" start="1"><li class="list-item" id="-2130585883#-xt4pon_118"><p><span class="control" id="-2130585883#-xt4pon_121">Informaci&oacute;n Adicional</span>: Podr&iacute;a extenderse para incluir informaci&oacute;n m&aacute;s detallada como se muestra en la implementaci&oacute;n extendida propuesta.</p></li><li class="list-item" id="-2130585883#-xt4pon_119"><p><span class="control" id="-2130585883#-xt4pon_122">M&eacute;todos de Utilidad</span>: Podr&iacute;an a&ntilde;adirse m&eacute;todos de utilidad para facilitar la creaci&oacute;n y el manejo de esta excepci&oacute;n.</p></li><li class="list-item" id="-2130585883#-xt4pon_120"><p><span class="control" id="-2130585883#-xt4pon_123">Integraci&oacute;n con Sistemas de Registro</span>: Podr&iacute;a a&ntilde;adirse funcionalidad para registrar autom&aacute;ticamente estas excepciones en un sistema de seguimiento.</p></li></ol></section></section><section><h2 id="-2130585883#notas-adicionales" data-toc="notas-adicionales#ProductHandlerNotImplementedException.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-2130585883#-xt4pon_124" type="1" start="1"><li class="list-item" id="-2130585883#-xt4pon_125"><p>La clase utiliza el modificador <span class="inline-code" id="-2130585883#-xt4pon_129">with sharing</span>, lo que significa que respetar&aacute; las reglas de compartici&oacute;n de Salesforce durante su ejecuci&oacute;n. Esto es apropiado para excepciones que se utilizan en contextos donde la seguridad es importante.</p></li><li class="list-item" id="-2130585883#-xt4pon_126"><p>La excepci&oacute;n es parte de un ecosistema m&aacute;s amplio de manejo de productos, trabajando en conjunto con otras clases relacionadas.</p></li><li class="list-item" id="-2130585883#-xt4pon_127"><p>El nombre de la clase indica claramente su prop&oacute;sito, lo que es una buena pr&aacute;ctica para mejorar la legibilidad y mantenibilidad del c&oacute;digo.</p></li><li class="list-item" id="-2130585883#-xt4pon_128"><p>Es una pr&aacute;ctica com&uacute;n en desarrollo de software crear excepciones espec&iacute;ficas para diferentes tipos de errores, como se hace aqu&iacute; para el caso de funcionalidades no implementadas.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="66328258">ProductHandlerImplementationException</h1><section><h2 id="66328258#descripci-n-general" data-toc="descripci-n-general#ProductHandlerImplementationException.md-descripci-n-general">Descripci&oacute;n General</h2><p id="66328258#-81tp1g_18"><span class="inline-code" id="66328258#-81tp1g_19">ProductHandlerImplementationException</span> es una clase global de excepci&oacute;n personalizada que extiende la clase <span class="inline-code" id="66328258#-81tp1g_20">Exception</span> est&aacute;ndar de Apex. Esta clase est&aacute; dise&ntilde;ada espec&iacute;ficamente para representar errores que ocurren durante la implementaci&oacute;n y ejecuci&oacute;n de manejadores de productos, proporcionando informaci&oacute;n adicional como c&oacute;digos de error y c&oacute;digos de estado HTTP.</p></section><section><h2 id="66328258#autor" data-toc="autor#ProductHandlerImplementationException.md-autor">Autor</h2><p id="66328258#-81tp1g_21">Jean Carlos Melendez</p></section><section><h2 id="66328258#ltima-modificaci-n" data-toc="ltima-modificaci-n#ProductHandlerImplementationException.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="66328258#-81tp1g_22">4 de febrero de 2025</p></section><section><h2 id="66328258#estructura" data-toc="estructura#ProductHandlerImplementationException.md-estructura">Estructura</h2><div class="detached code-block" id="66328258#-81tp1g_23"><pre><code class="language-none">global class ProductHandlerImplementationException extends Exception {
   String msg;
   String errorCode;
   Integer errorStatusCode;

   global ProductHandlerImplementationException(String msg, String errorCode, Integer errorStatusCode) {
      this.msg = msg;
      this.errorCode = errorCode;
      this.errorStatusCode = errorStatusCode;
   }

   global override String getMessage() {
      return this.msg;
   }

   global String getErrorCode() {
      return this.errorCode;
   }

   global Integer getStatusCode() {
      return this.errorStatusCode;
   }
}</code></pre></div></section><section><h2 id="66328258#propiedades" data-toc="propiedades#ProductHandlerImplementationException.md-propiedades">Propiedades</h2><section><h3 id="66328258#msg" data-toc="msg#ProductHandlerImplementationException.md-msg">msg</h3><ul class="list" id="66328258#-81tp1g_28" start="1"><li class="list-item" id="66328258#-81tp1g_30"><p><span class="control" id="66328258#-81tp1g_32">Tipo</span>: <span class="inline-code" id="66328258#-81tp1g_33">String</span></p></li><li class="list-item" id="66328258#-81tp1g_31"><p><span class="control" id="66328258#-81tp1g_34">Descripci&oacute;n</span>: Mensaje que describe el error.</p></li></ul></section><section><h3 id="66328258#errorcode" data-toc="errorcode#ProductHandlerImplementationException.md-errorcode">errorCode</h3><ul class="list" id="66328258#-81tp1g_36" start="1"><li class="list-item" id="66328258#-81tp1g_38"><p><span class="control" id="66328258#-81tp1g_40">Tipo</span>: <span class="inline-code" id="66328258#-81tp1g_41">String</span></p></li><li class="list-item" id="66328258#-81tp1g_39"><p><span class="control" id="66328258#-81tp1g_42">Descripci&oacute;n</span>: C&oacute;digo de error espec&iacute;fico que categoriza el tipo de error.</p></li></ul></section><section><h3 id="66328258#errorstatuscode" data-toc="errorstatuscode#ProductHandlerImplementationException.md-errorstatuscode">errorStatusCode</h3><ul class="list" id="66328258#-81tp1g_44" start="1"><li class="list-item" id="66328258#-81tp1g_46"><p><span class="control" id="66328258#-81tp1g_48">Tipo</span>: <span class="inline-code" id="66328258#-81tp1g_49">Integer</span></p></li><li class="list-item" id="66328258#-81tp1g_47"><p><span class="control" id="66328258#-81tp1g_50">Descripci&oacute;n</span>: C&oacute;digo de estado HTTP correspondiente al error, &uacute;til para mapear excepciones a respuestas HTTP.</p></li></ul></section></section><section><h2 id="66328258#constructor" data-toc="constructor#ProductHandlerImplementationException.md-constructor">Constructor</h2><section><h3 id="66328258#producthandlerimplementationexception-string-msg-string-errorcode-integer-errorstatuscode" data-toc="producthandlerimplementationexception-string-msg-string-errorcode-integer-errorstatuscode#ProductHandlerImplementationException.md-producthandlerimplementationexception-string-msg-string-errorcode-integer-errorstatuscode">ProductHandlerImplementationException(String msg, String errorCode, Integer errorStatusCode)</h3><section><h4 id="66328258#descripci-n" data-toc="descripci-n#ProductHandlerImplementationException.md-descripci-n">Descripci&oacute;n</h4><p id="66328258#-81tp1g_57">Constructor que inicializa una nueva instancia de la excepci&oacute;n con un mensaje, c&oacute;digo de error y c&oacute;digo de estado.</p></section><section><h4 id="66328258#par-metros" data-toc="par-metros#ProductHandlerImplementationException.md-par-metros">Par&aacute;metros</h4><ul class="list" id="66328258#-81tp1g_58" start="1"><li class="list-item" id="66328258#-81tp1g_59"><p><span class="inline-code" id="66328258#-81tp1g_62">msg</span> (String): Mensaje descriptivo del error.</p></li><li class="list-item" id="66328258#-81tp1g_60"><p><span class="inline-code" id="66328258#-81tp1g_63">errorCode</span> (String): C&oacute;digo de error espec&iacute;fico.</p></li><li class="list-item" id="66328258#-81tp1g_61"><p><span class="inline-code" id="66328258#-81tp1g_64">errorStatusCode</span> (Integer): C&oacute;digo de estado HTTP correspondiente.</p></li></ul></section><section><h4 id="66328258#c-digo" data-toc="c-digo#ProductHandlerImplementationException.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="66328258#-81tp1g_65"><pre><code class="language-none">global ProductHandlerImplementationException(String msg, String errorCode, Integer errorStatusCode) {
   this.msg = msg;
   this.errorCode = errorCode;
   this.errorStatusCode = errorStatusCode;
}</code></pre></div></section></section></section><section><h2 id="66328258#m-todos" data-toc="m-todos#ProductHandlerImplementationException.md-m-todos">M&eacute;todos</h2><section><h3 id="66328258#getmessage" data-toc="getmessage#ProductHandlerImplementationException.md-getmessage">getMessage()</h3><section><h4 id="66328258#descripci-n" data-toc="descripci-n#ProductHandlerImplementationException.md-descripci-n">Descripci&oacute;n</h4><p id="66328258#-81tp1g_75">M&eacute;todo sobrescrito que devuelve el mensaje de error asociado con la excepci&oacute;n.</p></section><section><h4 id="66328258#par-metros" data-toc="par-metros#ProductHandlerImplementationException.md-par-metros">Par&aacute;metros</h4><p id="66328258#-81tp1g_76">Ninguno.</p></section><section><h4 id="66328258#retorno" data-toc="retorno#ProductHandlerImplementationException.md-retorno">Retorno</h4><ul class="list" id="66328258#-81tp1g_77" start="1"><li class="list-item" id="66328258#-81tp1g_78"><p><span class="inline-code" id="66328258#-81tp1g_79">String</span>: El mensaje de error.</p></li></ul></section><section><h4 id="66328258#c-digo" data-toc="c-digo#ProductHandlerImplementationException.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="66328258#-81tp1g_80"><pre><code class="language-none">global override String getMessage() {
   return this.msg;
}</code></pre></div></section></section><section><h3 id="66328258#geterrorcode" data-toc="geterrorcode#ProductHandlerImplementationException.md-geterrorcode">getErrorCode()</h3><section><h4 id="66328258#descripci-n" data-toc="descripci-n#ProductHandlerImplementationException.md-descripci-n">Descripci&oacute;n</h4><p id="66328258#-81tp1g_87">M&eacute;todo que devuelve el c&oacute;digo de error espec&iacute;fico asociado con la excepci&oacute;n.</p></section><section><h4 id="66328258#par-metros" data-toc="par-metros#ProductHandlerImplementationException.md-par-metros">Par&aacute;metros</h4><p id="66328258#-81tp1g_88">Ninguno.</p></section><section><h4 id="66328258#retorno" data-toc="retorno#ProductHandlerImplementationException.md-retorno">Retorno</h4><ul class="list" id="66328258#-81tp1g_89" start="1"><li class="list-item" id="66328258#-81tp1g_90"><p><span class="inline-code" id="66328258#-81tp1g_91">String</span>: El c&oacute;digo de error.</p></li></ul></section><section><h4 id="66328258#c-digo" data-toc="c-digo#ProductHandlerImplementationException.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="66328258#-81tp1g_92"><pre><code class="language-none">global String getErrorCode() {
   return this.errorCode;
}</code></pre></div></section></section><section><h3 id="66328258#getstatuscode" data-toc="getstatuscode#ProductHandlerImplementationException.md-getstatuscode">getStatusCode()</h3><section><h4 id="66328258#descripci-n" data-toc="descripci-n#ProductHandlerImplementationException.md-descripci-n">Descripci&oacute;n</h4><p id="66328258#-81tp1g_99">M&eacute;todo que devuelve el c&oacute;digo de estado HTTP asociado con la excepci&oacute;n.</p></section><section><h4 id="66328258#par-metros" data-toc="par-metros#ProductHandlerImplementationException.md-par-metros">Par&aacute;metros</h4><p id="66328258#-81tp1g_100">Ninguno.</p></section><section><h4 id="66328258#retorno" data-toc="retorno#ProductHandlerImplementationException.md-retorno">Retorno</h4><ul class="list" id="66328258#-81tp1g_101" start="1"><li class="list-item" id="66328258#-81tp1g_102"><p><span class="inline-code" id="66328258#-81tp1g_103">Integer</span>: El c&oacute;digo de estado HTTP.</p></li></ul></section><section><h4 id="66328258#c-digo" data-toc="c-digo#ProductHandlerImplementationException.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="66328258#-81tp1g_104"><pre><code class="language-none">global Integer getStatusCode() {
   return this.errorStatusCode;
}</code></pre></div></section></section></section><section><h2 id="66328258#c-digos-de-error-comunes" data-toc="c-digos-de-error-comunes#ProductHandlerImplementationException.md-c-digos-de-error-comunes">C&oacute;digos de Error Comunes</h2><p id="66328258#-81tp1g_105">A continuaci&oacute;n se presenta una tabla de c&oacute;digos de error comunes que se utilizan con esta excepci&oacute;n:</p><div class="table-wrapper detached"><table id="66328258#-81tp1g_106"><tr class="header-row" id="66328258#-81tp1g_107"><th id="66328258#-81tp1g_115"><p>C&oacute;digo de Error</p></th><th id="66328258#-81tp1g_116"><p>Descripci&oacute;n</p></th><th id="66328258#-81tp1g_117"><p>C&oacute;digo de Estado T&iacute;pico</p></th></tr><tr class="" id="66328258#-81tp1g_108"><td id="66328258#-81tp1g_118"><p><span class="inline-code" id="66328258#-81tp1g_121">BAD_REQUEST</span></p></td><td id="66328258#-81tp1g_119"><p>La solicitud es inv&aacute;lida o carece de par&aacute;metros requeridos.</p></td><td id="66328258#-81tp1g_120"><p>400</p></td></tr><tr class="" id="66328258#-81tp1g_109"><td id="66328258#-81tp1g_122"><p><span class="inline-code" id="66328258#-81tp1g_125">UNAUTHORIZED</span></p></td><td id="66328258#-81tp1g_123"><p>La solicitud requiere autenticaci&oacute;n o la autenticaci&oacute;n proporcionada es insuficiente.</p></td><td id="66328258#-81tp1g_124"><p>401</p></td></tr><tr class="" id="66328258#-81tp1g_110"><td id="66328258#-81tp1g_126"><p><span class="inline-code" id="66328258#-81tp1g_129">FORBIDDEN</span></p></td><td id="66328258#-81tp1g_127"><p>La autenticaci&oacute;n es v&aacute;lida pero no tiene permisos para el recurso.</p></td><td id="66328258#-81tp1g_128"><p>403</p></td></tr><tr class="" id="66328258#-81tp1g_111"><td id="66328258#-81tp1g_130"><p><span class="inline-code" id="66328258#-81tp1g_133">NOT_FOUND</span></p></td><td id="66328258#-81tp1g_131"><p>El recurso o producto solicitado no se encuentra.</p></td><td id="66328258#-81tp1g_132"><p>404</p></td></tr><tr class="" id="66328258#-81tp1g_112"><td id="66328258#-81tp1g_134"><p><span class="inline-code" id="66328258#-81tp1g_137">UNPROCESSABLE_ENTITY</span></p></td><td id="66328258#-81tp1g_135"><p>La solicitud es v&aacute;lida pero no se puede procesar debido a errores sem&aacute;nticos.</p></td><td id="66328258#-81tp1g_136"><p>422</p></td></tr><tr class="" id="66328258#-81tp1g_113"><td id="66328258#-81tp1g_138"><p><span class="inline-code" id="66328258#-81tp1g_141">INTERNAL_ERROR</span></p></td><td id="66328258#-81tp1g_139"><p>Ocurri&oacute; un error interno inesperado.</p></td><td id="66328258#-81tp1g_140"><p>500</p></td></tr><tr class="" id="66328258#-81tp1g_114"><td id="66328258#-81tp1g_142"><p><span class="inline-code" id="66328258#-81tp1g_145">SERVICE_UNAVAILABLE</span></p></td><td id="66328258#-81tp1g_143"><p>El servicio externo requerido no est&aacute; disponible.</p></td><td id="66328258#-81tp1g_144"><p>503</p></td></tr></table></div></section><section><h2 id="66328258#ejemplos-de-uso" data-toc="ejemplos-de-uso#ProductHandlerImplementationException.md-ejemplos-de-uso">Ejemplos de Uso</h2><section><h3 id="66328258#ejemplo-1-validaci-n-de-campos-requeridos" data-toc="ejemplo-1-validaci-n-de-campos-requeridos#ProductHandlerImplementationException.md-ejemplo-1-validaci-n-de-campos-requeridos">Ejemplo 1: Validaci&oacute;n de Campos Requeridos</h3><div class="detached code-block" id="66328258#-81tp1g_150"><pre><code class="language-none">public class ProductValidator {
    public static void validateRequiredFields(Map&lt;String, Object&gt; productData) {
        if (productData == null) {
            throw new ProductHandlerImplementationException(
                'Datos del producto no proporcionados',
                'BAD_REQUEST',
                400
            );
        }
        
        if (!productData.containsKey('productCode') || String.isBlank((String)productData.get('productCode'))) {
            throw new ProductHandlerImplementationException(
                'El código del producto es requerido',
                'UNPROCESSABLE_ENTITY',
                422
            );
        }
        
        if (!productData.containsKey('price') || productData.get('price') == null) {
            throw new ProductHandlerImplementationException(
                'El precio del producto es requerido',
                'UNPROCESSABLE_ENTITY',
                422
            );
        }
    }
}</code></pre></div></section><section><h3 id="66328258#ejemplo-2-verificaci-n-de-existencia-de-producto" data-toc="ejemplo-2-verificaci-n-de-existencia-de-producto#ProductHandlerImplementationException.md-ejemplo-2-verificaci-n-de-existencia-de-producto">Ejemplo 2: Verificaci&oacute;n de Existencia de Producto</h3><div class="detached code-block" id="66328258#-81tp1g_151"><pre><code class="language-none">public class ProductFinder {
    public static Product2 findProductById(Id productId) {
        List&lt;Product2&gt; products = [SELECT Id, Name, ProductCode, IsActive FROM Product2 WHERE Id = :productId LIMIT 1];
        
        if (products.isEmpty()) {
            throw new ProductHandlerImplementationException(
                'Producto no encontrado con ID: ' + productId,
                'NOT_FOUND',
                404
            );
        }
        
        Product2 product = products[0];
        
        if (!product.IsActive) {
            throw new ProductHandlerImplementationException(
                'El producto está inactivo: ' + product.Name,
                'UNPROCESSABLE_ENTITY',
                422
            );
        }
        
        return product;
    }
}</code></pre></div></section><section><h3 id="66328258#ejemplo-3-manejo-de-errores-en-un-controlador-rest" data-toc="ejemplo-3-manejo-de-errores-en-un-controlador-rest#ProductHandlerImplementationException.md-ejemplo-3-manejo-de-errores-en-un-controlador-rest">Ejemplo 3: Manejo de Errores en un Controlador REST</h3><div class="detached code-block" id="66328258#-81tp1g_152"><pre><code class="language-none">@RestResource(urlMapping='/products/*')
global class ProductRESTService {
    
    @HttpGet
    global static void getProduct() {
        RestRequest req = RestContext.request;
        RestResponse res = RestContext.response;
        
        try {
            String productId = req.requestURI.substring(req.requestURI.lastIndexOf('/') + 1);
            
            if (String.isBlank(productId)) {
                throw new ProductHandlerImplementationException(
                    'ID de producto no proporcionado',
                    'BAD_REQUEST',
                    400
                );
            }
            
            Product2 product = ProductFinder.findProductById(productId);
            
            Map&lt;String, Object&gt; result = new Map&lt;String, Object&gt;{
                'success' =&gt; true,
                'product' =&gt; new Map&lt;String, Object&gt;{
                    'id' =&gt; product.Id,
                    'name' =&gt; product.Name,
                    'code' =&gt; product.ProductCode
                }
            };
            
            res.responseBody = Blob.valueOf(JSON.serialize(result));
            res.statusCode = 200;
        } catch (ProductHandlerImplementationException e) {
            handleException(e, res);
        } catch (Exception e) {
            // Convertir excepciones estándar a nuestra excepción personalizada
            ProductHandlerImplementationException customEx = new ProductHandlerImplementationException(
                'Error inesperado: ' + e.getMessage(),
                'INTERNAL_ERROR',
                500
            );
            handleException(customEx, res);
        }
    }
    
    private static void handleException(ProductHandlerImplementationException e, RestResponse res) {
        Map&lt;String, Object&gt; errorResponse = new Map&lt;String, Object&gt;{
            'success' =&gt; false,
            'errorCode' =&gt; e.getErrorCode(),
            'message' =&gt; e.getMessage()
        };
        
        res.responseBody = Blob.valueOf(JSON.serialize(errorResponse));
        res.statusCode = e.getStatusCode();
    }
}</code></pre></div></section><section><h3 id="66328258#ejemplo-4-uso-en-manejadores-de-productos" data-toc="ejemplo-4-uso-en-manejadores-de-productos#ProductHandlerImplementationException.md-ejemplo-4-uso-en-manejadores-de-productos">Ejemplo 4: Uso en Manejadores de Productos</h3><div class="detached code-block" id="66328258#-81tp1g_153"><pre><code class="language-none">public class AutoInsuranceProductHandler extends ProductHandler {
    
    public override Map&lt;String, Object&gt; process(
        Map&lt;String, Object&gt; options,
        Map&lt;String, Object&gt; input,
        Map&lt;String, Object&gt; output
    ) {
        try {
            // Validar datos de entrada
            validateInput(input);
            
            // Procesar el producto
            // ...
            
            return output;
        } catch (Exception e) {
            if (e instanceof ProductHandlerImplementationException) {
                throw e;
            } else {
                throw new ProductHandlerImplementationException(
                    'Error procesando el producto Auto Insurance: ' + e.getMessage(),
                    'INTERNAL_ERROR',
                    500
                );
            }
        }
    }
    
    private void validateInput(Map&lt;String, Object&gt; input) {
        if (!input.containsKey('vehicleData')) {
            throw new ProductHandlerImplementationException(
                'Datos del vehículo no proporcionados',
                'UNPROCESSABLE_ENTITY',
                422
            );
        }
        
        Map&lt;String, Object&gt; vehicleData = (Map&lt;String, Object&gt;)input.get('vehicleData');
        
        if (!vehicleData.containsKey('make') || String.isBlank((String)vehicleData.get('make'))) {
            throw new ProductHandlerImplementationException(
                'La marca del vehículo es requerida',
                'UNPROCESSABLE_ENTITY',
                422
            );
        }
        
        if (!vehicleData.containsKey('model') || String.isBlank((String)vehicleData.get('model'))) {
            throw new ProductHandlerImplementationException(
                'El modelo del vehículo es requerido',
                'UNPROCESSABLE_ENTITY',
                422
            );
        }
        
        if (!vehicleData.containsKey('year') || vehicleData.get('year') == null) {
            throw new ProductHandlerImplementationException(
                'El año del vehículo es requerido',
                'UNPROCESSABLE_ENTITY',
                422
            );
        }
    }
}</code></pre></div></section></section><section><h2 id="66328258#captura-y-manejo-de-la-excepci-n" data-toc="captura-y-manejo-de-la-excepci-n#ProductHandlerImplementationException.md-captura-y-manejo-de-la-excepci-n">Captura y Manejo de la Excepci&oacute;n</h2><div class="detached code-block" id="66328258#-81tp1g_154"><pre><code class="language-none">try {
    // Código que podría lanzar la excepción
    Map&lt;String, Object&gt; productData = new Map&lt;String, Object&gt;();
    ProductValidator.validateRequiredFields(productData);
} catch (ProductHandlerImplementationException e) {
    System.debug('Error: ' + e.getMessage());
    System.debug('Código de error: ' + e.getErrorCode());
    System.debug('Código de estado: ' + e.getStatusCode());
    
    // Manejar el error según su código
    switch on e.getErrorCode() {
        when 'BAD_REQUEST' {
            // Lógica para manejar errores de solicitud incorrecta
        }
        when 'UNPROCESSABLE_ENTITY' {
            // Lógica para manejar errores de validación
        }
        when 'NOT_FOUND' {
            // Lógica para manejar recursos no encontrados
        }
        when else {
            // Lógica para manejar otros errores
        }
    }
}</code></pre></div></section><section><h2 id="66328258#uso-en-pruebas-unitarias" data-toc="uso-en-pruebas-unitarias#ProductHandlerImplementationException.md-uso-en-pruebas-unitarias">Uso en Pruebas Unitarias</h2><div class="detached code-block" id="66328258#-81tp1g_155"><pre><code class="language-none">@IsTest
private class ProductHandlerImplementationExceptionTest {
    
    @IsTest
    static void testConstructorAndGetters() {
        // Configurar
        String message = 'Error de prueba';
        String errorCode = 'TEST_ERROR';
        Integer statusCode = 418; // I'm a teapot
        
        // Ejecutar
        ProductHandlerImplementationException ex = new ProductHandlerImplementationException(
            message, errorCode, statusCode
        );
        
        // Verificar
        System.assertEquals(message, ex.getMessage(), 'El mensaje debe coincidir');
        System.assertEquals(errorCode, ex.getErrorCode(), 'El código de error debe coincidir');
        System.assertEquals(statusCode, ex.getStatusCode(), 'El código de estado debe coincidir');
    }
    
    @IsTest
    static void testExceptionInProductValidator() {
        // Configurar
        Map&lt;String, Object&gt; emptyData = new Map&lt;String, Object&gt;();
        
        // Ejecutar y verificar
        try {
            ProductValidator.validateRequiredFields(emptyData);
            System.assert(false, 'Debería haber lanzado una excepción');
        } catch (ProductHandlerImplementationException e) {
            System.assertEquals('UNPROCESSABLE_ENTITY', e.getErrorCode(), 'Debería ser un error de entidad no procesable');
            System.assertEquals(422, e.getStatusCode(), 'El código de estado debería ser 422');
        }
    }
}</code></pre></div></section><section><h2 id="66328258#mejores-pr-cticas" data-toc="mejores-pr-cticas#ProductHandlerImplementationException.md-mejores-pr-cticas">Mejores Pr&aacute;cticas</h2><ol class="list list-decimal" id="66328258#-81tp1g_156" type="1" start="1"><li class="list-item" id="66328258#-81tp1g_157"><p><span class="control" id="66328258#-81tp1g_162">C&oacute;digos de Error Consistentes</span>: Utilizar un conjunto consistente de c&oacute;digos de error en toda la aplicaci&oacute;n.</p></li><li class="list-item" id="66328258#-81tp1g_158"><p><span class="control" id="66328258#-81tp1g_163">Mensajes Descriptivos</span>: Proporcionar mensajes de error claros y descriptivos.</p></li><li class="list-item" id="66328258#-81tp1g_159"><p><span class="control" id="66328258#-81tp1g_164">C&oacute;digos de Estado HTTP Apropiados</span>: Usar c&oacute;digos de estado HTTP est&aacute;ndar que se alineen con el tipo de error.</p></li><li class="list-item" id="66328258#-81tp1g_160"><p><span class="control" id="66328258#-81tp1g_165">Manejo Centralizado</span>: Implementar un manejo centralizado de excepciones en puntos de entrada como servicios REST.</p></li><li class="list-item" id="66328258#-81tp1g_161"><p><span class="control" id="66328258#-81tp1g_166">Registro de Errores</span>: Registrar los errores para an&aacute;lisis y depuraci&oacute;n futuros.</p></li></ol></section><section><h2 id="66328258#integraci-n-con-sistemas-m-s-amplios" data-toc="integraci-n-con-sistemas-m-s-amplios#ProductHandlerImplementationException.md-integraci-n-con-sistemas-m-s-amplios">Integraci&oacute;n con Sistemas m&aacute;s Amplios</h2><p id="66328258#-81tp1g_167">La clase <span class="inline-code" id="66328258#-81tp1g_169">ProductHandlerImplementationException</span> est&aacute; dise&ntilde;ada para integrarse con el sistema m&aacute;s amplio de manejo de productos:</p><ol class="list list-decimal" id="66328258#-81tp1g_168" type="1" start="1"><li class="list-item" id="66328258#-81tp1g_170"><p><span class="control" id="66328258#-81tp1g_173">ProductHandler y Derivados</span>: Clases como <span class="inline-code" id="66328258#-81tp1g_174">QuoteProductHandler</span>, <span class="inline-code" id="66328258#-81tp1g_175">IssueProductHandler</span>, etc., utilizan esta excepci&oacute;n para gestionar errores.</p></li><li class="list-item" id="66328258#-81tp1g_171"><p><span class="control" id="66328258#-81tp1g_176">Servicios REST</span>: Los servicios REST pueden capturar y transformar estas excepciones en respuestas HTTP estructuradas.</p></li><li class="list-item" id="66328258#-81tp1g_172"><p><span class="control" id="66328258#-81tp1g_177">Procedimientos de Integraci&oacute;n</span>: Los procedimientos de integraci&oacute;n pueden capturar estas excepciones y manejarlas adecuadamente.</p></li></ol></section><section><h2 id="66328258#consideraciones-de-rendimiento" data-toc="consideraciones-de-rendimiento#ProductHandlerImplementationException.md-consideraciones-de-rendimiento">Consideraciones de Rendimiento</h2><ol class="list list-decimal" id="66328258#-81tp1g_178" type="1" start="1"><li class="list-item" id="66328258#-81tp1g_179"><p><span class="control" id="66328258#-81tp1g_181">Creaci&oacute;n de Instancias</span>: La creaci&oacute;n de objetos de excepci&oacute;n tiene un costo en t&eacute;rminos de rendimiento y debe utilizarse para condiciones de error genuinas, no para control de flujo normal.</p></li><li class="list-item" id="66328258#-81tp1g_180"><p><span class="control" id="66328258#-81tp1g_182">Propagaci&oacute;n de Excepciones</span>: Propagar excepciones a trav&eacute;s de m&uacute;ltiples niveles de la pila de llamadas puede tener un impacto en el rendimiento. Considerar capturar y manejar excepciones lo m&aacute;s cerca posible de su origen cuando sea apropiado.</p></li></ol></section><section><h2 id="66328258#notas-adicionales" data-toc="notas-adicionales#ProductHandlerImplementationException.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="66328258#-81tp1g_183" type="1" start="1"><li class="list-item" id="66328258#-81tp1g_184"><p>La clase est&aacute; marcada como <span class="inline-code" id="66328258#-81tp1g_188">global</span>, lo que indica que est&aacute; dise&ntilde;ada para ser accesible desde diferentes paquetes o namespaces.</p></li><li class="list-item" id="66328258#-81tp1g_185"><p>La implementaci&oacute;n actual no guarda la excepci&oacute;n causa, lo que podr&iacute;a ser una mejora para considerar en futuras versiones.</p></li><li class="list-item" id="66328258#-81tp1g_186"><p>Los c&oacute;digos de estado HTTP utilizados (como 422 para <span class="inline-code" id="66328258#-81tp1g_189">UNPROCESSABLE_ENTITY</span>) se alinean con los est&aacute;ndares HTTP, lo que facilita la integraci&oacute;n con servicios web.</p></li><li class="list-item" id="66328258#-81tp1g_187"><p>Esta excepci&oacute;n proporciona una estructura estandarizada para manejo de errores, lo que mejora la consistencia en toda la aplicaci&oacute;n.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1377939673">Documentaci&oacute;n T&eacute;cnica - Objeto `Subconjunto Registro de Evento`</h1><p id="1377939673#tkll51_4">Este objeto est&aacute; destinado a registrar subconjuntos o trazabilidad de eventos internos, permitiendo una integraci&oacute;n ordenada, monitoreo estructurado y separaci&oacute;n de responsabilidades entre plataformas o procesos involucrados.</p><section><h2 id="1377939673#informaci-n-general" data-toc="informaci-n-general#Product Handler.md-informaci-n-general">Informaci&oacute;n General</h2><div class="table-wrapper detached"><table id="1377939673#tkll51_9"><tr class="header-row" id="1377939673#tkll51_11"><th id="1377939673#tkll51_19"><p>Atributo</p></th><th id="1377939673#tkll51_20"><p>Valor</p></th></tr><tr class="" id="1377939673#tkll51_12"><td id="1377939673#tkll51_21"><p><span class="control" id="1377939673#tkll51_23">Nombre API</span></p></td><td id="1377939673#tkll51_22"><p><span class="inline-code" id="1377939673#tkll51_24">Subconjunto_Registro_de_Evento__c</span></p></td></tr><tr class="" id="1377939673#tkll51_13"><td id="1377939673#tkll51_25"><p><span class="control" id="1377939673#tkll51_27">Etiqueta(Label)</span></p></td><td id="1377939673#tkll51_26"><p>Subconjunto Registro de Evento</p></td></tr><tr class="" id="1377939673#tkll51_14"><td id="1377939673#tkll51_28"><p><span class="control" id="1377939673#tkll51_30">Etiqueta(Label) Plural</span></p></td><td id="1377939673#tkll51_29"><p>Subconjunto Registros de Eventos</p></td></tr><tr class="" id="1377939673#tkll51_15"><td id="1377939673#tkll51_31"><p><span class="control" id="1377939673#tkll51_33">Estado de implementaci&oacute;n</span></p></td><td id="1377939673#tkll51_32"><p><span class="inline-code" id="1377939673#tkll51_34">Deployed</span></p></td></tr><tr class="" id="1377939673#tkll51_16"><td id="1377939673#tkll51_35"><p><span class="control" id="1377939673#tkll51_37">Namespace de acceso</span></p></td><td id="1377939673#tkll51_36"><p><span class="inline-code" id="1377939673#tkll51_38">SFCore</span></p></td></tr><tr class="" id="1377939673#tkll51_17"><td id="1377939673#tkll51_39"><p><span class="control" id="1377939673#tkll51_41">Modelo de uso compartido interno</span></p></td><td id="1377939673#tkll51_40"><p><span class="inline-code" id="1377939673#tkll51_42">ReadWrite</span></p></td></tr><tr class="" id="1377939673#tkll51_18"><td id="1377939673#tkll51_43"><p><span class="control" id="1377939673#tkll51_45">Modelo de uso compartido externo</span></p></td><td id="1377939673#tkll51_44"><p><span class="inline-code" id="1377939673#tkll51_46">Private</span></p></td></tr></table></div></section><section><h2 id="1377939673#campos-personalizados" data-toc="campos-personalizados#Product Handler.md-campos-personalizados">🧾 Campos Personalizados</h2><section><h3 id="1377939673#data-c" data-toc="data-c#Product Handler.md-data-c">🟦 Data__c</h3><ul class="list" id="1377939673#tkll51_58" start="1"><li class="list-item" id="1377939673#tkll51_61"><p><span class="control" id="1377939673#tkll51_67">Etiqueta(Label):</span> Dato</p></li><li class="list-item" id="1377939673#tkll51_62"><p><span class="control" id="1377939673#tkll51_68">Tipo:</span> &Aacute;rea de texto larga (<span class="inline-code" id="1377939673#tkll51_69">LongTextArea</span>)</p></li><li class="list-item" id="1377939673#tkll51_63"><p><span class="control" id="1377939673#tkll51_70">Longitud m&aacute;xima:</span> 32.768 caracteres</p></li><li class="list-item" id="1377939673#tkll51_64"><p><span class="control" id="1377939673#tkll51_71">L&iacute;neas visibles:</span> 3</p></li><li class="list-item" id="1377939673#tkll51_65"><p><span class="control" id="1377939673#tkll51_72">Uso:</span> Almacena los datos de entrada para cada Handler (proceso de manejo) o integraci&oacute;n (proceso de integraci&oacute;n).</p></li><li class="list-item" id="1377939673#tkll51_66"><p><span class="control" id="1377939673#tkll51_73">Requiere valor:</span> No</p></li></ul></section><section><h3 id="1377939673#date-c" data-toc="date-c#Product Handler.md-date-c">📅 Date__c</h3><ul class="list" id="1377939673#tkll51_75" start="1"><li class="list-item" id="1377939673#tkll51_78"><p><span class="control" id="1377939673#tkll51_83">Etiqueta(Label):</span> Fecha</p></li><li class="list-item" id="1377939673#tkll51_79"><p><span class="control" id="1377939673#tkll51_84">Tipo:</span> Fecha y hora (<span class="inline-code" id="1377939673#tkll51_85">DateTime</span>)</p></li><li class="list-item" id="1377939673#tkll51_80"><p><span class="control" id="1377939673#tkll51_86">Valor predeterminado:</span> <span class="inline-code" id="1377939673#tkll51_87">NOW()</span></p></li><li class="list-item" id="1377939673#tkll51_81"><p><span class="control" id="1377939673#tkll51_88">Uso:</span> Registra la fecha y hora del almacenamiento del subconjunto.</p></li><li class="list-item" id="1377939673#tkll51_82"><p><span class="control" id="1377939673#tkll51_89">Requiere valor:</span> S&iacute;</p></li></ul></section><section><h3 id="1377939673#details-c" data-toc="details-c#Product Handler.md-details-c">📋 Details__c</h3><ul class="list" id="1377939673#tkll51_91" start="1"><li class="list-item" id="1377939673#tkll51_94"><p><span class="control" id="1377939673#tkll51_100">Etiqueta(Label):</span> Detalle</p></li><li class="list-item" id="1377939673#tkll51_95"><p><span class="control" id="1377939673#tkll51_101">Tipo:</span> &Aacute;rea de texto larga (<span class="inline-code" id="1377939673#tkll51_102">LongTextArea</span>)</p></li><li class="list-item" id="1377939673#tkll51_96"><p><span class="control" id="1377939673#tkll51_103">Longitud m&aacute;xima:</span> 131.072 caracteres</p></li><li class="list-item" id="1377939673#tkll51_97"><p><span class="control" id="1377939673#tkll51_104">L&iacute;neas visibles:</span> 3</p></li><li class="list-item" id="1377939673#tkll51_98"><p><span class="control" id="1377939673#tkll51_105">Uso:</span> Almacena descripciones detalladas o trazabilidad del evento.</p></li><li class="list-item" id="1377939673#tkll51_99"><p><span class="control" id="1377939673#tkll51_106">Requiere valor:</span> No</p></li></ul></section><section><h3 id="1377939673#level-c" data-toc="level-c#Product Handler.md-level-c">🧭 Level__c</h3><ul class="list" id="1377939673#tkll51_108" start="1"><li class="list-item" id="1377939673#tkll51_111"><p><span class="control" id="1377939673#tkll51_116">Etiqueta(Label):</span> Nivel</p></li><li class="list-item" id="1377939673#tkll51_112"><p><span class="control" id="1377939673#tkll51_117">Tipo:</span> Texto (<span class="inline-code" id="1377939673#tkll51_118">Text</span>)</p></li><li class="list-item" id="1377939673#tkll51_113"><p><span class="control" id="1377939673#tkll51_119">Longitud m&aacute;xima:</span> 30 caracteres</p></li><li class="list-item" id="1377939673#tkll51_114"><p><span class="control" id="1377939673#tkll51_120">Uso:</span> Nivel o severidad del evento (ej. INFO, WARNING, ERROR, SUCCESS).</p></li><li class="list-item" id="1377939673#tkll51_115"><p><span class="control" id="1377939673#tkll51_121">Requiere valor:</span> S&iacute;</p></li></ul></section><section><h3 id="1377939673#platform-c" data-toc="platform-c#Product Handler.md-platform-c">🖥️ Platform__c</h3><ul class="list" id="1377939673#tkll51_123" start="1"><li class="list-item" id="1377939673#tkll51_126"><p><span class="control" id="1377939673#tkll51_131">Etiqueta(Label):</span> Plataforma</p></li><li class="list-item" id="1377939673#tkll51_127"><p><span class="control" id="1377939673#tkll51_132">Tipo:</span> Texto (<span class="inline-code" id="1377939673#tkll51_133">Text</span>)</p></li><li class="list-item" id="1377939673#tkll51_128"><p><span class="control" id="1377939673#tkll51_134">Longitud m&aacute;xima:</span> 50 caracteres</p></li><li class="list-item" id="1377939673#tkll51_129"><p><span class="control" id="1377939673#tkll51_135">Uso:</span> Plataforma tecnol&oacute;gica desde la cual se origina el evento. (ej, Salesfoce, Formulario placa, etc)</p></li><li class="list-item" id="1377939673#tkll51_130"><p><span class="control" id="1377939673#tkll51_136">Requiere valor:</span> No</p></li></ul></section><section><h3 id="1377939673#process-c" data-toc="process-c#Product Handler.md-process-c">⚙️ Process__c</h3><ul class="list" id="1377939673#tkll51_138" start="1"><li class="list-item" id="1377939673#tkll51_141"><p><span class="control" id="1377939673#tkll51_146">Etiqueta(Label):</span> Proceso</p></li><li class="list-item" id="1377939673#tkll51_142"><p><span class="control" id="1377939673#tkll51_147">Tipo:</span> Texto (<span class="inline-code" id="1377939673#tkll51_148">Text</span>)</p></li><li class="list-item" id="1377939673#tkll51_143"><p><span class="control" id="1377939673#tkll51_149">Longitud m&aacute;xima:</span> 80 caracteres</p></li><li class="list-item" id="1377939673#tkll51_144"><p><span class="control" id="1377939673#tkll51_150">Uso:</span> Identificador del proceso responsable del evento (Proceso de Lead, Tarifa, Emision, Fasecolda, etc).</p></li><li class="list-item" id="1377939673#tkll51_145"><p><span class="control" id="1377939673#tkll51_151">Requiere valor:</span> No</p></li></ul></section><section><h3 id="1377939673#product-c" data-toc="product-c#Product Handler.md-product-c">🛒 Product__c</h3><ul class="list" id="1377939673#tkll51_153" start="1"><li class="list-item" id="1377939673#tkll51_156"><p><span class="control" id="1377939673#tkll51_161">Etiqueta(Label):</span> Producto</p></li><li class="list-item" id="1377939673#tkll51_157"><p><span class="control" id="1377939673#tkll51_162">Tipo:</span> Texto (<span class="inline-code" id="1377939673#tkll51_163">Text</span>)</p></li><li class="list-item" id="1377939673#tkll51_158"><p><span class="control" id="1377939673#tkll51_164">Longitud m&aacute;xima:</span> 30 caracteres</p></li><li class="list-item" id="1377939673#tkll51_159"><p><span class="control" id="1377939673#tkll51_165">Uso:</span> Producto asociado al evento (ej. Motos, Autos, Viajes).</p></li><li class="list-item" id="1377939673#tkll51_160"><p><span class="control" id="1377939673#tkll51_166">Requiere valor:</span> No</p></li></ul></section><section><h3 id="1377939673#response-c" data-toc="response-c#Product Handler.md-response-c">💬 Response__c</h3><ul class="list" id="1377939673#tkll51_168" start="1"><li class="list-item" id="1377939673#tkll51_171"><p><span class="control" id="1377939673#tkll51_177">Etiqueta(Label):</span> Response</p></li><li class="list-item" id="1377939673#tkll51_172"><p><span class="control" id="1377939673#tkll51_178">Tipo:</span> &Aacute;rea de texto larga (<span class="inline-code" id="1377939673#tkll51_179">LongTextArea</span>)</p></li><li class="list-item" id="1377939673#tkll51_173"><p><span class="control" id="1377939673#tkll51_180">Longitud m&aacute;xima:</span> 32.768 caracteres</p></li><li class="list-item" id="1377939673#tkll51_174"><p><span class="control" id="1377939673#tkll51_181">L&iacute;neas visibles:</span> 3</p></li><li class="list-item" id="1377939673#tkll51_175"><p><span class="control" id="1377939673#tkll51_182">Uso:</span> Guarda la respuesta de un servicio externo o proceso interno.</p></li><li class="list-item" id="1377939673#tkll51_176"><p><span class="control" id="1377939673#tkll51_183">Requiere valor:</span> No</p></li></ul></section><section><h3 id="1377939673#type-c" data-toc="type-c#Product Handler.md-type-c">🏷️ Type__c</h3><ul class="list" id="1377939673#tkll51_185" start="1"><li class="list-item" id="1377939673#tkll51_188"><p><span class="control" id="1377939673#tkll51_193">Etiqueta(Label):</span> Tipo de Registro</p></li><li class="list-item" id="1377939673#tkll51_189"><p><span class="control" id="1377939673#tkll51_194">Tipo:</span> Texto (<span class="inline-code" id="1377939673#tkll51_195">Text</span>)</p></li><li class="list-item" id="1377939673#tkll51_190"><p><span class="control" id="1377939673#tkll51_196">Longitud m&aacute;xima:</span> 30 caracteres</p></li><li class="list-item" id="1377939673#tkll51_191"><p><span class="control" id="1377939673#tkll51_197">Uso:</span> Define el tipo espec&iacute;fico del registro (Handler, Integraci&oacute;n).</p></li><li class="list-item" id="1377939673#tkll51_192"><p><span class="control" id="1377939673#tkll51_198">Requiere valor:</span> No</p></li></ul></section><section><h3 id="1377939673#userid-c" data-toc="userid-c#Product Handler.md-userid-c">👤 UserId__c</h3><ul class="list" id="1377939673#tkll51_200" start="1"><li class="list-item" id="1377939673#tkll51_203"><p><span class="control" id="1377939673#tkll51_208">Etiqueta(Label):</span> ID de Usuario</p></li><li class="list-item" id="1377939673#tkll51_204"><p><span class="control" id="1377939673#tkll51_209">Tipo:</span> Texto (<span class="inline-code" id="1377939673#tkll51_210">Text</span>)</p></li><li class="list-item" id="1377939673#tkll51_205"><p><span class="control" id="1377939673#tkll51_211">Longitud m&aacute;xima:</span> 30 caracteres</p></li><li class="list-item" id="1377939673#tkll51_206"><p><span class="control" id="1377939673#tkll51_212">Uso:</span> Identificador del usuario responsable del evento.</p></li><li class="list-item" id="1377939673#tkll51_207"><p><span class="control" id="1377939673#tkll51_213">Requiere valor:</span> No</p></li></ul></section></section><section><h2 id="1377939673#ejemplo-practico" data-toc="ejemplo-practico#Product Handler.md-ejemplo-practico">Ejemplo Practico</h2><p id="1377939673#tkll51_214">Al Crear un lead de viajes y dejar el registro de Log para su trazabilidad, tenemos dentro del registro del objeto lo siguiente:</p><ul class="list" id="1377939673#tkll51_215" start="1"><li class="list-item" id="1377939673#tkll51_216"><p><span class="control" id="1377939673#tkll51_227">Registro de Evento Name:</span> Evento de LEAD</p></li><li class="list-item" id="1377939673#tkll51_217"><p><span class="control" id="1377939673#tkll51_228">Fecha:</span> Fecha de creaci&oacute;n</p></li><li class="list-item" id="1377939673#tkll51_218"><p><span class="control" id="1377939673#tkll51_229">ID de Usuario:</span> ID de Usuario</p></li><li class="list-item" id="1377939673#tkll51_219"><p><span class="control" id="1377939673#tkll51_230">Producto:</span> Viajes</p></li><li class="list-item" id="1377939673#tkll51_220"><p><span class="control" id="1377939673#tkll51_231">Plataforma:</span> Salesforce</p></li><li class="list-item" id="1377939673#tkll51_221"><p><span class="control" id="1377939673#tkll51_232">Dato:</span>--Datos de entrada del servicio -- &quot;{\&quot;Stage\&quot;:\&quot;KNOWING\&quot;,\&quot;options\&quot;:{},\&quot;SESION_ID\&quot;:\&quot;1747677805101\&quot;,\&quot;assessorCode\&quot;:\&quot;4999\&quot;,\&quot;productName\&quot;:\&quot;Viajes\&quot;,\&quot;accept_tos\&quot;:true,\&quot;email\&quot;:\&quot;jo@test.us\&quot;,\&quot;mobile_phone\&quot;:\&quot;3124567887\&quot;,\&quot;lastName\&quot;:\&quot;johan\&quot;,\&quot;first_name\&quot;:\&quot;johan\&quot;}&quot;</p></li><li class="list-item" id="1377939673#tkll51_222"><p><span class="control" id="1377939673#tkll51_233">Response:</span>--Respuesta del servicio -- {\&quot;type\&quot;:\&quot;Lead\&quot;,\&quot;url\&quot;:\&quot;/services/data/v64.0/sobjects/Lead/00QU900000Cl3LKMAZ\&quot;},\&quot;Status\&quot;:\&quot;0_Abierto\&quot;,\&quot;Id\&quot;:\&quot;00QU900000Cl3LKMAZ\&quot;,\&quot;LastName\&quot;:\&quot;johan\&quot;,\&quot;FirstName\&quot;:null,\&quot;Email\&quot;:\&quot;jo@test.us\&quot;,\&quot;MobilePhone\&quot;:\&quot;3124567887\&quot;,\&quot;Phone\&quot;:\&quot;3124567887\&quot;,\&quot;Company\&quot;:null,\&quot;SURAAuthForPersonalDataProcess__c\&quot;:true,\&quot;SURAUpgPersonDataProccess__c\&quot;:\&quot;2020-11-01\&quot;,\&quot;SURALastUpgPersonDataProccess__c\&quot;:\&quot;2020-10-29\&quot;,\&quot;RecordTypeId\&quot;:\&quot;012D60000045fd1IAA\&quot;,\&quot;SURAProducerId__c\&quot;:\&quot;0YxD60000008UqJKAU\&quot;}&quot;</p></li><li class="list-item" id="1377939673#tkll51_223"><p><span class="control" id="1377939673#tkll51_234">Detalle:</span> manejador de producto Viajes para proceso LEAD</p></li><li class="list-item" id="1377939673#tkll51_224"><p><span class="control" id="1377939673#tkll51_235">Proceso:</span> Lead</p></li><li class="list-item" id="1377939673#tkll51_225"><p><span class="control" id="1377939673#tkll51_236">Tipo de registro:</span> Handler(Proceso)</p></li><li class="list-item" id="1377939673#tkll51_226"><p><span class="control" id="1377939673#tkll51_237">Nivel:</span> success</p></li></ul></section><section><h2 id="1377939673#observaciones-t-cnicas" data-toc="observaciones-t-cnicas#Product Handler.md-observaciones-t-cnicas">🧠 Observaciones T&eacute;cnicas</h2><ul class="list" id="1377939673#tkll51_238" start="1"><li class="list-item" id="1377939673#tkll51_240"><p>Utiliza dise&ntilde;o compacto del sistema (<span class="inline-code" id="1377939673#tkll51_243">SYSTEM</span>).</p></li><li class="list-item" id="1377939673#tkll51_241"><p>Puede utilizarse en reportes y v&iacute;a API o Streaming API.</p></li><li class="list-item" id="1377939673#tkll51_242"><p>No est&aacute; indexado para b&uacute;squeda global.</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1511612937">LeadProductHandler</h1><section><h2 id="-1511612937#descripci-n-general" data-toc="descripci-n-general#LeadProductHandler.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-1511612937#z1pvx1_15"><span class="inline-code" id="-1511612937#z1pvx1_16">LeadProductHandler</span> es una clase virtual global que extiende <span class="inline-code" id="-1511612937#z1pvx1_17">ProductHandler</span>. Esta clase est&aacute; dise&ntilde;ada para manejar el procesamiento de leads como productos, siguiendo un patr&oacute;n de dise&ntilde;o que facilita la creaci&oacute;n y configuraci&oacute;n flexible de objetos Lead en Salesforce.</p></section><section><h2 id="-1511612937#autor" data-toc="autor#LeadProductHandler.md-autor">Autor</h2><p id="-1511612937#z1pvx1_18">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="-1511612937#ltima-modificaci-n" data-toc="ltima-modificaci-n#LeadProductHandler.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="-1511612937#z1pvx1_19">21 de febrero de 2025 por Jean Carlos Melendez</p></section><section><h2 id="-1511612937#constantes" data-toc="constantes#LeadProductHandler.md-constantes">Constantes</h2><section><h3 id="-1511612937#process-name" data-toc="process-name#LeadProductHandler.md-process-name">PROCESS_NAME</h3><ul class="list" id="-1511612937#z1pvx1_22" start="1"><li class="list-item" id="-1511612937#z1pvx1_24"><p><span class="control" id="-1511612937#z1pvx1_26">Valor</span>: <span class="inline-code" id="-1511612937#z1pvx1_27">&quot;KNOWING&quot;</span></p></li><li class="list-item" id="-1511612937#z1pvx1_25"><p><span class="control" id="-1511612937#z1pvx1_28">Descripci&oacute;n</span>: Constante que define el nombre del proceso asociado a este handler.</p></li></ul></section></section><section><h2 id="-1511612937#constructor" data-toc="constructor#LeadProductHandler.md-constructor">Constructor</h2><section><h3 id="-1511612937#leadproducthandler-string-productname" data-toc="leadproducthandler-string-productname#LeadProductHandler.md-leadproducthandler-string-productname">LeadProductHandler(String productName)</h3><section><h4 id="-1511612937#descripci-n" data-toc="descripci-n#LeadProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1511612937#z1pvx1_35">Constructor que inicializa un nuevo handler con un nombre de producto espec&iacute;fico, llamando al constructor de la clase base.</p></section><section><h4 id="-1511612937#par-metros" data-toc="par-metros#LeadProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1511612937#z1pvx1_36" start="1"><li class="list-item" id="-1511612937#z1pvx1_37"><p><span class="inline-code" id="-1511612937#z1pvx1_38">productName</span> (String): Nombre del producto asociado a este handler.</p></li></ul></section><section><h4 id="-1511612937#c-digo" data-toc="c-digo#LeadProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1511612937#z1pvx1_39"><pre><code class="language-none">global LeadProductHandler(String productName) {
  super(productName);
}</code></pre></div></section></section></section><section><h2 id="-1511612937#m-todos" data-toc="m-todos#LeadProductHandler.md-m-todos">M&eacute;todos</h2><section><h3 id="-1511612937#setobservers" data-toc="setobservers#LeadProductHandler.md-setobservers">setObservers()</h3><section><h4 id="-1511612937#descripci-n" data-toc="descripci-n#LeadProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1511612937#z1pvx1_48">M&eacute;todo sobrescrito que configura los observadores para el handler, espec&iacute;ficamente a&ntilde;adiendo un <span class="inline-code" id="-1511612937#z1pvx1_49">LeadObserver</span>.</p></section><section><h4 id="-1511612937#retorno" data-toc="retorno#LeadProductHandler.md-retorno">Retorno</h4><ul class="list" id="-1511612937#z1pvx1_50" start="1"><li class="list-item" id="-1511612937#z1pvx1_51"><p><span class="inline-code" id="-1511612937#z1pvx1_52">void</span></p></li></ul></section><section><h4 id="-1511612937#c-digo" data-toc="c-digo#LeadProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1511612937#z1pvx1_53"><pre><code class="language-none">public override void setObservers() {
  this.addObserver(new LeadObserver());
}</code></pre></div></section></section><section><h3 id="-1511612937#process-map-string-object-options-map-string-object-input-map-string-object-output" data-toc="process-map-string-object-options-map-string-object-input-map-string-object-output#LeadProductHandler.md-process-map-string-object-options-map-string-object-input-map-string-object-output">process(Map&lt;String, Object&gt; options, Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; output)</h3><section><h4 id="-1511612937#descripci-n" data-toc="descripci-n#LeadProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1511612937#z1pvx1_61">M&eacute;todo principal sobrescrito que procesa la creaci&oacute;n de un Lead utilizando los datos de entrada proporcionados, aplicando opciones adicionales y almacenando el resultado en el mapa de salida.</p></section><section><h4 id="-1511612937#par-metros" data-toc="par-metros#LeadProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1511612937#z1pvx1_62" start="1"><li class="list-item" id="-1511612937#z1pvx1_63"><p><span class="inline-code" id="-1511612937#z1pvx1_66">options</span> (Map&lt;String, Object&gt;): Opciones adicionales para el proceso.</p></li><li class="list-item" id="-1511612937#z1pvx1_64"><p><span class="inline-code" id="-1511612937#z1pvx1_67">input</span> (Map&lt;String, Object&gt;): Datos de entrada para la creaci&oacute;n del Lead.</p></li><li class="list-item" id="-1511612937#z1pvx1_65"><p><span class="inline-code" id="-1511612937#z1pvx1_68">output</span> (Map&lt;String, Object&gt;): Mapa de salida donde se almacenar&aacute; el resultado.</p></li></ul></section><section><h4 id="-1511612937#retorno" data-toc="retorno#LeadProductHandler.md-retorno">Retorno</h4><ul class="list" id="-1511612937#z1pvx1_69" start="1"><li class="list-item" id="-1511612937#z1pvx1_70"><p><span class="inline-code" id="-1511612937#z1pvx1_71">Map&lt;String, Object&gt;</span>: Mapa con los datos del Lead creado.</p></li></ul></section><section><h4 id="-1511612937#proceso" data-toc="proceso#LeadProductHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1511612937#z1pvx1_72" type="1" start="1"><li class="list-item" id="-1511612937#z1pvx1_73"><p>Verifica si se debe omitir el comportamiento predeterminado seg&uacute;n las opciones.</p></li><li class="list-item" id="-1511612937#z1pvx1_74"><p>Valida que ning&uacute;n valor en el mapa de entrada sea nulo.</p></li><li class="list-item" id="-1511612937#z1pvx1_75"><p>Establece el nombre del proceso utilizando la constante <span class="inline-code" id="-1511612937#z1pvx1_81">PROCESS_NAME</span>.</p></li><li class="list-item" id="-1511612937#z1pvx1_76"><p>Obtiene los configuradores de Lead del mapa de entrada.</p></li><li class="list-item" id="-1511612937#z1pvx1_77"><p>Utiliza <span class="inline-code" id="-1511612937#z1pvx1_82">LeadBuilderFoundation</span> con un patr&oacute;n builder para crear un objeto Lead.</p></li><li class="list-item" id="-1511612937#z1pvx1_78"><p>Guarda el Lead creado en el mapa de salida.</p></li><li class="list-item" id="-1511612937#z1pvx1_79"><p>Establece el proceso de respuesta.</p></li><li class="list-item" id="-1511612937#z1pvx1_80"><p>Maneja excepciones de DML y generales, lanzando <span class="inline-code" id="-1511612937#z1pvx1_83">ProductHandlerImplementationException</span> con el c&oacute;digo 422.</p></li></ol></section><section><h4 id="-1511612937#c-digo" data-toc="c-digo#LeadProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1511612937#z1pvx1_84"><pre><code class="language-none">public override Map&lt;String, Object&gt; process(
  Map&lt;String, Object&gt; options,
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; output
) {
  if (options?.containsKey('skipDefaultBehavior')) {
    return input;
  }

  for (String key : input.keySet()) {
    if (input?.get(key) == null) {
      Core.debug(
        key +
        ' must not be empty, throwing product handler implementation custom exception'
      );
      throw new ProductHandlerImplementationException(
        key + ' must not be empty',
        'UNPROCESSABLE_ENTITY',
        422
      );
    }
  }
  setProcessName(PROCESS_NAME);

  List&lt;LeadConfigurator&gt; configurators = new List&lt;LeadConfigurator&gt;();
  configurators = (List&lt;LeadConfigurator&gt;) input?.get('configurators');
  try {
    Lead newLead = LeadBuilderFoundation.createLead(
      new LeadBuilderFoundation()
        .setStatus((String) input?.get('status') ?? '0_Abierto')
        .setId((Id) input?.get('leadId'))
        .setLastName((String) input?.get('lastName'))
        .setFirstName((String) input?.get('firstName'))
        .setEmail((String) input?.get('email'))
        .setMobile((String) input?.get('mobile_phone'))
        .setPhone((String) input?.get('phone'))
        .addConfigurators(configurators ?? new List&lt;LeadConfigurator&gt;())
        .build()
    );

    Core.debug('Finishing lead trip process...' + newLead);
    output.put('resultProcess', newLead);
    this.setResponseProcess((newLead));
    return output;

    // TODO: Implement exception handling Pipe
  } catch (DmlException dmlEx) {
    System.debug(
      'DML Exception while processing lead: ' + dmlEx.getDmlMessage(0)
    );
    throw new ProductHandlerImplementationException(
      dmlEx.getMessage(),
      'UNPROCESSABLE_ENTITY',
      422
    );
  } catch (Exception e) {
    //System.debug(e.getCause().toString() + ' ' + e.getMessage());
    throw new ProductHandlerImplementationException(
      e.getMessage(),
      'UNPROCESSABLE_ENTITY',
      422
    );
  }
}</code></pre></div></section></section><section><h3 id="-1511612937#isvalidforleadrequirements-map-string-object-data" data-toc="isvalidforleadrequirements-map-string-object-data#LeadProductHandler.md-isvalidforleadrequirements-map-string-object-data">isValidForLeadRequirements(Map&lt;String, Object&gt; data)</h3><section><h4 id="-1511612937#descripci-n" data-toc="descripci-n#LeadProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1511612937#z1pvx1_91">M&eacute;todo virtual que valida los requerimientos de negocio para la creaci&oacute;n de un Lead. Este m&eacute;todo est&aacute; dise&ntilde;ado para ser sobrescrito por clases derivadas concretas que implementar&aacute;n l&oacute;gicas espec&iacute;ficas de validaci&oacute;n.</p></section><section><h4 id="-1511612937#par-metros" data-toc="par-metros#LeadProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1511612937#z1pvx1_92" start="1"><li class="list-item" id="-1511612937#z1pvx1_93"><p><span class="inline-code" id="-1511612937#z1pvx1_94">data</span> (Map&lt;String, Object&gt;): Datos a validar.</p></li></ul></section><section><h4 id="-1511612937#retorno" data-toc="retorno#LeadProductHandler.md-retorno">Retorno</h4><ul class="list" id="-1511612937#z1pvx1_95" start="1"><li class="list-item" id="-1511612937#z1pvx1_96"><p><span class="inline-code" id="-1511612937#z1pvx1_97">Boolean</span>: <span class="inline-code" id="-1511612937#z1pvx1_98">true</span> si los datos cumplen con los requisitos, <span class="inline-code" id="-1511612937#z1pvx1_99">false</span> en caso contrario. La implementaci&oacute;n base siempre retorna <span class="inline-code" id="-1511612937#z1pvx1_100">true</span>.</p></li></ul></section><section><h4 id="-1511612937#c-digo" data-toc="c-digo#LeadProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1511612937#z1pvx1_101"><pre><code class="language-none">global virtual Boolean isValidForLeadRequirements(Map&lt;String, Object&gt; data) {
  /**
   * Se sobreescribira el codigo que evaluará la logica
   * y los requerimientos de negocios para creación de Lead...
   **/
  return true;
}</code></pre></div></section></section></section><section><h2 id="-1511612937#excepciones" data-toc="excepciones#LeadProductHandler.md-excepciones">Excepciones</h2><section><h3 id="-1511612937#producthandlerimplementationexception" data-toc="producthandlerimplementationexception#LeadProductHandler.md-producthandlerimplementationexception">ProductHandlerImplementationException</h3><p id="-1511612937#z1pvx1_104">Esta excepci&oacute;n se lanza en las siguientes situaciones:</p><ol class="list list-decimal" id="-1511612937#z1pvx1_105" type="1" start="1"><li class="list-item" id="-1511612937#z1pvx1_108"><p>Cuando un valor requerido en el mapa de entrada es nulo.</p></li><li class="list-item" id="-1511612937#z1pvx1_109"><p>Cuando ocurre una excepci&oacute;n de DML durante la creaci&oacute;n del Lead.</p></li><li class="list-item" id="-1511612937#z1pvx1_110"><p>Cuando ocurre cualquier otra excepci&oacute;n durante el proceso.</p></li></ol><p id="-1511612937#z1pvx1_106">En todos los casos, la excepci&oacute;n se lanza con un c&oacute;digo HTTP 422 (UNPROCESSABLE_ENTITY).</p></section></section><section><h2 id="-1511612937#dependencias" data-toc="dependencias#LeadProductHandler.md-dependencias">Dependencias</h2><ul class="list" id="-1511612937#z1pvx1_111" start="1"><li class="list-item" id="-1511612937#z1pvx1_112"><p><span class="inline-code" id="-1511612937#z1pvx1_119">ProductHandler</span>: Clase base que <span class="inline-code" id="-1511612937#z1pvx1_120">LeadProductHandler</span> extiende.</p></li><li class="list-item" id="-1511612937#z1pvx1_113"><p><span class="inline-code" id="-1511612937#z1pvx1_121">LeadObserver</span>: Clase observadora a&ntilde;adida en el m&eacute;todo <span class="inline-code" id="-1511612937#z1pvx1_122">setObservers()</span>.</p></li><li class="list-item" id="-1511612937#z1pvx1_114"><p><span class="inline-code" id="-1511612937#z1pvx1_123">Core</span>: Clase utilitaria que proporciona el m&eacute;todo <span class="inline-code" id="-1511612937#z1pvx1_124">debug</span>.</p></li><li class="list-item" id="-1511612937#z1pvx1_115"><p><span class="inline-code" id="-1511612937#z1pvx1_125">ProductHandlerImplementationException</span>: Excepci&oacute;n personalizada lanzada cuando hay errores en el proceso.</p></li><li class="list-item" id="-1511612937#z1pvx1_116"><p><span class="inline-code" id="-1511612937#z1pvx1_126">LeadBuilderFoundation</span>: Clase que implementa el patr&oacute;n Builder para crear objetos Lead.</p></li><li class="list-item" id="-1511612937#z1pvx1_117"><p><span class="inline-code" id="-1511612937#z1pvx1_127">LeadConfigurator</span>: Interfaz o clase que define configuradores para personalizar objetos Lead.</p></li><li class="list-item" id="-1511612937#z1pvx1_118"><p><span class="inline-code" id="-1511612937#z1pvx1_128">Lead</span>: Objeto est&aacute;ndar de Salesforce utilizado en el proceso.</p></li></ul></section><section><h2 id="-1511612937#patrones-de-dise-o-implementados" data-toc="patrones-de-dise-o-implementados#LeadProductHandler.md-patrones-de-dise-o-implementados">Patrones de Dise&ntilde;o Implementados</h2><section><h3 id="-1511612937#observer" data-toc="observer#LeadProductHandler.md-observer">Observer</h3><p id="-1511612937#z1pvx1_132">A trav&eacute;s del m&eacute;todo <span class="inline-code" id="-1511612937#z1pvx1_133">setObservers()</span>, la clase implementa el patr&oacute;n Observer, permitiendo que otros objetos (espec&iacute;ficamente, <span class="inline-code" id="-1511612937#z1pvx1_134">LeadObserver</span>) sean notificados de eventos durante el procesamiento.</p></section><section><h3 id="-1511612937#builder" data-toc="builder#LeadProductHandler.md-builder">Builder</h3><p id="-1511612937#z1pvx1_135">Aunque no implementado directamente en esta clase, <span class="inline-code" id="-1511612937#z1pvx1_136">LeadProductHandler</span> utiliza el patr&oacute;n Builder a trav&eacute;s de <span class="inline-code" id="-1511612937#z1pvx1_137">LeadBuilderFoundation</span> para crear objetos Lead de manera flexible.</p></section><section><h3 id="-1511612937#template-method" data-toc="template-method#LeadProductHandler.md-template-method">Template Method</h3><p id="-1511612937#z1pvx1_138">Como clase virtual con m&eacute;todos que pueden ser sobrescritos, <span class="inline-code" id="-1511612937#z1pvx1_139">LeadProductHandler</span> implementa el patr&oacute;n Template Method, definiendo el esqueleto de un algoritmo pero permitiendo que las subclases sobrescriban pasos espec&iacute;ficos.</p></section></section><section><h2 id="-1511612937#ejemplo-de-uso" data-toc="ejemplo-de-uso#LeadProductHandler.md-ejemplo-de-uso">Ejemplo de Uso</h2><div class="detached code-block" id="-1511612937#z1pvx1_140"><pre><code class="language-none">// Crear una instancia del handler
LeadProductHandler handler = new LeadProductHandler('LeadGeneration');

// Preparar los datos de entrada
Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
  'lastName' =&gt; 'Pérez',
  'firstName' =&gt; 'Juan',
  'email' =&gt; 'juan.perez@example.com',
  'phone' =&gt; '555-1234',
  'mobile_phone' =&gt; '555-5678',
  'status' =&gt; '0_Abierto'
};

// Configuradores personalizados (opcional)
List&lt;LeadConfigurator&gt; configurators = new List&lt;LeadConfigurator&gt;{
  new CompanyNameConfigurator('ACME Inc.'),
  new LeadSourceConfigurator('Web')
};
input.put('configurators', configurators);

// Mapas para opciones y salida
Map&lt;String, Object&gt; options = new Map&lt;String, Object&gt;();
Map&lt;String, Object&gt; output = new Map&lt;String, Object&gt;();

try {
  // Procesar la creación del Lead
  Map&lt;String, Object&gt; result = handler.process(options, input, output);
  
  // Obtener el Lead creado
  Lead newLead = (Lead)result.get('resultProcess');
  System.debug('Lead creado: ' + newLead.Id);
} catch (ProductHandlerImplementationException e) {
  System.debug('Error: ' + e.getMessage());
}</code></pre></div></section><section><h2 id="-1511612937#extensi-n-de-la-clase" data-toc="extensi-n-de-la-clase#LeadProductHandler.md-extensi-n-de-la-clase">Extensi&oacute;n de la Clase</h2><div class="detached code-block" id="-1511612937#z1pvx1_141"><pre><code class="language-none">public class PremiumLeadHandler extends LeadProductHandler {
    
    public PremiumLeadHandler() {
        super('PremiumLead');
    }
    
    // Sobrescribir para implementar validaciones específicas
    global override Boolean isValidForLeadRequirements(Map&lt;String, Object&gt; data) {
        // Validar que sea un lead premium (ejemplo: debe tener email y teléfono)
        String email = (String)data.get('email');
        String phone = (String)data.get('phone');
        
        return !String.isBlank(email) &amp;&amp; !String.isBlank(phone);
    }
    
    // Opcionalmente sobrescribir process para añadir lógica específica
    public override Map&lt;String, Object&gt; process(
        Map&lt;String, Object&gt; options,
        Map&lt;String, Object&gt; input,
        Map&lt;String, Object&gt; output
    ) {
        // Validar requisitos específicos antes de procesar
        if (!isValidForLeadRequirements(input)) {
            throw new ProductHandlerImplementationException(
                'Este lead no cumple con los requisitos para ser premium',
                'UNPROCESSABLE_ENTITY',
                422
            );
        }
        
        // Añadir configurador específico para leads premium
        List&lt;LeadConfigurator&gt; configurators = (List&lt;LeadConfigurator&gt;)input.get('configurators');
        if (configurators == null) {
            configurators = new List&lt;LeadConfigurator&gt;();
            input.put('configurators', configurators);
        }
        
        configurators.add(new PremiumLeadConfigurator());
        
        // Llamar al proceso base
        return super.process(options, input, output);
    }
}</code></pre></div></section><section><h2 id="-1511612937#notas-adicionales" data-toc="notas-adicionales#LeadProductHandler.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-1511612937#z1pvx1_142" type="1" start="1"><li class="list-item" id="-1511612937#z1pvx1_143"><p>La clase usa el operador de navegaci&oacute;n segura (<span class="inline-code" id="-1511612937#z1pvx1_147">?.</span>) y el operador de coalescencia nula (<span class="inline-code" id="-1511612937#z1pvx1_148">??</span>) para evitar excepciones de referencia nula, lo que indica que est&aacute; destinada a ejecutarse en versiones recientes de Apex.</p></li><li class="list-item" id="-1511612937#z1pvx1_144"><p>Hay un comentario TODO para implementar un manejo de excepciones con &quot;Pipe&quot;, lo que sugiere que podr&iacute;a haber planes para mejorar el manejo de errores en el futuro.</p></li><li class="list-item" id="-1511612937#z1pvx1_145"><p>El m&eacute;todo <span class="inline-code" id="-1511612937#z1pvx1_149">process()</span> valida que todos los valores de entrada no sean nulos, lo que podr&iacute;a ser restrictivo en algunos casos. Considere implementar una lista de campos requeridos espec&iacute;ficos en lugar de exigir que todos los campos tengan un valor.</p></li><li class="list-item" id="-1511612937#z1pvx1_146"><p>La clase implementa un mecanismo para omitir su comportamiento predeterminado si la opci&oacute;n <span class="inline-code" id="-1511612937#z1pvx1_150">skipDefaultBehavior</span> est&aacute; presente, lo que proporciona flexibilidad para casos de uso especiales.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1606364044">IssueProductHandler</h1><section><h2 id="-1606364044#descripci-n-general" data-toc="descripci-n-general#IssueProductHandler.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-1606364044#-6h2ncm_17"><span class="inline-code" id="-1606364044#-6h2ncm_18">IssueProductHandler</span> es una clase virtual global que extiende <span class="inline-code" id="-1606364044#-6h2ncm_19">ProductHandler</span> y est&aacute; dise&ntilde;ada para manejar la emisi&oacute;n de productos de seguros a trav&eacute;s de procedimientos de integraci&oacute;n. Esta clase implementa la l&oacute;gica necesaria para validar datos, asignar cuentas a cotizaciones y gestionar el proceso de emisi&oacute;n de p&oacute;lizas.</p></section><section><h2 id="-1606364044#autor" data-toc="autor#IssueProductHandler.md-autor">Autor</h2><p id="-1606364044#-6h2ncm_20">Jean Carlos Melendez \&lt;jean@cloudblue.us\&gt;</p></section><section><h2 id="-1606364044#ltima-modificaci-n" data-toc="ltima-modificaci-n#IssueProductHandler.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="-1606364044#-6h2ncm_21">21 de febrero de 2025</p></section><section><h2 id="-1606364044#constantes" data-toc="constantes#IssueProductHandler.md-constantes">Constantes</h2><div class="table-wrapper detached"><table id="-1606364044#-6h2ncm_22"><tr class="header-row" id="-1606364044#-6h2ncm_23"><th id="-1606364044#-6h2ncm_31"><p>Nombre</p></th><th id="-1606364044#-6h2ncm_32"><p>Tipo</p></th><th id="-1606364044#-6h2ncm_33"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-1606364044#-6h2ncm_24"><td id="-1606364044#-6h2ncm_34"><p><span class="inline-code" id="-1606364044#-6h2ncm_37">FLAG_PLATFORM_NAME</span></p></td><td id="-1606364044#-6h2ncm_35"><p><span class="inline-code" id="-1606364044#-6h2ncm_38">String</span></p></td><td id="-1606364044#-6h2ncm_36"><p>Nombre del indicador de plataforma: 'sura_foundation_platform_events'</p></td></tr><tr class="" id="-1606364044#-6h2ncm_25"><td id="-1606364044#-6h2ncm_39"><p><span class="inline-code" id="-1606364044#-6h2ncm_42">IP_PREPROCESS</span></p></td><td id="-1606364044#-6h2ncm_40"><p><span class="inline-code" id="-1606364044#-6h2ncm_43">String</span></p></td><td id="-1606364044#-6h2ncm_41"><p>Nombre del procedimiento de preprocesamiento: 'sfcore_preandpostquotingprocess'</p></td></tr><tr class="" id="-1606364044#-6h2ncm_26"><td id="-1606364044#-6h2ncm_44"><p><span class="inline-code" id="-1606364044#-6h2ncm_47">PROCESS_NAME</span></p></td><td id="-1606364044#-6h2ncm_45"><p><span class="inline-code" id="-1606364044#-6h2ncm_48">String</span></p></td><td id="-1606364044#-6h2ncm_46"><p>Nombre del proceso: 'Issuing'</p></td></tr><tr class="" id="-1606364044#-6h2ncm_27"><td id="-1606364044#-6h2ncm_49"><p><span class="inline-code" id="-1606364044#-6h2ncm_52">OPTION_SKIP_BEHAVIOR</span></p></td><td id="-1606364044#-6h2ncm_50"><p><span class="inline-code" id="-1606364044#-6h2ncm_53">String</span></p></td><td id="-1606364044#-6h2ncm_51"><p>Opci&oacute;n para omitir el comportamiento predeterminado: 'skipDefaultBehavior'</p></td></tr><tr class="" id="-1606364044#-6h2ncm_28"><td id="-1606364044#-6h2ncm_54"><p><span class="inline-code" id="-1606364044#-6h2ncm_57">ISSUING_IPROCEDURE</span></p></td><td id="-1606364044#-6h2ncm_55"><p><span class="inline-code" id="-1606364044#-6h2ncm_58">String</span></p></td><td id="-1606364044#-6h2ncm_56"><p>Nombre del procedimiento de integraci&oacute;n para emisi&oacute;n: 'SURAFoundation_IssuingProcedure'</p></td></tr><tr class="" id="-1606364044#-6h2ncm_29"><td id="-1606364044#-6h2ncm_59"><p><span class="inline-code" id="-1606364044#-6h2ncm_62">ERROR_REQUIRED_FIELD</span></p></td><td id="-1606364044#-6h2ncm_60"><p><span class="inline-code" id="-1606364044#-6h2ncm_63">String</span></p></td><td id="-1606364044#-6h2ncm_61"><p>Mensaje de error para campos requeridos: ' es requerido'</p></td></tr><tr class="" id="-1606364044#-6h2ncm_30"><td id="-1606364044#-6h2ncm_64"><p><span class="inline-code" id="-1606364044#-6h2ncm_67">REQUIRED_FIELD_FOR_ISSUE_CORE</span></p></td><td id="-1606364044#-6h2ncm_65"><p><span class="inline-code" id="-1606364044#-6h2ncm_68">List&lt;String&gt;</span></p></td><td id="-1606364044#-6h2ncm_66"><p>Lista de campos requeridos para la emisi&oacute;n: 'quoteId', 'effectiveDate', 'producerId'</p></td></tr></table></div></section><section><h2 id="-1606364044#variables-globales" data-toc="variables-globales#IssueProductHandler.md-variables-globales">Variables Globales</h2><div class="table-wrapper detached"><table id="-1606364044#-6h2ncm_69"><tr class="header-row" id="-1606364044#-6h2ncm_70"><th id="-1606364044#-6h2ncm_72"><p>Nombre</p></th><th id="-1606364044#-6h2ncm_73"><p>Tipo</p></th><th id="-1606364044#-6h2ncm_74"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-1606364044#-6h2ncm_71"><td id="-1606364044#-6h2ncm_75"><p><span class="inline-code" id="-1606364044#-6h2ncm_78">EXECUTOR</span></p></td><td id="-1606364044#-6h2ncm_76"><p><span class="inline-code" id="-1606364044#-6h2ncm_79">IntegrationProcedureExecutor</span></p></td><td id="-1606364044#-6h2ncm_77"><p>Ejecutor de procedimientos de integraci&oacute;n</p></td></tr></table></div></section><section><h2 id="-1606364044#constructores" data-toc="constructores#IssueProductHandler.md-constructores">Constructores</h2><section><h3 id="-1606364044#issueproducthandler-string-productname-integrationprocedureexecutor-executor" data-toc="issueproducthandler-string-productname-integrationprocedureexecutor-executor#IssueProductHandler.md-issueproducthandler-string-productname-integrationprocedureexecutor-executor">IssueProductHandler(String productName, IntegrationProcedureExecutor executor)</h3><section><h4 id="-1606364044#descripci-n" data-toc="descripci-n#IssueProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1606364044#-6h2ncm_87">Constructor que inicializa el handler con un nombre de producto espec&iacute;fico y un ejecutor de procedimientos de integraci&oacute;n personalizado.</p></section><section><h4 id="-1606364044#par-metros" data-toc="par-metros#IssueProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1606364044#-6h2ncm_88" start="1"><li class="list-item" id="-1606364044#-6h2ncm_89"><p><span class="inline-code" id="-1606364044#-6h2ncm_91">productName</span> (String): Nombre del producto a gestionar.</p></li><li class="list-item" id="-1606364044#-6h2ncm_90"><p><span class="inline-code" id="-1606364044#-6h2ncm_92">executor</span> (IntegrationProcedureExecutor): Ejecutor personalizado para los procedimientos de integraci&oacute;n.</p></li></ul></section><section><h4 id="-1606364044#c-digo" data-toc="c-digo#IssueProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1606364044#-6h2ncm_93"><pre><code class="language-none">global IssueProductHandler(
  String productName,
  IntegrationProcedureExecutor executor
) {
  super(productName);
  this.EXECUTOR = executor;
}</code></pre></div></section></section><section><h3 id="-1606364044#issueproducthandler-string-productname" data-toc="issueproducthandler-string-productname#IssueProductHandler.md-issueproducthandler-string-productname">IssueProductHandler(String productName)</h3><section><h4 id="-1606364044#descripci-n" data-toc="descripci-n#IssueProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1606364044#-6h2ncm_99">Constructor alternativo que inicializa el handler con un nombre de producto espec&iacute;fico y un ejecutor mock por defecto.</p></section><section><h4 id="-1606364044#par-metros" data-toc="par-metros#IssueProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1606364044#-6h2ncm_100" start="1"><li class="list-item" id="-1606364044#-6h2ncm_101"><p><span class="inline-code" id="-1606364044#-6h2ncm_102">productName</span> (String): Nombre del producto a gestionar.</p></li></ul></section><section><h4 id="-1606364044#c-digo" data-toc="c-digo#IssueProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1606364044#-6h2ncm_103"><pre><code class="language-none">global IssueProductHandler(String productName) {
  super(productName);
  this.EXECUTOR = new MockIntegrationProcedureExecutor();
}</code></pre></div></section></section></section><section><h2 id="-1606364044#m-todos-p-blicos-y-globales" data-toc="m-todos-p-blicos-y-globales#IssueProductHandler.md-m-todos-p-blicos-y-globales">M&eacute;todos P&uacute;blicos y Globales</h2><section><h3 id="-1606364044#onpre-map-string-object-options-map-string-object-input-map-string-object-output" data-toc="onpre-map-string-object-options-map-string-object-input-map-string-object-output#IssueProductHandler.md-onpre-map-string-object-options-map-string-object-input-map-string-object-output">onPre(Map&lt;String, Object&gt; options, Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; output)</h3><section><h4 id="-1606364044#descripci-n" data-toc="descripci-n#IssueProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1606364044#-6h2ncm_116">M&eacute;todo virtual sobrescrito que se ejecuta antes del proceso principal. Realiza validaciones iniciales y asigna cuentas a la cotizaci&oacute;n.</p></section><section><h4 id="-1606364044#par-metros" data-toc="par-metros#IssueProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1606364044#-6h2ncm_117" start="1"><li class="list-item" id="-1606364044#-6h2ncm_118"><p><span class="inline-code" id="-1606364044#-6h2ncm_121">options</span> (Map&lt;String, Object&gt;): Opciones adicionales para el proceso.</p></li><li class="list-item" id="-1606364044#-6h2ncm_119"><p><span class="inline-code" id="-1606364044#-6h2ncm_122">input</span> (Map&lt;String, Object&gt;): Datos de entrada para el proceso.</p></li><li class="list-item" id="-1606364044#-6h2ncm_120"><p><span class="inline-code" id="-1606364044#-6h2ncm_123">output</span> (Map&lt;String, Object&gt;): Mapa de salida donde se guardar&aacute;n los resultados.</p></li></ul></section><section><h4 id="-1606364044#retorno" data-toc="retorno#IssueProductHandler.md-retorno">Retorno</h4><ul class="list" id="-1606364044#-6h2ncm_124" start="1"><li class="list-item" id="-1606364044#-6h2ncm_125"><p><span class="inline-code" id="-1606364044#-6h2ncm_126">Map&lt;String, Object&gt;</span>: Los datos de entrada, posiblemente modificados durante el pre-procesamiento.</p></li></ul></section><section><h4 id="-1606364044#c-digo" data-toc="c-digo#IssueProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1606364044#-6h2ncm_127"><pre><code class="language-none">global virtual override Map&lt;String, Object&gt; onPre(
  Map&lt;String, Object&gt; options,
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; output
) {
  validateInput(input, new List&lt;String&gt;{ 'leadId', 'quoteId' });
  assignAccountsToQuote(
    listInsuredPartyAccounts(input),
    (Id) input.get('quoteId')
  );
  return input;
}</code></pre></div></section></section><section><h3 id="-1606364044#assignaccountstoquote-list-map-string-object-parties-id-quoteid" data-toc="assignaccountstoquote-list-map-string-object-parties-id-quoteid#IssueProductHandler.md-assignaccountstoquote-list-map-string-object-parties-id-quoteid">assignAccountsToQuote(List&lt;Map&lt;String, Object&gt;&gt; parties, Id quoteId)</h3><section><h4 id="-1606364044#descripci-n" data-toc="descripci-n#IssueProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1606364044#-6h2ncm_134">M&eacute;todo virtual que asigna cuentas de partes aseguradas a una cotizaci&oacute;n.</p></section><section><h4 id="-1606364044#par-metros" data-toc="par-metros#IssueProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1606364044#-6h2ncm_135" start="1"><li class="list-item" id="-1606364044#-6h2ncm_136"><p><span class="inline-code" id="-1606364044#-6h2ncm_138">parties</span> (List&lt;Map&lt;String, Object&gt;&gt;): Lista de partes aseguradas a asignar.</p></li><li class="list-item" id="-1606364044#-6h2ncm_137"><p><span class="inline-code" id="-1606364044#-6h2ncm_139">quoteId</span> (Id): ID de la cotizaci&oacute;n a la que se asignar&aacute;n las cuentas.</p></li></ul></section><section><h4 id="-1606364044#retorno" data-toc="retorno#IssueProductHandler.md-retorno">Retorno</h4><ul class="list" id="-1606364044#-6h2ncm_140" start="1"><li class="list-item" id="-1606364044#-6h2ncm_141"><p><span class="inline-code" id="-1606364044#-6h2ncm_142">void</span></p></li></ul></section><section><h4 id="-1606364044#c-digo" data-toc="c-digo#IssueProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1606364044#-6h2ncm_143"><pre><code class="language-none">global virtual void assignAccountsToQuote(
  List&lt;Map&lt;String, Object&gt;&gt; parties,
  Id quoteId
) {
  SObject quote = QuoteUtils.getQuoteById(quoteId);
  new QuoteUtils().setInsuredPartyToQuoteAndOpp(parties, quote);
}</code></pre></div></section></section><section><h3 id="-1606364044#listinsuredpartyaccounts-map-string-object-input" data-toc="listinsuredpartyaccounts-map-string-object-input#IssueProductHandler.md-listinsuredpartyaccounts-map-string-object-input">listInsuredPartyAccounts(Map&lt;String, Object&gt; input)</h3><section><h4 id="-1606364044#descripci-n" data-toc="descripci-n#IssueProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1606364044#-6h2ncm_150">M&eacute;todo virtual que obtiene la lista de cuentas de partes aseguradas a partir de los datos de entrada.</p></section><section><h4 id="-1606364044#par-metros" data-toc="par-metros#IssueProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1606364044#-6h2ncm_151" start="1"><li class="list-item" id="-1606364044#-6h2ncm_152"><p><span class="inline-code" id="-1606364044#-6h2ncm_153">input</span> (Map&lt;String, Object&gt;): Datos de entrada que contienen informaci&oacute;n sobre las partes aseguradas.</p></li></ul></section><section><h4 id="-1606364044#retorno" data-toc="retorno#IssueProductHandler.md-retorno">Retorno</h4><ul class="list" id="-1606364044#-6h2ncm_154" start="1"><li class="list-item" id="-1606364044#-6h2ncm_155"><p><span class="inline-code" id="-1606364044#-6h2ncm_156">List&lt;Map&lt;String, Object&gt;&gt;</span>: Lista de mapas que representan las cuentas de partes aseguradas.</p></li></ul></section><section><h4 id="-1606364044#c-digo" data-toc="c-digo#IssueProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1606364044#-6h2ncm_157"><pre><code class="language-none">global virtual List&lt;Map&lt;String, Object&gt;&gt; listInsuredPartyAccounts(
  Map&lt;String, Object&gt; input
) {
  return new LeadUtils().convertInsuredPartyFromLeadToAccount(input);
}</code></pre></div></section></section><section><h3 id="-1606364044#onpos-map-string-object-options-map-string-object-input-map-string-object-output" data-toc="onpos-map-string-object-options-map-string-object-input-map-string-object-output#IssueProductHandler.md-onpos-map-string-object-options-map-string-object-input-map-string-object-output">onPos(Map&lt;String, Object&gt; options, Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; output)</h3><section><h4 id="-1606364044#descripci-n" data-toc="descripci-n#IssueProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1606364044#-6h2ncm_164">M&eacute;todo virtual sobrescrito que se ejecuta despu&eacute;s del proceso principal. Actualiza el estado de la oportunidad a &quot;Poliza emitida&quot;.</p></section><section><h4 id="-1606364044#par-metros" data-toc="par-metros#IssueProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1606364044#-6h2ncm_165" start="1"><li class="list-item" id="-1606364044#-6h2ncm_166"><p><span class="inline-code" id="-1606364044#-6h2ncm_169">options</span> (Map&lt;String, Object&gt;): Opciones adicionales para el proceso.</p></li><li class="list-item" id="-1606364044#-6h2ncm_167"><p><span class="inline-code" id="-1606364044#-6h2ncm_170">input</span> (Map&lt;String, Object&gt;): Datos de entrada para el proceso.</p></li><li class="list-item" id="-1606364044#-6h2ncm_168"><p><span class="inline-code" id="-1606364044#-6h2ncm_171">output</span> (Map&lt;String, Object&gt;): Mapa de salida con los resultados del proceso principal.</p></li></ul></section><section><h4 id="-1606364044#retorno" data-toc="retorno#IssueProductHandler.md-retorno">Retorno</h4><ul class="list" id="-1606364044#-6h2ncm_172" start="1"><li class="list-item" id="-1606364044#-6h2ncm_173"><p><span class="inline-code" id="-1606364044#-6h2ncm_174">Map&lt;String, Object&gt;</span>: Los datos de entrada, posiblemente modificados durante el post-procesamiento.</p></li></ul></section><section><h4 id="-1606364044#c-digo" data-toc="c-digo#IssueProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1606364044#-6h2ncm_175"><pre><code class="language-none">global virtual override Map&lt;String, Object&gt; onPos(
  Map&lt;String, Object&gt; options,
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; output
) {
  String opportunityId = (String) ((Map&lt;String, Object&gt;) input
      ?.get('resultProcess'))
    ?.get('OpportunityId');

  if (opportunityId == null) {
    throw new ProductHandlerImplementationException(
      'OpportunityId is null',
      'UNPROCESSABLE_ENTITY',
      422
    );
  }
  Opportunity opp = [
    SELECT Id, StageName
    FROM Opportunity
    WHERE Id = :opportunityId
  ];

  opp.StageName = 'Poliza emitida';
  update opp;
  return input;
}</code></pre></div></section></section><section><h3 id="-1606364044#process-map-string-object-options-map-string-object-input-map-string-object-output" data-toc="process-map-string-object-options-map-string-object-input-map-string-object-output#IssueProductHandler.md-process-map-string-object-options-map-string-object-input-map-string-object-output">process(Map&lt;String, Object&gt; options, Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; output)</h3><section><h4 id="-1606364044#descripci-n" data-toc="descripci-n#IssueProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1606364044#-6h2ncm_182">M&eacute;todo sobrescrito que orquesta el proceso principal de emisi&oacute;n de producto.</p></section><section><h4 id="-1606364044#par-metros" data-toc="par-metros#IssueProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1606364044#-6h2ncm_183" start="1"><li class="list-item" id="-1606364044#-6h2ncm_184"><p><span class="inline-code" id="-1606364044#-6h2ncm_187">options</span> (Map&lt;String, Object&gt;): Opciones adicionales para el proceso.</p></li><li class="list-item" id="-1606364044#-6h2ncm_185"><p><span class="inline-code" id="-1606364044#-6h2ncm_188">input</span> (Map&lt;String, Object&gt;): Datos de entrada para el proceso.</p></li><li class="list-item" id="-1606364044#-6h2ncm_186"><p><span class="inline-code" id="-1606364044#-6h2ncm_189">output</span> (Map&lt;String, Object&gt;): Mapa de salida donde se guardar&aacute;n los resultados.</p></li></ul></section><section><h4 id="-1606364044#retorno" data-toc="retorno#IssueProductHandler.md-retorno">Retorno</h4><ul class="list" id="-1606364044#-6h2ncm_190" start="1"><li class="list-item" id="-1606364044#-6h2ncm_191"><p><span class="inline-code" id="-1606364044#-6h2ncm_192">Map&lt;String, Object&gt;</span>: Mapa con los datos del producto emitido.</p></li></ul></section><section><h4 id="-1606364044#c-digo" data-toc="c-digo#IssueProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1606364044#-6h2ncm_193"><pre><code class="language-none">global override Map&lt;String, Object&gt; process(
  Map&lt;String, Object&gt; options,
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; output
) {
  if (options?.containsKey(OPTION_SKIP_BEHAVIOR)) {
    return input;
  }

  return executeIntegrationProcedure(this.preIssuingValidation(input));
}</code></pre></div></section></section><section><h3 id="-1606364044#executeintegrationprocedure-map-string-object-ipinput" data-toc="executeintegrationprocedure-map-string-object-ipinput#IssueProductHandler.md-executeintegrationprocedure-map-string-object-ipinput">executeIntegrationProcedure(Map&lt;String, Object&gt; ipInput)</h3><section><h4 id="-1606364044#descripci-n" data-toc="descripci-n#IssueProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1606364044#-6h2ncm_200">Ejecuta el procedimiento de integraci&oacute;n para la emisi&oacute;n del producto.</p></section><section><h4 id="-1606364044#par-metros" data-toc="par-metros#IssueProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1606364044#-6h2ncm_201" start="1"><li class="list-item" id="-1606364044#-6h2ncm_202"><p><span class="inline-code" id="-1606364044#-6h2ncm_203">ipInput</span> (Map&lt;String, Object&gt;): Datos de entrada para el procedimiento de integraci&oacute;n.</p></li></ul></section><section><h4 id="-1606364044#retorno" data-toc="retorno#IssueProductHandler.md-retorno">Retorno</h4><ul class="list" id="-1606364044#-6h2ncm_204" start="1"><li class="list-item" id="-1606364044#-6h2ncm_205"><p><span class="inline-code" id="-1606364044#-6h2ncm_206">Map&lt;String, Object&gt;</span>: Mapa con los resultados del procedimiento de integraci&oacute;n.</p></li></ul></section><section><h4 id="-1606364044#c-digo" data-toc="c-digo#IssueProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1606364044#-6h2ncm_207"><pre><code class="language-none">global Map&lt;String, Object&gt; executeIntegrationProcedure(
  Map&lt;String, Object&gt; ipInput
) {
  Map&lt;String, Object&gt; output = new Map&lt;String, Object&gt;{
    'resultProcess' =&gt; EXECUTOR.execute(ISSUING_IPROCEDURE, ipInput)
  };
  this.setResponseProcess(output);
  return output;
}</code></pre></div></section></section></section><section><h2 id="-1606364044#m-todos-privados" data-toc="m-todos-privados#IssueProductHandler.md-m-todos-privados">M&eacute;todos Privados</h2><section><h3 id="-1606364044#validateinput-map-string-object-input-list-string-requiredfields" data-toc="validateinput-map-string-object-input-list-string-requiredfields#IssueProductHandler.md-validateinput-map-string-object-input-list-string-requiredfields">validateInput(Map&lt;String, Object&gt; input, List&lt;String&gt; requiredFields)</h3><section><h4 id="-1606364044#descripci-n" data-toc="descripci-n#IssueProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1606364044#-6h2ncm_217">Valida que los campos requeridos est&eacute;n presentes en el mapa de entrada.</p></section><section><h4 id="-1606364044#par-metros" data-toc="par-metros#IssueProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1606364044#-6h2ncm_218" start="1"><li class="list-item" id="-1606364044#-6h2ncm_219"><p><span class="inline-code" id="-1606364044#-6h2ncm_221">input</span> (Map&lt;String, Object&gt;): Datos de entrada a validar.</p></li><li class="list-item" id="-1606364044#-6h2ncm_220"><p><span class="inline-code" id="-1606364044#-6h2ncm_222">requiredFields</span> (List</p><p>): Lista de nombres de campos requeridos.</p></li></ul></section><section><h4 id="-1606364044#retorno" data-toc="retorno#IssueProductHandler.md-retorno">Retorno</h4><ul class="list" id="-1606364044#-6h2ncm_224" start="1"><li class="list-item" id="-1606364044#-6h2ncm_225"><p><span class="inline-code" id="-1606364044#-6h2ncm_226">void</span></p></li></ul></section><section><h4 id="-1606364044#excepciones" data-toc="excepciones#IssueProductHandler.md-excepciones">Excepciones</h4><ul class="list" id="-1606364044#-6h2ncm_227" start="1"><li class="list-item" id="-1606364044#-6h2ncm_228"><p><span class="inline-code" id="-1606364044#-6h2ncm_229">ProductHandlerImplementationException</span>: Si alg&uacute;n campo requerido est&aacute; ausente o vac&iacute;o.</p></li></ul></section><section><h4 id="-1606364044#c-digo" data-toc="c-digo#IssueProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1606364044#-6h2ncm_230"><pre><code class="language-none">private void validateInput(
  Map&lt;String, Object&gt; input,
  List&lt;String&gt; requiredFields
) {
  for (String field : requiredFields) {
    if (String.isBlank(String.valueOf(input?.get(field)))) {
      throw new ProductHandlerImplementationException(
        field + ERROR_REQUIRED_FIELD,
        'UNPROCESSABLE_ENTITY',
        422
      );
    }
  }
}</code></pre></div></section></section><section><h3 id="-1606364044#preissuingvalidation-map-string-object-input" data-toc="preissuingvalidation-map-string-object-input#IssueProductHandler.md-preissuingvalidation-map-string-object-input">preIssuingValidation(Map&lt;String, Object&gt; input)</h3><section><h4 id="-1606364044#descripci-n" data-toc="descripci-n#IssueProductHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1606364044#-6h2ncm_238">Realiza validaciones espec&iacute;ficas para el preprocesamiento de emisi&oacute;n, verificando la presencia de campos requeridos y las relaciones entre cotizaci&oacute;n, oportunidad y cuenta.</p></section><section><h4 id="-1606364044#par-metros" data-toc="par-metros#IssueProductHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1606364044#-6h2ncm_239" start="1"><li class="list-item" id="-1606364044#-6h2ncm_240"><p><span class="inline-code" id="-1606364044#-6h2ncm_241">input</span> (Map&lt;String, Object&gt;): Datos de entrada a validar.</p></li></ul></section><section><h4 id="-1606364044#retorno" data-toc="retorno#IssueProductHandler.md-retorno">Retorno</h4><ul class="list" id="-1606364044#-6h2ncm_242" start="1"><li class="list-item" id="-1606364044#-6h2ncm_243"><p><span class="inline-code" id="-1606364044#-6h2ncm_244">Map&lt;String, Object&gt;</span>: Los datos de entrada validados.</p></li></ul></section><section><h4 id="-1606364044#excepciones" data-toc="excepciones#IssueProductHandler.md-excepciones">Excepciones</h4><ul class="list" id="-1606364044#-6h2ncm_245" start="1"><li class="list-item" id="-1606364044#-6h2ncm_246"><p><span class="inline-code" id="-1606364044#-6h2ncm_247">ProductHandlerImplementationException</span>: Si no se encuentra el ID de oportunidad en la cotizaci&oacute;n o el ID de cuenta en la oportunidad.</p></li></ul></section><section><h4 id="-1606364044#c-digo" data-toc="c-digo#IssueProductHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1606364044#-6h2ncm_248"><pre><code class="language-none">private Map&lt;String, Object&gt; preIssuingValidation(Map&lt;String, Object&gt; input) {
  validateInput(input, REQUIRED_FIELD_FOR_ISSUE_CORE);
  SObject quote = QuoteUtils.getQuoteById((Id) input.get('quoteId'));
  Id opportunityId = (Id) quote.get('OpportunityId');

  if (opportunityId == null) {
    throw new ProductHandlerImplementationException(
      'No OpportunityId found in Quote',
      'UNPROCESSABLE_ENTITY',
      422
    );
  }

  Opportunity opp = [
    SELECT Id, AccountId
    FROM Opportunity
    WHERE Id = :opportunityId
    LIMIT 1
  ];

  if (opp.AccountId == null) {
    throw new ProductHandlerImplementationException(
      'No AccountId found in Opportunity',
      'UNPROCESSABLE_ENTITY',
      422
    );
  }

  return input;
}</code></pre></div></section></section></section><section><h2 id="-1606364044#excepciones" data-toc="excepciones#IssueProductHandler.md-excepciones">Excepciones</h2><section><h3 id="-1606364044#producthandlerimplementationexception" data-toc="producthandlerimplementationexception#IssueProductHandler.md-producthandlerimplementationexception">ProductHandlerImplementationException</h3><p id="-1606364044#-6h2ncm_251">Esta excepci&oacute;n personalizada se lanza en las siguientes situaciones:</p><ol class="list list-decimal" id="-1606364044#-6h2ncm_252" type="1" start="1"><li class="list-item" id="-1606364044#-6h2ncm_254"><p>Cuando un campo requerido est&aacute; ausente o vac&iacute;o.</p></li><li class="list-item" id="-1606364044#-6h2ncm_255"><p>Cuando no se encuentra el ID de oportunidad en la cotizaci&oacute;n.</p></li><li class="list-item" id="-1606364044#-6h2ncm_256"><p>Cuando no se encuentra el ID de cuenta en la oportunidad.</p></li><li class="list-item" id="-1606364044#-6h2ncm_257"><p>Cuando el ID de oportunidad es nulo en los resultados del proceso.</p></li></ol></section></section><section><h2 id="-1606364044#dependencias" data-toc="dependencias#IssueProductHandler.md-dependencias">Dependencias</h2><ul class="list" id="-1606364044#-6h2ncm_258" start="1"><li class="list-item" id="-1606364044#-6h2ncm_259"><p><span class="inline-code" id="-1606364044#-6h2ncm_265">ProductHandler</span>: Clase base que <span class="inline-code" id="-1606364044#-6h2ncm_266">IssueProductHandler</span> extiende.</p></li><li class="list-item" id="-1606364044#-6h2ncm_260"><p><span class="inline-code" id="-1606364044#-6h2ncm_267">IntegrationProcedureExecutor</span>: Interfaz o clase que define el m&eacute;todo <span class="inline-code" id="-1606364044#-6h2ncm_268">execute</span> para ejecutar procedimientos de integraci&oacute;n.</p></li><li class="list-item" id="-1606364044#-6h2ncm_261"><p><span class="inline-code" id="-1606364044#-6h2ncm_269">MockIntegrationProcedureExecutor</span>: Implementaci&oacute;n mock de <span class="inline-code" id="-1606364044#-6h2ncm_270">IntegrationProcedureExecutor</span> utilizada en el constructor alternativo.</p></li><li class="list-item" id="-1606364044#-6h2ncm_262"><p><span class="inline-code" id="-1606364044#-6h2ncm_271">QuoteUtils</span>: Clase utilitaria para operaciones con cotizaciones.</p></li><li class="list-item" id="-1606364044#-6h2ncm_263"><p><span class="inline-code" id="-1606364044#-6h2ncm_272">LeadUtils</span>: Clase utilitaria para operaciones con leads.</p></li><li class="list-item" id="-1606364044#-6h2ncm_264"><p><span class="inline-code" id="-1606364044#-6h2ncm_273">ProductHandlerImplementationException</span>: Excepci&oacute;n personalizada lanzada cuando hay errores en el proceso.</p></li></ul></section><section><h2 id="-1606364044#flujo-de-proceso" data-toc="flujo-de-proceso#IssueProductHandler.md-flujo-de-proceso">Flujo de Proceso</h2><p id="-1606364044#-6h2ncm_274">El proceso de emisi&oacute;n de producto sigue el siguiente flujo:</p><ol class="list list-decimal" id="-1606364044#-6h2ncm_275" type="1" start="1"><li class="list-item" id="-1606364044#-6h2ncm_276"><p id="-1606364044#-6h2ncm_279"><span class="control" id="-1606364044#-6h2ncm_281">Pre-procesamiento (<span class="inline-code" id="-1606364044#-6h2ncm_282">onPre</span>)</span>:</p><ul class="list" id="-1606364044#-6h2ncm_280" start="1"><li class="list-item" id="-1606364044#-6h2ncm_283"><p>Validaci&oacute;n de campos requeridos ('leadId', 'quoteId').</p></li><li class="list-item" id="-1606364044#-6h2ncm_284"><p>Obtenci&oacute;n de la lista de cuentas de partes aseguradas.</p></li><li class="list-item" id="-1606364044#-6h2ncm_285"><p>Asignaci&oacute;n de cuentas a la cotizaci&oacute;n.</p></li></ul></li><li class="list-item" id="-1606364044#-6h2ncm_277"><p id="-1606364044#-6h2ncm_286"><span class="control" id="-1606364044#-6h2ncm_288">Proceso principal (<span class="inline-code" id="-1606364044#-6h2ncm_289">process</span>)</span>:</p><ul class="list" id="-1606364044#-6h2ncm_287" start="1"><li class="list-item" id="-1606364044#-6h2ncm_290"><p>Validaci&oacute;n espec&iacute;fica para emisi&oacute;n (verificaci&oacute;n de campos y relaciones).</p></li><li class="list-item" id="-1606364044#-6h2ncm_291"><p>Ejecuci&oacute;n del procedimiento de integraci&oacute;n para emisi&oacute;n.</p></li></ul></li><li class="list-item" id="-1606364044#-6h2ncm_278"><p id="-1606364044#-6h2ncm_292"><span class="control" id="-1606364044#-6h2ncm_294">Post-procesamiento (<span class="inline-code" id="-1606364044#-6h2ncm_295">onPos</span>)</span>:</p><ul class="list" id="-1606364044#-6h2ncm_293" start="1"><li class="list-item" id="-1606364044#-6h2ncm_296"><p>Actualizaci&oacute;n del estado de la oportunidad a &quot;Poliza emitida&quot;.</p></li></ul></li></ol></section><section><h2 id="-1606364044#ejemplo-de-uso" data-toc="ejemplo-de-uso#IssueProductHandler.md-ejemplo-de-uso">Ejemplo de Uso</h2><div class="detached code-block" id="-1606364044#-6h2ncm_297"><pre><code class="language-none">// Crear el ejecutor de procedimientos de integración
IntegrationProcedureExecutor executor = new SomeIntegrationProcedureExecutor();

// Instanciar el handler
IssueProductHandler handler = new IssueProductHandler('AutoInsurance', executor);

// Preparar los datos de entrada
Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
  'leadId' =&gt; '00Q0x000000XXXXX',
  'quoteId' =&gt; '0Q00x000000XXXXX',
  'effectiveDate' =&gt; Date.today(),
  'producerId' =&gt; '0010x000000XXXXX'
};

// Mapas para opciones y salida
Map&lt;String, Object&gt; options = new Map&lt;String, Object&gt;();
Map&lt;String, Object&gt; output = new Map&lt;String, Object&gt;();

try {
  // Iniciar el flujo de emisión
  Map&lt;String, Object&gt; result = handler.onPre(options, input, output);
  result = handler.process(options, result, output);
  result = handler.onPos(options, result, output);
  
  // Verificar el resultado
  System.debug('Emisión completada. Resultado: ' + result);
} catch (ProductHandlerImplementationException e) {
  System.debug('Error en el proceso de emisión: ' + e.getMessage());
}</code></pre></div></section><section><h2 id="-1606364044#extensi-n-de-la-clase" data-toc="extensi-n-de-la-clase#IssueProductHandler.md-extensi-n-de-la-clase">Extensi&oacute;n de la Clase</h2><div class="detached code-block" id="-1606364044#-6h2ncm_298"><pre><code class="language-none">public class SpecializedIssueHandler extends IssueProductHandler {
    
    public SpecializedIssueHandler(String productName) {
        super(productName);
    }
    
    // Personalizar el comportamiento previo a la emisión
    global override Map&lt;String, Object&gt; onPre(
        Map&lt;String, Object&gt; options,
        Map&lt;String, Object&gt; input,
        Map&lt;String, Object&gt; output
    ) {
        // Realizar validaciones adicionales específicas del producto
        if (!String.valueOf(input.get('productLine')).equals('SpecialLine')) {
            throw new ProductHandlerImplementationException(
                'Este handler solo maneja la línea de producto &quot;SpecialLine&quot;',
                'UNPROCESSABLE_ENTITY',
                422
            );
        }
        
        // Llamar al método base
        return super.onPre(options, input, output);
    }
    
    // Personalizar el comportamiento posterior a la emisión
    global override Map&lt;String, Object&gt; onPos(
        Map&lt;String, Object&gt; options,
        Map&lt;String, Object&gt; input,
        Map&lt;String, Object&gt; output
    ) {
        // Llamar al método base primero
        Map&lt;String, Object&gt; result = super.onPos(options, input, output);
        
        // Realizar acciones adicionales después de la emisión
        String opportunityId = (String) ((Map&lt;String, Object&gt;) input.get('resultProcess')).get('OpportunityId');
        if (opportunityId != null) {
            // Crear una tarea de seguimiento, por ejemplo
            Task followUpTask = new Task(
                WhatId = opportunityId,
                Subject = 'Seguimiento post-emisión',
                ActivityDate = Date.today().addDays(7),
                Status = 'Pendiente',
                Priority = 'Normal'
            );
            insert followUpTask;
        }
        
        return result;
    }
}</code></pre></div></section><section><h2 id="-1606364044#notas-adicionales" data-toc="notas-adicionales#IssueProductHandler.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-1606364044#-6h2ncm_299" type="1" start="1"><li class="list-item" id="-1606364044#-6h2ncm_300"><p>La clase utiliza el operador de navegaci&oacute;n segura (<span class="inline-code" id="-1606364044#-6h2ncm_305">?.</span>) para evitar excepciones de referencia nula al acceder a valores en mapas.</p></li><li class="list-item" id="-1606364044#-6h2ncm_301"><p>La clase implementa un mecanismo para omitir su comportamiento predeterminado si la opci&oacute;n <span class="inline-code" id="-1606364044#-6h2ncm_306">skipDefaultBehavior</span> est&aacute; presente.</p></li><li class="list-item" id="-1606364044#-6h2ncm_302"><p>El m&eacute;todo <span class="inline-code" id="-1606364044#-6h2ncm_307">executeIntegrationProcedure</span> encapsula la ejecuci&oacute;n del procedimiento de integraci&oacute;n, facilitando la prueba unitaria y la extensibilidad.</p></li><li class="list-item" id="-1606364044#-6h2ncm_303"><p>La clase realiza validaciones exhaustivas en diferentes etapas del proceso para garantizar la integridad de los datos.</p></li><li class="list-item" id="-1606364044#-6h2ncm_304"><p>La estructura de la clase facilita la personalizaci&oacute;n mediante herencia, permitiendo sobrescribir los m&eacute;todos virtuales para comportamientos espec&iacute;ficos.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="2057955537">LeadConfigurator</h1><section><h2 id="2057955537#descripci-n-general" data-toc="descripci-n-general#LeadConfigurator.md-descripci-n-general">Descripci&oacute;n General</h2><p id="2057955537#ni6u0r_17"><span class="inline-code" id="2057955537#ni6u0r_18">LeadConfigurator</span> es una interfaz global que define un contrato para clases que configuran objetos Lead en Salesforce. Esta interfaz forma parte del patr&oacute;n de dise&ntilde;o Strategy, permitiendo encapsular diferentes algoritmos de configuraci&oacute;n para Leads que pueden ser utilizados intercambiablemente.</p></section><section><h2 id="2057955537#autor" data-toc="autor#LeadConfigurator.md-autor">Autor</h2><p id="2057955537#ni6u0r_19">Jean Carlos Melendez</p></section><section><h2 id="2057955537#ltima-modificaci-n" data-toc="ltima-modificaci-n#LeadConfigurator.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="2057955537#ni6u0r_20">30 de enero de 2025</p></section><section><h2 id="2057955537#definici-n-de-la-interfaz" data-toc="definici-n-de-la-interfaz#LeadConfigurator.md-definici-n-de-la-interfaz">Definici&oacute;n de la Interfaz</h2><div class="detached code-block" id="2057955537#ni6u0r_21"><pre><code class="language-none">global interface LeadConfigurator {
  void configure(Lead lead);
}</code></pre></div></section><section><h2 id="2057955537#m-todos" data-toc="m-todos#LeadConfigurator.md-m-todos">M&eacute;todos</h2><section><h3 id="2057955537#configure-lead-lead" data-toc="configure-lead-lead#LeadConfigurator.md-configure-lead-lead">configure(Lead lead)</h3><section><h4 id="2057955537#descripci-n" data-toc="descripci-n#LeadConfigurator.md-descripci-n">Descripci&oacute;n</h4><p id="2057955537#ni6u0r_28">M&eacute;todo que debe ser implementado por las clases que implementan esta interfaz. Su prop&oacute;sito es aplicar una configuraci&oacute;n espec&iacute;fica a un objeto Lead.</p></section><section><h4 id="2057955537#par-metros" data-toc="par-metros#LeadConfigurator.md-par-metros">Par&aacute;metros</h4><ul class="list" id="2057955537#ni6u0r_29" start="1"><li class="list-item" id="2057955537#ni6u0r_30"><p><span class="inline-code" id="2057955537#ni6u0r_31">lead</span> (Lead): El objeto Lead que ser&aacute; configurado.</p></li></ul></section><section><h4 id="2057955537#retorno" data-toc="retorno#LeadConfigurator.md-retorno">Retorno</h4><ul class="list" id="2057955537#ni6u0r_32" start="1"><li class="list-item" id="2057955537#ni6u0r_33"><p><span class="inline-code" id="2057955537#ni6u0r_34">void</span>: Este m&eacute;todo no devuelve ning&uacute;n valor.</p></li></ul></section></section></section><section><h2 id="2057955537#prop-sito-y-aplicaciones" data-toc="prop-sito-y-aplicaciones#LeadConfigurator.md-prop-sito-y-aplicaciones">Prop&oacute;sito y Aplicaciones</h2><p id="2057955537#ni6u0r_35">El prop&oacute;sito principal de esta interfaz es proporcionar un mecanismo flexible para configurar objetos Lead de diferentes maneras sin modificar el c&oacute;digo que utiliza estas configuraciones. Esto es particularmente &uacute;til en escenarios como:</p><ol class="list list-decimal" id="2057955537#ni6u0r_36" type="1" start="1"><li class="list-item" id="2057955537#ni6u0r_37"><p><span class="control" id="2057955537#ni6u0r_42">Configuraci&oacute;n de Leads por canal</span>: Aplicar configuraciones espec&iacute;ficas seg&uacute;n el canal de origen del Lead (web, tel&eacute;fono, evento, etc.).</p></li><li class="list-item" id="2057955537#ni6u0r_38"><p><span class="control" id="2057955537#ni6u0r_43">Configuraci&oacute;n por campa&ntilde;as</span>: Configurar Leads con informaci&oacute;n relacionada a campa&ntilde;as espec&iacute;ficas.</p></li><li class="list-item" id="2057955537#ni6u0r_39"><p><span class="control" id="2057955537#ni6u0r_44">Configuraci&oacute;n por producto de inter&eacute;s</span>: Aplicar l&oacute;gica personalizada seg&uacute;n el producto o servicio de inter&eacute;s del Lead.</p></li><li class="list-item" id="2057955537#ni6u0r_40"><p><span class="control" id="2057955537#ni6u0r_45">Normalizaci&oacute;n de datos</span>: Implementar diferentes estrategias para limpiar y normalizar datos de Leads.</p></li><li class="list-item" id="2057955537#ni6u0r_41"><p><span class="control" id="2057955537#ni6u0r_46">Asignaci&oacute;n de equipos o territorios</span>: Configurar asignaciones basadas en reglas personalizadas.</p></li></ol></section><section><h2 id="2057955537#patrones-de-dise-o-relacionados" data-toc="patrones-de-dise-o-relacionados#LeadConfigurator.md-patrones-de-dise-o-relacionados">Patrones de Dise&ntilde;o Relacionados</h2><section><h3 id="2057955537#strategy" data-toc="strategy#LeadConfigurator.md-strategy">Strategy</h3><p id="2057955537#ni6u0r_50">La interfaz <span class="inline-code" id="2057955537#ni6u0r_51">LeadConfigurator</span> es un ejemplo cl&aacute;sico del patr&oacute;n de dise&ntilde;o Strategy, que permite definir una familia de algoritmos (en este caso, algoritmos de configuraci&oacute;n de Leads), encapsularlos y hacerlos intercambiables. Este patr&oacute;n permite que el algoritmo var&iacute;e independientemente de los clientes que lo utilizan.</p></section><section><h3 id="2057955537#composite" data-toc="composite#LeadConfigurator.md-composite">Composite</h3><p id="2057955537#ni6u0r_52">Cuando se utilizan m&uacute;ltiples implementaciones de <span class="inline-code" id="2057955537#ni6u0r_53">LeadConfigurator</span> juntas para configurar un Lead, se est&aacute; empleando indirectamente el patr&oacute;n Composite, permitiendo tratar tanto configuraciones individuales como grupos de configuraciones de manera uniforme.</p></section><section><h3 id="2057955537#decorator" data-toc="decorator#LeadConfigurator.md-decorator">Decorator</h3><p id="2057955537#ni6u0r_54">Las implementaciones de esta interfaz pueden actuar como decoradores, a&ntilde;adiendo funcionalidades adicionales o modificando propiedades existentes de un objeto Lead sin cambiar su estructura b&aacute;sica.</p></section></section><section><h2 id="2057955537#relaci-n-con-leadbuilderfoundation" data-toc="relaci-n-con-leadbuilderfoundation#LeadConfigurator.md-relaci-n-con-leadbuilderfoundation">Relaci&oacute;n con LeadBuilderFoundation</h2><p id="2057955537#ni6u0r_55">Esta interfaz est&aacute; dise&ntilde;ada para trabajar en conjunto con la clase <span class="inline-code" id="2057955537#ni6u0r_57">LeadBuilderFoundation</span>, que implementa el patr&oacute;n Builder para construir objetos Lead. La clase <span class="inline-code" id="2057955537#ni6u0r_58">LeadBuilderFoundation</span> tiene un m&eacute;todo <span class="inline-code" id="2057955537#ni6u0r_59">addConfigurators</span> que acepta una lista de objetos que implementan esta interfaz, y luego los aplica secuencialmente en su m&eacute;todo <span class="inline-code" id="2057955537#ni6u0r_60">build</span>.</p><div class="detached code-block" id="2057955537#ni6u0r_56"><pre><code class="language-none">// Fragmento de código de LeadBuilderFoundation
global Lead build() {
  if (!this.configurators.isEmpty()) {
    for (LeadConfigurator configurator : configurators) {
      configurator.configure(lead);
    }
  }
  return lead;
}</code></pre></div></section><section><h2 id="2057955537#ejemplos-de-implementaci-n" data-toc="ejemplos-de-implementaci-n#LeadConfigurator.md-ejemplos-de-implementaci-n">Ejemplos de Implementaci&oacute;n</h2><section><h3 id="2057955537#configurador-de-fuente-de-lead" data-toc="configurador-de-fuente-de-lead#LeadConfigurator.md-configurador-de-fuente-de-lead">Configurador de Fuente de Lead</h3><div class="detached code-block" id="2057955537#ni6u0r_65"><pre><code class="language-none">public class LeadSourceConfigurator implements LeadConfigurator {
    private String source;
    private String sourceDetail;
    
    public LeadSourceConfigurator(String source, String sourceDetail) {
        this.source = source;
        this.sourceDetail = sourceDetail;
    }
    
    public void configure(Lead lead) {
        lead.LeadSource = this.source;
        lead.Source_Detail__c = this.sourceDetail;
    }
}</code></pre></div></section><section><h3 id="2057955537#configurador-de-datos-de-contacto" data-toc="configurador-de-datos-de-contacto#LeadConfigurator.md-configurador-de-datos-de-contacto">Configurador de Datos de Contacto</h3><div class="detached code-block" id="2057955537#ni6u0r_66"><pre><code class="language-none">public class ContactInfoConfigurator implements LeadConfigurator {
    private String email;
    private String phone;
    private String country;
    
    public ContactInfoConfigurator(String email, String phone, String country) {
        this.email = email;
        this.phone = phone;
        this.country = country;
    }
    
    public void configure(Lead lead) {
        lead.Email = this.email;
        lead.Phone = this.phone;
        lead.Country = this.country;
        
        // Normalizar el número de teléfono según el país
        if (this.country == 'USA' || this.country == 'US') {
            lead.Phone = normalizeUSPhone(this.phone);
        }
    }
    
    private String normalizeUSPhone(String phone) {
        // Implementación de normalización de número telefónico de EE.UU.
        // ...
        return phone;
    }
}</code></pre></div></section><section><h3 id="2057955537#configurador-para-asignaci-n-de-propietario" data-toc="configurador-para-asignaci-n-de-propietario#LeadConfigurator.md-configurador-para-asignaci-n-de-propietario">Configurador para Asignaci&oacute;n de Propietario</h3><div class="detached code-block" id="2057955537#ni6u0r_67"><pre><code class="language-none">public class OwnerAssignmentConfigurator implements LeadConfigurator {
    private String productInterest;
    
    public OwnerAssignmentConfigurator(String productInterest) {
        this.productInterest = productInterest;
    }
    
    public void configure(Lead lead) {
        lead.Product_Interest__c = this.productInterest;
        
        // Asignar propietario basado en el producto de interés
        Id ownerId = getOwnerIdForProduct(this.productInterest);
        if (ownerId != null) {
            lead.OwnerId = ownerId;
        }
    }
    
    private Id getOwnerIdForProduct(String product) {
        // Lógica para determinar el propietario adecuado basado en el producto
        // Podría consultar una configuración personalizada, una jerarquía de roles, etc.
        // ...
        return null; // Devolver el ID del propietario apropiado
    }
}</code></pre></div></section><section><h3 id="2057955537#configurador-compuesto" data-toc="configurador-compuesto#LeadConfigurator.md-configurador-compuesto">Configurador Compuesto</h3><div class="detached code-block" id="2057955537#ni6u0r_68"><pre><code class="language-none">public class CompositeLeadConfigurator implements LeadConfigurator {
    private List&lt;LeadConfigurator&gt; configurators;
    
    public CompositeLeadConfigurator() {
        this.configurators = new List&lt;LeadConfigurator&gt;();
    }
    
    public CompositeLeadConfigurator addConfigurator(LeadConfigurator configurator) {
        this.configurators.add(configurator);
        return this;
    }
    
    public void configure(Lead lead) {
        for (LeadConfigurator configurator : configurators) {
            configurator.configure(lead);
        }
    }
}</code></pre></div></section></section><section><h2 id="2057955537#ejemplo-de-uso-con-leadbuilderfoundation" data-toc="ejemplo-de-uso-con-leadbuilderfoundation#LeadConfigurator.md-ejemplo-de-uso-con-leadbuilderfoundation">Ejemplo de Uso con LeadBuilderFoundation</h2><div class="detached code-block" id="2057955537#ni6u0r_69"><pre><code class="language-none">// Crear configuradores específicos
LeadSourceConfigurator sourceConfig = new LeadSourceConfigurator('Web', 'Landing Page');
ContactInfoConfigurator contactConfig = new ContactInfoConfigurator('john.doe@example.com', '555-1234', 'US');
OwnerAssignmentConfigurator ownerConfig = new OwnerAssignmentConfigurator('Cloud Services');

// Añadir configuradores al builder
List&lt;LeadConfigurator&gt; configurators = new List&lt;LeadConfigurator&gt;{
    sourceConfig,
    contactConfig,
    ownerConfig
};

// Crear y configurar un Lead usando el builder
Lead newLead = new LeadBuilderFoundation()
    .setFirstName('John')
    .setLastName('Doe')
    .addConfigurators(configurators)
    .build();

// Alternativamente, crear y configurar y insertar un Lead
Lead insertedLead = new LeadBuilderFoundation()
    .setFirstName('Jane')
    .setLastName('Smith')
    .addConfigurators(configurators)
    .buildAndInsert();</code></pre></div></section><section><h2 id="2057955537#ejemplo-avanzado-con-l-gica-personalizada" data-toc="ejemplo-avanzado-con-l-gica-personalizada#LeadConfigurator.md-ejemplo-avanzado-con-l-gica-personalizada">Ejemplo Avanzado con L&oacute;gica Personalizada</h2><div class="detached code-block" id="2057955537#ni6u0r_70"><pre><code class="language-none">public class CampaignResponderConfigurator implements LeadConfigurator {
    private Id campaignId;
    private Boolean attended;
    private Date responseDate;
    
    public CampaignResponderConfigurator(Id campaignId, Boolean attended, Date responseDate) {
        this.campaignId = campaignId;
        this.attended = attended;
        this.responseDate = responseDate;
    }
    
    public void configure(Lead lead) {
        // Configurar campos relacionados con la campaña
        lead.Campaign_Source__c = this.campaignId;
        
        // Después de insertar el Lead, crear un CampaignMember
        if (lead.Id != null) {
            try {
                CampaignMember member = new CampaignMember(
                    CampaignId = this.campaignId,
                    LeadId = lead.Id,
                    Status = this.attended ? 'Attended' : 'Responded',
                    HasResponded = true
                );
                
                if (this.responseDate != null) {
                    member.FirstRespondedDate = this.responseDate;
                }
                
                insert member;
            } catch (Exception e) {
                // Manejar errores o registrar excepciones
                System.debug('Error al crear CampaignMember: ' + e.getMessage());
            }
        }
    }
}</code></pre></div></section><section><h2 id="2057955537#consideraciones-para-testing" data-toc="consideraciones-para-testing#LeadConfigurator.md-consideraciones-para-testing">Consideraciones para Testing</h2><p id="2057955537#ni6u0r_71">Al probar clases que implementan la interfaz <span class="inline-code" id="2057955537#ni6u0r_75">LeadConfigurator</span>, es importante:</p><ol class="list list-decimal" id="2057955537#ni6u0r_72" type="1" start="1"><li class="list-item" id="2057955537#ni6u0r_76"><p><span class="control" id="2057955537#ni6u0r_80">Verificar campos individuales</span>: Comprobar que cada campo afectado por el configurador tenga el valor esperado.</p></li><li class="list-item" id="2057955537#ni6u0r_77"><p><span class="control" id="2057955537#ni6u0r_81">Probar combinaciones</span>: Verificar que m&uacute;ltiples configuradores funcionen correctamente juntos sin conflictos.</p></li><li class="list-item" id="2057955537#ni6u0r_78"><p><span class="control" id="2057955537#ni6u0r_82">Simular dependencias</span>: Utilizar mocks o datos de prueba para cualquier consulta o l&oacute;gica externa.</p></li><li class="list-item" id="2057955537#ni6u0r_79"><p><span class="control" id="2057955537#ni6u0r_83">Verificar efectos secundarios</span>: Si el configurador realiza DML u otras operaciones, asegurarse de que se ejecuten correctamente.</p></li></ol><p id="2057955537#ni6u0r_73">Ejemplo de una clase de prueba:</p><div class="detached code-block" id="2057955537#ni6u0r_74"><pre><code class="language-none">@isTest
private class LeadSourceConfiguratorTest {
    @isTest
    static void testConfigureLead() {
        // Preparar datos
        String source = 'Web';
        String detail = 'Social Media';
        LeadSourceConfigurator configurator = new LeadSourceConfigurator(source, detail);
        
        Lead testLead = new Lead(
            FirstName = 'Test',
            LastName = 'User'
        );
        
        // Ejecutar la configuración
        Test.startTest();
        configurator.configure(testLead);
        Test.stopTest();
        
        // Verificar resultados
        System.assertEquals(source, testLead.LeadSource, 'Lead source should be set correctly');
        System.assertEquals(detail, testLead.Source_Detail__c, 'Source detail should be set correctly');
    }
}</code></pre></div></section><section><h2 id="2057955537#mejores-pr-cticas" data-toc="mejores-pr-cticas#LeadConfigurator.md-mejores-pr-cticas">Mejores Pr&aacute;cticas</h2><ol class="list list-decimal" id="2057955537#ni6u0r_84" type="1" start="1"><li class="list-item" id="2057955537#ni6u0r_85"><p><span class="control" id="2057955537#ni6u0r_91">Principio de Responsabilidad &Uacute;nica</span>: Cada implementaci&oacute;n de <span class="inline-code" id="2057955537#ni6u0r_92">LeadConfigurator</span> debe tener una responsabilidad &uacute;nica y espec&iacute;fica.</p></li><li class="list-item" id="2057955537#ni6u0r_86"><p><span class="control" id="2057955537#ni6u0r_93">Inmutabilidad</span>: Las implementaciones deber&iacute;an ser inmutables cuando sea posible, recibiendo todos los datos necesarios en el constructor.</p></li><li class="list-item" id="2057955537#ni6u0r_87"><p><span class="control" id="2057955537#ni6u0r_94">Manejo de errores robusto</span>: Implementar manejo de excepciones adecuado para evitar fallos en cascada.</p></li><li class="list-item" id="2057955537#ni6u0r_88"><p><span class="control" id="2057955537#ni6u0r_95">Documentaci&oacute;n clara</span>: Documentar qu&eacute; campos modifica cada configurador para facilitar su uso y mantenimiento.</p></li><li class="list-item" id="2057955537#ni6u0r_89"><p><span class="control" id="2057955537#ni6u0r_96">Evitar efectos secundarios</span>: Minimizar las operaciones DML u otros efectos secundarios dentro de los configuradores.</p></li><li class="list-item" id="2057955537#ni6u0r_90"><p><span class="control" id="2057955537#ni6u0r_97">Parametrizaci&oacute;n</span>: Dise&ntilde;ar configuradores parametrizados en lugar de codificar valores fijos.</p></li></ol></section><section><h2 id="2057955537#notas-adicionales" data-toc="notas-adicionales#LeadConfigurator.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="2057955537#ni6u0r_98" type="1" start="1"><li class="list-item" id="2057955537#ni6u0r_99"><p>La naturaleza global de la interfaz sugiere que est&aacute; dise&ntilde;ada para ser accesible desde diferentes paquetes o namespaces.</p></li><li class="list-item" id="2057955537#ni6u0r_100"><p>Esta interfaz facilita la aplicaci&oacute;n del principio abierto/cerrado, permitiendo extender la funcionalidad sin modificar el c&oacute;digo existente.</p></li><li class="list-item" id="2057955537#ni6u0r_101"><p>Al ser parte de un sistema m&aacute;s amplio que incluye <span class="inline-code" id="2057955537#ni6u0r_102">LeadBuilderFoundation</span>, esta interfaz contribuye a una arquitectura m&aacute;s modular y mantenible para la gesti&oacute;n de Leads.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1538875026">LeadBuilderFoundation</h1><section><h2 id="1538875026#descripci-n-general" data-toc="descripci-n-general#LeadBuilderFoundation.md-descripci-n-general">Descripci&oacute;n General</h2><p id="1538875026#pum1ik_16"><span class="inline-code" id="1538875026#pum1ik_17">LeadBuilderFoundation</span> es una clase global que implementa el patr&oacute;n de dise&ntilde;o Builder para crear y configurar objetos Lead de manera fluida en Salesforce. Esta clase permite encadenar m&eacute;todos para establecer diferentes atributos del Lead y aplicar configuradores personalizados antes de construir e insertar el registro.</p></section><section><h2 id="1538875026#autor" data-toc="autor#LeadBuilderFoundation.md-autor">Autor</h2><p id="1538875026#pum1ik_18">Felipe Correa \&lt;felipe.correa@nespon.com\&gt;</p></section><section><h2 id="1538875026#ltima-modificaci-n" data-toc="ltima-modificaci-n#LeadBuilderFoundation.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="1538875026#pum1ik_19">30 de enero de 2025 por Jean Carlos Melendez</p></section><section><h2 id="1538875026#atributos" data-toc="atributos#LeadBuilderFoundation.md-atributos">Atributos</h2><section><h3 id="1538875026#lead" data-toc="lead#LeadBuilderFoundation.md-lead">lead</h3><ul class="list" id="1538875026#pum1ik_23" start="1"><li class="list-item" id="1538875026#pum1ik_25"><p><span class="control" id="1538875026#pum1ik_28">Tipo</span>: <span class="inline-code" id="1538875026#pum1ik_29">Lead</span></p></li><li class="list-item" id="1538875026#pum1ik_26"><p><span class="control" id="1538875026#pum1ik_30">Accesibilidad</span>: <span class="inline-code" id="1538875026#pum1ik_31">global</span></p></li><li class="list-item" id="1538875026#pum1ik_27"><p><span class="control" id="1538875026#pum1ik_32">Descripci&oacute;n</span>: El objeto Lead que se est&aacute; construyendo.</p></li></ul></section><section><h3 id="1538875026#configurators" data-toc="configurators#LeadBuilderFoundation.md-configurators">configurators</h3><ul class="list" id="1538875026#pum1ik_34" start="1"><li class="list-item" id="1538875026#pum1ik_36"><p><span class="control" id="1538875026#pum1ik_39">Tipo</span>: <span class="inline-code" id="1538875026#pum1ik_40">List&lt;LeadConfigurator&gt;</span></p></li><li class="list-item" id="1538875026#pum1ik_37"><p><span class="control" id="1538875026#pum1ik_41">Accesibilidad</span>: <span class="inline-code" id="1538875026#pum1ik_42">global</span></p></li><li class="list-item" id="1538875026#pum1ik_38"><p><span class="control" id="1538875026#pum1ik_43">Descripci&oacute;n</span>: Lista de configuradores que aplicar&aacute;n personalizaciones adicionales al Lead.</p></li></ul></section></section><section><h2 id="1538875026#constructor" data-toc="constructor#LeadBuilderFoundation.md-constructor">Constructor</h2><section><h3 id="1538875026#leadbuilderfoundation" data-toc="leadbuilderfoundation#LeadBuilderFoundation.md-leadbuilderfoundation">LeadBuilderFoundation()</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_50">Constructor que inicializa un nuevo objeto Lead vac&iacute;o.</p></section><section><h4 id="1538875026#par-metros" data-toc="par-metros#LeadBuilderFoundation.md-par-metros">Par&aacute;metros</h4><p id="1538875026#pum1ik_51">Ninguno.</p></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_52"><pre><code class="language-none">global LeadBuilderFoundation() {
  lead = new Lead();
}</code></pre></div></section></section></section><section><h2 id="1538875026#m-todos-de-configuraci-n-fluida" data-toc="m-todos-de-configuraci-n-fluida#LeadBuilderFoundation.md-m-todos-de-configuraci-n-fluida">M&eacute;todos de Configuraci&oacute;n Fluida</h2><p id="1538875026#pum1ik_53">Estos m&eacute;todos permiten establecer valores para campos espec&iacute;ficos del Lead y devuelven la instancia del builder, permitiendo el encadenamiento de m&eacute;todos.</p><section><h3 id="1538875026#setid-id-id" data-toc="setid-id-id#LeadBuilderFoundation.md-setid-id-id">setId(Id id)</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_68">Establece el Id del Lead.</p></section><section><h4 id="1538875026#par-metros" data-toc="par-metros#LeadBuilderFoundation.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1538875026#pum1ik_69" start="1"><li class="list-item" id="1538875026#pum1ik_70"><p><span class="inline-code" id="1538875026#pum1ik_71">id</span> (Id): Id del Lead.</p></li></ul></section><section><h4 id="1538875026#retorno" data-toc="retorno#LeadBuilderFoundation.md-retorno">Retorno</h4><ul class="list" id="1538875026#pum1ik_72" start="1"><li class="list-item" id="1538875026#pum1ik_73"><p><span class="inline-code" id="1538875026#pum1ik_74">LeadBuilderFoundation</span>: La instancia actual del builder.</p></li></ul></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_75"><pre><code class="language-none">global LeadBuilderFoundation setId(Id id) {
  lead.Id = id;
  return this;
}</code></pre></div></section></section><section><h3 id="1538875026#setstatus-string-status" data-toc="setstatus-string-status#LeadBuilderFoundation.md-setstatus-string-status">setStatus(String status)</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_82">Establece el estado del Lead.</p></section><section><h4 id="1538875026#par-metros" data-toc="par-metros#LeadBuilderFoundation.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1538875026#pum1ik_83" start="1"><li class="list-item" id="1538875026#pum1ik_84"><p><span class="inline-code" id="1538875026#pum1ik_85">status</span> (String): Estado del Lead.</p></li></ul></section><section><h4 id="1538875026#retorno" data-toc="retorno#LeadBuilderFoundation.md-retorno">Retorno</h4><ul class="list" id="1538875026#pum1ik_86" start="1"><li class="list-item" id="1538875026#pum1ik_87"><p><span class="inline-code" id="1538875026#pum1ik_88">LeadBuilderFoundation</span>: La instancia actual del builder.</p></li></ul></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_89"><pre><code class="language-none">global LeadBuilderFoundation setStatus(String status) {
  lead.Status = status;
  return this;
}</code></pre></div></section></section><section><h3 id="1538875026#setlastname-string-lastname" data-toc="setlastname-string-lastname#LeadBuilderFoundation.md-setlastname-string-lastname">setLastName(String lastName)</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_96">Establece el apellido del Lead.</p></section><section><h4 id="1538875026#par-metros" data-toc="par-metros#LeadBuilderFoundation.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1538875026#pum1ik_97" start="1"><li class="list-item" id="1538875026#pum1ik_98"><p><span class="inline-code" id="1538875026#pum1ik_99">lastName</span> (String): Apellido del Lead.</p></li></ul></section><section><h4 id="1538875026#retorno" data-toc="retorno#LeadBuilderFoundation.md-retorno">Retorno</h4><ul class="list" id="1538875026#pum1ik_100" start="1"><li class="list-item" id="1538875026#pum1ik_101"><p><span class="inline-code" id="1538875026#pum1ik_102">LeadBuilderFoundation</span>: La instancia actual del builder.</p></li></ul></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_103"><pre><code class="language-none">global LeadBuilderFoundation setLastName(String lastName) {
  lead.LastName = lastName;
  return this;
}</code></pre></div></section></section><section><h3 id="1538875026#setfirstname-string-firstname" data-toc="setfirstname-string-firstname#LeadBuilderFoundation.md-setfirstname-string-firstname">setFirstName(String firstName)</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_110">Establece el nombre del Lead.</p></section><section><h4 id="1538875026#par-metros" data-toc="par-metros#LeadBuilderFoundation.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1538875026#pum1ik_111" start="1"><li class="list-item" id="1538875026#pum1ik_112"><p><span class="inline-code" id="1538875026#pum1ik_113">firstName</span> (String): Nombre del Lead.</p></li></ul></section><section><h4 id="1538875026#retorno" data-toc="retorno#LeadBuilderFoundation.md-retorno">Retorno</h4><ul class="list" id="1538875026#pum1ik_114" start="1"><li class="list-item" id="1538875026#pum1ik_115"><p><span class="inline-code" id="1538875026#pum1ik_116">LeadBuilderFoundation</span>: La instancia actual del builder.</p></li></ul></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_117"><pre><code class="language-none">global LeadBuilderFoundation setFirstName(String firstName) {
  lead.FirstName = firstName;
  return this;
}</code></pre></div></section></section><section><h3 id="1538875026#setemail-string-email" data-toc="setemail-string-email#LeadBuilderFoundation.md-setemail-string-email">setEmail(String email)</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_124">Establece el correo electr&oacute;nico del Lead.</p></section><section><h4 id="1538875026#par-metros" data-toc="par-metros#LeadBuilderFoundation.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1538875026#pum1ik_125" start="1"><li class="list-item" id="1538875026#pum1ik_126"><p><span class="inline-code" id="1538875026#pum1ik_127">email</span> (String): Correo electr&oacute;nico del Lead.</p></li></ul></section><section><h4 id="1538875026#retorno" data-toc="retorno#LeadBuilderFoundation.md-retorno">Retorno</h4><ul class="list" id="1538875026#pum1ik_128" start="1"><li class="list-item" id="1538875026#pum1ik_129"><p><span class="inline-code" id="1538875026#pum1ik_130">LeadBuilderFoundation</span>: La instancia actual del builder.</p></li></ul></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_131"><pre><code class="language-none">global LeadBuilderFoundation setEmail(String email) {
  lead.Email = email;
  return this;
}</code></pre></div></section></section><section><h3 id="1538875026#setmobile-string-mobile" data-toc="setmobile-string-mobile#LeadBuilderFoundation.md-setmobile-string-mobile">setMobile(String mobile)</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_138">Establece el n&uacute;mero de tel&eacute;fono m&oacute;vil del Lead.</p></section><section><h4 id="1538875026#par-metros" data-toc="par-metros#LeadBuilderFoundation.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1538875026#pum1ik_139" start="1"><li class="list-item" id="1538875026#pum1ik_140"><p><span class="inline-code" id="1538875026#pum1ik_141">mobile</span> (String): N&uacute;mero de tel&eacute;fono m&oacute;vil del Lead.</p></li></ul></section><section><h4 id="1538875026#retorno" data-toc="retorno#LeadBuilderFoundation.md-retorno">Retorno</h4><ul class="list" id="1538875026#pum1ik_142" start="1"><li class="list-item" id="1538875026#pum1ik_143"><p><span class="inline-code" id="1538875026#pum1ik_144">LeadBuilderFoundation</span>: La instancia actual del builder.</p></li></ul></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_145"><pre><code class="language-none">global LeadBuilderFoundation setMobile(String mobile) {
  lead.MobilePhone = mobile;
  return this;
}</code></pre></div></section></section><section><h3 id="1538875026#setphone-string-phone" data-toc="setphone-string-phone#LeadBuilderFoundation.md-setphone-string-phone">setPhone(String phone)</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_152">Establece el n&uacute;mero de tel&eacute;fono del Lead.</p></section><section><h4 id="1538875026#par-metros" data-toc="par-metros#LeadBuilderFoundation.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1538875026#pum1ik_153" start="1"><li class="list-item" id="1538875026#pum1ik_154"><p><span class="inline-code" id="1538875026#pum1ik_155">phone</span> (String): N&uacute;mero de tel&eacute;fono del Lead.</p></li></ul></section><section><h4 id="1538875026#retorno" data-toc="retorno#LeadBuilderFoundation.md-retorno">Retorno</h4><ul class="list" id="1538875026#pum1ik_156" start="1"><li class="list-item" id="1538875026#pum1ik_157"><p><span class="inline-code" id="1538875026#pum1ik_158">LeadBuilderFoundation</span>: La instancia actual del builder.</p></li></ul></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_159"><pre><code class="language-none">global LeadBuilderFoundation setPhone(String phone) {
  lead.Phone = phone;
  return this;
}</code></pre></div></section></section><section><h3 id="1538875026#addconfigurators-list-leadconfigurator-configuratorslist" data-toc="addconfigurators-list-leadconfigurator-configuratorslist#LeadBuilderFoundation.md-addconfigurators-list-leadconfigurator-configuratorslist">addConfigurators(List&lt;LeadConfigurator&gt; configuratorsList)</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_166">A&ntilde;ade una lista de configuradores para personalizar el Lead.</p></section><section><h4 id="1538875026#par-metros" data-toc="par-metros#LeadBuilderFoundation.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1538875026#pum1ik_167" start="1"><li class="list-item" id="1538875026#pum1ik_168"><p><span class="inline-code" id="1538875026#pum1ik_169">configuratorsList</span> (List</p><p>): Lista de configuradores a a&ntilde;adir.</p></li></ul></section><section><h4 id="1538875026#retorno" data-toc="retorno#LeadBuilderFoundation.md-retorno">Retorno</h4><ul class="list" id="1538875026#pum1ik_171" start="1"><li class="list-item" id="1538875026#pum1ik_172"><p><span class="inline-code" id="1538875026#pum1ik_173">LeadBuilderFoundation</span>: La instancia actual del builder.</p></li></ul></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_174"><pre><code class="language-none">global LeadBuilderFoundation addConfigurators(
  List&lt;LeadConfigurator&gt; configuratorsList
) {
  if (!configuratorsList.isEmpty()) {
    this.configurators.addAll(configuratorsList);
  }
  return this;
}</code></pre></div></section></section></section><section><h2 id="1538875026#m-todos-de-construcci-n" data-toc="m-todos-de-construcci-n#LeadBuilderFoundation.md-m-todos-de-construcci-n">M&eacute;todos de Construcci&oacute;n</h2><section><h3 id="1538875026#build" data-toc="build#LeadBuilderFoundation.md-build">build()</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_183">Construye el objeto Lead aplicando todos los configuradores a&ntilde;adidos.</p></section><section><h4 id="1538875026#retorno" data-toc="retorno#LeadBuilderFoundation.md-retorno">Retorno</h4><ul class="list" id="1538875026#pum1ik_184" start="1"><li class="list-item" id="1538875026#pum1ik_185"><p><span class="inline-code" id="1538875026#pum1ik_186">Lead</span>: El objeto Lead configurado.</p></li></ul></section><section><h4 id="1538875026#proceso" data-toc="proceso#LeadBuilderFoundation.md-proceso">Proceso</h4><ol class="list list-decimal" id="1538875026#pum1ik_187" type="1" start="1"><li class="list-item" id="1538875026#pum1ik_188"><p>Verifica si hay configuradores en la lista.</p></li><li class="list-item" id="1538875026#pum1ik_189"><p>Si existen, aplica cada configurador al objeto Lead.</p></li><li class="list-item" id="1538875026#pum1ik_190"><p>Devuelve el objeto Lead configurado.</p></li></ol></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_191"><pre><code class="language-none">global Lead build() {
  if (!this.configurators.isEmpty()) {
    for (LeadConfigurator configurator : configurators) {
      configurator.configure(lead);
    }
  }
  return lead;
}</code></pre></div></section></section><section><h3 id="1538875026#buildandinsert" data-toc="buildandinsert#LeadBuilderFoundation.md-buildandinsert">buildAndInsert()</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_198">Construye el objeto Lead aplicando todos los configuradores y lo inserta en la base de datos.</p></section><section><h4 id="1538875026#retorno" data-toc="retorno#LeadBuilderFoundation.md-retorno">Retorno</h4><ul class="list" id="1538875026#pum1ik_199" start="1"><li class="list-item" id="1538875026#pum1ik_200"><p><span class="inline-code" id="1538875026#pum1ik_201">Lead</span>: El objeto Lead configurado e insertado.</p></li></ul></section><section><h4 id="1538875026#proceso" data-toc="proceso#LeadBuilderFoundation.md-proceso">Proceso</h4><ol class="list list-decimal" id="1538875026#pum1ik_202" type="1" start="1"><li class="list-item" id="1538875026#pum1ik_203"><p>Verifica si hay configuradores en la lista.</p></li><li class="list-item" id="1538875026#pum1ik_204"><p>Si existen, aplica cada configurador al objeto Lead.</p></li><li class="list-item" id="1538875026#pum1ik_205"><p>Realiza un upsert del Lead en la base de datos.</p></li><li class="list-item" id="1538875026#pum1ik_206"><p>Devuelve el objeto Lead insertado.</p></li></ol></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_207"><pre><code class="language-none">global Lead buildAndInsert() {
  if (!this.configurators.isEmpty()) {
    for (LeadConfigurator configurator : configurators) {
      configurator.configure(lead);
    }
  }
  upsert lead;
  return lead;
}</code></pre></div></section></section></section><section><h2 id="1538875026#m-todos-est-ticos-de-servicio" data-toc="m-todos-est-ticos-de-servicio#LeadBuilderFoundation.md-m-todos-est-ticos-de-servicio">M&eacute;todos Est&aacute;ticos de Servicio</h2><section><h3 id="1538875026#createlead-lead-lead" data-toc="createlead-lead-lead#LeadBuilderFoundation.md-createlead-lead-lead">createLead(Lead lead)</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_216">M&eacute;todo est&aacute;tico que inserta un Lead utilizando reglas de asignaci&oacute;n.</p></section><section><h4 id="1538875026#par-metros" data-toc="par-metros#LeadBuilderFoundation.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1538875026#pum1ik_217" start="1"><li class="list-item" id="1538875026#pum1ik_218"><p><span class="inline-code" id="1538875026#pum1ik_219">lead</span> (Lead): El objeto Lead a insertar.</p></li></ul></section><section><h4 id="1538875026#retorno" data-toc="retorno#LeadBuilderFoundation.md-retorno">Retorno</h4><ul class="list" id="1538875026#pum1ik_220" start="1"><li class="list-item" id="1538875026#pum1ik_221"><p><span class="inline-code" id="1538875026#pum1ik_222">Lead</span>: El objeto Lead insertado.</p></li></ul></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_223"><pre><code class="language-none">global static Lead createLead(Lead lead) {
  return insertLeadWithAssignmentRules(lead);
}</code></pre></div></section></section><section><h3 id="1538875026#upsertlead-lead-lead" data-toc="upsertlead-lead-lead#LeadBuilderFoundation.md-upsertlead-lead-lead">upsertLead(Lead lead)</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_231">M&eacute;todo est&aacute;tico que realiza un upsert de un Lead utilizando reglas de asignaci&oacute;n.</p></section><section><h4 id="1538875026#par-metros" data-toc="par-metros#LeadBuilderFoundation.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1538875026#pum1ik_232" start="1"><li class="list-item" id="1538875026#pum1ik_233"><p><span class="inline-code" id="1538875026#pum1ik_234">lead</span> (Lead): El objeto Lead para realizar upsert.</p></li></ul></section><section><h4 id="1538875026#retorno" data-toc="retorno#LeadBuilderFoundation.md-retorno">Retorno</h4><ul class="list" id="1538875026#pum1ik_235" start="1"><li class="list-item" id="1538875026#pum1ik_236"><p><span class="inline-code" id="1538875026#pum1ik_237">Lead</span>: El objeto Lead despu&eacute;s del upsert.</p></li></ul></section><section><h4 id="1538875026#proceso" data-toc="proceso#LeadBuilderFoundation.md-proceso">Proceso</h4><ol class="list list-decimal" id="1538875026#pum1ik_238" type="1" start="1"><li class="list-item" id="1538875026#pum1ik_239"><p>Configura las opciones DML para utilizar la regla de asignaci&oacute;n predeterminada.</p></li><li class="list-item" id="1538875026#pum1ik_240"><p>Establece estas opciones en el objeto Lead.</p></li><li class="list-item" id="1538875026#pum1ik_241"><p>Realiza un upsert del Lead en la base de datos.</p></li><li class="list-item" id="1538875026#pum1ik_242"><p>Devuelve el objeto Lead actualizado.</p></li></ol></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_243"><pre><code class="language-none">global static Lead upsertLead(Lead lead) {
  Database.DMLOptions dmlOptn = new Database.DMLOptions();
  dmlOptn.assignmentRuleHeader.useDefaultRule = true;
  lead.setOptions(dmlOptn);
  Database.upsert(lead);
  return lead;
}</code></pre></div></section></section></section><section><h2 id="1538875026#m-todos-privados" data-toc="m-todos-privados#LeadBuilderFoundation.md-m-todos-privados">M&eacute;todos Privados</h2><section><h3 id="1538875026#insertleadwithassignmentrules-lead-lead" data-toc="insertleadwithassignmentrules-lead-lead#LeadBuilderFoundation.md-insertleadwithassignmentrules-lead-lead">insertLeadWithAssignmentRules(Lead lead)</h3><section><h4 id="1538875026#descripci-n" data-toc="descripci-n#LeadBuilderFoundation.md-descripci-n">Descripci&oacute;n</h4><p id="1538875026#pum1ik_252">M&eacute;todo auxiliar privado que inserta un Lead utilizando reglas de asignaci&oacute;n predeterminadas.</p></section><section><h4 id="1538875026#par-metros" data-toc="par-metros#LeadBuilderFoundation.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1538875026#pum1ik_253" start="1"><li class="list-item" id="1538875026#pum1ik_254"><p><span class="inline-code" id="1538875026#pum1ik_255">lead</span> (Lead): El objeto Lead a insertar.</p></li></ul></section><section><h4 id="1538875026#retorno" data-toc="retorno#LeadBuilderFoundation.md-retorno">Retorno</h4><ul class="list" id="1538875026#pum1ik_256" start="1"><li class="list-item" id="1538875026#pum1ik_257"><p><span class="inline-code" id="1538875026#pum1ik_258">Lead</span>: El objeto Lead insertado.</p></li></ul></section><section><h4 id="1538875026#proceso" data-toc="proceso#LeadBuilderFoundation.md-proceso">Proceso</h4><ol class="list list-decimal" id="1538875026#pum1ik_259" type="1" start="1"><li class="list-item" id="1538875026#pum1ik_260"><p>Configura las opciones DML para utilizar la regla de asignaci&oacute;n predeterminada.</p></li><li class="list-item" id="1538875026#pum1ik_261"><p>Establece estas opciones en el objeto Lead.</p></li><li class="list-item" id="1538875026#pum1ik_262"><p>Realiza un upsert del Lead en la base de datos.</p></li><li class="list-item" id="1538875026#pum1ik_263"><p>Devuelve el objeto Lead insertado.</p></li></ol></section><section><h4 id="1538875026#c-digo" data-toc="c-digo#LeadBuilderFoundation.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1538875026#pum1ik_264"><pre><code class="language-none">private static Lead insertLeadWithAssignmentRules(Lead lead) {
  Database.DMLOptions dmlOptn = new Database.DMLOptions();
  dmlOptn.assignmentRuleHeader.useDefaultRule = true;
  lead.setOptions(dmlOptn);
  Database.upsert(lead);
  return lead;
}</code></pre></div></section></section></section><section><h2 id="1538875026#dependencias" data-toc="dependencias#LeadBuilderFoundation.md-dependencias">Dependencias</h2><ul class="list" id="1538875026#pum1ik_265" start="1"><li class="list-item" id="1538875026#pum1ik_266"><p><span class="inline-code" id="1538875026#pum1ik_269">Lead</span>: Objeto est&aacute;ndar de Salesforce para almacenar prospectos.</p></li><li class="list-item" id="1538875026#pum1ik_267"><p><span class="inline-code" id="1538875026#pum1ik_270">LeadConfigurator</span>: Interfaz o clase que define el m&eacute;todo <span class="inline-code" id="1538875026#pum1ik_271">configure(Lead)</span> para personalizar Leads.</p></li><li class="list-item" id="1538875026#pum1ik_268"><p><span class="inline-code" id="1538875026#pum1ik_272">Database.DMLOptions</span>: Clase de Salesforce para configurar opciones de operaciones DML.</p></li></ul></section><section><h2 id="1538875026#patr-n-de-dise-o-implementado" data-toc="patr-n-de-dise-o-implementado#LeadBuilderFoundation.md-patr-n-de-dise-o-implementado">Patr&oacute;n de Dise&ntilde;o Implementado</h2><section><h3 id="1538875026#builder" data-toc="builder#LeadBuilderFoundation.md-builder">Builder</h3><p id="1538875026#pum1ik_274">La clase implementa el patr&oacute;n de dise&ntilde;o Builder, que permite construir objetos complejos paso a paso. Las principales caracter&iacute;sticas de este patr&oacute;n en la implementaci&oacute;n son:</p><ol class="list list-decimal" id="1538875026#pum1ik_275" type="1" start="1"><li class="list-item" id="1538875026#pum1ik_276"><p><span class="control" id="1538875026#pum1ik_280">M&eacute;todos de configuraci&oacute;n fluida</span>: Todos los m&eacute;todos <span class="inline-code" id="1538875026#pum1ik_281">set*</span> devuelven la instancia del builder, permitiendo el encadenamiento de m&eacute;todos.</p></li><li class="list-item" id="1538875026#pum1ik_277"><p><span class="control" id="1538875026#pum1ik_282">Separaci&oacute;n de construcci&oacute;n y representaci&oacute;n</span>: El proceso de construcci&oacute;n est&aacute; separado de la representaci&oacute;n final del objeto Lead.</p></li><li class="list-item" id="1538875026#pum1ik_278"><p><span class="control" id="1538875026#pum1ik_283">Proceso paso a paso</span>: El objeto Lead se construye gradualmente a&ntilde;adiendo propiedades espec&iacute;ficas.</p></li><li class="list-item" id="1538875026#pum1ik_279"><p><span class="control" id="1538875026#pum1ik_284">Configuraci&oacute;n extensible</span>: El m&eacute;todo <span class="inline-code" id="1538875026#pum1ik_285">addConfigurators</span> permite a&ntilde;adir comportamientos personalizados a trav&eacute;s de implementaciones de <span class="inline-code" id="1538875026#pum1ik_286">LeadConfigurator</span>.</p></li></ol></section></section><section><h2 id="1538875026#ejemplo-de-uso" data-toc="ejemplo-de-uso#LeadBuilderFoundation.md-ejemplo-de-uso">Ejemplo de Uso</h2><section><h3 id="1538875026#uso-b-sico" data-toc="uso-b-sico#LeadBuilderFoundation.md-uso-b-sico">Uso B&aacute;sico</h3><div class="detached code-block" id="1538875026#pum1ik_290"><pre><code class="language-none">// Crear un Lead con el Builder
Lead newLead = new LeadBuilderFoundation()
    .setFirstName('John')
    .setLastName('Doe')
    .setEmail('john.doe@example.com')
    .setPhone('555-1234')
    .setMobile('555-5678')
    .setStatus('Open')
    .build();

// Insertar el Lead creado usando el servicio estático
Lead insertedLead = LeadBuilderFoundation.createLead(newLead);</code></pre></div></section><section><h3 id="1538875026#uso-con-configuradores-personalizados" data-toc="uso-con-configuradores-personalizados#LeadBuilderFoundation.md-uso-con-configuradores-personalizados">Uso con Configuradores Personalizados</h3><div class="detached code-block" id="1538875026#pum1ik_291"><pre><code class="language-none">// Definir un configurador personalizado
public class CompanyNameConfigurator implements LeadConfigurator {
    private String companyName;
    
    public CompanyNameConfigurator(String companyName) {
        this.companyName = companyName;
    }
    
    public void configure(Lead lead) {
        lead.Company = this.companyName;
    }
}

// Definir otro configurador
public class LeadSourceConfigurator implements LeadConfigurator {
    private String source;
    
    public LeadSourceConfigurator(String source) {
        this.source = source;
    }
    
    public void configure(Lead lead) {
        lead.LeadSource = this.source;
    }
}

// Crear y usar una lista de configuradores
List&lt;LeadConfigurator&gt; configurators = new List&lt;LeadConfigurator&gt;{
    new CompanyNameConfigurator('ACME Inc.'),
    new LeadSourceConfigurator('Web')
};

// Crear y insertar un Lead con configuradores personalizados
Lead lead = new LeadBuilderFoundation()
    .setFirstName('Jane')
    .setLastName('Smith')
    .setEmail('jane.smith@example.com')
    .addConfigurators(configurators)
    .buildAndInsert();</code></pre></div></section><section><h3 id="1538875026#uso-con-id-existente-actualizaci-n" data-toc="uso-con-id-existente-actualizaci-n#LeadBuilderFoundation.md-uso-con-id-existente-actualizaci-n">Uso con ID Existente (Actualizaci&oacute;n)</h3><div class="detached code-block" id="1538875026#pum1ik_292"><pre><code class="language-none">// Actualizar un Lead existente
Id existingLeadId = '00Q0x000000XXXXX';
Lead updatedLead = new LeadBuilderFoundation()
    .setId(existingLeadId)
    .setStatus('Qualified')
    .build();

// Realizar upsert del Lead
Lead result = LeadBuilderFoundation.upsertLead(updatedLead);</code></pre></div></section></section><section><h2 id="1538875026#notas-adicionales" data-toc="notas-adicionales#LeadBuilderFoundation.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="1538875026#pum1ik_293" type="1" start="1"><li class="list-item" id="1538875026#pum1ik_294"><p>La clase utiliza el m&eacute;todo <span class="inline-code" id="1538875026#pum1ik_300">upsert</span> para permitir tanto la inserci&oacute;n como la actualizaci&oacute;n de registros de Lead, dependiendo de si se proporciona un Id.</p></li><li class="list-item" id="1538875026#pum1ik_295"><p>Los configuradores personalizados (<span class="inline-code" id="1538875026#pum1ik_301">LeadConfigurator</span>) permiten extender la funcionalidad del builder sin modificar su c&oacute;digo base.</p></li><li class="list-item" id="1538875026#pum1ik_296"><p>El uso de reglas de asignaci&oacute;n asegura que los Leads se asignen correctamente seg&uacute;n las reglas configuradas en Salesforce.</p></li><li class="list-item" id="1538875026#pum1ik_297"><p>El patr&oacute;n builder implementado mejora la legibilidad del c&oacute;digo y simplifica la creaci&oacute;n de objetos Lead con m&uacute;ltiples atributos.</p></li><li class="list-item" id="1538875026#pum1ik_298"><p>La clase est&aacute; marcada como <span class="inline-code" id="1538875026#pum1ik_302">global</span>, lo que permite su uso en paquetes gestionados y su acceso desde otros namespaces.</p></li><li class="list-item" id="1538875026#pum1ik_299"><p>Hay una duplicaci&oacute;n de c&oacute;digo entre <span class="inline-code" id="1538875026#pum1ik_303">insertLeadWithAssignmentRules</span> y <span class="inline-code" id="1538875026#pum1ik_304">upsertLead</span> que podr&iacute;a refactorizarse para mejorar la mantenibilidad.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1183693549">LeadUtils</h1><p id="1183693549#-exjw81_3">Esta clase proporciona utilidades para la gesti&oacute;n y manipulaci&oacute;n de objetos Lead, facilitando la b&uacute;squeda, recuperaci&oacute;n y conversi&oacute;n de datos relacionados con leads.</p><section><h2 id="1183693549#informaci-n-general" data-toc="informaci-n-general#Lead Utils.md-informaci-n-general">📋 Informaci&oacute;n General</h2><div class="table-wrapper detached"><table id="1183693549#-exjw81_10"><tr class="header-row" id="1183693549#-exjw81_11"><th id="1183693549#-exjw81_17"><p>Atributo</p></th><th id="1183693549#-exjw81_18"><p>Valor</p></th></tr><tr class="" id="1183693549#-exjw81_12"><td id="1183693549#-exjw81_19"><p><span class="control" id="1183693549#-exjw81_21">Nombre API</span></p></td><td id="1183693549#-exjw81_20"><p><span class="inline-code" id="1183693549#-exjw81_22">LeadUtils</span></p></td></tr><tr class="" id="1183693549#-exjw81_13"><td id="1183693549#-exjw81_23"><p><span class="control" id="1183693549#-exjw81_25">Contexto</span></p></td><td id="1183693549#-exjw81_24"><p><span class="inline-code" id="1183693549#-exjw81_26">global virtual</span></p></td></tr><tr class="" id="1183693549#-exjw81_14"><td id="1183693549#-exjw81_27"><p><span class="control" id="1183693549#-exjw81_29">Grupo</span></p></td><td id="1183693549#-exjw81_28"><p><span class="inline-code" id="1183693549#-exjw81_30">utils</span></p></td></tr><tr class="" id="1183693549#-exjw81_15"><td id="1183693549#-exjw81_31"><p><span class="control" id="1183693549#-exjw81_33">Desarrollador original</span></p></td><td id="1183693549#-exjw81_32"><p>Jean Carlos Melendez</p></td></tr><tr class="" id="1183693549#-exjw81_16"><td id="1183693549#-exjw81_34"><p><span class="control" id="1183693549#-exjw81_36">&Uacute;ltima modificaci&oacute;n</span></p></td><td id="1183693549#-exjw81_35"><p>30-01-2025 (Jean Carlos Melendez)</p></td></tr></table></div></section><section><h2 id="1183693549#principales-caracter-sticas" data-toc="principales-caracter-sticas#Lead Utils.md-principales-caracter-sticas">🧩 Principales caracter&iacute;sticas</h2><p id="1183693549#-exjw81_37">Esta clase proporciona m&eacute;todos utilitarios para:</p><ul class="list" id="1183693549#-exjw81_38" start="1"><li class="list-item" id="1183693549#-exjw81_39"><p>B&uacute;squeda de leads por criterios espec&iacute;ficos (email y tel&eacute;fono m&oacute;vil)</p></li><li class="list-item" id="1183693549#-exjw81_40"><p>Recuperaci&oacute;n de leads por ID</p></li><li class="list-item" id="1183693549#-exjw81_41"><p>Conversi&oacute;n de leads a cuentas para partes aseguradas</p></li></ul></section><section><h2 id="1183693549#m-todos-principales" data-toc="m-todos-principales#Lead Utils.md-m-todos-principales">🔄 M&eacute;todos principales</h2><section><h3 id="1183693549#searchleadidbyemailandmobilephone-string-email-string-mobilephone" data-toc="searchleadidbyemailandmobilephone-string-email-string-mobilephone#Lead Utils.md-searchleadidbyemailandmobilephone-string-email-string-mobilephone">🔍 searchLeadIdByEmailAndMobilePhone(String email, String mobilePhone)</h3><div class="detached code-block" id="1183693549#-exjw81_45"><pre><code class="language-none">global static Id searchLeadIdByEmailAndMobilePhone(String email, String mobilePhone)</code></pre></div><ul class="list" id="1183693549#-exjw81_46" start="1"><li class="list-item" id="1183693549#-exjw81_47"><p><span class="control" id="1183693549#-exjw81_51">Descripci&oacute;n</span>: Busca un lead por su correo electr&oacute;nico y n&uacute;mero de tel&eacute;fono m&oacute;vil.</p></li><li class="list-item" id="1183693549#-exjw81_48"><p><span class="control" id="1183693549#-exjw81_52">Par&aacute;metros</span>: </p><ul class="list" id="1183693549#-exjw81_53" start="1"><li class="list-item" id="1183693549#-exjw81_54"><p><span class="inline-code" id="1183693549#-exjw81_56">email</span> (String): Correo electr&oacute;nico del lead.</p></li><li class="list-item" id="1183693549#-exjw81_55"><p><span class="inline-code" id="1183693549#-exjw81_57">mobilePhone</span> (String): N&uacute;mero de tel&eacute;fono m&oacute;vil del lead.</p></li></ul></li><li class="list-item" id="1183693549#-exjw81_49"><p><span class="control" id="1183693549#-exjw81_58">Retorna</span>: </p><ul class="list" id="1183693549#-exjw81_59" start="1"><li class="list-item" id="1183693549#-exjw81_60"><p><span class="inline-code" id="1183693549#-exjw81_61">Id</span>: ID del lead encontrado, o null si no se encuentra ning&uacute;n lead.</p></li></ul></li><li class="list-item" id="1183693549#-exjw81_50"><p><span class="control" id="1183693549#-exjw81_62">Comportamiento</span>: </p><ol class="list list-decimal" id="1183693549#-exjw81_63" type="1" start="1"><li class="list-item" id="1183693549#-exjw81_64"><p>Realiza una consulta SOQL para buscar leads que coincidan con el correo electr&oacute;nico y tel&eacute;fono m&oacute;vil proporcionados.</p></li><li class="list-item" id="1183693549#-exjw81_65"><p>Si encuentra al menos un lead, devuelve el ID del primer lead encontrado.</p></li><li class="list-item" id="1183693549#-exjw81_66"><p>Si no encuentra ning&uacute;n lead, devuelve null.</p></li><li class="list-item" id="1183693549#-exjw81_67"><p>Registra en el log de depuraci&oacute;n el ID del lead encontrado.</p></li></ol></li></ul></section><section><h3 id="1183693549#getleadbyid-id-leadid" data-toc="getleadbyid-id-leadid#Lead Utils.md-getleadbyid-id-leadid">📄 getLeadById(Id leadId)</h3><div class="detached code-block" id="1183693549#-exjw81_68"><pre><code class="language-none">global static Lead getLeadById(Id leadId)</code></pre></div><ul class="list" id="1183693549#-exjw81_69" start="1"><li class="list-item" id="1183693549#-exjw81_70"><p><span class="control" id="1183693549#-exjw81_74">Descripci&oacute;n</span>: Recupera un objeto Lead por su ID.</p></li><li class="list-item" id="1183693549#-exjw81_71"><p><span class="control" id="1183693549#-exjw81_75">Par&aacute;metros</span>: </p><ul class="list" id="1183693549#-exjw81_76" start="1"><li class="list-item" id="1183693549#-exjw81_77"><p><span class="inline-code" id="1183693549#-exjw81_78">leadId</span> (Id): ID del lead a recuperar.</p></li></ul></li><li class="list-item" id="1183693549#-exjw81_72"><p><span class="control" id="1183693549#-exjw81_79">Retorna</span>: </p><ul class="list" id="1183693549#-exjw81_80" start="1"><li class="list-item" id="1183693549#-exjw81_81"><p><span class="inline-code" id="1183693549#-exjw81_82">Lead</span>: Objeto Lead correspondiente al ID proporcionado.</p></li></ul></li><li class="list-item" id="1183693549#-exjw81_73"><p><span class="control" id="1183693549#-exjw81_83">Comportamiento</span>: </p><ol class="list list-decimal" id="1183693549#-exjw81_84" type="1" start="1"><li class="list-item" id="1183693549#-exjw81_85"><p>Realiza una consulta SOQL para buscar el lead con el ID proporcionado.</p></li><li class="list-item" id="1183693549#-exjw81_86"><p>Devuelve el objeto Lead encontrado.</p></li><li class="list-item" id="1183693549#-exjw81_87"><p>La consulta est&aacute; limitada a 1 registro para optimizar el rendimiento.</p></li></ol></li></ul></section><section><h3 id="1183693549#convertinsuredpartyfromleadtoaccount-map-string-object-input" data-toc="convertinsuredpartyfromleadtoaccount-map-string-object-input#Lead Utils.md-convertinsuredpartyfromleadtoaccount-map-string-object-input">🔄 convertInsuredPartyFromLeadToAccount(Map&lt;String, Object&gt; input)</h3><div class="detached code-block" id="1183693549#-exjw81_88"><pre><code class="language-none">global virtual List&lt;Map&lt;String, Object&gt;&gt; convertInsuredPartyFromLeadToAccount(Map&lt;String, Object&gt; input)</code></pre></div><ul class="list" id="1183693549#-exjw81_89" start="1"><li class="list-item" id="1183693549#-exjw81_90"><p><span class="control" id="1183693549#-exjw81_95">Descripci&oacute;n</span>: Convierte un lead en una estructura de datos para una parte asegurada (cuenta).</p></li><li class="list-item" id="1183693549#-exjw81_91"><p><span class="control" id="1183693549#-exjw81_96">Par&aacute;metros</span>: </p><ul class="list" id="1183693549#-exjw81_97" start="1"><li class="list-item" id="1183693549#-exjw81_98"><p><span class="inline-code" id="1183693549#-exjw81_99">input</span> (Map&lt;String, Object&gt;): Mapa con los datos de entrada, debe contener una clave 'leadId' con el ID del lead a convertir.</p></li></ul></li><li class="list-item" id="1183693549#-exjw81_92"><p><span class="control" id="1183693549#-exjw81_100">Retorna</span>: </p><ul class="list" id="1183693549#-exjw81_101" start="1"><li class="list-item" id="1183693549#-exjw81_102"><p><span class="inline-code" id="1183693549#-exjw81_103">List&lt;Map&lt;String, Object&gt;&gt;</span>: Lista de mapas con la estructura de datos para las partes aseguradas.</p></li></ul></li><li class="list-item" id="1183693549#-exjw81_93"><p><span class="control" id="1183693549#-exjw81_104">Comportamiento</span>: </p><ol class="list list-decimal" id="1183693549#-exjw81_105" type="1" start="1"><li class="list-item" id="1183693549#-exjw81_106"><p>Extrae el ID del lead del mapa de entrada.</p></li><li class="list-item" id="1183693549#-exjw81_107"><p>Consulta los datos del lead, incluyendo nombre, apellido, correo electr&oacute;nico, tel&eacute;fono m&oacute;vil, ciudad y calle.</p></li><li class="list-item" id="1183693549#-exjw81_108"><p>Crea una estructura de datos para la parte asegurada utilizando el patr&oacute;n Builder (AccountBuilder).</p></li><li class="list-item" id="1183693549#-exjw81_109"><p>Registra en el log de depuraci&oacute;n la estructura de datos creada.</p></li><li class="list-item" id="1183693549#-exjw81_110"><p>Devuelve la lista de partes aseguradas.</p></li></ol></li><li class="list-item" id="1183693549#-exjw81_94"><p><span class="control" id="1183693549#-exjw81_111">Notas</span>: </p><ul class="list" id="1183693549#-exjw81_112" start="1"><li class="list-item" id="1183693549#-exjw81_113"><p>Este m&eacute;todo es virtual, por lo que puede ser sobrescrito en clases que extiendan LeadUtils.</p></li><li class="list-item" id="1183693549#-exjw81_114"><p>Utiliza el patr&oacute;n Builder para la construcci&oacute;n del objeto Account.</p></li></ul></li></ul></section></section><section><h2 id="1183693549#ejemplo-pr-ctico" data-toc="ejemplo-pr-ctico#Lead Utils.md-ejemplo-pr-ctico">📊 Ejemplo pr&aacute;ctico</h2><div class="detached code-block" id="1183693549#-exjw81_115"><pre><code class="language-none">// Búsqueda de un lead por correo electrónico y teléfono
Id leadId = LeadUtils.searchLeadIdByEmailAndMobilePhone('ejemplo@email.com', '5551234567');
if (leadId != null) {
    // Recuperación del lead completo
    Lead leadEncontrado = LeadUtils.getLeadById(leadId);
    
    // Conversión del lead a estructura de asegurado
    Map&lt;String, Object&gt; entrada = new Map&lt;String, Object&gt;{'leadId' =&gt; leadId};
    List&lt;Map&lt;String, Object&gt;&gt; partesAseguradas = new LeadUtils().convertInsuredPartyFromLeadToAccount(entrada);
    
    // Procesar las partes aseguradas
    for (Map&lt;String, Object&gt; parte : partesAseguradas) {
        Account cuentaAsegurado = (Account)parte.get('Asegurado');
        // Hacer algo con la cuenta...
    }
}</code></pre></div></section><section><h2 id="1183693549#dependencias" data-toc="dependencias#Lead Utils.md-dependencias">🔍 Dependencias</h2><ul class="list" id="1183693549#-exjw81_116" start="1"><li class="list-item" id="1183693549#-exjw81_117"><p><span class="control" id="1183693549#-exjw81_119">AccountBuilder</span>: Patr&oacute;n Builder utilizado para construir objetos Account a partir de datos de Lead.</p></li><li class="list-item" id="1183693549#-exjw81_118"><p><span class="control" id="1183693549#-exjw81_120">Objeto Lead</span>: Interact&uacute;a directamente con el objeto est&aacute;ndar Lead de Salesforce.</p></li></ul></section><section><h2 id="1183693549#consideraciones-t-cnicas" data-toc="consideraciones-t-cnicas#Lead Utils.md-consideraciones-t-cnicas">🧪 Consideraciones t&eacute;cnicas</h2><ul class="list" id="1183693549#-exjw81_121" start="1"><li class="list-item" id="1183693549#-exjw81_122"><p>Los m&eacute;todos <span class="inline-code" id="1183693549#-exjw81_126">searchLeadIdByEmailAndMobilePhone</span> y <span class="inline-code" id="1183693549#-exjw81_127">getLeadById</span> son est&aacute;ticos, por lo que pueden ser llamados directamente desde la clase sin necesidad de instanciarla.</p></li><li class="list-item" id="1183693549#-exjw81_123"><p>El m&eacute;todo <span class="inline-code" id="1183693549#-exjw81_128">convertInsuredPartyFromLeadToAccount</span> es virtual y no est&aacute;tico, lo que permite sobrescribirlo en clases que extiendan LeadUtils.</p></li><li class="list-item" id="1183693549#-exjw81_124"><p>Las consultas SOQL est&aacute;n optimizadas con l&iacute;mites para evitar problemas de rendimiento.</p></li><li class="list-item" id="1183693549#-exjw81_125"><p>La clase utiliza el patr&oacute;n Builder para la construcci&oacute;n de objetos Account, lo que facilita la creaci&oacute;n de objetos complejos.</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="170943110">LeadProductHandler</h1><p id="170943110#-6ab0t6_3">Este handler gestiona el procesamiento de leads para diferentes productos, aplicando la l&oacute;gica de negocio espec&iacute;fica y preparando los datos para su procesamiento posterior.</p><section><h2 id="170943110#informaci-n-general" data-toc="informaci-n-general#Lead Handler.md-informaci-n-general">📋 Informaci&oacute;n General</h2><div class="table-wrapper detached"><table id="170943110#-6ab0t6_12"><tr class="header-row" id="170943110#-6ab0t6_13"><th id="170943110#-6ab0t6_20"><p>Atributo</p></th><th id="170943110#-6ab0t6_21"><p>Valor</p></th></tr><tr class="" id="170943110#-6ab0t6_14"><td id="170943110#-6ab0t6_22"><p><span class="control" id="170943110#-6ab0t6_24">Nombre API</span></p></td><td id="170943110#-6ab0t6_23"><p><span class="inline-code" id="170943110#-6ab0t6_25">LeadProductHandler</span></p></td></tr><tr class="" id="170943110#-6ab0t6_15"><td id="170943110#-6ab0t6_26"><p><span class="control" id="170943110#-6ab0t6_28">Extiende</span></p></td><td id="170943110#-6ab0t6_27"><p><span class="inline-code" id="170943110#-6ab0t6_29">ProductHandler</span></p></td></tr><tr class="" id="170943110#-6ab0t6_16"><td id="170943110#-6ab0t6_30"><p><span class="control" id="170943110#-6ab0t6_32">Contexto</span></p></td><td id="170943110#-6ab0t6_31"><p><span class="inline-code" id="170943110#-6ab0t6_33">global virtual</span></p></td></tr><tr class="" id="170943110#-6ab0t6_17"><td id="170943110#-6ab0t6_34"><p><span class="control" id="170943110#-6ab0t6_36">Proceso</span></p></td><td id="170943110#-6ab0t6_35"><p><span class="inline-code" id="170943110#-6ab0t6_37">LEAD</span></p></td></tr><tr class="" id="170943110#-6ab0t6_18"><td id="170943110#-6ab0t6_38"><p><span class="control" id="170943110#-6ab0t6_40">Desarrollador original</span></p></td><td id="170943110#-6ab0t6_39"><p>Soulberto Lorenzo</p></td></tr><tr class="" id="170943110#-6ab0t6_19"><td id="170943110#-6ab0t6_41"><p><span class="control" id="170943110#-6ab0t6_43">&Uacute;ltima modificaci&oacute;n</span></p></td><td id="170943110#-6ab0t6_42"><p>25-04-2025 (Jean Carlos Melendez)</p></td></tr></table></div></section><section><h2 id="170943110#principales-caracter-sticas" data-toc="principales-caracter-sticas#Lead Handler.md-principales-caracter-sticas">🧩 Principales caracter&iacute;sticas</h2><section><h3 id="170943110#constantes" data-toc="constantes#Lead Handler.md-constantes">📦 Constantes</h3><ul class="list" id="170943110#-6ab0t6_45" start="1"><li class="list-item" id="170943110#-6ab0t6_46"><p><span class="control" id="170943110#-6ab0t6_47">PROCESS_NAME</span>: Define el nombre del proceso como &quot;LEAD&quot;.</p></li></ul></section></section><section><h2 id="170943110#m-todos-principales" data-toc="m-todos-principales#Lead Handler.md-m-todos-principales">🔄 M&eacute;todos principales</h2><section><h3 id="170943110#constructor" data-toc="constructor#Lead Handler.md-constructor">👨&zwj;💼 Constructor</h3><div class="detached code-block" id="170943110#-6ab0t6_55"><pre><code class="language-none">global LeadProductHandler(String productName)</code></pre></div><ul class="list" id="170943110#-6ab0t6_56" start="1"><li class="list-item" id="170943110#-6ab0t6_57"><p><span class="control" id="170943110#-6ab0t6_59">Descripci&oacute;n</span>: Inicializa la instancia del handler con el nombre del producto.</p></li><li class="list-item" id="170943110#-6ab0t6_58"><p><span class="control" id="170943110#-6ab0t6_60">Par&aacute;metros</span>: </p><ul class="list" id="170943110#-6ab0t6_61" start="1"><li class="list-item" id="170943110#-6ab0t6_62"><p><span class="inline-code" id="170943110#-6ab0t6_63">productName</span> (String): Nombre del producto asociado al lead.</p></li></ul></li></ul></section><section><h3 id="170943110#setobservers" data-toc="setobservers#Lead Handler.md-setobservers">👁️ setObservers()</h3><div class="detached code-block" id="170943110#-6ab0t6_64"><pre><code class="language-none">public override void setObservers()</code></pre></div><ul class="list" id="170943110#-6ab0t6_65" start="1"><li class="list-item" id="170943110#-6ab0t6_66"><p><span class="control" id="170943110#-6ab0t6_68">Descripci&oacute;n</span>: Configura los observadores para este handler.</p></li><li class="list-item" id="170943110#-6ab0t6_67"><p><span class="control" id="170943110#-6ab0t6_69">Implementaci&oacute;n</span>: A&ntilde;ade un <span class="inline-code" id="170943110#-6ab0t6_70">LeadObserver</span> a la lista de observadores.</p></li></ul></section><section><h3 id="170943110#setprocessname-string-processname" data-toc="setprocessname-string-processname#Lead Handler.md-setprocessname-string-processname">🏷️ setProcessName(String processName)</h3><div class="detached code-block" id="170943110#-6ab0t6_71"><pre><code class="language-none">global virtual override void setProcessName(String processName)</code></pre></div><ul class="list" id="170943110#-6ab0t6_72" start="1"><li class="list-item" id="170943110#-6ab0t6_73"><p><span class="control" id="170943110#-6ab0t6_75">Descripci&oacute;n</span>: Establece el nombre del proceso.</p></li><li class="list-item" id="170943110#-6ab0t6_74"><p><span class="control" id="170943110#-6ab0t6_76">Par&aacute;metros</span>: </p><ul class="list" id="170943110#-6ab0t6_77" start="1"><li class="list-item" id="170943110#-6ab0t6_78"><p><span class="inline-code" id="170943110#-6ab0t6_79">processName</span> (String): Nombre del proceso a establecer.</p></li></ul></li></ul></section><section><h3 id="170943110#setresponseprocess-object-responseprocess" data-toc="setresponseprocess-object-responseprocess#Lead Handler.md-setresponseprocess-object-responseprocess">📤 setResponseProcess(Object responseProcess)</h3><div class="detached code-block" id="170943110#-6ab0t6_80"><pre><code class="language-none">global virtual override void setResponseProcess(Object responseProcess)</code></pre></div><ul class="list" id="170943110#-6ab0t6_81" start="1"><li class="list-item" id="170943110#-6ab0t6_82"><p><span class="control" id="170943110#-6ab0t6_84">Descripci&oacute;n</span>: Establece la respuesta del proceso.</p></li><li class="list-item" id="170943110#-6ab0t6_83"><p><span class="control" id="170943110#-6ab0t6_85">Par&aacute;metros</span>: </p><ul class="list" id="170943110#-6ab0t6_86" start="1"><li class="list-item" id="170943110#-6ab0t6_87"><p><span class="inline-code" id="170943110#-6ab0t6_88">responseProcess</span> (Object): Objeto con la respuesta del proceso.</p></li></ul></li></ul></section><section><h3 id="170943110#setrequestinput-object-requestinput" data-toc="setrequestinput-object-requestinput#Lead Handler.md-setrequestinput-object-requestinput">📥 setRequestInput(Object requestInput)</h3><div class="detached code-block" id="170943110#-6ab0t6_89"><pre><code class="language-none">global virtual override void setRequestInput(Object requestInput)</code></pre></div><ul class="list" id="170943110#-6ab0t6_90" start="1"><li class="list-item" id="170943110#-6ab0t6_91"><p><span class="control" id="170943110#-6ab0t6_93">Descripci&oacute;n</span>: Establece los datos de entrada para el proceso.</p></li><li class="list-item" id="170943110#-6ab0t6_92"><p><span class="control" id="170943110#-6ab0t6_94">Par&aacute;metros</span>: </p><ul class="list" id="170943110#-6ab0t6_95" start="1"><li class="list-item" id="170943110#-6ab0t6_96"><p><span class="inline-code" id="170943110#-6ab0t6_97">requestInput</span> (Object): Objeto con los datos de entrada.</p></li></ul></li></ul></section><section><h3 id="170943110#process-map-string-object-options-map-string-object-input-map-string-object-output" data-toc="process-map-string-object-options-map-string-object-input-map-string-object-output#Lead Handler.md-process-map-string-object-options-map-string-object-input-map-string-object-output">⚙️ process(Map&lt;String, Object&gt; options, Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; output)</h3><div class="detached code-block" id="170943110#-6ab0t6_98"><pre><code class="language-none">public override Map&lt;String, Object&gt; process(
  Map&lt;String, Object&gt; options,
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; output
)</code></pre></div><ul class="list" id="170943110#-6ab0t6_99" start="1"><li class="list-item" id="170943110#-6ab0t6_100"><p><span class="control" id="170943110#-6ab0t6_104">Descripci&oacute;n</span>: M&eacute;todo principal que ejecuta el procesamiento del lead.</p></li><li class="list-item" id="170943110#-6ab0t6_101"><p><span class="control" id="170943110#-6ab0t6_105">Par&aacute;metros</span>: </p><ul class="list" id="170943110#-6ab0t6_106" start="1"><li class="list-item" id="170943110#-6ab0t6_107"><p><span class="inline-code" id="170943110#-6ab0t6_110">options</span> (Map&lt;String, Object&gt;): Opciones de configuraci&oacute;n para el proceso.</p></li><li class="list-item" id="170943110#-6ab0t6_108"><p><span class="inline-code" id="170943110#-6ab0t6_111">input</span> (Map&lt;String, Object&gt;): Datos de entrada para el proceso.</p></li><li class="list-item" id="170943110#-6ab0t6_109"><p><span class="inline-code" id="170943110#-6ab0t6_112">output</span> (Map&lt;String, Object&gt;): Mapa donde se almacena el resultado.</p></li></ul></li><li class="list-item" id="170943110#-6ab0t6_102"><p><span class="control" id="170943110#-6ab0t6_113">Retorna</span>: </p><ul class="list" id="170943110#-6ab0t6_114" start="1"><li class="list-item" id="170943110#-6ab0t6_115"><p>Map&lt;String, Object&gt;: El mapa de salida con el resultado del proceso.</p></li></ul></li><li class="list-item" id="170943110#-6ab0t6_103"><p><span class="control" id="170943110#-6ab0t6_116">Comportamiento</span>: </p><ol class="list list-decimal" id="170943110#-6ab0t6_117" type="1" start="1"><li class="list-item" id="170943110#-6ab0t6_118"><p>Verifica si debe omitirse el comportamiento predeterminado.</p></li><li class="list-item" id="170943110#-6ab0t6_119"><p>Establece el nombre del proceso.</p></li><li class="list-item" id="170943110#-6ab0t6_120"><p>Obtiene los configuradores de lead del mapa de entrada.</p></li><li class="list-item" id="170943110#-6ab0t6_121"><p>Crea un nuevo lead utilizando el patr&oacute;n Builder.</p></li><li class="list-item" id="170943110#-6ab0t6_122"><p>Registra la finalizaci&oacute;n del proceso y guarda el resultado.</p></li><li class="list-item" id="170943110#-6ab0t6_123"><p>Maneja excepciones DML y generales, lanzando excepciones personalizadas.</p></li></ol></li></ul></section><section><h3 id="170943110#isvalidforleadrequirements-map-string-object-data" data-toc="isvalidforleadrequirements-map-string-object-data#Lead Handler.md-isvalidforleadrequirements-map-string-object-data">✅ isValidForLeadRequirements(Map&lt;String, Object&gt; data)</h3><div class="detached code-block" id="170943110#-6ab0t6_124"><pre><code class="language-none">global virtual Boolean isValidForLeadRequirements(Map&lt;String, Object&gt; data)</code></pre></div><ul class="list" id="170943110#-6ab0t6_125" start="1"><li class="list-item" id="170943110#-6ab0t6_126"><p><span class="control" id="170943110#-6ab0t6_130">Descripci&oacute;n</span>: Valida que los datos cumplan con los requisitos de negocio para la creaci&oacute;n de un lead.</p></li><li class="list-item" id="170943110#-6ab0t6_127"><p><span class="control" id="170943110#-6ab0t6_131">Par&aacute;metros</span>: </p><ul class="list" id="170943110#-6ab0t6_132" start="1"><li class="list-item" id="170943110#-6ab0t6_133"><p><span class="inline-code" id="170943110#-6ab0t6_134">data</span> (Map&lt;String, Object&gt;): Datos a validar.</p></li></ul></li><li class="list-item" id="170943110#-6ab0t6_128"><p><span class="control" id="170943110#-6ab0t6_135">Retorna</span>: </p><ul class="list" id="170943110#-6ab0t6_136" start="1"><li class="list-item" id="170943110#-6ab0t6_137"><p>Boolean: <span class="inline-code" id="170943110#-6ab0t6_138">true</span> si los datos son v&aacute;lidos, <span class="inline-code" id="170943110#-6ab0t6_139">false</span> en caso contrario.</p></li></ul></li><li class="list-item" id="170943110#-6ab0t6_129"><p><span class="control" id="170943110#-6ab0t6_140">Notas</span>: Este m&eacute;todo est&aacute; dise&ntilde;ado para ser sobrescrito en implementaciones espec&iacute;ficas.</p></li></ul></section></section><section><h2 id="170943110#flujo-de-ejecuci-n" data-toc="flujo-de-ejecuci-n#Lead Handler.md-flujo-de-ejecuci-n">🔄 Flujo de ejecuci&oacute;n</h2><ol class="list list-decimal" id="170943110#-6ab0t6_141" type="1" start="1"><li class="list-item" id="170943110#-6ab0t6_142"><p>Se instancia el handler con el nombre del producto.</p></li><li class="list-item" id="170943110#-6ab0t6_143"><p>Se configuran los observadores llamando a <span class="inline-code" id="170943110#-6ab0t6_147">setObservers()</span>.</p></li><li class="list-item" id="170943110#-6ab0t6_144"><p>Se invoca el m&eacute;todo <span class="inline-code" id="170943110#-6ab0t6_148">process()</span> con los mapas correspondientes.</p></li><li class="list-item" id="170943110#-6ab0t6_145"><p>Se validan los datos y se crea el lead utilizando el builder.</p></li><li class="list-item" id="170943110#-6ab0t6_146"><p>Se registra el resultado y se devuelve en el mapa de salida.</p></li></ol></section><section><h2 id="170943110#puntos-de-extensi-n" data-toc="puntos-de-extensi-n#Lead Handler.md-puntos-de-extensi-n">🧠 Puntos de extensi&oacute;n</h2><p id="170943110#-6ab0t6_149">Este handler puede ser extendido de las siguientes maneras:</p><ol class="list list-decimal" id="170943110#-6ab0t6_150" type="1" start="1"><li class="list-item" id="170943110#-6ab0t6_151"><p><span class="control" id="170943110#-6ab0t6_154">Sobrescribir el m&eacute;todo <span class="inline-code" id="170943110#-6ab0t6_155">isValidForLeadRequirements()</span></span>: Para implementar validaciones espec&iacute;ficas de negocio.</p></li><li class="list-item" id="170943110#-6ab0t6_152"><p><span class="control" id="170943110#-6ab0t6_156">Crear un handler que extienda <span class="inline-code" id="170943110#-6ab0t6_157">LeadProductHandler</span></span>: Para personalizar comportamientos espec&iacute;ficos por producto.</p></li><li class="list-item" id="170943110#-6ab0t6_153"><p><span class="control" id="170943110#-6ab0t6_158">Agregar configuradores adicionales</span>: Mediante la lista <span class="inline-code" id="170943110#-6ab0t6_159">configurators</span> para modificar la creaci&oacute;n del lead.</p></li></ol></section><section><h2 id="170943110#ejemplo-pr-ctico" data-toc="ejemplo-pr-ctico#Lead Handler.md-ejemplo-pr-ctico">📊 Ejemplo pr&aacute;ctico</h2><div class="detached code-block" id="170943110#-6ab0t6_160"><pre><code class="language-none">// Creación de un handler para leads de producto Viajes
LeadProductHandler viajesHandler = new LeadProductHandler('Viajes');

// Configuración de los datos de entrada
Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
  'lastName' =&gt; 'Pérez',
  'firstName' =&gt; 'Juan',
  'email' =&gt; 'juan.perez@example.com',
  'mobile_phone' =&gt; '3124567890',
  'status' =&gt; '0_Abierto'
};

// Procesamiento del lead
Map&lt;String, Object&gt; output = new Map&lt;String, Object&gt;();
Map&lt;String, Object&gt; options = new Map&lt;String, Object&gt;();
output = viajesHandler.process(options, input, output);

// Obtención del resultado
Lead createdLead = (Lead)output.get('resultProcess');</code></pre></div></section><section><h2 id="170943110#consideraciones-t-cnicas" data-toc="consideraciones-t-cnicas#Lead Handler.md-consideraciones-t-cnicas">🧪 Consideraciones t&eacute;cnicas</h2><ul class="list" id="170943110#-6ab0t6_161" start="1"><li class="list-item" id="170943110#-6ab0t6_162"><p>Utiliza el patr&oacute;n Observer para notificar sobre eventos durante el procesamiento.</p></li><li class="list-item" id="170943110#-6ab0t6_163"><p>Implementa el patr&oacute;n Builder para la construcci&oacute;n del objeto Lead.</p></li><li class="list-item" id="170943110#-6ab0t6_164"><p>Utiliza manejo de excepciones personalizadas para informar errores espec&iacute;ficos.</p></li><li class="list-item" id="170943110#-6ab0t6_165"><p>Los errores se devuelven con un c&oacute;digo HTTP 422 (UNPROCESSABLE_ENTITY).</p></li></ul></section><section><h2 id="170943110#log-y-trazabilidad" data-toc="log-y-trazabilidad#Lead Handler.md-log-y-trazabilidad">🔍 Log y trazabilidad</h2><p id="170943110#-6ab0t6_166">El proceso registra informaci&oacute;n en el objeto <span class="inline-code" id="170943110#-6ab0t6_168">Subconjunto_Registro_de_Evento__c</span> para permitir la trazabilidad completa, incluyendo:</p><ul class="list" id="170943110#-6ab0t6_167" start="1"><li class="list-item" id="170943110#-6ab0t6_169"><p>Datos de entrada</p></li><li class="list-item" id="170943110#-6ab0t6_170"><p>Respuesta del proceso</p></li><li class="list-item" id="170943110#-6ab0t6_171"><p>Detalles de la ejecuci&oacute;n</p></li><li class="list-item" id="170943110#-6ab0t6_172"><p>Usuario responsable</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-760055542">RUNTWrapper</h1><section><h2 id="-760055542#descripci-n-general" data-toc="descripci-n-general#RUNTWrapper.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-760055542#z2d4hys_10"><span class="inline-code" id="-760055542#z2d4hys_11">RUNTWrapper</span> es una clase dise&ntilde;ada para manejar y estructurar los datos provenientes del Registro &Uacute;nico Nacional de Tr&aacute;nsito (RUNT) de Colombia. Esta clase encapsula informaci&oacute;n detallada sobre veh&iacute;culos, sus propietarios y caracter&iacute;sticas t&eacute;cnicas.</p></section><section><h2 id="-760055542#autor" data-toc="autor#RUNTWrapper.md-autor">Autor</h2><ul class="list" id="-760055542#z2d4hys_12" start="1"><li class="list-item" id="-760055542#z2d4hys_13"><p><span class="control" id="-760055542#z2d4hys_16">Autor:</span> felipe.correa@nespon.com</p></li><li class="list-item" id="-760055542#z2d4hys_14"><p><span class="control" id="-760055542#z2d4hys_17">Proyecto:</span> Foundation Salesforce - Suratech - UH-17585</p></li><li class="list-item" id="-760055542#z2d4hys_15"><p><span class="control" id="-760055542#z2d4hys_18">&Uacute;ltima modificaci&oacute;n:</span> 11-06-2024</p></li></ul></section><section><h2 id="-760055542#anotaciones" data-toc="anotaciones#RUNTWrapper.md-anotaciones">Anotaciones</h2><ul class="list" id="-760055542#z2d4hys_19" start="1"><li class="list-item" id="-760055542#z2d4hys_20"><p><span class="inline-code" id="-760055542#z2d4hys_21">@NamespaceAccessible</span>: Permite que la clase sea accesible desde otros namespaces, facilitando su uso en paquetes gestionados o en integraciones.</p></li></ul></section><section><h2 id="-760055542#estructura-de-la-clase" data-toc="estructura-de-la-clase#RUNTWrapper.md-estructura-de-la-clase">Estructura de la Clase</h2><section><h3 id="-760055542#propiedades-principales" data-toc="propiedades-principales#RUNTWrapper.md-propiedades-principales">Propiedades Principales</h3><p id="-760055542#z2d4hys_24">La clase contiene numerosas propiedades que representan los diferentes atributos de un veh&iacute;culo registrado en el RUNT:</p><div class="table-wrapper detached"><table id="-760055542#z2d4hys_25"><tr class="header-row" id="-760055542#z2d4hys_26"><th id="-760055542#z2d4hys_83"><p>Propiedad</p></th><th id="-760055542#z2d4hys_84"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-760055542#z2d4hys_27"><td id="-760055542#z2d4hys_85"><p><span class="inline-code" id="-760055542#z2d4hys_87">codigoResultado</span></p></td><td id="-760055542#z2d4hys_86"><p>C&oacute;digo del resultado de la consulta</p></td></tr><tr class="" id="-760055542#z2d4hys_28"><td id="-760055542#z2d4hys_88"><p><span class="inline-code" id="-760055542#z2d4hys_90">fecha</span></p></td><td id="-760055542#z2d4hys_89"><p>Fecha de la consulta o registro</p></td></tr><tr class="" id="-760055542#z2d4hys_29"><td id="-760055542#z2d4hys_91"><p><span class="inline-code" id="-760055542#z2d4hys_93">idUsuario</span></p></td><td id="-760055542#z2d4hys_92"><p>Identificador del usuario</p></td></tr><tr class="" id="-760055542#z2d4hys_30"><td id="-760055542#z2d4hys_94"><p><span class="inline-code" id="-760055542#z2d4hys_96">noRegistro</span></p></td><td id="-760055542#z2d4hys_95"><p>N&uacute;mero de registro</p></td></tr><tr class="" id="-760055542#z2d4hys_31"><td id="-760055542#z2d4hys_97"><p><span class="inline-code" id="-760055542#z2d4hys_99">noLicenciaTransito</span></p></td><td id="-760055542#z2d4hys_98"><p>N&uacute;mero de licencia de tr&aacute;nsito</p></td></tr><tr class="" id="-760055542#z2d4hys_32"><td id="-760055542#z2d4hys_100"><p><span class="inline-code" id="-760055542#z2d4hys_102">fechaExpedicionLicTransito</span></p></td><td id="-760055542#z2d4hys_101"><p>Fecha de expedici&oacute;n de la licencia de tr&aacute;nsito</p></td></tr><tr class="" id="-760055542#z2d4hys_33"><td id="-760055542#z2d4hys_103"><p><span class="inline-code" id="-760055542#z2d4hys_105">estadoDelVehiculo</span></p></td><td id="-760055542#z2d4hys_104"><p>Estado actual del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_34"><td id="-760055542#z2d4hys_106"><p><span class="inline-code" id="-760055542#z2d4hys_108">idTipoServicio</span></p></td><td id="-760055542#z2d4hys_107"><p>ID del tipo de servicio del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_35"><td id="-760055542#z2d4hys_109"><p><span class="inline-code" id="-760055542#z2d4hys_111">tipoServicio</span></p></td><td id="-760055542#z2d4hys_110"><p>Descripci&oacute;n del tipo de servicio</p></td></tr><tr class="" id="-760055542#z2d4hys_36"><td id="-760055542#z2d4hys_112"><p><span class="inline-code" id="-760055542#z2d4hys_114">idClaseVehiculo</span></p></td><td id="-760055542#z2d4hys_113"><p>ID de la clase del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_37"><td id="-760055542#z2d4hys_115"><p><span class="inline-code" id="-760055542#z2d4hys_117">claseVehiculo</span></p></td><td id="-760055542#z2d4hys_116"><p>Descripci&oacute;n de la clase del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_38"><td id="-760055542#z2d4hys_118"><p><span class="inline-code" id="-760055542#z2d4hys_120">idMarca</span></p></td><td id="-760055542#z2d4hys_119"><p>ID de la marca del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_39"><td id="-760055542#z2d4hys_121"><p><span class="inline-code" id="-760055542#z2d4hys_123">marca</span></p></td><td id="-760055542#z2d4hys_122"><p>Nombre de la marca del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_40"><td id="-760055542#z2d4hys_124"><p><span class="inline-code" id="-760055542#z2d4hys_126">idLinea</span></p></td><td id="-760055542#z2d4hys_125"><p>ID de la l&iacute;nea del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_41"><td id="-760055542#z2d4hys_127"><p><span class="inline-code" id="-760055542#z2d4hys_129">linea</span></p></td><td id="-760055542#z2d4hys_128"><p>Descripci&oacute;n de la l&iacute;nea del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_42"><td id="-760055542#z2d4hys_130"><p><span class="inline-code" id="-760055542#z2d4hys_132">modelo</span></p></td><td id="-760055542#z2d4hys_131"><p>A&ntilde;o modelo del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_43"><td id="-760055542#z2d4hys_133"><p><span class="inline-code" id="-760055542#z2d4hys_135">idColor</span></p></td><td id="-760055542#z2d4hys_134"><p>ID del color del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_44"><td id="-760055542#z2d4hys_136"><p><span class="inline-code" id="-760055542#z2d4hys_138">color</span></p></td><td id="-760055542#z2d4hys_137"><p>Descripci&oacute;n del color del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_45"><td id="-760055542#z2d4hys_139"><p><span class="inline-code" id="-760055542#z2d4hys_141">noMotor</span></p></td><td id="-760055542#z2d4hys_140"><p>N&uacute;mero de motor</p></td></tr><tr class="" id="-760055542#z2d4hys_46"><td id="-760055542#z2d4hys_142"><p><span class="inline-code" id="-760055542#z2d4hys_144">noChasis</span></p></td><td id="-760055542#z2d4hys_143"><p>N&uacute;mero de chasis</p></td></tr><tr class="" id="-760055542#z2d4hys_47"><td id="-760055542#z2d4hys_145"><p><span class="inline-code" id="-760055542#z2d4hys_147">noVin</span></p></td><td id="-760055542#z2d4hys_146"><p>N&uacute;mero VIN (Vehicle Identification Number)</p></td></tr><tr class="" id="-760055542#z2d4hys_48"><td id="-760055542#z2d4hys_148"><p><span class="inline-code" id="-760055542#z2d4hys_150">cilindraje</span></p></td><td id="-760055542#z2d4hys_149"><p>Cilindraje del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_49"><td id="-760055542#z2d4hys_151"><p><span class="inline-code" id="-760055542#z2d4hys_153">divipola</span></p></td><td id="-760055542#z2d4hys_152"><p>C&oacute;digo de Divisi&oacute;n Pol&iacute;tico-Administrativa</p></td></tr><tr class="" id="-760055542#z2d4hys_50"><td id="-760055542#z2d4hys_154"><p><span class="inline-code" id="-760055542#z2d4hys_156">idTipoCarroceria</span></p></td><td id="-760055542#z2d4hys_155"><p>ID del tipo de carrocer&iacute;a</p></td></tr><tr class="" id="-760055542#z2d4hys_51"><td id="-760055542#z2d4hys_157"><p><span class="inline-code" id="-760055542#z2d4hys_159">tipoCarroceria</span></p></td><td id="-760055542#z2d4hys_158"><p>Descripci&oacute;n del tipo de carrocer&iacute;a</p></td></tr><tr class="" id="-760055542#z2d4hys_52"><td id="-760055542#z2d4hys_160"><p><span class="inline-code" id="-760055542#z2d4hys_162">fechaMatricula</span></p></td><td id="-760055542#z2d4hys_161"><p>Fecha de matr&iacute;cula del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_53"><td id="-760055542#z2d4hys_163"><p><span class="inline-code" id="-760055542#z2d4hys_165">tieneGravamenes</span></p></td><td id="-760055542#z2d4hys_164"><p>Indica si el veh&iacute;culo tiene grav&aacute;menes</p></td></tr><tr class="" id="-760055542#z2d4hys_54"><td id="-760055542#z2d4hys_166"><p><span class="inline-code" id="-760055542#z2d4hys_168">organismoTransito</span></p></td><td id="-760055542#z2d4hys_167"><p>Organismo de tr&aacute;nsito donde est&aacute; registrado</p></td></tr><tr class="" id="-760055542#z2d4hys_55"><td id="-760055542#z2d4hys_169"><p><span class="inline-code" id="-760055542#z2d4hys_171">prendas</span></p></td><td id="-760055542#z2d4hys_170"><p>Informaci&oacute;n sobre prendas asociadas al veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_56"><td id="-760055542#z2d4hys_172"><p><span class="inline-code" id="-760055542#z2d4hys_174">prendario</span></p></td><td id="-760055542#z2d4hys_173"><p>Informaci&oacute;n adicional sobre estado prendario</p></td></tr><tr class="" id="-760055542#z2d4hys_57"><td id="-760055542#z2d4hys_175"><p><span class="inline-code" id="-760055542#z2d4hys_177">clasificacion</span></p></td><td id="-760055542#z2d4hys_176"><p>Clasificaci&oacute;n del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_58"><td id="-760055542#z2d4hys_178"><p><span class="inline-code" id="-760055542#z2d4hys_180">esRegrabadoMotor</span></p></td><td id="-760055542#z2d4hys_179"><p>Indica si el motor ha sido regrabado</p></td></tr><tr class="" id="-760055542#z2d4hys_59"><td id="-760055542#z2d4hys_181"><p><span class="inline-code" id="-760055542#z2d4hys_183">esRegrabadoChasis</span></p></td><td id="-760055542#z2d4hys_182"><p>Indica si el chasis ha sido regrabado</p></td></tr><tr class="" id="-760055542#z2d4hys_60"><td id="-760055542#z2d4hys_184"><p><span class="inline-code" id="-760055542#z2d4hys_186">esRegrabadoSerie</span></p></td><td id="-760055542#z2d4hys_185"><p>Indica si la serie ha sido regrabada</p></td></tr><tr class="" id="-760055542#z2d4hys_61"><td id="-760055542#z2d4hys_187"><p><span class="inline-code" id="-760055542#z2d4hys_189">esRegrabadoVin</span></p></td><td id="-760055542#z2d4hys_188"><p>Indica si el VIN ha sido regrabado</p></td></tr><tr class="" id="-760055542#z2d4hys_62"><td id="-760055542#z2d4hys_190"><p><span class="inline-code" id="-760055542#z2d4hys_192">tipoServicioNombre</span></p></td><td id="-760055542#z2d4hys_191"><p>Nombre del tipo de servicio</p></td></tr><tr class="" id="-760055542#z2d4hys_63"><td id="-760055542#z2d4hys_193"><p><span class="inline-code" id="-760055542#z2d4hys_195">nroMotor</span></p></td><td id="-760055542#z2d4hys_194"><p>N&uacute;mero de motor (duplicado de <span class="inline-code" id="-760055542#z2d4hys_196">noMotor</span>)</p></td></tr><tr class="" id="-760055542#z2d4hys_64"><td id="-760055542#z2d4hys_197"><p><span class="inline-code" id="-760055542#z2d4hys_199">capacidadCarga</span></p></td><td id="-760055542#z2d4hys_198"><p>Capacidad de carga del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_65"><td id="-760055542#z2d4hys_200"><p><span class="inline-code" id="-760055542#z2d4hys_202">pesoBrutoVehicular</span></p></td><td id="-760055542#z2d4hys_201"><p>Peso bruto vehicular</p></td></tr><tr class="" id="-760055542#z2d4hys_66"><td id="-760055542#z2d4hys_203"><p><span class="inline-code" id="-760055542#z2d4hys_205">noEjes</span></p></td><td id="-760055542#z2d4hys_204"><p>N&uacute;mero de ejes del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_67"><td id="-760055542#z2d4hys_206"><p><span class="inline-code" id="-760055542#z2d4hys_208">noPlaca</span></p></td><td id="-760055542#z2d4hys_207"><p>N&uacute;mero de placa del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_68"><td id="-760055542#z2d4hys_209"><p><span class="inline-code" id="-760055542#z2d4hys_211">repotenciado</span></p></td><td id="-760055542#z2d4hys_210"><p>Indica si el veh&iacute;culo ha sido repotenciado</p></td></tr><tr class="" id="-760055542#z2d4hys_69"><td id="-760055542#z2d4hys_212"><p><span class="inline-code" id="-760055542#z2d4hys_214">diasMatriculado</span></p></td><td id="-760055542#z2d4hys_213"><p>D&iacute;as transcurridos desde la matr&iacute;cula</p></td></tr><tr class="" id="-760055542#z2d4hys_70"><td id="-760055542#z2d4hys_215"><p><span class="inline-code" id="-760055542#z2d4hys_217">idPaisOrigen</span></p></td><td id="-760055542#z2d4hys_216"><p>ID del pa&iacute;s de origen del veh&iacute;culo</p></td></tr><tr class="" id="-760055542#z2d4hys_71"><td id="-760055542#z2d4hys_218"><p><span class="inline-code" id="-760055542#z2d4hys_220">paisOrigen</span></p></td><td id="-760055542#z2d4hys_219"><p>Nombre del pa&iacute;s de origen</p></td></tr><tr class="" id="-760055542#z2d4hys_72"><td id="-760055542#z2d4hys_221"><p><span class="inline-code" id="-760055542#z2d4hys_223">capacidadPasajerosSentados</span></p></td><td id="-760055542#z2d4hys_222"><p>Capacidad de pasajeros sentados</p></td></tr><tr class="" id="-760055542#z2d4hys_73"><td id="-760055542#z2d4hys_224"><p><span class="inline-code" id="-760055542#z2d4hys_226">idTipoImportacion</span></p></td><td id="-760055542#z2d4hys_225"><p>ID del tipo de importaci&oacute;n</p></td></tr><tr class="" id="-760055542#z2d4hys_74"><td id="-760055542#z2d4hys_227"><p><span class="inline-code" id="-760055542#z2d4hys_229">tipoImportacion</span></p></td><td id="-760055542#z2d4hys_228"><p>Descripci&oacute;n del tipo de importaci&oacute;n</p></td></tr><tr class="" id="-760055542#z2d4hys_75"><td id="-760055542#z2d4hys_230"><p><span class="inline-code" id="-760055542#z2d4hys_232">idTipoCombustible</span></p></td><td id="-760055542#z2d4hys_231"><p>ID del tipo de combustible</p></td></tr><tr class="" id="-760055542#z2d4hys_76"><td id="-760055542#z2d4hys_233"><p><span class="inline-code" id="-760055542#z2d4hys_235">tipoCombustible</span></p></td><td id="-760055542#z2d4hys_234"><p>Descripci&oacute;n del tipo de combustible</p></td></tr><tr class="" id="-760055542#z2d4hys_77"><td id="-760055542#z2d4hys_236"><p><span class="inline-code" id="-760055542#z2d4hys_238">nombreAcreedor</span></p></td><td id="-760055542#z2d4hys_237"><p>Nombre del acreedor en caso de prenda</p></td></tr><tr class="" id="-760055542#z2d4hys_78"><td id="-760055542#z2d4hys_239"><p><span class="inline-code" id="-760055542#z2d4hys_241">datosTecnicos</span></p></td><td id="-760055542#z2d4hys_240"><p>Objeto que contiene datos t&eacute;cnicos adicionales</p></td></tr><tr class="" id="-760055542#z2d4hys_79"><td id="-760055542#z2d4hys_242"><p><span class="inline-code" id="-760055542#z2d4hys_244">normalizacion</span></p></td><td id="-760055542#z2d4hys_243"><p>Objeto con informaci&oacute;n de normalizaci&oacute;n</p></td></tr><tr class="" id="-760055542#z2d4hys_80"><td id="-760055542#z2d4hys_245"><p><span class="inline-code" id="-760055542#z2d4hys_247">propietarios</span></p></td><td id="-760055542#z2d4hys_246"><p>Lista de propietarios generales</p></td></tr><tr class="" id="-760055542#z2d4hys_81"><td id="-760055542#z2d4hys_248"><p><span class="inline-code" id="-760055542#z2d4hys_250">propietariosActuales</span></p></td><td id="-760055542#z2d4hys_249"><p>Lista de propietarios actuales con informaci&oacute;n detallada</p></td></tr><tr class="" id="-760055542#z2d4hys_82"><td id="-760055542#z2d4hys_251"><p><span class="inline-code" id="-760055542#z2d4hys_253">codigoUUID</span></p></td><td id="-760055542#z2d4hys_252"><p>C&oacute;digo UUID de la consulta</p></td></tr></table></div></section><section><h3 id="-760055542#clases-internas" data-toc="clases-internas#RUNTWrapper.md-clases-internas">Clases Internas</h3><section><h4 id="-760055542#datostecnicos" data-toc="datostecnicos#RUNTWrapper.md-datostecnicos">DatosTecnicos</h4><p id="-760055542#z2d4hys_258">Contiene informaci&oacute;n t&eacute;cnica adicional del veh&iacute;culo:</p><div class="table-wrapper detached"><table id="-760055542#z2d4hys_259"><tr class="header-row" id="-760055542#z2d4hys_260"><th id="-760055542#z2d4hys_267"><p>Propiedad</p></th><th id="-760055542#z2d4hys_268"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-760055542#z2d4hys_261"><td id="-760055542#z2d4hys_269"><p><span class="inline-code" id="-760055542#z2d4hys_271">capacidadCarga</span></p></td><td id="-760055542#z2d4hys_270"><p>Capacidad de carga en kilogramos</p></td></tr><tr class="" id="-760055542#z2d4hys_262"><td id="-760055542#z2d4hys_272"><p><span class="inline-code" id="-760055542#z2d4hys_274">pesoBrutoVehicular</span></p></td><td id="-760055542#z2d4hys_273"><p>Peso bruto del veh&iacute;culo en kilogramos</p></td></tr><tr class="" id="-760055542#z2d4hys_263"><td id="-760055542#z2d4hys_275"><p><span class="inline-code" id="-760055542#z2d4hys_277">noEjes</span></p></td><td id="-760055542#z2d4hys_276"><p>N&uacute;mero de ejes</p></td></tr><tr class="" id="-760055542#z2d4hys_264"><td id="-760055542#z2d4hys_278"><p><span class="inline-code" id="-760055542#z2d4hys_280">puertas</span></p></td><td id="-760055542#z2d4hys_279"><p>N&uacute;mero de puertas</p></td></tr><tr class="" id="-760055542#z2d4hys_265"><td id="-760055542#z2d4hys_281"><p><span class="inline-code" id="-760055542#z2d4hys_283">idTipoCombustible</span></p></td><td id="-760055542#z2d4hys_282"><p>ID del tipo de combustible</p></td></tr><tr class="" id="-760055542#z2d4hys_266"><td id="-760055542#z2d4hys_284"><p><span class="inline-code" id="-760055542#z2d4hys_286">tipoCombustible</span></p></td><td id="-760055542#z2d4hys_285"><p>Descripci&oacute;n del tipo de combustible</p></td></tr></table></div></section><section><h4 id="-760055542#normalizacion" data-toc="normalizacion#RUNTWrapper.md-normalizacion">Normalizacion</h4><p id="-760055542#z2d4hys_287">Contiene informaci&oacute;n sobre el estado de normalizaci&oacute;n del veh&iacute;culo:</p><div class="table-wrapper detached"><table id="-760055542#z2d4hys_288"><tr class="header-row" id="-760055542#z2d4hys_289"><th id="-760055542#z2d4hys_292"><p>Propiedad</p></th><th id="-760055542#z2d4hys_293"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-760055542#z2d4hys_290"><td id="-760055542#z2d4hys_294"><p><span class="inline-code" id="-760055542#z2d4hys_296">deficienciaMatriculaInicial</span></p></td><td id="-760055542#z2d4hys_295"><p>Indica deficiencias en la matr&iacute;cula inicial</p></td></tr><tr class="" id="-760055542#z2d4hys_291"><td id="-760055542#z2d4hys_297"><p><span class="inline-code" id="-760055542#z2d4hys_299">vehiculoNormalizado</span></p></td><td id="-760055542#z2d4hys_298"><p>Indica si el veh&iacute;culo ha sido normalizado</p></td></tr></table></div></section><section><h4 id="-760055542#propietario" data-toc="propietario#RUNTWrapper.md-propietario">Propietario</h4><p id="-760055542#z2d4hys_300">Representa informaci&oacute;n general sobre los propietarios:</p><div class="table-wrapper detached"><table id="-760055542#z2d4hys_301"><tr class="header-row" id="-760055542#z2d4hys_302"><th id="-760055542#z2d4hys_305"><p>Propiedad</p></th><th id="-760055542#z2d4hys_306"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-760055542#z2d4hys_303"><td id="-760055542#z2d4hys_307"><p><span class="inline-code" id="-760055542#z2d4hys_309">cantidad</span></p></td><td id="-760055542#z2d4hys_308"><p>Cantidad de propietarios</p></td></tr><tr class="" id="-760055542#z2d4hys_304"><td id="-760055542#z2d4hys_310"><p><span class="inline-code" id="-760055542#z2d4hys_312">tipoPropietario</span></p></td><td id="-760055542#z2d4hys_311"><p>Tipo de propietario</p></td></tr></table></div></section><section><h4 id="-760055542#propietarioactual" data-toc="propietarioactual#RUNTWrapper.md-propietarioactual">PropietarioActual</h4><p id="-760055542#z2d4hys_313">Contiene informaci&oacute;n detallada sobre los propietarios actuales:</p><div class="table-wrapper detached"><table id="-760055542#z2d4hys_314"><tr class="header-row" id="-760055542#z2d4hys_315"><th id="-760055542#z2d4hys_329"><p>Propiedad</p></th><th id="-760055542#z2d4hys_330"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-760055542#z2d4hys_316"><td id="-760055542#z2d4hys_331"><p><span class="inline-code" id="-760055542#z2d4hys_333">id</span></p></td><td id="-760055542#z2d4hys_332"><p>ID del propietario</p></td></tr><tr class="" id="-760055542#z2d4hys_317"><td id="-760055542#z2d4hys_334"><p><span class="inline-code" id="-760055542#z2d4hys_336">idTipoDocumento</span></p></td><td id="-760055542#z2d4hys_335"><p>ID del tipo de documento</p></td></tr><tr class="" id="-760055542#z2d4hys_318"><td id="-760055542#z2d4hys_337"><p><span class="inline-code" id="-760055542#z2d4hys_339">tipoDocumento</span></p></td><td id="-760055542#z2d4hys_338"><p>Tipo de documento de identidad</p></td></tr><tr class="" id="-760055542#z2d4hys_319"><td id="-760055542#z2d4hys_340"><p><span class="inline-code" id="-760055542#z2d4hys_342">noDocumento</span></p></td><td id="-760055542#z2d4hys_341"><p>N&uacute;mero de documento</p></td></tr><tr class="" id="-760055542#z2d4hys_320"><td id="-760055542#z2d4hys_343"><p><span class="inline-code" id="-760055542#z2d4hys_345">nombreCompleto</span></p></td><td id="-760055542#z2d4hys_344"><p>Nombre completo del propietario</p></td></tr><tr class="" id="-760055542#z2d4hys_321"><td id="-760055542#z2d4hys_346"><p><span class="inline-code" id="-760055542#z2d4hys_348">primerNombre</span></p></td><td id="-760055542#z2d4hys_347"><p>Primer nombre</p></td></tr><tr class="" id="-760055542#z2d4hys_322"><td id="-760055542#z2d4hys_349"><p><span class="inline-code" id="-760055542#z2d4hys_351">segundoNombre</span></p></td><td id="-760055542#z2d4hys_350"><p>Segundo nombre</p></td></tr><tr class="" id="-760055542#z2d4hys_323"><td id="-760055542#z2d4hys_352"><p><span class="inline-code" id="-760055542#z2d4hys_354">primerApellido</span></p></td><td id="-760055542#z2d4hys_353"><p>Primer apellido</p></td></tr><tr class="" id="-760055542#z2d4hys_324"><td id="-760055542#z2d4hys_355"><p><span class="inline-code" id="-760055542#z2d4hys_357">segundoApellido</span></p></td><td id="-760055542#z2d4hys_356"><p>Segundo apellido</p></td></tr><tr class="" id="-760055542#z2d4hys_325"><td id="-760055542#z2d4hys_358"><p><span class="inline-code" id="-760055542#z2d4hys_360">tipoPropiedad</span></p></td><td id="-760055542#z2d4hys_359"><p>Tipo de propiedad (num&eacute;rico)</p></td></tr><tr class="" id="-760055542#z2d4hys_326"><td id="-760055542#z2d4hys_361"><p><span class="inline-code" id="-760055542#z2d4hys_363">detallePropiedad</span></p></td><td id="-760055542#z2d4hys_362"><p>Detalle del tipo de propiedad</p></td></tr><tr class="" id="-760055542#z2d4hys_327"><td id="-760055542#z2d4hys_364"><p><span class="inline-code" id="-760055542#z2d4hys_366">fechaNacimiento</span></p></td><td id="-760055542#z2d4hys_365"><p>Fecha de nacimiento</p></td></tr><tr class="" id="-760055542#z2d4hys_328"><td id="-760055542#z2d4hys_367"><p><span class="inline-code" id="-760055542#z2d4hys_369">aux</span></p></td><td id="-760055542#z2d4hys_368"><p>Campo auxiliar</p></td></tr></table></div></section></section></section><section><h2 id="-760055542#m-todos" data-toc="m-todos#RUNTWrapper.md-m-todos">M&eacute;todos</h2><section><h3 id="-760055542#newinstance" data-toc="newinstance#RUNTWrapper.md-newinstance">newInstance</h3><div class="detached code-block" id="-760055542#z2d4hys_371"><pre><code class="language-none">public static RUNTWrapper newInstance(Map&lt;String, Object&gt; response)</code></pre></div><p id="-760055542#z2d4hys_372"><span class="control" id="-760055542#z2d4hys_378">Descripci&oacute;n:</span> M&eacute;todo est&aacute;tico que crea una nueva instancia de <span class="inline-code" id="-760055542#z2d4hys_379">RUNTWrapper</span> a partir de una respuesta recibida, t&iacute;picamente de una llamada API.</p><p id="-760055542#z2d4hys_373"><span class="control" id="-760055542#z2d4hys_380">Par&aacute;metros:</span></p><ul class="list" id="-760055542#z2d4hys_374" start="1"><li class="list-item" id="-760055542#z2d4hys_381"><p><span class="inline-code" id="-760055542#z2d4hys_382">response</span> (Map&lt;String, Object&gt;): Mapa que contiene la respuesta, donde se espera que haya una clave 'body' con los datos a deserializar.</p></li></ul><p id="-760055542#z2d4hys_375"><span class="control" id="-760055542#z2d4hys_383">Retorna:</span> Una instancia de <span class="inline-code" id="-760055542#z2d4hys_384">RUNTWrapper</span> con los datos deserializados de la respuesta.</p><p id="-760055542#z2d4hys_376"><span class="control" id="-760055542#z2d4hys_385">Funcionalidad:</span></p><ol class="list list-decimal" id="-760055542#z2d4hys_377" type="1" start="1"><li class="list-item" id="-760055542#z2d4hys_386"><p>Serializa el objeto almacenado en la clave 'body' del mapa de respuesta</p></li><li class="list-item" id="-760055542#z2d4hys_387"><p>Deserializa el JSON resultante a la clase <span class="inline-code" id="-760055542#z2d4hys_389">RUNTWrapper</span></p></li><li class="list-item" id="-760055542#z2d4hys_388"><p>Devuelve la instancia creada</p></li></ol></section></section><section><h2 id="-760055542#uso-t-pico" data-toc="uso-t-pico#RUNTWrapper.md-uso-t-pico">Uso T&iacute;pico</h2><p id="-760055542#z2d4hys_390">Esta clase se utiliza principalmente para:</p><ol class="list list-decimal" id="-760055542#z2d4hys_391" type="1" start="1"><li class="list-item" id="-760055542#z2d4hys_392"><p>Recibir y estructurar datos de consultas al RUNT</p></li><li class="list-item" id="-760055542#z2d4hys_393"><p>Facilitar el acceso a informaci&oacute;n detallada de veh&iacute;culos colombianos</p></li><li class="list-item" id="-760055542#z2d4hys_394"><p>Servir como modelo de datos para integraciones con el sistema RUNT</p></li></ol></section><section><h2 id="-760055542#consideraciones" data-toc="consideraciones#RUNTWrapper.md-consideraciones">Consideraciones</h2><ul class="list" id="-760055542#z2d4hys_395" start="1"><li class="list-item" id="-760055542#z2d4hys_396"><p>La clase contiene algunas propiedades que parecen duplicadas (como <span class="inline-code" id="-760055542#z2d4hys_398">noMotor</span> y <span class="inline-code" id="-760055542#z2d4hys_399">nroMotor</span>), lo que podr&iacute;a indicar variaciones en la nomenclatura del sistema de origen.</p></li><li class="list-item" id="-760055542#z2d4hys_397"><p>Al ser <span class="inline-code" id="-760055542#z2d4hys_400">@NamespaceAccessible</span>, esta clase est&aacute; dise&ntilde;ada para ser utilizada en contextos de paquetes gestionados o integraciones externas.</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1772259966">RUNTServiceHandler</h1><section><h2 id="1772259966#descripci-n-general" data-toc="descripci-n-general#RUNTServiceHandler.md-descripci-n-general">Descripci&oacute;n General</h2><p id="1772259966#-eyj5zm_15"><span class="inline-code" id="1772259966#-eyj5zm_16">RUNTServiceHandler</span> es una clase virtual global que extiende <span class="inline-code" id="1772259966#-eyj5zm_17">PlatformEventIntegrationObserver</span>. Esta clase est&aacute; dise&ntilde;ada para manejar la integraci&oacute;n con el servicio RUNT (Registro &Uacute;nico Nacional de Tr&aacute;nsito), permitiendo consultar informaci&oacute;n de veh&iacute;culos a trav&eacute;s de un servicio externo.</p></section><section><h2 id="1772259966#autor" data-toc="autor#RUNTServiceHandler.md-autor">Autor</h2><p id="1772259966#-eyj5zm_18">Felipe Correa \&lt;felipe.correa@nespon.com\&gt;</p></section><section><h2 id="1772259966#proyecto" data-toc="proyecto#RUNTServiceHandler.md-proyecto">Proyecto</h2><p id="1772259966#-eyj5zm_19">Foundation Salesforce - Suratech - UH-17752</p></section><section><h2 id="1772259966#ltima-modificaci-n" data-toc="ltima-modificaci-n#RUNTServiceHandler.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="1772259966#-eyj5zm_20">20 de febrero de 2025</p></section><section><h2 id="1772259966#constantes" data-toc="constantes#RUNTServiceHandler.md-constantes">Constantes</h2><section><h3 id="1772259966#service-method" data-toc="service-method#RUNTServiceHandler.md-service-method">SERVICE_METHOD</h3><ul class="list" id="1772259966#-eyj5zm_24" start="1"><li class="list-item" id="1772259966#-eyj5zm_26"><p><span class="control" id="1772259966#-eyj5zm_28">Valor</span>: <span class="inline-code" id="1772259966#-eyj5zm_29">&quot;GET&quot;</span></p></li><li class="list-item" id="1772259966#-eyj5zm_27"><p><span class="control" id="1772259966#-eyj5zm_30">Descripci&oacute;n</span>: Define el m&eacute;todo HTTP utilizado para la comunicaci&oacute;n con el servicio externo (GET).</p></li></ul></section><section><h3 id="1772259966#suratech-mdt-config-name" data-toc="suratech-mdt-config-name#RUNTServiceHandler.md-suratech-mdt-config-name">SURATECH_MDT_CONFIG_NAME</h3><ul class="list" id="1772259966#-eyj5zm_32" start="1"><li class="list-item" id="1772259966#-eyj5zm_34"><p><span class="control" id="1772259966#-eyj5zm_36">Valor</span>: <span class="inline-code" id="1772259966#-eyj5zm_37">&quot;runt_endpoint&quot;</span></p></li><li class="list-item" id="1772259966#-eyj5zm_35"><p><span class="control" id="1772259966#-eyj5zm_38">Descripci&oacute;n</span>: Nombre del registro de metadatos personalizado que contiene la configuraci&oacute;n de conexi&oacute;n al servicio RUNT.</p></li></ul></section></section><section><h2 id="1772259966#m-todos" data-toc="m-todos#RUNTServiceHandler.md-m-todos">M&eacute;todos</h2><section><h3 id="1772259966#preprocess-map-string-object-input-map-string-object-options" data-toc="preprocess-map-string-object-input-map-string-object-options#RUNTServiceHandler.md-preprocess-map-string-object-input-map-string-object-options">preProcess(Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; options)</h3><section><h4 id="1772259966#descripci-n" data-toc="descripci-n#RUNTServiceHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1772259966#-eyj5zm_49">M&eacute;todo virtual que realiza el pre-procesamiento de la solicitud antes de invocar el servicio externo. Publica un evento de plataforma si est&aacute; habilitado.</p></section><section><h4 id="1772259966#par-metros" data-toc="par-metros#RUNTServiceHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1772259966#-eyj5zm_50" start="1"><li class="list-item" id="1772259966#-eyj5zm_51"><p><span class="inline-code" id="1772259966#-eyj5zm_53">input</span> (Map&lt;String, Object&gt;): Datos de entrada para la solicitud.</p></li><li class="list-item" id="1772259966#-eyj5zm_52"><p><span class="inline-code" id="1772259966#-eyj5zm_54">options</span> (Map&lt;String, Object&gt;): Opciones adicionales para el procesamiento.</p></li></ul></section><section><h4 id="1772259966#retorno" data-toc="retorno#RUNTServiceHandler.md-retorno">Retorno</h4><ul class="list" id="1772259966#-eyj5zm_55" start="1"><li class="list-item" id="1772259966#-eyj5zm_56"><p><span class="inline-code" id="1772259966#-eyj5zm_57">Map&lt;String, Object&gt;</span>: Los datos de entrada, posiblemente modificados durante el pre-procesamiento.</p></li></ul></section><section><h4 id="1772259966#c-digo" data-toc="c-digo#RUNTServiceHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1772259966#-eyj5zm_58"><pre><code class="language-none">global virtual Map&lt;String, Object&gt; preProcess(
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; options
) {
  Core.debug('Starting RUNT Integration Service Pre Process');
  if (
    options.containsKey('PlatformEventEnabled') &amp;&amp;
    ((Boolean) options.get('PlatformEventEnabled')) == true
  )
    publishPlatformEventIntegration('pre', JSON.serialize(input));
  return input;
}</code></pre></div></section></section><section><h3 id="1772259966#invokeprocess-map-string-object-input-map-string-object-output-map-string-object-options" data-toc="invokeprocess-map-string-object-input-map-string-object-output-map-string-object-options#RUNTServiceHandler.md-invokeprocess-map-string-object-input-map-string-object-output-map-string-object-options">invokeProcess(Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; output, Map&lt;String, Object&gt; options)</h3><section><h4 id="1772259966#descripci-n" data-toc="descripci-n#RUNTServiceHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1772259966#-eyj5zm_66">M&eacute;todo principal que orquesta el flujo completo de integraci&oacute;n con el servicio RUNT. Obtiene la configuraci&oacute;n de metadatos, realiza validaciones, emite la solicitud al servicio externo, procesa la respuesta y maneja excepciones.</p></section><section><h4 id="1772259966#par-metros" data-toc="par-metros#RUNTServiceHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1772259966#-eyj5zm_67" start="1"><li class="list-item" id="1772259966#-eyj5zm_68"><p><span class="inline-code" id="1772259966#-eyj5zm_71">input</span> (Map&lt;String, Object&gt;): Datos de entrada para la solicitud.</p></li><li class="list-item" id="1772259966#-eyj5zm_69"><p><span class="inline-code" id="1772259966#-eyj5zm_72">output</span> (Map&lt;String, Object&gt;): Mapa donde se almacenar&aacute; el resultado de la operaci&oacute;n.</p></li><li class="list-item" id="1772259966#-eyj5zm_70"><p><span class="inline-code" id="1772259966#-eyj5zm_73">options</span> (Map&lt;String, Object&gt;): Opciones adicionales para el procesamiento.</p></li></ul></section><section><h4 id="1772259966#retorno" data-toc="retorno#RUNTServiceHandler.md-retorno">Retorno</h4><ul class="list" id="1772259966#-eyj5zm_74" start="1"><li class="list-item" id="1772259966#-eyj5zm_75"><p><span class="inline-code" id="1772259966#-eyj5zm_76">Map&lt;String, Object&gt;</span>: Mapa con la respuesta procesada o <span class="inline-code" id="1772259966#-eyj5zm_77">null</span> en caso de error.</p></li></ul></section><section><h4 id="1772259966#proceso" data-toc="proceso#RUNTServiceHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="1772259966#-eyj5zm_78" type="1" start="1"><li class="list-item" id="1772259966#-eyj5zm_79"><p>Obtiene la configuraci&oacute;n del servicio desde metadatos personalizados.</p></li><li class="list-item" id="1772259966#-eyj5zm_80"><p>Marca si los eventos de plataforma est&aacute;n habilitados para este servicio.</p></li><li class="list-item" id="1772259966#-eyj5zm_81"><p>Crea un manejador de notificaciones externas.</p></li><li class="list-item" id="1772259966#-eyj5zm_82"><p>Ejecuta el pre-procesamiento.</p></li><li class="list-item" id="1772259966#-eyj5zm_83"><p>Publica un evento de plataforma para el inicio del proceso.</p></li><li class="list-item" id="1772259966#-eyj5zm_84"><p>Emite la solicitud al servicio externo mediante el manejador de notificaciones.</p></li><li class="list-item" id="1772259966#-eyj5zm_85"><p>Procesa la respuesta HTTP.</p></li><li class="list-item" id="1772259966#-eyj5zm_86"><p>Publica un evento de plataforma con el resultado.</p></li><li class="list-item" id="1772259966#-eyj5zm_87"><p>Ejecuta el post-procesamiento.</p></li><li class="list-item" id="1772259966#-eyj5zm_88"><p>Maneja excepciones si ocurren durante el proceso.</p></li></ol></section><section><h4 id="1772259966#c-digo" data-toc="c-digo#RUNTServiceHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1772259966#-eyj5zm_89"><pre><code class="language-none">global Map&lt;String, Object&gt; invokeProcess(
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; output,
  Map&lt;String, Object&gt; options
) {
  SF_IntegrationSetting__mdt config = Test.isRunningTest()
    ? ExternalServiceMetadataIntegrationMock.getIntegrationSettings(
        SURATECH_MDT_CONFIG_NAME
      )
    : SF_IntegrationSetting__mdt.getInstance(SURATECH_MDT_CONFIG_NAME);
  if (config == null) {
    throw new ExternalServiceException(
      'No existing &quot;' +
        SURATECH_MDT_CONFIG_NAME +
        '&quot; custom metadata type record at Integration Setting'
    );
  }

  //Marcamos la activacion si debemos ejecutar Eventos de Plataformas para este servicio.
  options.put('PlatformEventEnabled', config.Platform_Events_Enabled__c);

  ExternalNotificationHandler enh = new ExternalNotificationHandler();
  Map&lt;String, Object&gt; payload = new Map&lt;String, Object&gt;();

  try {
    payload = this.preProcess(input, options);
    Core.debug('Starting RUNT Integration Service In Process');
    publishPlatformEventIntegration('in', JSON.serialize(input));
    //Validations
    // ExternalServiceValidationUtil.plateValidation(
    //   (String) input.get('plate')
    // );

    System.HTTPResponse response = enh.emit(
      SERVICE_METHOD,
      config,
      String.valueOf(input.get('plate')),
      payload
    );

    Map&lt;String, Object&gt; responseMap = new Map&lt;String, Object&gt;{
      'body' =&gt; (Map&lt;String, Object&gt;) JSON.deserializeUntyped(
        response.getBody()
      ),
      'status' =&gt; response.getStatus(),
      'statusCode' =&gt; response.getStatusCode()
    };

    this.publishPlatFormEvent(
      response.getStatusCode(),
      JSON.serialize(payload),
      JSON.serialize(response.getBody())
    );
    return this.postProcess(responseMap, options);
  } catch (Exception e) {
    enh.controlException(
      'RUNT Service remote service',
      e,
      JSON.serialize(payload)
    );
    return null;
  }
}</code></pre></div></section></section><section><h3 id="1772259966#postprocess-map-string-object-response-map-string-object-options" data-toc="postprocess-map-string-object-response-map-string-object-options#RUNTServiceHandler.md-postprocess-map-string-object-response-map-string-object-options">postProcess(Map&lt;String, Object&gt; response, Map&lt;String, Object&gt; options)</h3><section><h4 id="1772259966#descripci-n" data-toc="descripci-n#RUNTServiceHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1772259966#-eyj5zm_96">M&eacute;todo virtual que realiza el post-procesamiento de la respuesta despu&eacute;s de invocar el servicio externo. Publica un evento de plataforma si est&aacute; habilitado.</p></section><section><h4 id="1772259966#par-metros" data-toc="par-metros#RUNTServiceHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1772259966#-eyj5zm_97" start="1"><li class="list-item" id="1772259966#-eyj5zm_98"><p><span class="inline-code" id="1772259966#-eyj5zm_100">response</span> (Map&lt;String, Object&gt;): Datos de respuesta del servicio externo.</p></li><li class="list-item" id="1772259966#-eyj5zm_99"><p><span class="inline-code" id="1772259966#-eyj5zm_101">options</span> (Map&lt;String, Object&gt;): Opciones adicionales para el procesamiento.</p></li></ul></section><section><h4 id="1772259966#retorno" data-toc="retorno#RUNTServiceHandler.md-retorno">Retorno</h4><ul class="list" id="1772259966#-eyj5zm_102" start="1"><li class="list-item" id="1772259966#-eyj5zm_103"><p><span class="inline-code" id="1772259966#-eyj5zm_104">Map&lt;String, Object&gt;</span>: La respuesta, posiblemente modificada durante el post-procesamiento.</p></li></ul></section><section><h4 id="1772259966#c-digo" data-toc="c-digo#RUNTServiceHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1772259966#-eyj5zm_105"><pre><code class="language-none">global virtual Map&lt;String, Object&gt; postProcess(
  Map&lt;String, Object&gt; response,
  Map&lt;String, Object&gt; options
) {
  Core.debug('Starting RUNT Integration Service Post Process');
  if (
    options.containsKey('PlatformEventEnabled') &amp;&amp;
    ((Boolean) options.get('PlatformEventEnabled')) == true
  )
    publishPlatformEventIntegration('post', JSON.serialize(response));
  return response;
}</code></pre></div></section></section><section><h3 id="1772259966#publishplatformeventintegration-string-moment-string-data" data-toc="publishplatformeventintegration-string-moment-string-data#RUNTServiceHandler.md-publishplatformeventintegration-string-moment-string-data">publishPlatformEventIntegration(String moment, String data)</h3><section><h4 id="1772259966#descripci-n" data-toc="descripci-n#RUNTServiceHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1772259966#-eyj5zm_112">Publica diferentes tipos de eventos de plataforma seg&uacute;n el momento del proceso de integraci&oacute;n.</p></section><section><h4 id="1772259966#par-metros" data-toc="par-metros#RUNTServiceHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1772259966#-eyj5zm_113" start="1"><li class="list-item" id="1772259966#-eyj5zm_114"><p><span class="inline-code" id="1772259966#-eyj5zm_116">moment</span> (String): Momento del proceso ('pre', 'post', 'in').</p></li><li class="list-item" id="1772259966#-eyj5zm_115"><p><span class="inline-code" id="1772259966#-eyj5zm_117">data</span> (String): Datos serializados para incluir en el evento.</p></li></ul></section><section><h4 id="1772259966#proceso" data-toc="proceso#RUNTServiceHandler.md-proceso">Proceso</h4><p id="1772259966#-eyj5zm_118">Utiliza una declaraci&oacute;n switch para determinar qu&eacute; tipo de evento de plataforma publicar:</p><ul class="list" id="1772259966#-eyj5zm_119" start="1"><li class="list-item" id="1772259966#-eyj5zm_120"><p>'pre': Evento de pre-procesamiento.</p></li><li class="list-item" id="1772259966#-eyj5zm_121"><p>'post': Evento de post-procesamiento.</p></li><li class="list-item" id="1772259966#-eyj5zm_122"><p>'in': Evento durante el procesamiento.</p></li></ul></section><section><h4 id="1772259966#c-digo" data-toc="c-digo#RUNTServiceHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1772259966#-eyj5zm_123"><pre><code class="language-none">global void publishPlatformEventIntegration(String moment, String data) {
  switch on moment.toLowerCase() {
    when 'pre' {
      publishInitPrePlatformEvent(data, 'RUNT Integration Service');
    }
    when 'post' {
      publishInitPosPlatformEvent(data, 'RUNT Integration Service');
    }
    when 'in' {
      publishPlatFormEvent(200, data, 'Starting RUNT In process');
    }
  }
}</code></pre></div></section></section></section><section><h2 id="1772259966#excepciones" data-toc="excepciones#RUNTServiceHandler.md-excepciones">Excepciones</h2><section><h3 id="1772259966#externalserviceexception" data-toc="externalserviceexception#RUNTServiceHandler.md-externalserviceexception">ExternalServiceException</h3><p id="1772259966#-eyj5zm_126">Esta excepci&oacute;n se lanza cuando no se encuentra la configuraci&oacute;n del servicio RUNT en los metadatos personalizados.</p></section></section><section><h2 id="1772259966#dependencias" data-toc="dependencias#RUNTServiceHandler.md-dependencias">Dependencias</h2><ul class="list" id="1772259966#-eyj5zm_128" start="1"><li class="list-item" id="1772259966#-eyj5zm_129"><p><span class="inline-code" id="1772259966#-eyj5zm_136">PlatformEventIntegrationObserver</span>: Clase base que proporciona funcionalidades para publicar eventos de plataforma.</p></li><li class="list-item" id="1772259966#-eyj5zm_130"><p><span class="inline-code" id="1772259966#-eyj5zm_137">SF_IntegrationSetting__mdt</span>: Tipo de metadatos personalizado que contiene la configuraci&oacute;n para la integraci&oacute;n.</p></li><li class="list-item" id="1772259966#-eyj5zm_131"><p><span class="inline-code" id="1772259966#-eyj5zm_138">ExternalServiceMetadataIntegrationMock</span>: Clase mock utilizada durante las pruebas para simular la configuraci&oacute;n de integraci&oacute;n.</p></li><li class="list-item" id="1772259966#-eyj5zm_132"><p><span class="inline-code" id="1772259966#-eyj5zm_139">ExternalNotificationHandler</span>: Clase que maneja la emisi&oacute;n de solicitudes a servicios externos y el control de excepciones.</p></li><li class="list-item" id="1772259966#-eyj5zm_133"><p><span class="inline-code" id="1772259966#-eyj5zm_140">Core</span>: Clase de utilidad que proporciona el m&eacute;todo <span class="inline-code" id="1772259966#-eyj5zm_141">debug</span> para registro.</p></li><li class="list-item" id="1772259966#-eyj5zm_134"><p><span class="inline-code" id="1772259966#-eyj5zm_142">ExternalServiceException</span>: Excepci&oacute;n personalizada lanzada cuando hay problemas con la configuraci&oacute;n del servicio.</p></li><li class="list-item" id="1772259966#-eyj5zm_135"><p><span class="inline-code" id="1772259966#-eyj5zm_143">ExternalServiceValidationUtil</span>: Clase de utilidad para validar datos (actualmente comentada).</p></li></ul></section><section><h2 id="1772259966#caracter-sticas-notables" data-toc="caracter-sticas-notables#RUNTServiceHandler.md-caracter-sticas-notables">Caracter&iacute;sticas Notables</h2><section><h3 id="1772259966#eventos-de-plataforma" data-toc="eventos-de-plataforma#RUNTServiceHandler.md-eventos-de-plataforma">Eventos de Plataforma</h3><p id="1772259966#-eyj5zm_148">La clase implementa una integraci&oacute;n completa con eventos de plataforma de Salesforce, permitiendo el seguimiento y monitoreo del proceso de integraci&oacute;n en diferentes etapas:</p><ul class="list" id="1772259966#-eyj5zm_149" start="1"><li class="list-item" id="1772259966#-eyj5zm_150"><p>Pre-procesamiento</p></li><li class="list-item" id="1772259966#-eyj5zm_151"><p>Durante el procesamiento</p></li><li class="list-item" id="1772259966#-eyj5zm_152"><p>Post-procesamiento</p></li></ul></section><section><h3 id="1772259966#manejo-de-configuraci-n" data-toc="manejo-de-configuraci-n#RUNTServiceHandler.md-manejo-de-configuraci-n">Manejo de Configuraci&oacute;n</h3><p id="1772259966#-eyj5zm_153">La configuraci&oacute;n del servicio se obtiene din&aacute;micamente de un registro de metadatos personalizado (<span class="inline-code" id="1772259966#-eyj5zm_154">SF_IntegrationSetting__mdt</span>), facilitando cambios en la configuraci&oacute;n sin modificar el c&oacute;digo.</p></section><section><h3 id="1772259966#manejo-de-pruebas" data-toc="manejo-de-pruebas#RUNTServiceHandler.md-manejo-de-pruebas">Manejo de Pruebas</h3><p id="1772259966#-eyj5zm_155">Incorpora l&oacute;gica especial para entornos de prueba, utilizando una clase mock (<span class="inline-code" id="1772259966#-eyj5zm_156">ExternalServiceMetadataIntegrationMock</span>) para simular la configuraci&oacute;n durante las pruebas.</p></section><section><h3 id="1772259966#virtualidad" data-toc="virtualidad#RUNTServiceHandler.md-virtualidad">Virtualidad</h3><p id="1772259966#-eyj5zm_157">Los m&eacute;todos principales (<span class="inline-code" id="1772259966#-eyj5zm_158">preProcess</span> y <span class="inline-code" id="1772259966#-eyj5zm_159">postProcess</span>) son declarados como virtuales, permitiendo que las clases derivadas personalicen el comportamiento sin modificar el flujo general.</p></section></section><section><h2 id="1772259966#ejemplo-de-uso" data-toc="ejemplo-de-uso#RUNTServiceHandler.md-ejemplo-de-uso">Ejemplo de Uso</h2><div class="detached code-block" id="1772259966#-eyj5zm_160"><pre><code class="language-none">// Crear una instancia del handler
RUNTServiceHandler handler = new RUNTServiceHandler();

// Preparar los datos de entrada
Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
  'plate' =&gt; 'ABC123'  // Placa del vehículo a consultar
};

// Mapas para opciones y salida
Map&lt;String, Object&gt; options = new Map&lt;String, Object&gt;();
Map&lt;String, Object&gt; output = new Map&lt;String, Object&gt;();

try {
  // Invocar el proceso de integración
  Map&lt;String, Object&gt; result = handler.invokeProcess(input, output, options);
  
  if (result != null) {
    // Procesar el resultado
    Map&lt;String, Object&gt; body = (Map&lt;String, Object&gt;)result.get('body');
    Integer statusCode = (Integer)result.get('statusCode');
    
    if (statusCode == 200) {
      // Extraer información del vehículo del resultado
      System.debug('Información del vehículo: ' + body);
      
      // Realizar operaciones con la información obtenida
      // ...
    } else {
      System.debug('Error en la consulta. Código: ' + statusCode);
    }
  }
} catch (Exception e) {
  System.debug('Error en la integración: ' + e.getMessage());
}</code></pre></div></section><section><h2 id="1772259966#extensi-n-de-la-clase" data-toc="extensi-n-de-la-clase#RUNTServiceHandler.md-extensi-n-de-la-clase">Extensi&oacute;n de la Clase</h2><div class="detached code-block" id="1772259966#-eyj5zm_161"><pre><code class="language-none">public class CustomRUNTServiceHandler extends RUNTServiceHandler {
    
    // Personalizar el pre-procesamiento
    global override Map&lt;String, Object&gt; preProcess(
        Map&lt;String, Object&gt; input,
        Map&lt;String, Object&gt; options
    ) {
        // Realizar validaciones adicionales
        String plate = (String)input.get('plate');
        if (plate != null) {
            // Convertir la placa a mayúsculas
            input.put('plate', plate.toUpperCase());
            
            // Validar el formato de la placa
            ExternalServiceValidationUtil.plateValidation(plate);
        }
        
        // Agregar información adicional
        input.put('requestTimestamp', System.now().getTime());
        input.put('requestUser', UserInfo.getUserId());
        
        // Llamar al método base
        return super.preProcess(input, options);
    }
    
    // Personalizar el post-procesamiento
    global override Map&lt;String, Object&gt; postProcess(
        Map&lt;String, Object&gt; response,
        Map&lt;String, Object&gt; options
    ) {
        // Transformar o enriquecer la respuesta
        if (response != null &amp;&amp; response.containsKey('body')) {
            Map&lt;String, Object&gt; body = (Map&lt;String, Object&gt;)response.get('body');
            
            // Agregar información adicional
            body.put('processedTimestamp', System.now().getTime());
            
            // Transformar datos específicos si es necesario
            // ...
        }
        
        // Llamar al método base
        return super.postProcess(response, options);
    }
}</code></pre></div></section><section><h2 id="1772259966#notas-adicionales" data-toc="notas-adicionales#RUNTServiceHandler.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="1772259966#-eyj5zm_162" type="1" start="1"><li class="list-item" id="1772259966#-eyj5zm_163"><p>La clase contiene c&oacute;digo comentado que sugiere una implementaci&oacute;n anterior o alternativa, incluyendo constantes para el nombre del procedimiento de integraci&oacute;n y el nombre del servicio, as&iacute; como una validaci&oacute;n de placa de veh&iacute;culo.</p></li><li class="list-item" id="1772259966#-eyj5zm_164"><p>La clase est&aacute; dise&ntilde;ada siguiendo un patr&oacute;n de tres fases (pre-proceso, proceso, post-proceso), permitiendo personalizar cada fase a trav&eacute;s de la herencia.</p></li><li class="list-item" id="1772259966#-eyj5zm_165"><p>La integraci&oacute;n con eventos de plataforma facilita el monitoreo y depuraci&oacute;n del proceso de integraci&oacute;n.</p></li><li class="list-item" id="1772259966#-eyj5zm_166"><p>La clase es consciente del contexto de prueba (<span class="inline-code" id="1772259966#-eyj5zm_168">Test.isRunningTest()</span>) y utiliza mocks para simular la configuraci&oacute;n durante las pruebas.</p></li><li class="list-item" id="1772259966#-eyj5zm_167"><p>La clase no realiza actualmente la validaci&oacute;n de la placa del veh&iacute;culo, aunque hay c&oacute;digo comentado que sugiere que esta validaci&oacute;n podr&iacute;a ser necesaria en alg&uacute;n momento.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1024734388">LocalEmisionNotificationHandler</h1><section><h2 id="1024734388#descripci-n-general" data-toc="descripci-n-general#LocalEmisionNotificationHandler.md-descripci-n-general">Descripci&oacute;n General</h2><p id="1024734388#sveb2i_15"><span class="inline-code" id="1024734388#sveb2i_16">LocalEmisionNotificationHandler</span> es una clase que gestiona la integraci&oacute;n para notificaciones de emisi&oacute;n local. Extiende <span class="inline-code" id="1024734388#sveb2i_17">PlatformEventIntegrationObserver</span> e implementa las interfaces <span class="inline-code" id="1024734388#sveb2i_18">Queueable</span> y <span class="inline-code" id="1024734388#sveb2i_19">Database.AllowsCallouts</span>, lo que le permite ser ejecutada como trabajo en cola as&iacute;ncrono y realizar llamadas HTTP a servicios externos.</p></section><section><h2 id="1024734388#autor-y-modificaciones" data-toc="autor-y-modificaciones#LocalEmisionNotificationHandler.md-autor-y-modificaciones">Autor y Modificaciones</h2><ul class="list" id="1024734388#sveb2i_20" start="1"><li class="list-item" id="1024734388#sveb2i_21"><p><span class="control" id="1024734388#sveb2i_25">Autor Original:</span> felipe.correa@nespon.com</p></li><li class="list-item" id="1024734388#sveb2i_22"><p><span class="control" id="1024734388#sveb2i_26">Proyecto:</span> Foundation Salesforce - Suratech - UH-17589</p></li><li class="list-item" id="1024734388#sveb2i_23"><p><span class="control" id="1024734388#sveb2i_27">&Uacute;ltima modificaci&oacute;n:</span> 03-03-2025</p></li><li class="list-item" id="1024734388#sveb2i_24"><p><span class="control" id="1024734388#sveb2i_28">Modificado por:</span> fabian.lopez@nespon.com</p></li></ul></section><section><h2 id="1024734388#anotaciones" data-toc="anotaciones#LocalEmisionNotificationHandler.md-anotaciones">Anotaciones</h2><ul class="list" id="1024734388#sveb2i_29" start="1"><li class="list-item" id="1024734388#sveb2i_30"><p><span class="inline-code" id="1024734388#sveb2i_31">global virtual</span>: La clase es accesible desde cualquier namespace y puede ser extendida por otras clases.</p></li></ul></section><section><h2 id="1024734388#constantes" data-toc="constantes#LocalEmisionNotificationHandler.md-constantes">Constantes</h2><div class="table-wrapper detached"><table id="1024734388#sveb2i_32"><tr class="header-row" id="1024734388#sveb2i_33"><th id="1024734388#sveb2i_36"><p>Constante</p></th><th id="1024734388#sveb2i_37"><p>Valor</p></th><th id="1024734388#sveb2i_38"><p>Descripci&oacute;n</p></th></tr><tr class="" id="1024734388#sveb2i_34"><td id="1024734388#sveb2i_39"><p><span class="inline-code" id="1024734388#sveb2i_42">SERVICE_METHOD</span></p></td><td id="1024734388#sveb2i_40"><p><span class="inline-code" id="1024734388#sveb2i_43">'POST'</span></p></td><td id="1024734388#sveb2i_41"><p>M&eacute;todo HTTP utilizado para las llamadas al servicio externo</p></td></tr><tr class="" id="1024734388#sveb2i_35"><td id="1024734388#sveb2i_44"><p><span class="inline-code" id="1024734388#sveb2i_47">SURATECH_MDT_CONFIG_NAME</span></p></td><td id="1024734388#sveb2i_45"><p><span class="inline-code" id="1024734388#sveb2i_48">'emisionlocal_endpoint'</span></p></td><td id="1024734388#sveb2i_46"><p>Nombre del registro de metadatos personalizado que contiene la configuraci&oacute;n de integraci&oacute;n</p></td></tr></table></div></section><section><h2 id="1024734388#propiedades" data-toc="propiedades#LocalEmisionNotificationHandler.md-propiedades">Propiedades</h2><div class="table-wrapper detached"><table id="1024734388#sveb2i_49"><tr class="header-row" id="1024734388#sveb2i_50"><th id="1024734388#sveb2i_55"><p>Propiedad</p></th><th id="1024734388#sveb2i_56"><p>Tipo</p></th><th id="1024734388#sveb2i_57"><p>Descripci&oacute;n</p></th></tr><tr class="" id="1024734388#sveb2i_51"><td id="1024734388#sveb2i_58"><p><span class="inline-code" id="1024734388#sveb2i_61">input</span></p></td><td id="1024734388#sveb2i_59"><p><span class="inline-code" id="1024734388#sveb2i_62">Map&lt;String, Object&gt;</span></p></td><td id="1024734388#sveb2i_60"><p>Datos de entrada para el proceso de integraci&oacute;n</p></td></tr><tr class="" id="1024734388#sveb2i_52"><td id="1024734388#sveb2i_63"><p><span class="inline-code" id="1024734388#sveb2i_66">output</span></p></td><td id="1024734388#sveb2i_64"><p><span class="inline-code" id="1024734388#sveb2i_67">Map&lt;String, Object&gt;</span></p></td><td id="1024734388#sveb2i_65"><p>Datos de salida del proceso de integraci&oacute;n</p></td></tr><tr class="" id="1024734388#sveb2i_53"><td id="1024734388#sveb2i_68"><p><span class="inline-code" id="1024734388#sveb2i_71">options</span></p></td><td id="1024734388#sveb2i_69"><p><span class="inline-code" id="1024734388#sveb2i_72">Map&lt;String, Object&gt;</span></p></td><td id="1024734388#sveb2i_70"><p>Opciones de configuraci&oacute;n para el proceso</p></td></tr><tr class="" id="1024734388#sveb2i_54"><td id="1024734388#sveb2i_73"><p><span class="inline-code" id="1024734388#sveb2i_76">policyId</span></p></td><td id="1024734388#sveb2i_74"><p><span class="inline-code" id="1024734388#sveb2i_77">String</span></p></td><td id="1024734388#sveb2i_75"><p>Identificador de la p&oacute;liza relacionada (declarado pero no utilizado en el c&oacute;digo)</p></td></tr></table></div></section><section><h2 id="1024734388#constructor" data-toc="constructor#LocalEmisionNotificationHandler.md-constructor">Constructor</h2><div class="detached code-block" id="1024734388#sveb2i_78"><pre><code class="language-none">global LocalEmisionNotificationHandler(
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; output,
  Map&lt;String, Object&gt; options
)</code></pre></div><p id="1024734388#sveb2i_79"><span class="control" id="1024734388#sveb2i_82">Descripci&oacute;n:</span> Inicializa una nueva instancia de la clase con los par&aacute;metros proporcionados.</p><p id="1024734388#sveb2i_80"><span class="control" id="1024734388#sveb2i_83">Par&aacute;metros:</span></p><ul class="list" id="1024734388#sveb2i_81" start="1"><li class="list-item" id="1024734388#sveb2i_84"><p><span class="inline-code" id="1024734388#sveb2i_87">input</span>: Datos de entrada para el proceso</p></li><li class="list-item" id="1024734388#sveb2i_85"><p><span class="inline-code" id="1024734388#sveb2i_88">output</span>: Contenedor para los datos de salida</p></li><li class="list-item" id="1024734388#sveb2i_86"><p><span class="inline-code" id="1024734388#sveb2i_89">options</span>: Opciones de configuraci&oacute;n</p></li></ul></section><section><h2 id="1024734388#m-todos" data-toc="m-todos#LocalEmisionNotificationHandler.md-m-todos">M&eacute;todos</h2><section><h3 id="1024734388#execute" data-toc="execute#LocalEmisionNotificationHandler.md-execute">execute</h3><div class="detached code-block" id="1024734388#sveb2i_96"><pre><code class="language-none">global void execute(QueueableContext context)</code></pre></div><p id="1024734388#sveb2i_97"><span class="control" id="1024734388#sveb2i_100">Descripci&oacute;n:</span> Implementaci&oacute;n del m&eacute;todo requerido por la interfaz <span class="inline-code" id="1024734388#sveb2i_101">Queueable</span>. Inicia el proceso de integraci&oacute;n cuando el trabajo en cola es ejecutado.</p><p id="1024734388#sveb2i_98"><span class="control" id="1024734388#sveb2i_102">Par&aacute;metros:</span></p><ul class="list" id="1024734388#sveb2i_99" start="1"><li class="list-item" id="1024734388#sveb2i_103"><p><span class="inline-code" id="1024734388#sveb2i_104">context</span>: Contexto de la ejecuci&oacute;n en cola</p></li></ul></section><section><h3 id="1024734388#preprocess" data-toc="preprocess#LocalEmisionNotificationHandler.md-preprocess">preProcess</h3><div class="detached code-block" id="1024734388#sveb2i_105"><pre><code class="language-none">global virtual Map&lt;String, Object&gt; preProcess(
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; options
)</code></pre></div><p id="1024734388#sveb2i_106"><span class="control" id="1024734388#sveb2i_112">Descripci&oacute;n:</span> M&eacute;todo virtual que realiza el pre-procesamiento de los datos de entrada antes de la integraci&oacute;n.</p><p id="1024734388#sveb2i_107"><span class="control" id="1024734388#sveb2i_113">Par&aacute;metros:</span></p><ul class="list" id="1024734388#sveb2i_108" start="1"><li class="list-item" id="1024734388#sveb2i_114"><p><span class="inline-code" id="1024734388#sveb2i_116">input</span>: Datos de entrada para procesar</p></li><li class="list-item" id="1024734388#sveb2i_115"><p><span class="inline-code" id="1024734388#sveb2i_117">options</span>: Opciones de configuraci&oacute;n</p></li></ul><p id="1024734388#sveb2i_109"><span class="control" id="1024734388#sveb2i_118">Retorna:</span> Los datos de entrada posiblemente modificados</p><p id="1024734388#sveb2i_110"><span class="control" id="1024734388#sveb2i_119">Funcionalidad:</span></p><ol class="list list-decimal" id="1024734388#sveb2i_111" type="1" start="1"><li class="list-item" id="1024734388#sveb2i_120"><p>Registra un mensaje de depuraci&oacute;n</p></li><li class="list-item" id="1024734388#sveb2i_121"><p>Si las opciones incluyen 'PlatformEventEnabled' establecido como verdadero, publica un evento de plataforma con los datos de entrada</p></li><li class="list-item" id="1024734388#sveb2i_122"><p>Devuelve los datos de entrada (potencialmente modificados)</p></li></ol></section><section><h3 id="1024734388#invokeprocess" data-toc="invokeprocess#LocalEmisionNotificationHandler.md-invokeprocess">invokeProcess</h3><div class="detached code-block" id="1024734388#sveb2i_123"><pre><code class="language-none">global Map&lt;String, Object&gt; invokeProcess(
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; output,
  Map&lt;String, Object&gt; options
)</code></pre></div><p id="1024734388#sveb2i_124"><span class="control" id="1024734388#sveb2i_130">Descripci&oacute;n:</span> M&eacute;todo principal que orquesta todo el proceso de integraci&oacute;n.</p><p id="1024734388#sveb2i_125"><span class="control" id="1024734388#sveb2i_131">Par&aacute;metros:</span></p><ul class="list" id="1024734388#sveb2i_126" start="1"><li class="list-item" id="1024734388#sveb2i_132"><p><span class="inline-code" id="1024734388#sveb2i_135">input</span>: Datos de entrada para el proceso</p></li><li class="list-item" id="1024734388#sveb2i_133"><p><span class="inline-code" id="1024734388#sveb2i_136">output</span>: Contenedor para los datos de salida</p></li><li class="list-item" id="1024734388#sveb2i_134"><p><span class="inline-code" id="1024734388#sveb2i_137">options</span>: Opciones de configuraci&oacute;n</p></li></ul><p id="1024734388#sveb2i_127"><span class="control" id="1024734388#sveb2i_138">Retorna:</span> Mapa con la respuesta procesada del servicio externo o null en caso de error</p><p id="1024734388#sveb2i_128"><span class="control" id="1024734388#sveb2i_139">Funcionalidad:</span></p><ol class="list list-decimal" id="1024734388#sveb2i_129" type="1" start="1"><li class="list-item" id="1024734388#sveb2i_140"><p>Obtiene la configuraci&oacute;n de integraci&oacute;n desde metadatos personalizados</p></li><li class="list-item" id="1024734388#sveb2i_141"><p>Establece la configuraci&oacute;n para eventos de plataforma</p></li><li class="list-item" id="1024734388#sveb2i_142"><p>Ejecuta el pre-procesamiento de los datos</p></li><li class="list-item" id="1024734388#sveb2i_143"><p>Valida que el producto est&eacute; incluido en los datos de entrada</p></li><li class="list-item" id="1024734388#sveb2i_144"><p>A&ntilde;ade la direcci&oacute;n IP externa de Salesforce a los datos de entrada</p></li><li class="list-item" id="1024734388#sveb2i_145"><p>Estructura la carga &uacute;til en el formato esperado por el servicio</p></li><li class="list-item" id="1024734388#sveb2i_146"><p>Invoca el servicio externo a trav&eacute;s de <span class="inline-code" id="1024734388#sveb2i_150">ExternalNotificationHandler</span></p></li><li class="list-item" id="1024734388#sveb2i_147"><p>Procesa la respuesta y publica un evento de plataforma con los resultados</p></li><li class="list-item" id="1024734388#sveb2i_148"><p>Ejecuta el post-procesamiento de la respuesta</p></li><li class="list-item" id="1024734388#sveb2i_149"><p>Maneja cualquier excepci&oacute;n que ocurra durante el proceso</p></li></ol></section><section><h3 id="1024734388#postprocess" data-toc="postprocess#LocalEmisionNotificationHandler.md-postprocess">postProcess</h3><div class="detached code-block" id="1024734388#sveb2i_151"><pre><code class="language-none">global virtual Map&lt;String, Object&gt; postProcess(
  Map&lt;String, Object&gt; response,
  Map&lt;String, Object&gt; options
)</code></pre></div><p id="1024734388#sveb2i_152"><span class="control" id="1024734388#sveb2i_158">Descripci&oacute;n:</span> M&eacute;todo virtual que realiza el post-procesamiento de la respuesta del servicio.</p><p id="1024734388#sveb2i_153"><span class="control" id="1024734388#sveb2i_159">Par&aacute;metros:</span></p><ul class="list" id="1024734388#sveb2i_154" start="1"><li class="list-item" id="1024734388#sveb2i_160"><p><span class="inline-code" id="1024734388#sveb2i_162">response</span>: Respuesta del servicio externo</p></li><li class="list-item" id="1024734388#sveb2i_161"><p><span class="inline-code" id="1024734388#sveb2i_163">options</span>: Opciones de configuraci&oacute;n</p></li></ul><p id="1024734388#sveb2i_155"><span class="control" id="1024734388#sveb2i_164">Retorna:</span> La respuesta posiblemente modificada</p><p id="1024734388#sveb2i_156"><span class="control" id="1024734388#sveb2i_165">Funcionalidad:</span></p><ol class="list list-decimal" id="1024734388#sveb2i_157" type="1" start="1"><li class="list-item" id="1024734388#sveb2i_166"><p>Registra un mensaje de depuraci&oacute;n</p></li><li class="list-item" id="1024734388#sveb2i_167"><p>Si las opciones incluyen 'PlatformEventEnabled' establecido como verdadero, publica un evento de plataforma con los datos de la respuesta</p></li><li class="list-item" id="1024734388#sveb2i_168"><p>Devuelve la respuesta (potencialmente modificada)</p></li></ol></section><section><h3 id="1024734388#getexternalipaddress" data-toc="getexternalipaddress#LocalEmisionNotificationHandler.md-getexternalipaddress">getExternalIPAddress</h3><div class="detached code-block" id="1024734388#sveb2i_169"><pre><code class="language-none">public static String getExternalIPAddress()</code></pre></div><p id="1024734388#sveb2i_170"><span class="control" id="1024734388#sveb2i_174">Descripci&oacute;n:</span> M&eacute;todo est&aacute;tico que obtiene la direcci&oacute;n IP externa del servidor de Salesforce.</p><p id="1024734388#sveb2i_171"><span class="control" id="1024734388#sveb2i_175">Retorna:</span> String con la direcci&oacute;n IP externa</p><p id="1024734388#sveb2i_172"><span class="control" id="1024734388#sveb2i_176">Funcionalidad:</span></p><ol class="list list-decimal" id="1024734388#sveb2i_173" type="1" start="1"><li class="list-item" id="1024734388#sveb2i_177"><p>Registra los l&iacute;mites actuales a trav&eacute;s de <span class="inline-code" id="1024734388#sveb2i_180">Core.getSymmaryLimits()</span></p></li><li class="list-item" id="1024734388#sveb2i_178"><p>Realiza una llamada HTTP GET al servicio ipify.org</p></li><li class="list-item" id="1024734388#sveb2i_179"><p>Registra y devuelve la respuesta que contiene la direcci&oacute;n IP</p></li></ol></section><section><h3 id="1024734388#publishplatformeventintegration" data-toc="publishplatformeventintegration#LocalEmisionNotificationHandler.md-publishplatformeventintegration">publishPlatformEventIntegration</h3><div class="detached code-block" id="1024734388#sveb2i_181"><pre><code class="language-none">global void publishPlatformEventIntegration(String moment, String data)</code></pre></div><p id="1024734388#sveb2i_182"><span class="control" id="1024734388#sveb2i_187">Descripci&oacute;n:</span> Publica diferentes tipos de eventos de plataforma seg&uacute;n el momento del proceso.</p><p id="1024734388#sveb2i_183"><span class="control" id="1024734388#sveb2i_188">Par&aacute;metros:</span></p><ul class="list" id="1024734388#sveb2i_184" start="1"><li class="list-item" id="1024734388#sveb2i_189"><p><span class="inline-code" id="1024734388#sveb2i_191">moment</span>: Momento del proceso ('pre', 'post', 'in')</p></li><li class="list-item" id="1024734388#sveb2i_190"><p><span class="inline-code" id="1024734388#sveb2i_192">data</span>: Datos a incluir en el evento</p></li></ul><p id="1024734388#sveb2i_185"><span class="control" id="1024734388#sveb2i_193">Funcionalidad:</span> Utiliza un switch para determinar qu&eacute; tipo de evento publicar:</p><ul class="list" id="1024734388#sveb2i_186" start="1"><li class="list-item" id="1024734388#sveb2i_194"><p>'pre': Publica un evento de pre-proceso inicial</p></li><li class="list-item" id="1024734388#sveb2i_195"><p>'post': Publica un evento de post-proceso inicial</p></li><li class="list-item" id="1024734388#sveb2i_196"><p>'in': Publica un evento general con c&oacute;digo de estado 200</p></li></ul></section></section><section><h2 id="1024734388#flujo-de-trabajo-principal" data-toc="flujo-de-trabajo-principal#LocalEmisionNotificationHandler.md-flujo-de-trabajo-principal">Flujo de Trabajo Principal</h2><ol class="list list-decimal" id="1024734388#sveb2i_197" type="1" start="1"><li class="list-item" id="1024734388#sveb2i_198"><p>La clase puede ser instanciada y ejecutada como un trabajo en cola (Queueable)</p></li><li class="list-item" id="1024734388#sveb2i_199"><p>Cuando se ejecuta, sigue un patr&oacute;n de pre-proceso &rarr; proceso principal &rarr; post-proceso</p></li><li class="list-item" id="1024734388#sveb2i_200"><p>Durante el proceso principal: </p><ul class="list" id="1024734388#sveb2i_201" start="1"><li class="list-item" id="1024734388#sveb2i_202"><p>Obtiene configuraci&oacute;n desde metadatos personalizados</p></li><li class="list-item" id="1024734388#sveb2i_203"><p>Valida los datos de entrada</p></li><li class="list-item" id="1024734388#sveb2i_204"><p>Enriquece los datos con informaci&oacute;n adicional (como la IP externa)</p></li><li class="list-item" id="1024734388#sveb2i_205"><p>Realiza llamadas a servicios externos</p></li><li class="list-item" id="1024734388#sveb2i_206"><p>Maneja las respuestas y las excepciones</p></li></ul></li></ol></section><section><h2 id="1024734388#integraci-n-con-eventos-de-plataforma" data-toc="integraci-n-con-eventos-de-plataforma#LocalEmisionNotificationHandler.md-integraci-n-con-eventos-de-plataforma">Integraci&oacute;n con Eventos de Plataforma</h2><p id="1024734388#sveb2i_207">La clase utiliza eventos de plataforma para registrar y comunicar diferentes etapas del proceso de integraci&oacute;n:</p><ul class="list" id="1024734388#sveb2i_208" start="1"><li class="list-item" id="1024734388#sveb2i_209"><p>Eventos de pre-proceso ('pre')</p></li><li class="list-item" id="1024734388#sveb2i_210"><p>Eventos durante el proceso ('in')</p></li><li class="list-item" id="1024734388#sveb2i_211"><p>Eventos de post-proceso ('post')</p></li></ul></section><section><h2 id="1024734388#dependencias" data-toc="dependencias#LocalEmisionNotificationHandler.md-dependencias">Dependencias</h2><ul class="list" id="1024734388#sveb2i_212" start="1"><li class="list-item" id="1024734388#sveb2i_213"><p><span class="inline-code" id="1024734388#sveb2i_217">PlatformEventIntegrationObserver</span>: Clase base que proporciona funcionalidad para eventos de plataforma</p></li><li class="list-item" id="1024734388#sveb2i_214"><p><span class="inline-code" id="1024734388#sveb2i_218">ExternalNotificationHandler</span>: Clase para interactuar con servicios externos</p></li><li class="list-item" id="1024734388#sveb2i_215"><p><span class="inline-code" id="1024734388#sveb2i_219">Core</span>: Clase de utilidad para depuraci&oacute;n y registro</p></li><li class="list-item" id="1024734388#sveb2i_216"><p><span class="inline-code" id="1024734388#sveb2i_220">SF_IntegrationSetting__mdt</span>: Metadatos personalizados para configuraci&oacute;n de integraci&oacute;n</p></li></ul></section><section><h2 id="1024734388#casos-de-uso" data-toc="casos-de-uso#LocalEmisionNotificationHandler.md-casos-de-uso">Casos de Uso</h2><p id="1024734388#sveb2i_221">Esta clase se utiliza principalmente para:</p><ol class="list list-decimal" id="1024734388#sveb2i_222" type="1" start="1"><li class="list-item" id="1024734388#sveb2i_223"><p>Enviar notificaciones sobre emisiones locales a servicios externos</p></li><li class="list-item" id="1024734388#sveb2i_224"><p>Integrar Salesforce con sistemas externos para la emisi&oacute;n de p&oacute;lizas o documentos</p></li><li class="list-item" id="1024734388#sveb2i_225"><p>Proporcionar un flujo de trabajo as&iacute;ncrono para operaciones de integraci&oacute;n que pueden tomar tiempo</p></li></ol></section><section><h2 id="1024734388#consideraciones-y-mejores-pr-cticas" data-toc="consideraciones-y-mejores-pr-cticas#LocalEmisionNotificationHandler.md-consideraciones-y-mejores-pr-cticas">Consideraciones y Mejores Pr&aacute;cticas</h2><ul class="list" id="1024734388#sveb2i_226" start="1"><li class="list-item" id="1024734388#sveb2i_227"><p>La clase est&aacute; dise&ntilde;ada para ser extendida (virtual), permitiendo personalizar el comportamiento en clases derivadas</p></li><li class="list-item" id="1024734388#sveb2i_228"><p>Utiliza un patr&oacute;n as&iacute;ncrono para evitar problemas de l&iacute;mites de tiempo en Salesforce</p></li><li class="list-item" id="1024734388#sveb2i_229"><p>Implementa manejo de excepciones para garantizar que los errores sean registrados adecuadamente</p></li><li class="list-item" id="1024734388#sveb2i_230"><p>Usa eventos de plataforma para proporcionar visibilidad sobre el proceso de integraci&oacute;n</p></li><li class="list-item" id="1024734388#sveb2i_231"><p>El nombre de configuraci&oacute;n de metadatos sugiere variantes para diferentes productos (comentario indica &quot;_Arrendamientos, _Viajes, _Autos, _Motos&quot;)</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-277013134">IntegrationProcedureExecutor</h1><section><h2 id="-277013134#descripci-n-general" data-toc="descripci-n-general#IntegrationProcedureExecutor.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-277013134#-d1i4au_16"><span class="inline-code" id="-277013134#-d1i4au_17">IntegrationProcedureExecutor</span> es una interfaz global que define el contrato para la ejecuci&oacute;n de procedimientos de integraci&oacute;n. Esta interfaz establece un m&eacute;todo est&aacute;ndar para invocar procedimientos de integraci&oacute;n con par&aacute;metros de entrada y obtener resultados estructurados.</p></section><section><h2 id="-277013134#autor" data-toc="autor#IntegrationProcedureExecutor.md-autor">Autor</h2><p id="-277013134#-d1i4au_18">Jean Carlos Melendez</p></section><section><h2 id="-277013134#ltima-modificaci-n" data-toc="ltima-modificaci-n#IntegrationProcedureExecutor.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="-277013134#-d1i4au_19">28 de enero de 2025</p></section><section><h2 id="-277013134#definici-n-de-la-interfaz" data-toc="definici-n-de-la-interfaz#IntegrationProcedureExecutor.md-definici-n-de-la-interfaz">Definici&oacute;n de la Interfaz</h2><div class="detached code-block" id="-277013134#-d1i4au_20"><pre><code class="language-none">global interface IntegrationProcedureExecutor {
  Map&lt;String, Object&gt; execute(String procedureName, Map&lt;String, Object&gt; input);
}</code></pre></div></section><section><h2 id="-277013134#m-todos" data-toc="m-todos#IntegrationProcedureExecutor.md-m-todos">M&eacute;todos</h2><section><h3 id="-277013134#execute-string-procedurename-map-string-object-input" data-toc="execute-string-procedurename-map-string-object-input#IntegrationProcedureExecutor.md-execute-string-procedurename-map-string-object-input">execute(String procedureName, Map&lt;String, Object&gt; input)</h3><section><h4 id="-277013134#descripci-n" data-toc="descripci-n#IntegrationProcedureExecutor.md-descripci-n">Descripci&oacute;n</h4><p id="-277013134#-d1i4au_27">Este m&eacute;todo ejecuta un procedimiento de integraci&oacute;n especificado, pasando los par&aacute;metros de entrada proporcionados y devolviendo los resultados del procedimiento.</p></section><section><h4 id="-277013134#par-metros" data-toc="par-metros#IntegrationProcedureExecutor.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-277013134#-d1i4au_28" start="1"><li class="list-item" id="-277013134#-d1i4au_29"><p><span class="inline-code" id="-277013134#-d1i4au_31">procedureName</span> (String): Nombre del procedimiento de integraci&oacute;n a ejecutar.</p></li><li class="list-item" id="-277013134#-d1i4au_30"><p><span class="inline-code" id="-277013134#-d1i4au_32">input</span> (Map&lt;String, Object&gt;): Mapa con los par&aacute;metros de entrada para el procedimiento.</p></li></ul></section><section><h4 id="-277013134#retorno" data-toc="retorno#IntegrationProcedureExecutor.md-retorno">Retorno</h4><ul class="list" id="-277013134#-d1i4au_33" start="1"><li class="list-item" id="-277013134#-d1i4au_34"><p><span class="inline-code" id="-277013134#-d1i4au_35">Map&lt;String, Object&gt;</span>: Mapa con los resultados del procedimiento de integraci&oacute;n.</p></li></ul></section></section></section><section><h2 id="-277013134#prop-sito-y-aplicaciones" data-toc="prop-sito-y-aplicaciones#IntegrationProcedureExecutor.md-prop-sito-y-aplicaciones">Prop&oacute;sito y Aplicaciones</h2><p id="-277013134#-d1i4au_36">El prop&oacute;sito principal de esta interfaz es proporcionar una abstracci&oacute;n para la ejecuci&oacute;n de procedimientos de integraci&oacute;n, ofreciendo:</p><ol class="list list-decimal" id="-277013134#-d1i4au_37" type="1" start="1"><li class="list-item" id="-277013134#-d1i4au_40"><p><span class="control" id="-277013134#-d1i4au_44">Desacoplamiento</span>: Separar el c&oacute;digo que necesita invocar procedimientos de integraci&oacute;n de la implementaci&oacute;n espec&iacute;fica de c&oacute;mo se ejecutan estos procedimientos.</p></li><li class="list-item" id="-277013134#-d1i4au_41"><p><span class="control" id="-277013134#-d1i4au_45">Flexibilidad</span>: Permitir m&uacute;ltiples implementaciones para diferentes contextos (por ejemplo, producci&oacute;n, pruebas, mock).</p></li><li class="list-item" id="-277013134#-d1i4au_42"><p><span class="control" id="-277013134#-d1i4au_46">Consistencia</span>: Establecer un contrato est&aacute;ndar para la ejecuci&oacute;n de procedimientos de integraci&oacute;n en toda la aplicaci&oacute;n.</p></li><li class="list-item" id="-277013134#-d1i4au_43"><p><span class="control" id="-277013134#-d1i4au_47">Testabilidad</span>: Facilitar la creaci&oacute;n de mocks para pruebas unitarias.</p></li></ol><p id="-277013134#-d1i4au_38">Esta interfaz es especialmente &uacute;til en escenarios como:</p><ul class="list" id="-277013134#-d1i4au_39" start="1"><li class="list-item" id="-277013134#-d1i4au_48"><p><span class="control" id="-277013134#-d1i4au_52">Sistemas de Integraci&oacute;n</span>: Facilitar la comunicaci&oacute;n con sistemas externos a trav&eacute;s de procedimientos de integraci&oacute;n estandarizados.</p></li><li class="list-item" id="-277013134#-d1i4au_49"><p><span class="control" id="-277013134#-d1i4au_53">Orquestaci&oacute;n de Procesos</span>: Coordinar diferentes pasos en flujos de trabajo complejos que pueden involucrar m&uacute;ltiples sistemas.</p></li><li class="list-item" id="-277013134#-d1i4au_50"><p><span class="control" id="-277013134#-d1i4au_54">Abstracci&oacute;n de Detalles T&eacute;cnicos</span>: Ocultar los detalles espec&iacute;ficos de c&oacute;mo se ejecutan los procedimientos de integraci&oacute;n a los componentes que los utilizan.</p></li><li class="list-item" id="-277013134#-d1i4au_51"><p><span class="control" id="-277013134#-d1i4au_55">Cambio de Implementaciones</span>: Permitir cambiar la forma en que se ejecutan los procedimientos de integraci&oacute;n sin afectar a los componentes que los invocan.</p></li></ul></section><section><h2 id="-277013134#ejemplos-de-implementaci-n" data-toc="ejemplos-de-implementaci-n#IntegrationProcedureExecutor.md-ejemplos-de-implementaci-n">Ejemplos de Implementaci&oacute;n</h2><section><h3 id="-277013134#implementaci-n-para-omniscript-integration-procedures-de-vlocity" data-toc="implementaci-n-para-omniscript-integration-procedures-de-vlocity#IntegrationProcedureExecutor.md-implementaci-n-para-omniscript-integration-procedures-de-vlocity">Implementaci&oacute;n para OmniScript/Integration Procedures de Vlocity</h3><div class="detached code-block" id="-277013134#-d1i4au_59"><pre><code class="language-none">global class VlocityIntegrationProcedureExecutor implements IntegrationProcedureExecutor {
    
    global Map&lt;String, Object&gt; execute(String procedureName, Map&lt;String, Object&gt; input) {
        try {
            // Inicializar el resultado
            Map&lt;String, Object&gt; result = new Map&lt;String, Object&gt;();
            
            // Verificar parámetros
            if (String.isBlank(procedureName)) {
                throw new IntegrationProcedureException('El nombre del procedimiento no puede estar vacío');
            }
            
            if (input == null) {
                input = new Map&lt;String, Object&gt;();
            }
            
            // Crear la petición para el procedimiento de integración de Vlocity
            Map&lt;String, Object&gt; request = new Map&lt;String, Object&gt;{
                'procedureName' =&gt; procedureName,
                'input' =&gt; input
            };
            
            // Invocar el procedimiento de integración a través de la API de Vlocity
            Map&lt;String, Object&gt; response = (Map&lt;String, Object&gt;) vlocity_ins.IntegrationProcedureService.runIntegrationProcedureQueueable(
                procedureName, 
                input
            );
            
            // Verificar la respuesta
            if (response == null) {
                throw new IntegrationProcedureException('No se recibió respuesta del procedimiento de integración');
            }
            
            return response;
        } catch (Exception e) {
            System.debug(LoggingLevel.ERROR, 'Error ejecutando procedimiento de integración: ' + procedureName + '. Error: ' + e.getMessage());
            throw new IntegrationProcedureException('Error ejecutando procedimiento: ' + e.getMessage(), e);
        }
    }
    
    // Clase de excepción personalizada
    global class IntegrationProcedureException extends Exception {}
}</code></pre></div></section><section><h3 id="-277013134#implementaci-n-a-trav-s-de-remote-actions" data-toc="implementaci-n-a-trav-s-de-remote-actions#IntegrationProcedureExecutor.md-implementaci-n-a-trav-s-de-remote-actions">Implementaci&oacute;n a trav&eacute;s de Remote Actions</h3><div class="detached code-block" id="-277013134#-d1i4au_60"><pre><code class="language-none">global class RemoteActionIntegrationProcedureExecutor implements IntegrationProcedureExecutor {
    
    global Map&lt;String, Object&gt; execute(String procedureName, Map&lt;String, Object&gt; input) {
        try {
            // Validar parámetros
            if (String.isBlank(procedureName)) {
                throw new IntegrationProcedureException('El nombre del procedimiento no puede estar vacío');
            }
            
            if (input == null) {
                input = new Map&lt;String, Object&gt;();
            }
            
            // Preparar parámetros para Remote Action
            String namespace = 'vlocity_ins';
            String classname = 'IntegrationProcedureService';
            String methodName = 'invokeIntegrationProcedure';
            String options = '{}';
            
            // Convertir el mapa de entrada a JSON
            String inputJson = JSON.serialize(input);
            
            // Invocar Remote Action
            Object result = vlocity_ins.RemoteActionController.invokeMethod(
                namespace, 
                classname, 
                methodName, 
                procedureName, 
                inputJson, 
                options
            );
            
            // Procesar resultado
            if (result == null) {
                return new Map&lt;String, Object&gt;();
            }
            
            // Convertir el resultado a un mapa
            Map&lt;String, Object&gt; resultMap;
            if (result instanceof String) {
                resultMap = (Map&lt;String, Object&gt;) JSON.deserializeUntyped((String) result);
            } else if (result instanceof Map&lt;String, Object&gt;) {
                resultMap = (Map&lt;String, Object&gt;) result;
            } else {
                throw new IntegrationProcedureException('Resultado inesperado del tipo: ' + result.getClass().getName());
            }
            
            return resultMap;
        } catch (Exception e) {
            System.debug(LoggingLevel.ERROR, 'Error ejecutando procedimiento de integración: ' + procedureName + '. Error: ' + e.getMessage());
            throw new IntegrationProcedureException('Error ejecutando procedimiento: ' + e.getMessage(), e);
        }
    }
    
    // Clase de excepción personalizada
    global class IntegrationProcedureException extends Exception {}
}</code></pre></div></section><section><h3 id="-277013134#implementaci-n-mock-para-pruebas" data-toc="implementaci-n-mock-para-pruebas#IntegrationProcedureExecutor.md-implementaci-n-mock-para-pruebas">Implementaci&oacute;n Mock para Pruebas</h3><div class="detached code-block" id="-277013134#-d1i4au_61"><pre><code class="language-none">@IsTest
global class MockIntegrationProcedureExecutor implements IntegrationProcedureExecutor {
    
    // Mapa para almacenar respuestas mockificadas por nombre de procedimiento
    private static Map&lt;String, Map&lt;String, Object&gt;&gt; mockResponses = new Map&lt;String, Map&lt;String, Object&gt;&gt;();
    
    // Bandera para simular errores
    private static Boolean throwError = false;
    private static String errorMessage = 'Error simulado en procedimiento de integración';
    
    global Map&lt;String, Object&gt; execute(String procedureName, Map&lt;String, Object&gt; input) {
        // Registrar la llamada para verificación en las pruebas
        recordExecution(procedureName, input);
        
        // Simular error si está configurado
        if (throwError) {
            throw new IntegrationProcedureException(errorMessage);
        }
        
        // Devolver respuesta mockificada si existe
        if (mockResponses.containsKey(procedureName)) {
            return mockResponses.get(procedureName);
        }
        
        // Respuesta por defecto
        return new Map&lt;String, Object&gt;{
            'success' =&gt; true,
            'procedureName' =&gt; procedureName,
            'mockInput' =&gt; input,
            'result' =&gt; 'Mock result for ' + procedureName
        };
    }
    
    // Métodos para configurar el comportamiento del mock
    
    global static void setMockResponse(String procedureName, Map&lt;String, Object&gt; response) {
        mockResponses.put(procedureName, response);
    }
    
    global static void clearMockResponses() {
        mockResponses.clear();
    }
    
    global static void setThrowError(Boolean shouldThrow, String message) {
        throwError = shouldThrow;
        if (String.isNotBlank(message)) {
            errorMessage = message;
        }
    }
    
    // Registro de ejecuciones para verificación en pruebas
    private static List&lt;ExecutionRecord&gt; executionRecords = new List&lt;ExecutionRecord&gt;();
    
    private void recordExecution(String procedureName, Map&lt;String, Object&gt; input) {
        executionRecords.add(new ExecutionRecord(procedureName, input));
    }
    
    global static List&lt;ExecutionRecord&gt; getExecutionRecords() {
        return executionRecords;
    }
    
    global static void clearExecutionRecords() {
        executionRecords.clear();
    }
    
    // Clase interna para registrar ejecuciones
    global class ExecutionRecord {
        public String procedureName;
        public Map&lt;String, Object&gt; input;
        
        public ExecutionRecord(String procedureName, Map&lt;String, Object&gt; input) {
            this.procedureName = procedureName;
            this.input = input;
        }
    }
    
    // Clase de excepción personalizada
    global class IntegrationProcedureException extends Exception {}
}</code></pre></div></section></section><section><h2 id="-277013134#ejemplo-de-uso" data-toc="ejemplo-de-uso#IntegrationProcedureExecutor.md-ejemplo-de-uso">Ejemplo de Uso</h2><section><h3 id="-277013134#uso-b-sico-en-un-servicio" data-toc="uso-b-sico-en-un-servicio#IntegrationProcedureExecutor.md-uso-b-sico-en-un-servicio">Uso B&aacute;sico en un Servicio</h3><div class="detached code-block" id="-277013134#-d1i4au_65"><pre><code class="language-none">public class QuotingService {
    
    private final IntegrationProcedureExecutor ipExecutor;
    
    // Constructor con inyección de dependencia
    public QuotingService(IntegrationProcedureExecutor ipExecutor) {
        this.ipExecutor = ipExecutor;
    }
    
    // Constructor sin parámetros para uso general
    public QuotingService() {
        this.ipExecutor = new VlocityIntegrationProcedureExecutor();
    }
    
    // Método para calcular prima de un producto
    public Map&lt;String, Object&gt; calculatePremium(String productCode, Map&lt;String, Object&gt; customerData) {
        try {
            // Preparar los datos de entrada
            Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
                'productCode' =&gt; productCode,
                'customerData' =&gt; customerData,
                'calculationDate' =&gt; System.now()
            };
            
            // Ejecutar el procedimiento de integración
            Map&lt;String, Object&gt; result = ipExecutor.execute('CalculatePremium', input);
            
            // Procesar y validar resultados
            if (!result.containsKey('premium')) {
                throw new QuotingException('La respuesta del cálculo de prima no contiene el campo &quot;premium&quot;');
            }
            
            return result;
        } catch (Exception e) {
            throw new QuotingException('Error al calcular prima: ' + e.getMessage(), e);
        }
    }
    
    // Clase de excepción personalizada
    public class QuotingException extends Exception {}
}</code></pre></div></section><section><h3 id="-277013134#uso-con-factory-para-obtener-la-implementaci-n-adecuada" data-toc="uso-con-factory-para-obtener-la-implementaci-n-adecuada#IntegrationProcedureExecutor.md-uso-con-factory-para-obtener-la-implementaci-n-adecuada">Uso con Factory para Obtener la Implementaci&oacute;n Adecuada</h3><div class="detached code-block" id="-277013134#-d1i4au_66"><pre><code class="language-none">public class IntegrationProcedureExecutorFactory {
    
    // Singleton instance
    private static IntegrationProcedureExecutorFactory instance;
    
    // Obtener instancia singleton
    public static IntegrationProcedureExecutorFactory getInstance() {
        if (instance == null) {
            instance = new IntegrationProcedureExecutorFactory();
        }
        return instance;
    }
    
    // Obtener el ejecutor adecuado basado en configuración o contexto
    public IntegrationProcedureExecutor getExecutor() {
        // En un entorno de prueba, usar el mock
        if (Test.isRunningTest()) {
            return new MockIntegrationProcedureExecutor();
        }
        
        // Verificar si se debe usar una implementación alternativa
        SF_IntegrationConfig__mdt config = SF_IntegrationConfig__mdt.getInstance('IPExecutorConfig');
        if (config != null &amp;&amp; String.isNotBlank(config.AlternativeImplementation__c)) {
            return (IntegrationProcedureExecutor)Type.forName(config.AlternativeImplementation__c).newInstance();
        }
        
        // Por defecto, usar la implementación estándar
        return new VlocityIntegrationProcedureExecutor();
    }
}

// Uso con factory
public class RatingService {
    
    public Map&lt;String, Object&gt; rateProduct(String productId, Map&lt;String, Object&gt; ratingFactors) {
        IntegrationProcedureExecutor executor = IntegrationProcedureExecutorFactory.getInstance().getExecutor();
        
        Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
            'productId' =&gt; productId,
            'ratingFactors' =&gt; ratingFactors
        };
        
        return executor.execute('RateProduct', input);
    }
}</code></pre></div></section><section><h3 id="-277013134#uso-en-pruebas-unitarias" data-toc="uso-en-pruebas-unitarias#IntegrationProcedureExecutor.md-uso-en-pruebas-unitarias">Uso en Pruebas Unitarias</h3><div class="detached code-block" id="-277013134#-d1i4au_67"><pre><code class="language-none">@IsTest
private class QuotingServiceTest {
    
    @IsTest
    static void testCalculatePremium() {
        // Configurar el mock
        MockIntegrationProcedureExecutor mockExecutor = new MockIntegrationProcedureExecutor();
        
        // Configurar respuesta esperada
        Map&lt;String, Object&gt; mockResponse = new Map&lt;String, Object&gt;{
            'premium' =&gt; 1200.50,
            'discounts' =&gt; new Map&lt;String, Object&gt;{
                'goodDriver' =&gt; 100.00,
                'multiPolicy' =&gt; 50.00
            },
            'totalPremium' =&gt; 1050.50,
            'currency' =&gt; 'USD'
        };
        
        MockIntegrationProcedureExecutor.setMockResponse('CalculatePremium', mockResponse);
        
        // Crear instancia del servicio con el mock
        QuotingService service = new QuotingService(mockExecutor);
        
        // Preparar datos de prueba
        String productCode = 'AUTO-001';
        Map&lt;String, Object&gt; customerData = new Map&lt;String, Object&gt;{
            'age' =&gt; 35,
            'vehicleValue' =&gt; 25000,
            'drivingHistory' =&gt; 'Clean'
        };
        
        // Ejecutar el método a probar
        Test.startTest();
        Map&lt;String, Object&gt; result = service.calculatePremium(productCode, customerData);
        Test.stopTest();
        
        // Verificar resultados
        System.assertEquals(1200.50, result.get('premium'), 'Premium should match mock value');
        System.assertEquals(1050.50, result.get('totalPremium'), 'Total premium should match mock value');
        System.assertEquals('USD', result.get('currency'), 'Currency should match mock value');
        
        // Verificar que se llamó al procedimiento correcto con los parámetros esperados
        List&lt;MockIntegrationProcedureExecutor.ExecutionRecord&gt; executions = MockIntegrationProcedureExecutor.getExecutionRecords();
        System.assertEquals(1, executions.size(), 'Should have executed exactly one procedure');
        System.assertEquals('CalculatePremium', executions[0].procedureName, 'Should have called the correct procedure');
        System.assertEquals(productCode, executions[0].input.get('productCode'), 'Should have passed the correct product code');
    }
    
    @IsTest
    static void testCalculatePremiumError() {
        // Configurar el mock para lanzar error
        MockIntegrationProcedureExecutor mockExecutor = new MockIntegrationProcedureExecutor();
        MockIntegrationProcedureExecutor.setThrowError(true, 'Error de cálculo simulado');
        
        // Crear instancia del servicio con el mock
        QuotingService service = new QuotingService(mockExecutor);
        
        // Preparar datos de prueba
        String productCode = 'AUTO-001';
        Map&lt;String, Object&gt; customerData = new Map&lt;String, Object&gt;{
            'age' =&gt; 35,
            'vehicleValue' =&gt; 25000
        };
        
        // Ejecutar el método y verificar que se lance la excepción esperada
        Test.startTest();
        try {
            service.calculatePremium(productCode, customerData);
            System.assert(false, 'Should have thrown an exception');
        } catch (QuotingService.QuotingException e) {
            System.assert(e.getMessage().contains('Error de cálculo simulado'), 'Exception should contain the mock error message');
        }
        Test.stopTest();
    }
}</code></pre></div></section></section><section><h2 id="-277013134#consideraciones-de-dise-o" data-toc="consideraciones-de-dise-o#IntegrationProcedureExecutor.md-consideraciones-de-dise-o">Consideraciones de Dise&ntilde;o</h2><section><h3 id="-277013134#ventajas" data-toc="ventajas#IntegrationProcedureExecutor.md-ventajas">Ventajas</h3><ol class="list list-decimal" id="-277013134#-d1i4au_70" type="1" start="1"><li class="list-item" id="-277013134#-d1i4au_71"><p><span class="control" id="-277013134#-d1i4au_75">Desacoplamiento</span>: Los componentes que necesitan ejecutar procedimientos de integraci&oacute;n no dependen de una implementaci&oacute;n espec&iacute;fica.</p></li><li class="list-item" id="-277013134#-d1i4au_72"><p><span class="control" id="-277013134#-d1i4au_76">Flexibilidad</span>: Se pueden crear diferentes implementaciones para diferentes contextos o requisitos.</p></li><li class="list-item" id="-277013134#-d1i4au_73"><p><span class="control" id="-277013134#-d1i4au_77">Testabilidad</span>: Facilita la creaci&oacute;n de mocks para pruebas unitarias.</p></li><li class="list-item" id="-277013134#-d1i4au_74"><p><span class="control" id="-277013134#-d1i4au_78">Consistencia</span>: Proporciona un contrato est&aacute;ndar para la ejecuci&oacute;n de procedimientos de integraci&oacute;n.</p></li></ol></section><section><h3 id="-277013134#desaf-os" data-toc="desaf-os#IntegrationProcedureExecutor.md-desaf-os">Desaf&iacute;os</h3><ol class="list list-decimal" id="-277013134#-d1i4au_79" type="1" start="1"><li class="list-item" id="-277013134#-d1i4au_80"><p><span class="control" id="-277013134#-d1i4au_83">Manejo de Errores</span>: Las implementaciones deben proporcionar un manejo coherente de errores para mantener un comportamiento predecible.</p></li><li class="list-item" id="-277013134#-d1i4au_81"><p><span class="control" id="-277013134#-d1i4au_84">Tipado Din&aacute;mico</span>: El uso de <span class="inline-code" id="-277013134#-d1i4au_85">Map&lt;String, Object&gt;</span> proporciona flexibilidad pero requiere verificaciones adicionales de tipo en tiempo de ejecuci&oacute;n.</p></li><li class="list-item" id="-277013134#-d1i4au_82"><p><span class="control" id="-277013134#-d1i4au_86">Sincronizaci&oacute;n</span>: La interfaz actual es s&iacute;ncrona, lo que podr&iacute;a no ser adecuado para procedimientos de larga duraci&oacute;n.</p></li></ol></section></section><section><h2 id="-277013134#patrones-de-dise-o-relacionados" data-toc="patrones-de-dise-o-relacionados#IntegrationProcedureExecutor.md-patrones-de-dise-o-relacionados">Patrones de Dise&ntilde;o Relacionados</h2><section><h3 id="-277013134#inyecci-n-de-dependencias" data-toc="inyecci-n-de-dependencias#IntegrationProcedureExecutor.md-inyecci-n-de-dependencias">Inyecci&oacute;n de Dependencias</h3><p id="-277013134#-d1i4au_91">La interfaz <span class="inline-code" id="-277013134#-d1i4au_92">IntegrationProcedureExecutor</span> facilita la inyecci&oacute;n de dependencias, permitiendo que los componentes reciban la implementaci&oacute;n espec&iacute;fica a trav&eacute;s de constructores o setters.</p></section><section><h3 id="-277013134#estrategia-strategy" data-toc="estrategia-strategy#IntegrationProcedureExecutor.md-estrategia-strategy">Estrategia (Strategy)</h3><p id="-277013134#-d1i4au_93">Permite definir una familia de algoritmos (diferentes formas de ejecutar procedimientos de integraci&oacute;n), encapsularlos y hacerlos intercambiables.</p></section><section><h3 id="-277013134#f-brica-factory" data-toc="f-brica-factory#IntegrationProcedureExecutor.md-f-brica-factory">F&aacute;brica (Factory)</h3><p id="-277013134#-d1i4au_94">Puede utilizarse junto con un patr&oacute;n de f&aacute;brica para proporcionar la implementaci&oacute;n adecuada basada en el contexto.</p></section><section><h3 id="-277013134#adaptador-adapter" data-toc="adaptador-adapter#IntegrationProcedureExecutor.md-adaptador-adapter">Adaptador (Adapter)</h3><p id="-277013134#-d1i4au_95">Algunas implementaciones pueden actuar como adaptadores, permitiendo que diferentes sistemas de procedimientos de integraci&oacute;n se utilicen de manera uniforme.</p></section></section><section><h2 id="-277013134#relaci-n-con-otras-interfaces-y-clases" data-toc="relaci-n-con-otras-interfaces-y-clases#IntegrationProcedureExecutor.md-relaci-n-con-otras-interfaces-y-clases">Relaci&oacute;n con Otras Interfaces y Clases</h2><p id="-277013134#-d1i4au_96">Esta interfaz est&aacute; relacionada y es utilizada por varias clases en el sistema, como:</p><ol class="list list-decimal" id="-277013134#-d1i4au_97" type="1" start="1"><li class="list-item" id="-277013134#-d1i4au_98"><p><span class="control" id="-277013134#-d1i4au_101">QuoteProductHandler</span>: Utiliza un <span class="inline-code" id="-277013134#-d1i4au_102">IntegrationProcedureExecutor</span> para ejecutar procedimientos relacionados con cotizaciones.</p></li><li class="list-item" id="-277013134#-d1i4au_99"><p><span class="control" id="-277013134#-d1i4au_103">IssueProductHandler</span>: Emplea un ejecutor para gestionar la emisi&oacute;n de productos.</p></li><li class="list-item" id="-277013134#-d1i4au_100"><p><span class="control" id="-277013134#-d1i4au_104">MockIntegrationProcedureExecutor</span>: Implementaci&oacute;n de prueba que simula la ejecuci&oacute;n de procedimientos de integraci&oacute;n.</p></li></ol></section><section><h2 id="-277013134#mejores-pr-cticas" data-toc="mejores-pr-cticas#IntegrationProcedureExecutor.md-mejores-pr-cticas">Mejores Pr&aacute;cticas</h2><ol class="list list-decimal" id="-277013134#-d1i4au_105" type="1" start="1"><li class="list-item" id="-277013134#-d1i4au_106"><p><span class="control" id="-277013134#-d1i4au_111">Manejo Adecuado de Errores</span>: Implementar un manejo robusto de errores en todas las implementaciones.</p></li><li class="list-item" id="-277013134#-d1i4au_107"><p><span class="control" id="-277013134#-d1i4au_112">Registro de Actividad</span>: Incluir registro de actividad para facilitar el seguimiento y la depuraci&oacute;n.</p></li><li class="list-item" id="-277013134#-d1i4au_108"><p><span class="control" id="-277013134#-d1i4au_113">Validaci&oacute;n de Par&aacute;metros</span>: Validar los par&aacute;metros de entrada para evitar errores inesperados.</p></li><li class="list-item" id="-277013134#-d1i4au_109"><p><span class="control" id="-277013134#-d1i4au_114">Implementaciones con Cach&eacute;</span>: Considerar la implementaci&oacute;n de mecanismos de cach&eacute; para procedimientos frecuentemente utilizados.</p></li><li class="list-item" id="-277013134#-d1i4au_110"><p><span class="control" id="-277013134#-d1i4au_115">Timeout y Reintentos</span>: Implementar mecanismos de timeout y reintentos para manejar situaciones de fallo transitorio.</p></li></ol></section><section><h2 id="-277013134#notas-adicionales" data-toc="notas-adicionales#IntegrationProcedureExecutor.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-277013134#-d1i4au_116" type="1" start="1"><li class="list-item" id="-277013134#-d1i4au_117"><p>Esta interfaz est&aacute; marcada como <span class="inline-code" id="-277013134#-d1i4au_121">global</span>, lo que indica que est&aacute; dise&ntilde;ada para ser accesible desde diferentes paquetes o namespaces.</p></li><li class="list-item" id="-277013134#-d1i4au_118"><p>El uso de mapas gen&eacute;ricos (<span class="inline-code" id="-277013134#-d1i4au_122">Map&lt;String, Object&gt;</span>) proporciona flexibilidad pero requiere un manejo cuidadoso de los tipos en tiempo de ejecuci&oacute;n.</p></li><li class="list-item" id="-277013134#-d1i4au_119"><p>Esta interfaz forma parte de un sistema m&aacute;s amplio para la integraci&oacute;n y orquestaci&oacute;n de procesos, trabajando en conjunto con otras interfaces y clases.</p></li><li class="list-item" id="-277013134#-d1i4au_120"><p>Para procedimientos de larga duraci&oacute;n, podr&iacute;a ser necesario considerar una variante as&iacute;ncrona de esta interfaz.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1356896840">InsServiceAdapter</h1><section><h2 id="1356896840#descripci-n-general" data-toc="descripci-n-general#InsServiceAdapter.md-descripci-n-general">Descripci&oacute;n General</h2><p id="1356896840#gqw4dy_18"><span class="inline-code" id="1356896840#gqw4dy_19">InsServiceAdapter</span> es una clase que implementa la interfaz <span class="inline-code" id="1356896840#gqw4dy_20">Adapter</span> y proporciona funcionalidad para interactuar con servicios de Vlocity Insurance. Esta clase act&uacute;a como un adaptador que facilita la comunicaci&oacute;n entre el sistema Salesforce y los servicios de seguros externos, espec&iacute;ficamente para acceder a productos calificados (rated products).</p></section><section><h2 id="1356896840#autor" data-toc="autor#InsServiceAdapter.md-autor">Autor</h2><p id="1356896840#gqw4dy_21">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="1356896840#ltima-modificaci-n" data-toc="ltima-modificaci-n#InsServiceAdapter.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="1356896840#gqw4dy_22">2 de septiembre de 2024</p></section><section><h2 id="1356896840#decoradores-y-accesibilidad" data-toc="decoradores-y-accesibilidad#InsServiceAdapter.md-decoradores-y-accesibilidad">Decoradores y Accesibilidad</h2><p id="1356896840#gqw4dy_23">La clase est&aacute; marcada con <span class="inline-code" id="1356896840#gqw4dy_24">@namespaceAccessible</span>, lo que indica que est&aacute; dise&ntilde;ada para ser accesible desde diferentes espacios de nombres (namespaces). Esto es especialmente relevante en contextos de paquetes gestionados donde se necesita que componentes espec&iacute;ficos sean accesibles desde fuera del namespace del paquete.</p></section><section><h2 id="1356896840#estructura-de-la-clase" data-toc="estructura-de-la-clase#InsServiceAdapter.md-estructura-de-la-clase">Estructura de la Clase</h2><div class="detached code-block" id="1356896840#gqw4dy_25"><pre><code class="language-none">@namespaceAccessible
public class InsServiceAdapter implements Adapter {
  @namespaceAccessible
  public Map&lt;String, Object&gt; adaptee() {
    return new Map&lt;String, Object&gt;();
  }

  @namespaceAccessible
  public static Boolean useInsAdapter() {
    // Implementación del método
  }
}</code></pre></div></section><section><h2 id="1356896840#interfaz-implementada" data-toc="interfaz-implementada#InsServiceAdapter.md-interfaz-implementada">Interfaz Implementada</h2><section><h3 id="1356896840#adapter" data-toc="adapter#InsServiceAdapter.md-adapter">Adapter</h3><p id="1356896840#gqw4dy_28">La clase implementa la interfaz <span class="inline-code" id="1356896840#gqw4dy_30">Adapter</span>. Aunque no se muestra la definici&oacute;n de esta interfaz en el c&oacute;digo proporcionado, se puede inferir que requiere al menos un m&eacute;todo <span class="inline-code" id="1356896840#gqw4dy_31">adaptee()</span> que devuelve un <span class="inline-code" id="1356896840#gqw4dy_32">Map&lt;String, Object&gt;</span>.</p></section></section><section><h2 id="1356896840#m-todos" data-toc="m-todos#InsServiceAdapter.md-m-todos">M&eacute;todos</h2><section><h3 id="1356896840#adaptee" data-toc="adaptee#InsServiceAdapter.md-adaptee">adaptee()</h3><section><h4 id="1356896840#descripci-n" data-toc="descripci-n#InsServiceAdapter.md-descripci-n">Descripci&oacute;n</h4><p id="1356896840#gqw4dy_41">M&eacute;todo que implementa la interfaz <span class="inline-code" id="1356896840#gqw4dy_42">Adapter</span> y devuelve un mapa vac&iacute;o. Seg&uacute;n el comentario comentado, estaba previsto que devolviera una instancia de <span class="inline-code" id="1356896840#gqw4dy_43">URLGenerationNotificationHandler</span>, pero actualmente devuelve un mapa vac&iacute;o.</p></section><section><h4 id="1356896840#par-metros" data-toc="par-metros#InsServiceAdapter.md-par-metros">Par&aacute;metros</h4><p id="1356896840#gqw4dy_44">Ninguno.</p></section><section><h4 id="1356896840#retorno" data-toc="retorno#InsServiceAdapter.md-retorno">Retorno</h4><ul class="list" id="1356896840#gqw4dy_45" start="1"><li class="list-item" id="1356896840#gqw4dy_46"><p><span class="inline-code" id="1356896840#gqw4dy_47">Map&lt;String, Object&gt;</span>: Un mapa vac&iacute;o.</p></li></ul></section><section><h4 id="1356896840#c-digo" data-toc="c-digo#InsServiceAdapter.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1356896840#gqw4dy_48"><pre><code class="language-none">@namespaceAccessible
public Map&lt;String, Object&gt; adaptee() {
  // return new URLGenerationNotificationHandler();
  return new Map&lt;String, Object&gt;();
}</code></pre></div></section></section><section><h3 id="1356896840#useinsadapter" data-toc="useinsadapter#InsServiceAdapter.md-useinsadapter">useInsAdapter()</h3><section><h4 id="1356896840#descripci-n" data-toc="descripci-n#InsServiceAdapter.md-descripci-n">Descripci&oacute;n</h4><p id="1356896840#gqw4dy_56">M&eacute;todo est&aacute;tico que intenta realizar una llamada HTTP a un servicio de Vlocity Insurance para obtener productos calificados. Determina si el adaptador de seguros debe ser utilizado bas&aacute;ndose en el &eacute;xito de esta llamada.</p></section><section><h4 id="1356896840#par-metros" data-toc="par-metros#InsServiceAdapter.md-par-metros">Par&aacute;metros</h4><p id="1356896840#gqw4dy_57">Ninguno.</p></section><section><h4 id="1356896840#retorno" data-toc="retorno#InsServiceAdapter.md-retorno">Retorno</h4><ul class="list" id="1356896840#gqw4dy_58" start="1"><li class="list-item" id="1356896840#gqw4dy_59"><p><span class="inline-code" id="1356896840#gqw4dy_60">Boolean</span>: <span class="inline-code" id="1356896840#gqw4dy_61">true</span> si la llamada al servicio fue exitosa (estado 200), <span class="inline-code" id="1356896840#gqw4dy_62">false</span> en caso contrario.</p></li></ul></section><section><h4 id="1356896840#proceso" data-toc="proceso#InsServiceAdapter.md-proceso">Proceso</h4><ol class="list list-decimal" id="1356896840#gqw4dy_63" type="1" start="1"><li class="list-item" id="1356896840#gqw4dy_64"><p>Inicializa una variable booleana <span class="inline-code" id="1356896840#gqw4dy_72">isSuccess</span> como <span class="inline-code" id="1356896840#gqw4dy_73">false</span>.</p></li><li class="list-item" id="1356896840#gqw4dy_65"><p>Crea una nueva solicitud HTTP.</p></li><li class="list-item" id="1356896840#gqw4dy_66"><p>Consulta el nombre de la instancia de la organizaci&oacute;n actual.</p></li><li class="list-item" id="1356896840#gqw4dy_67"><p>Configura el endpoint de la solicitud usando una credencial nombrada para el servicio de integraci&oacute;n de Vlocity.</p></li><li class="list-item" id="1356896840#gqw4dy_68"><p>Establece el m&eacute;todo HTTP como 'GET'.</p></li><li class="list-item" id="1356896840#gqw4dy_69"><p>Crea una instancia de Http y env&iacute;a la solicitud.</p></li><li class="list-item" id="1356896840#gqw4dy_70"><p>Analiza la respuesta: </p><ul class="list" id="1356896840#gqw4dy_74" start="1"><li class="list-item" id="1356896840#gqw4dy_75"><p>Si el c&oacute;digo de estado es 200, registra el cuerpo de la respuesta y establece <span class="inline-code" id="1356896840#gqw4dy_77">isSuccess</span> como <span class="inline-code" id="1356896840#gqw4dy_78">true</span>.</p></li><li class="list-item" id="1356896840#gqw4dy_76"><p>Si el c&oacute;digo de estado no es 200, registra el estado de error y mantiene <span class="inline-code" id="1356896840#gqw4dy_79">isSuccess</span> como <span class="inline-code" id="1356896840#gqw4dy_80">false</span>.</p></li></ul></li><li class="list-item" id="1356896840#gqw4dy_71"><p>Devuelve el valor de <span class="inline-code" id="1356896840#gqw4dy_81">isSuccess</span>.</p></li></ol></section><section><h4 id="1356896840#c-digo" data-toc="c-digo#InsServiceAdapter.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1356896840#gqw4dy_82"><pre><code class="language-none">@namespaceAccessible
public static Boolean useInsAdapter() {
  Boolean isSuccess = false;
  HttpRequest insServiceRequest = new HttpRequest();

  String instanceName = [SELECT InstanceName FROM Organization LIMIT 1]
  .InstanceName;
  System.debug(instanceName);

  // insServiceRequest.setEndpoint(
  //   'callout:salesforce_ins_service_adaptar/services/apexrest/vlocity_insurance/ratedproducts'
  // );
  insServiceRequest.setEndpoint(
    'callout:Suratech_Salesforce_Vlocity_Integration_Credential/services/apexrest/vlocity_insurance/ratedproducts'
  );
  insServiceRequest.setMethod('GET');

  Http http = new Http();
  HttpResponse res = http.send(insServiceRequest);

  if (res.getStatusCode() == 200) {
    System.debug('Response: ' + res.getBody());
    isSuccess = true;
  } else {
    System.debug('Error: ' + res.getStatus());
    isSuccess = false;
  }

  return isSuccess;
}</code></pre></div></section></section></section><section><h2 id="1356896840#observaciones-sobre-el-c-digo" data-toc="observaciones-sobre-el-c-digo#InsServiceAdapter.md-observaciones-sobre-el-c-digo">Observaciones sobre el C&oacute;digo</h2><section><h3 id="1356896840#puntos-a-destacar" data-toc="puntos-a-destacar#InsServiceAdapter.md-puntos-a-destacar">Puntos a Destacar</h3><ol class="list list-decimal" id="1356896840#gqw4dy_85" type="1" start="1"><li class="list-item" id="1356896840#gqw4dy_86"><p><span class="control" id="1356896840#gqw4dy_89">Implementaci&oacute;n Parcial o Transitoria</span>: El m&eacute;todo <span class="inline-code" id="1356896840#gqw4dy_90">adaptee()</span> parece estar en un estado transitorio, ya que contiene c&oacute;digo comentado y devuelve un mapa vac&iacute;o.</p></li><li class="list-item" id="1356896840#gqw4dy_87"><p><span class="control" id="1356896840#gqw4dy_91">Uso de Credencial Nombrada</span>: La clase utiliza una credencial nombrada (<span class="inline-code" id="1356896840#gqw4dy_92">Suratech_Salesforce_Vlocity_Integration_Credential</span>) para la autenticaci&oacute;n segura con el servicio externo.</p></li><li class="list-item" id="1356896840#gqw4dy_88"><p><span class="control" id="1356896840#gqw4dy_93">Consulta de Organizaci&oacute;n</span>: La clase consulta la informaci&oacute;n de la organizaci&oacute;n actual, aunque actualmente solo utiliza esta informaci&oacute;n para registro de depuraci&oacute;n.</p></li></ol></section><section><h3 id="1356896840#posibles-mejoras" data-toc="posibles-mejoras#InsServiceAdapter.md-posibles-mejoras">Posibles Mejoras</h3><ol class="list list-decimal" id="1356896840#gqw4dy_94" type="1" start="1"><li class="list-item" id="1356896840#gqw4dy_95"><p><span class="control" id="1356896840#gqw4dy_100">Implementaci&oacute;n Completa de <span class="inline-code" id="1356896840#gqw4dy_102">adaptee()</span></span>: Completar la implementaci&oacute;n del m&eacute;todo <span class="inline-code" id="1356896840#gqw4dy_101">adaptee()</span> para que devuelva la instancia apropiada o un mapa con datos relevantes.</p></li><li class="list-item" id="1356896840#gqw4dy_96"><p><span class="control" id="1356896840#gqw4dy_103">Manejo de Excepciones</span>: A&ntilde;adir manejo de excepciones para capturar y gestionar adecuadamente posibles errores durante la llamada HTTP.</p></li><li class="list-item" id="1356896840#gqw4dy_97"><p><span class="control" id="1356896840#gqw4dy_104">Parametrizaci&oacute;n</span>: Considerar hacer que el endpoint sea configurable, posiblemente a trav&eacute;s de metadatos personalizados, en lugar de codificarlo directamente.</p></li><li class="list-item" id="1356896840#gqw4dy_98"><p><span class="control" id="1356896840#gqw4dy_105">Timeout y Reintentos</span>: Implementar l&oacute;gica de timeout y reintentos para manejar situaciones donde el servicio externo no responde o lo hace lentamente.</p></li><li class="list-item" id="1356896840#gqw4dy_99"><p><span class="control" id="1356896840#gqw4dy_106">Utilizaci&oacute;n de la Informaci&oacute;n de Instancia</span>: Hacer un uso m&aacute;s significativo de la informaci&oacute;n de instancia que se est&aacute; consultando.</p></li></ol></section></section><section><h2 id="1356896840#versi-n-mejorada-propuesta" data-toc="versi-n-mejorada-propuesta#InsServiceAdapter.md-versi-n-mejorada-propuesta">Versi&oacute;n Mejorada Propuesta</h2><div class="detached code-block" id="1356896840#gqw4dy_107"><pre><code class="language-none">/**
 * @description       : Adaptador para servicios de seguros de Vlocity
 * @author            : Soulberto Lorenzo &lt;soulberto@cloudblue.us&gt;
 * @group             : Adapters
 * @last modified on  : 09-02-2024
 * @last modified by  : Soulberto Lorenzo &lt;soulberto@cloudblue.us&gt;
 **/
@namespaceAccessible
public class InsServiceAdapter implements Adapter {
  // Constantes para configuración
  private static final String VLOCITY_ENDPOINT_PATH = '/services/apexrest/vlocity_insurance/ratedproducts';
  private static final String NAMED_CREDENTIAL = 'Suratech_Salesforce_Vlocity_Integration_Credential';
  private static final Integer DEFAULT_TIMEOUT = 30000; // 30 segundos
  
  /**
   * @description Implementa la interfaz Adapter devolviendo un adaptador para servicios de seguros
   * @author Soulberto Lorenzo &lt;soulberto@cloudblue.us&gt; | 09-02-2024
   * @return Map&lt;String, Object&gt; Mapa con información del adaptador
   **/
  @namespaceAccessible
  public Map&lt;String, Object&gt; adaptee() {
    Map&lt;String, Object&gt; adapterInfo = new Map&lt;String, Object&gt;();
    
    try {
      // Verificar disponibilidad del servicio
      Boolean serviceAvailable = checkServiceAvailability();
      
      // Añadir información relevante al mapa
      adapterInfo.put('type', 'InsuranceServiceAdapter');
      adapterInfo.put('serviceAvailable', serviceAvailable);
      adapterInfo.put('instanceName', getOrganizationInstanceName());
      
      // Si el servicio está disponible, añadir información adicional
      if (serviceAvailable) {
        // Aquí se podría añadir más información específica del servicio
        // Por ejemplo, versión de API, capacidades disponibles, etc.
      }
    } catch (Exception e) {
      // Registrar error y añadir información de error al mapa
      System.debug(LoggingLevel.ERROR, 'Error en adaptee(): ' + e.getMessage());
      adapterInfo.put('error', e.getMessage());
      adapterInfo.put('errorType', e.getTypeName());
    }
    
    return adapterInfo;
  }

  /**
   * @description Verifica si se debe utilizar el adaptador de seguros basándose en la disponibilidad del servicio
   * @author Soulberto Lorenzo &lt;soulberto@cloudblue.us&gt; | 09-02-2024
   * @return Boolean true si el servicio está disponible, false en caso contrario
   **/
  @namespaceAccessible
  public static Boolean useInsAdapter() {
    return checkServiceAvailability();
  }
  
  /**
   * @description Verifica la disponibilidad del servicio de seguros
   * @return Boolean true si el servicio está disponible, false en caso contrario
   **/
  private static Boolean checkServiceAvailability() {
    try {
      HttpRequest insServiceRequest = new HttpRequest();
      
      String endpoint = 'callout:' + NAMED_CREDENTIAL + VLOCITY_ENDPOINT_PATH;
      System.debug('Verificando disponibilidad del servicio: ' + endpoint);
      
      insServiceRequest.setEndpoint(endpoint);
      insServiceRequest.setMethod('GET');
      insServiceRequest.setTimeout(DEFAULT_TIMEOUT);
      
      Http http = new Http();
      HttpResponse res = http.send(insServiceRequest);
      
      Integer statusCode = res.getStatusCode();
      System.debug('Código de estado de respuesta: ' + statusCode);
      
      if (statusCode == 200) {
        System.debug('Servicio disponible. Respuesta: ' + res.getBody());
        return true;
      } else {
        System.debug('Servicio no disponible. Estado: ' + res.getStatus());
        logServiceError(statusCode, res.getStatus(), res.getBody());
        return false;
      }
    } catch (Exception e) {
      System.debug(LoggingLevel.ERROR, 'Error al verificar disponibilidad del servicio: ' + e.getMessage());
      return false;
    }
  }
  
  /**
   * @description Obtiene el nombre de la instancia de la organización actual
   * @return String Nombre de la instancia
   **/
  private static String getOrganizationInstanceName() {
    try {
      Organization org = [SELECT InstanceName FROM Organization LIMIT 1];
      return org.InstanceName;
    } catch (Exception e) {
      System.debug(LoggingLevel.ERROR, 'Error al obtener el nombre de la instancia: ' + e.getMessage());
      return '';
    }
  }
  
  /**
   * @description Registra información detallada sobre errores del servicio
   * @param statusCode Código de estado HTTP
   * @param status Descripción del estado
   * @param responseBody Cuerpo de la respuesta
   **/
  private static void logServiceError(Integer statusCode, String status, String responseBody) {
    // Aquí se podría implementar lógica para registrar errores en un objeto personalizado,
    // enviar notificaciones, o realizar otras acciones según la política de gestión de errores
    
    System.debug(LoggingLevel.ERROR, 'Error en servicio de seguros - Código: ' + statusCode + 
                 ', Estado: ' + status + ', Respuesta: ' + responseBody);
  }
  
  /**
   * @description Realiza una llamada al servicio de seguros para obtener productos calificados
   * @param parameters Parámetros de la solicitud
   * @return Map&lt;String, Object&gt; Respuesta del servicio
   * @throws InsServiceException Si hay un error en la llamada al servicio
   **/
  @namespaceAccessible
  public static Map&lt;String, Object&gt; getRatedProducts(Map&lt;String, Object&gt; parameters) {
    try {
      // Verificar disponibilidad del servicio
      if (!checkServiceAvailability()) {
        throw new InsServiceException('El servicio de seguros no está disponible');
      }
      
      // Implementar lógica para obtener productos calificados
      // ...
      
      return new Map&lt;String, Object&gt;(); // Placeholder
    } catch (Exception e) {
      throw new InsServiceException('Error al obtener productos calificados: ' + e.getMessage(), e);
    }
  }
  
  /**
   * Clase de excepción personalizada para errores del servicio de seguros
   */
  public class InsServiceException extends Exception {}
}</code></pre></div></section><section><h2 id="1356896840#ejemplo-de-uso" data-toc="ejemplo-de-uso#InsServiceAdapter.md-ejemplo-de-uso">Ejemplo de Uso</h2><section><h3 id="1356896840#uso-b-sico-para-verificar-disponibilidad" data-toc="uso-b-sico-para-verificar-disponibilidad#InsServiceAdapter.md-uso-b-sico-para-verificar-disponibilidad">Uso B&aacute;sico para Verificar Disponibilidad</h3><div class="detached code-block" id="1356896840#gqw4dy_110"><pre><code class="language-none">// Verificar si el adaptador de seguros debe ser utilizado
Boolean useInsAdapter = InsServiceAdapter.useInsAdapter();

if (useInsAdapter) {
    System.debug('El servicio de seguros está disponible, se utilizará el adaptador');
    // Lógica adicional cuando el servicio está disponible
} else {
    System.debug('El servicio de seguros no está disponible, se utilizará una alternativa');
    // Lógica alternativa cuando el servicio no está disponible
}</code></pre></div></section><section><h3 id="1356896840#uso-del-adaptador" data-toc="uso-del-adaptador#InsServiceAdapter.md-uso-del-adaptador">Uso del Adaptador</h3><div class="detached code-block" id="1356896840#gqw4dy_111"><pre><code class="language-none">// Crear una instancia del adaptador
InsServiceAdapter adapter = new InsServiceAdapter();

// Obtener información del adaptador
Map&lt;String, Object&gt; adapterInfo = adapter.adaptee();

// Verificar si el servicio está disponible
Boolean serviceAvailable = (Boolean)adapterInfo.get('serviceAvailable');

if (serviceAvailable) {
    // Utilizar el adaptador para obtener productos calificados
    Map&lt;String, Object&gt; parameters = new Map&lt;String, Object&gt;{
        'productType' =&gt; 'Auto',
        'clientId' =&gt; '12345'
    };
    
    try {
        Map&lt;String, Object&gt; ratedProducts = InsServiceAdapter.getRatedProducts(parameters);
        // Procesar los productos calificados
        // ...
    } catch (InsServiceAdapter.InsServiceException e) {
        System.debug('Error al obtener productos calificados: ' + e.getMessage());
        // Manejar el error
    }
} else {
    System.debug('El servicio no está disponible: ' + adapterInfo.get('error'));
    // Manejar la falta de disponibilidad del servicio
}</code></pre></div></section></section><section><h2 id="1356896840#contexto-y-uso-t-pico" data-toc="contexto-y-uso-t-pico#InsServiceAdapter.md-contexto-y-uso-t-pico">Contexto y Uso T&iacute;pico</h2><section><h3 id="1356896840#vlocity-insurance-y-salesforce" data-toc="vlocity-insurance-y-salesforce#InsServiceAdapter.md-vlocity-insurance-y-salesforce">Vlocity Insurance y Salesforce</h3><p id="1356896840#gqw4dy_114">Esta clase probablemente forma parte de una integraci&oacute;n entre Salesforce y Vlocity, una soluci&oacute;n espec&iacute;fica para la industria de seguros que ahora es parte de Salesforce Industries. Vlocity proporciona componentes y funcionalidad espec&iacute;fica para varias industrias, incluyendo seguros.</p></section><section><h3 id="1356896840#casos-de-uso-t-picos" data-toc="casos-de-uso-t-picos#InsServiceAdapter.md-casos-de-uso-t-picos">Casos de Uso T&iacute;picos</h3><ol class="list list-decimal" id="1356896840#gqw4dy_115" type="1" start="1"><li class="list-item" id="1356896840#gqw4dy_116"><p><span class="control" id="1356896840#gqw4dy_120">Cotizaci&oacute;n de Seguros</span>: Obtener productos calificados con precios y coberturas espec&iacute;ficas para un cliente.</p></li><li class="list-item" id="1356896840#gqw4dy_117"><p><span class="control" id="1356896840#gqw4dy_121">Configuraci&oacute;n de Productos</span>: Acceder a reglas de configuraci&oacute;n y opciones para productos de seguros.</p></li><li class="list-item" id="1356896840#gqw4dy_118"><p><span class="control" id="1356896840#gqw4dy_122">Verificaci&oacute;n de Elegibilidad</span>: Determinar si un cliente es elegible para ciertos productos o coberturas.</p></li><li class="list-item" id="1356896840#gqw4dy_119"><p><span class="control" id="1356896840#gqw4dy_123">C&aacute;lculo de Primas</span>: Obtener c&aacute;lculos de primas basados en informaci&oacute;n espec&iacute;fica del cliente.</p></li></ol></section></section><section><h2 id="1356896840#patrones-de-dise-o-utilizados" data-toc="patrones-de-dise-o-utilizados#InsServiceAdapter.md-patrones-de-dise-o-utilizados">Patrones de Dise&ntilde;o Utilizados</h2><section><h3 id="1356896840#patr-n-adaptador-adapter" data-toc="patr-n-adaptador-adapter#InsServiceAdapter.md-patr-n-adaptador-adapter">Patr&oacute;n Adaptador (Adapter)</h3><p id="1356896840#gqw4dy_126">La clase implementa el patr&oacute;n Adaptador, que permite que interfaces incompatibles trabajen juntas. En este caso, adapta la comunicaci&oacute;n con el servicio de Vlocity Insurance a una interfaz com&uacute;n definida por <span class="inline-code" id="1356896840#gqw4dy_127">Adapter</span>.</p></section><section><h3 id="1356896840#patr-n-de-comprobaci-n-de-disponibilidad-availability-check" data-toc="patr-n-de-comprobaci-n-de-disponibilidad-availability-check#InsServiceAdapter.md-patr-n-de-comprobaci-n-de-disponibilidad-availability-check">Patr&oacute;n de Comprobaci&oacute;n de Disponibilidad (Availability Check)</h3><p id="1356896840#gqw4dy_128">El m&eacute;todo <span class="inline-code" id="1356896840#gqw4dy_129">useInsAdapter()</span> implementa un patr&oacute;n de comprobaci&oacute;n de disponibilidad, que verifica si un servicio externo est&aacute; disponible antes de intentar utilizarlo para operaciones cr&iacute;ticas.</p></section></section><section><h2 id="1356896840#consideraciones-de-seguridad" data-toc="consideraciones-de-seguridad#InsServiceAdapter.md-consideraciones-de-seguridad">Consideraciones de Seguridad</h2><ol class="list list-decimal" id="1356896840#gqw4dy_130" type="1" start="1"><li class="list-item" id="1356896840#gqw4dy_131"><p><span class="control" id="1356896840#gqw4dy_133">Credenciales Nombradas</span>: El uso de credenciales nombradas es una buena pr&aacute;ctica para manejar la autenticaci&oacute;n, ya que abstrae las credenciales del c&oacute;digo.</p></li><li class="list-item" id="1356896840#gqw4dy_132"><p><span class="control" id="1356896840#gqw4dy_134">Registro de Datos Sensibles</span>: El c&oacute;digo actual registra el cuerpo completo de la respuesta, lo que podr&iacute;a contener informaci&oacute;n sensible. Considerar filtrar o anonimizar datos sensibles en los registros.</p></li></ol></section><section><h2 id="1356896840#consideraciones-de-rendimiento" data-toc="consideraciones-de-rendimiento#InsServiceAdapter.md-consideraciones-de-rendimiento">Consideraciones de Rendimiento</h2><ol class="list list-decimal" id="1356896840#gqw4dy_135" type="1" start="1"><li class="list-item" id="1356896840#gqw4dy_136"><p><span class="control" id="1356896840#gqw4dy_138">Timeout</span>: El c&oacute;digo original no establece un timeout espec&iacute;fico para la llamada HTTP, lo que podr&iacute;a resultar en esperas prolongadas si el servicio externo no responde.</p></li><li class="list-item" id="1356896840#gqw4dy_137"><p><span class="control" id="1356896840#gqw4dy_139">Consulta de Organizaci&oacute;n</span>: La consulta a la tabla Organization se realiza en cada llamada al m&eacute;todo <span class="inline-code" id="1356896840#gqw4dy_140">useInsAdapter()</span>. Para uso frecuente, considerar cachear esta informaci&oacute;n.</p></li></ol></section><section><h2 id="1356896840#notas-adicionales" data-toc="notas-adicionales#InsServiceAdapter.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="1356896840#gqw4dy_141" type="1" start="1"><li class="list-item" id="1356896840#gqw4dy_142"><p>La clase parece estar en desarrollo o en transici&oacute;n, como lo indican los comentarios y la implementaci&oacute;n incompleta de <span class="inline-code" id="1356896840#gqw4dy_146">adaptee()</span>.</p></li><li class="list-item" id="1356896840#gqw4dy_143"><p>La anotaci&oacute;n <span class="inline-code" id="1356896840#gqw4dy_147">@namespaceAccessible</span> sugiere que esta clase est&aacute; dise&ntilde;ada para ser parte de un paquete gestionado que necesita exponer funcionalidad a otros paquetes o al c&oacute;digo de la organizaci&oacute;n.</p></li><li class="list-item" id="1356896840#gqw4dy_144"><p>La clase no incluye manejo de excepciones, lo que podr&iacute;a llevar a comportamientos inesperados si la llamada HTTP falla por razones distintas a un c&oacute;digo de estado no 200 (por ejemplo, timeout, problemas de DNS, etc.).</p></li><li class="list-item" id="1356896840#gqw4dy_145"><p>El c&oacute;digo actual no incluye documentaci&oacute;n completa ni pruebas unitarias, que ser&iacute;an recomendables para una clase de esta naturaleza.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1402701071">GenerateURLServiceHandler</h1><section><h2 id="1402701071#descripci-n-general" data-toc="descripci-n-general#GenerateURLServiceHandler.md-descripci-n-general">Descripci&oacute;n General</h2><p id="1402701071#vedsen_19"><span class="inline-code" id="1402701071#vedsen_20">GenerateURLServiceHandler</span> es una clase virtual global que extiende <span class="inline-code" id="1402701071#vedsen_21">PlatformEventIntegrationObserver</span> y est&aacute; dise&ntilde;ada para manejar la integraci&oacute;n con servicios externos para la generaci&oacute;n de URLs. Esta clase implementa un patr&oacute;n de procesamiento en tres fases (pre-proceso, proceso principal y post-proceso) y proporciona capacidades de publicaci&oacute;n de eventos de plataforma para monitoreo y auditor&iacute;a.</p></section><section><h2 id="1402701071#autor" data-toc="autor#GenerateURLServiceHandler.md-autor">Autor</h2><p id="1402701071#vedsen_22">Felipe Correa \&lt;felipe.correa@nespon.com\&gt;</p></section><section><h2 id="1402701071#proyecto" data-toc="proyecto#GenerateURLServiceHandler.md-proyecto">Proyecto</h2><p id="1402701071#vedsen_23">Foundation Salesforce - Suratech - UH-17594</p></section><section><h2 id="1402701071#ltima-modificaci-n" data-toc="ltima-modificaci-n#GenerateURLServiceHandler.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="1402701071#vedsen_24">20 de febrero de 2025 por &quot;ChangeMeIn@UserSettingsUnder.SFDoc&quot;</p></section><section><h2 id="1402701071#estructura-de-la-clase" data-toc="estructura-de-la-clase#GenerateURLServiceHandler.md-estructura-de-la-clase">Estructura de la Clase</h2><div class="detached code-block" id="1402701071#vedsen_25"><pre><code class="language-none">global virtual class GenerateURLServiceHandler extends PlatformEventIntegrationObserver {
  // Constantes de configuración
  private static final String SERVICE_METHOD = 'POST';
  private static final String SURATECH_MDT_CONFIG_NAME = 'url_endpoint';
  
  // Métodos de procesamiento
  global virtual Map&lt;String, Object&gt; preProcess(Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; options);
  global Map&lt;String, Object&gt; invokeProcess(Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; output, Map&lt;String, Object&gt; options);
  global virtual Map&lt;String, Object&gt; postProcess(Map&lt;String, Object&gt; response, Map&lt;String, Object&gt; options);
  global void publishPlatformEventIntegration(String moment, String data);
}</code></pre></div></section><section><h2 id="1402701071#herencia" data-toc="herencia#GenerateURLServiceHandler.md-herencia">Herencia</h2><ul class="list" id="1402701071#vedsen_26" start="1"><li class="list-item" id="1402701071#vedsen_27"><p><span class="control" id="1402701071#vedsen_29">Clase Base</span>: <span class="inline-code" id="1402701071#vedsen_30">PlatformEventIntegrationObserver</span></p></li><li class="list-item" id="1402701071#vedsen_28"><p><span class="control" id="1402701071#vedsen_31">Modificadores</span>: <span class="inline-code" id="1402701071#vedsen_32">global virtual</span></p></li></ul></section><section><h2 id="1402701071#constantes" data-toc="constantes#GenerateURLServiceHandler.md-constantes">Constantes</h2><div class="table-wrapper detached"><table id="1402701071#vedsen_33"><tr class="header-row" id="1402701071#vedsen_34"><th id="1402701071#vedsen_37"><p>Nombre</p></th><th id="1402701071#vedsen_38"><p>Valor</p></th><th id="1402701071#vedsen_39"><p>Descripci&oacute;n</p></th></tr><tr class="" id="1402701071#vedsen_35"><td id="1402701071#vedsen_40"><p><span class="inline-code" id="1402701071#vedsen_43">SERVICE_METHOD</span></p></td><td id="1402701071#vedsen_41"><p><span class="inline-code" id="1402701071#vedsen_44">'POST'</span></p></td><td id="1402701071#vedsen_42"><p>M&eacute;todo HTTP utilizado para las llamadas al servicio externo</p></td></tr><tr class="" id="1402701071#vedsen_36"><td id="1402701071#vedsen_45"><p><span class="inline-code" id="1402701071#vedsen_48">SURATECH_MDT_CONFIG_NAME</span></p></td><td id="1402701071#vedsen_46"><p><span class="inline-code" id="1402701071#vedsen_49">'url_endpoint'</span></p></td><td id="1402701071#vedsen_47"><p>Nombre del registro de metadatos personalizados que contiene la configuraci&oacute;n del servicio</p></td></tr></table></div></section><section><h2 id="1402701071#m-todos" data-toc="m-todos#GenerateURLServiceHandler.md-m-todos">M&eacute;todos</h2><section><h3 id="1402701071#preprocess-map-string-object-input-map-string-object-options" data-toc="preprocess-map-string-object-input-map-string-object-options#GenerateURLServiceHandler.md-preprocess-map-string-object-input-map-string-object-options">preProcess(Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; options)</h3><section><h4 id="1402701071#descripci-n" data-toc="descripci-n#GenerateURLServiceHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1402701071#vedsen_61">M&eacute;todo virtual que se ejecuta antes del procesamiento principal. Realiza la preparaci&oacute;n inicial de los datos y opcionalmente publica eventos de plataforma para el monitoreo del proceso.</p></section><section><h4 id="1402701071#par-metros" data-toc="par-metros#GenerateURLServiceHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1402701071#vedsen_62" start="1"><li class="list-item" id="1402701071#vedsen_63"><p><span class="inline-code" id="1402701071#vedsen_65">input</span> (Map&lt;String, Object&gt;): Datos de entrada para el procesamiento.</p></li><li class="list-item" id="1402701071#vedsen_64"><p><span class="inline-code" id="1402701071#vedsen_66">options</span> (Map&lt;String, Object&gt;): Opciones de configuraci&oacute;n para el procesamiento.</p></li></ul></section><section><h4 id="1402701071#retorno" data-toc="retorno#GenerateURLServiceHandler.md-retorno">Retorno</h4><ul class="list" id="1402701071#vedsen_67" start="1"><li class="list-item" id="1402701071#vedsen_68"><p><span class="inline-code" id="1402701071#vedsen_69">Map&lt;String, Object&gt;</span>: Los datos de entrada, potencialmente modificados durante el pre-procesamiento.</p></li></ul></section><section><h4 id="1402701071#proceso" data-toc="proceso#GenerateURLServiceHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="1402701071#vedsen_70" type="1" start="1"><li class="list-item" id="1402701071#vedsen_71"><p>Registra el inicio del pre-procesamiento.</p></li><li class="list-item" id="1402701071#vedsen_72"><p>Verifica si los eventos de plataforma est&aacute;n habilitados en las opciones.</p></li><li class="list-item" id="1402701071#vedsen_73"><p>Si est&aacute;n habilitados, publica un evento de plataforma con los datos de entrada.</p></li><li class="list-item" id="1402701071#vedsen_74"><p>Devuelve los datos de entrada sin modificaciones.</p></li></ol></section><section><h4 id="1402701071#c-digo" data-toc="c-digo#GenerateURLServiceHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1402701071#vedsen_75"><pre><code class="language-none">global virtual Map&lt;String, Object&gt; preProcess(
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; options
) {
  Core.debug('Starting Generate URL Integration Service Pre Process');
  if (
    options.containsKey('PlatformEventEnabled') &amp;&amp;
    ((Boolean) options.get('PlatformEventEnabled')) == true
  )
    publishPlatformEventIntegration('pre', JSON.serialize(input));
  return input;
}</code></pre></div></section></section><section><h3 id="1402701071#invokeprocess-map-string-object-input-map-string-object-output-map-string-object-options" data-toc="invokeprocess-map-string-object-input-map-string-object-output-map-string-object-options#GenerateURLServiceHandler.md-invokeprocess-map-string-object-input-map-string-object-output-map-string-object-options">invokeProcess(Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; output, Map&lt;String, Object&gt; options)</h3><section><h4 id="1402701071#descripci-n" data-toc="descripci-n#GenerateURLServiceHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1402701071#vedsen_83">M&eacute;todo principal que ejecuta la l&oacute;gica de integraci&oacute;n con el servicio externo para la generaci&oacute;n de URLs. Maneja la configuraci&oacute;n, validaci&oacute;n, comunicaci&oacute;n con el servicio externo y procesamiento de respuestas.</p></section><section><h4 id="1402701071#par-metros" data-toc="par-metros#GenerateURLServiceHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1402701071#vedsen_84" start="1"><li class="list-item" id="1402701071#vedsen_85"><p><span class="inline-code" id="1402701071#vedsen_88">input</span> (Map&lt;String, Object&gt;): Datos de entrada para el procesamiento.</p></li><li class="list-item" id="1402701071#vedsen_86"><p><span class="inline-code" id="1402701071#vedsen_89">output</span> (Map&lt;String, Object&gt;): Mapa de salida (no utilizado en la implementaci&oacute;n actual).</p></li><li class="list-item" id="1402701071#vedsen_87"><p><span class="inline-code" id="1402701071#vedsen_90">options</span> (Map&lt;String, Object&gt;): Opciones de configuraci&oacute;n para el procesamiento.</p></li></ul></section><section><h4 id="1402701071#retorno" data-toc="retorno#GenerateURLServiceHandler.md-retorno">Retorno</h4><ul class="list" id="1402701071#vedsen_91" start="1"><li class="list-item" id="1402701071#vedsen_92"><p><span class="inline-code" id="1402701071#vedsen_93">Map&lt;String, Object&gt;</span>: Respuesta procesada del servicio externo, o <span class="inline-code" id="1402701071#vedsen_94">null</span> en caso de error.</p></li></ul></section><section><h4 id="1402701071#proceso" data-toc="proceso#GenerateURLServiceHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="1402701071#vedsen_95" type="1" start="1"><li class="list-item" id="1402701071#vedsen_96"><p>Obtiene la configuraci&oacute;n desde metadatos personalizados.</p></li><li class="list-item" id="1402701071#vedsen_97"><p>Configura las opciones de eventos de plataforma.</p></li><li class="list-item" id="1402701071#vedsen_98"><p>Ejecuta el pre-procesamiento.</p></li><li class="list-item" id="1402701071#vedsen_99"><p>Realiza la llamada HTTP al servicio externo.</p></li><li class="list-item" id="1402701071#vedsen_100"><p>Procesa la respuesta y la estructura en un formato est&aacute;ndar.</p></li><li class="list-item" id="1402701071#vedsen_101"><p>Publica eventos de plataforma con los resultados.</p></li><li class="list-item" id="1402701071#vedsen_102"><p>Ejecuta el post-procesamiento.</p></li><li class="list-item" id="1402701071#vedsen_103"><p>Maneja excepciones y devuelve resultados.</p></li></ol></section><section><h4 id="1402701071#c-digo" data-toc="c-digo#GenerateURLServiceHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1402701071#vedsen_104"><pre><code class="language-none">global Map&lt;String, Object&gt; invokeProcess(
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; output,
  Map&lt;String, Object&gt; options
) {
  // Obtener configuración de metadatos
  SF_IntegrationSetting__mdt config = Test.isRunningTest()
    ? ExternalServiceMetadataIntegrationMock.getIntegrationSettings(SURATECH_MDT_CONFIG_NAME)
    : SF_IntegrationSetting__mdt.getInstance(SURATECH_MDT_CONFIG_NAME);
    
  if (config == null) {
    throw new ExternalServiceException(
      'No existing &quot;' + SURATECH_MDT_CONFIG_NAME + 
      '&quot; custom metadata type record at Integration Setting'
    );
  }

  // Configurar opciones
  options.put('PlatformEventEnabled', config.Platform_Events_Enabled__c);

  ExternalNotificationHandler enh = new ExternalNotificationHandler();
  Map&lt;String, Object&gt; payload = new Map&lt;String, Object&gt;();

  Boolean ignoreHash = options.containsKey('ignoreHash')
    ? (Boolean) options.get('ignoreHash')
    : false;
    
  try {
    payload = this.preProcess(input, options);
    Core.debug('Starting URL Generation Integration Service In Process');
    publishPlatformEventIntegration('in', JSON.serialize(input));

    // Realizar llamada HTTP
    System.HTTPResponse response = enh.emit(
      SERVICE_METHOD,
      config,
      '',
      (Object) payload
    );

    // Procesar respuesta
    Map&lt;String, Object&gt; mapResponse = new Map&lt;String, Object&gt;{
      'body' =&gt; (Map&lt;String, Object&gt;) JSON.deserializeUntyped(response.getBody()),
      'status' =&gt; response.getStatus(),
      'statusCode' =&gt; response.getStatusCode()
    };
    
    String responseString = response.getBody();
    System.debug('Response String: ' + responseString);

    this.publishPlatFormEvent(
      response.getStatusCode(),
      JSON.serialize(payload),
      JSON.serialize(response.getBody())
    );
    
    return this.postProcess(mapResponse, options);
  } catch (Exception e) {
    enh.controlException(
      'Generate URL remote service',
      e,
      JSON.serialize(payload)
    );
    return null;
  }
}</code></pre></div></section></section><section><h3 id="1402701071#postprocess-map-string-object-response-map-string-object-options" data-toc="postprocess-map-string-object-response-map-string-object-options#GenerateURLServiceHandler.md-postprocess-map-string-object-response-map-string-object-options">postProcess(Map&lt;String, Object&gt; response, Map&lt;String, Object&gt; options)</h3><section><h4 id="1402701071#descripci-n" data-toc="descripci-n#GenerateURLServiceHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1402701071#vedsen_111">M&eacute;todo virtual que se ejecuta despu&eacute;s del procesamiento principal. Realiza tareas de finalizaci&oacute;n y opcionalmente publica eventos de plataforma con la respuesta final.</p></section><section><h4 id="1402701071#par-metros" data-toc="par-metros#GenerateURLServiceHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1402701071#vedsen_112" start="1"><li class="list-item" id="1402701071#vedsen_113"><p><span class="inline-code" id="1402701071#vedsen_115">response</span> (Map&lt;String, Object&gt;): Respuesta del procesamiento principal.</p></li><li class="list-item" id="1402701071#vedsen_114"><p><span class="inline-code" id="1402701071#vedsen_116">options</span> (Map&lt;String, Object&gt;): Opciones de configuraci&oacute;n.</p></li></ul></section><section><h4 id="1402701071#retorno" data-toc="retorno#GenerateURLServiceHandler.md-retorno">Retorno</h4><ul class="list" id="1402701071#vedsen_117" start="1"><li class="list-item" id="1402701071#vedsen_118"><p><span class="inline-code" id="1402701071#vedsen_119">Map&lt;String, Object&gt;</span>: La respuesta, potencialmente modificada durante el post-procesamiento.</p></li></ul></section><section><h4 id="1402701071#c-digo" data-toc="c-digo#GenerateURLServiceHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1402701071#vedsen_120"><pre><code class="language-none">global virtual Map&lt;String, Object&gt; postProcess(
  Map&lt;String, Object&gt; response,
  Map&lt;String, Object&gt; options
) {
  Core.debug('Starting Generate URL Integration Service Post Process');
  if (
    options.containsKey('PlatformEventEnabled') &amp;&amp;
    ((Boolean) options.get('PlatformEventEnabled')) == true
  )
    publishPlatformEventIntegration('post', JSON.serialize(response));
  return response;
}</code></pre></div></section></section><section><h3 id="1402701071#publishplatformeventintegration-string-moment-string-data" data-toc="publishplatformeventintegration-string-moment-string-data#GenerateURLServiceHandler.md-publishplatformeventintegration-string-moment-string-data">publishPlatformEventIntegration(String moment, String data)</h3><section><h4 id="1402701071#descripci-n" data-toc="descripci-n#GenerateURLServiceHandler.md-descripci-n">Descripci&oacute;n</h4><p id="1402701071#vedsen_128">M&eacute;todo que publica eventos de plataforma en diferentes momentos del procesamiento para proporcionar visibilidad y auditor&iacute;a del proceso de integraci&oacute;n.</p></section><section><h4 id="1402701071#par-metros" data-toc="par-metros#GenerateURLServiceHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1402701071#vedsen_129" start="1"><li class="list-item" id="1402701071#vedsen_130"><p><span class="inline-code" id="1402701071#vedsen_132">moment</span> (String): Momento del procesamiento ('pre', 'in', 'post').</p></li><li class="list-item" id="1402701071#vedsen_131"><p><span class="inline-code" id="1402701071#vedsen_133">data</span> (String): Datos a incluir en el evento de plataforma.</p></li></ul></section><section><h4 id="1402701071#retorno" data-toc="retorno#GenerateURLServiceHandler.md-retorno">Retorno</h4><ul class="list" id="1402701071#vedsen_134" start="1"><li class="list-item" id="1402701071#vedsen_135"><p><span class="inline-code" id="1402701071#vedsen_136">void</span>: Este m&eacute;todo no devuelve ning&uacute;n valor.</p></li></ul></section><section><h4 id="1402701071#proceso" data-toc="proceso#GenerateURLServiceHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="1402701071#vedsen_137" type="1" start="1"><li class="list-item" id="1402701071#vedsen_138"><p>Eval&uacute;a el momento especificado usando un switch.</p></li><li class="list-item" id="1402701071#vedsen_139"><p>Llama al m&eacute;todo de publicaci&oacute;n de evento apropiado seg&uacute;n el momento.</p></li><li class="list-item" id="1402701071#vedsen_140"><p>Incluye informaci&oacute;n contextual espec&iacute;fica para cada momento.</p></li></ol></section><section><h4 id="1402701071#c-digo" data-toc="c-digo#GenerateURLServiceHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1402701071#vedsen_141"><pre><code class="language-none">global void publishPlatformEventIntegration(String moment, String data) {
  switch on moment.toLowerCase() {
    when 'pre' {
      publishInitPrePlatformEvent(data, 'Generate URL Integration Service');
    }
    when 'post' {
      publishInitPosPlatformEvent(data, 'Generate URL Integration Service');
    }
    when 'in' {
      publishPlatFormEvent(200, data, 'Starting Generate URL In process');
    }
  }
}</code></pre></div></section></section></section><section><h2 id="1402701071#dependencias" data-toc="dependencias#GenerateURLServiceHandler.md-dependencias">Dependencias</h2><ul class="list" id="1402701071#vedsen_142" start="1"><li class="list-item" id="1402701071#vedsen_143"><p><span class="control" id="1402701071#vedsen_149"><span class="inline-code" id="1402701071#vedsen_150">PlatformEventIntegrationObserver</span></span>: Clase base que proporciona funcionalidad de eventos de plataforma.</p></li><li class="list-item" id="1402701071#vedsen_144"><p><span class="control" id="1402701071#vedsen_151"><span class="inline-code" id="1402701071#vedsen_152">SF_IntegrationSetting__mdt</span></span>: Tipo de metadatos personalizados que almacena la configuraci&oacute;n de integraci&oacute;n.</p></li><li class="list-item" id="1402701071#vedsen_145"><p><span class="control" id="1402701071#vedsen_153"><span class="inline-code" id="1402701071#vedsen_154">ExternalNotificationHandler</span></span>: Clase que maneja las comunicaciones HTTP con servicios externos.</p></li><li class="list-item" id="1402701071#vedsen_146"><p><span class="control" id="1402701071#vedsen_155"><span class="inline-code" id="1402701071#vedsen_156">ExternalServiceException</span></span>: Excepci&oacute;n personalizada para errores de servicios externos.</p></li><li class="list-item" id="1402701071#vedsen_147"><p><span class="control" id="1402701071#vedsen_157"><span class="inline-code" id="1402701071#vedsen_158">ExternalServiceMetadataIntegrationMock</span></span>: Clase mock para proporcionar configuraci&oacute;n durante las pruebas.</p></li><li class="list-item" id="1402701071#vedsen_148"><p><span class="control" id="1402701071#vedsen_159"><span class="inline-code" id="1402701071#vedsen_160">Core</span></span>: Clase utilitaria que proporciona funcionalidad de depuraci&oacute;n.</p></li></ul></section><section><h2 id="1402701071#patr-n-de-dise-o-implementado" data-toc="patr-n-de-dise-o-implementado#GenerateURLServiceHandler.md-patr-n-de-dise-o-implementado">Patr&oacute;n de Dise&ntilde;o Implementado</h2><section><h3 id="1402701071#template-method" data-toc="template-method#GenerateURLServiceHandler.md-template-method">Template Method</h3><p id="1402701071#vedsen_163">La clase implementa el patr&oacute;n Template Method a trav&eacute;s de los m&eacute;todos <span class="inline-code" id="1402701071#vedsen_164">preProcess</span>, <span class="inline-code" id="1402701071#vedsen_165">invokeProcess</span> y <span class="inline-code" id="1402701071#vedsen_166">postProcess</span>, definiendo un algoritmo de procesamiento en pasos donde algunos pasos pueden ser sobrescritos por subclases.</p></section><section><h3 id="1402701071#observer" data-toc="observer#GenerateURLServiceHandler.md-observer">Observer</h3><p id="1402701071#vedsen_167">A trav&eacute;s de la herencia de <span class="inline-code" id="1402701071#vedsen_168">PlatformEventIntegrationObserver</span>, la clase implementa el patr&oacute;n Observer para la publicaci&oacute;n de eventos de plataforma.</p></section></section><section><h2 id="1402701071#ejemplos-de-uso" data-toc="ejemplos-de-uso#GenerateURLServiceHandler.md-ejemplos-de-uso">Ejemplos de Uso</h2><section><h3 id="1402701071#ejemplo-1-uso-b-sico-del-servicio" data-toc="ejemplo-1-uso-b-sico-del-servicio#GenerateURLServiceHandler.md-ejemplo-1-uso-b-sico-del-servicio">Ejemplo 1: Uso B&aacute;sico del Servicio</h3><div class="detached code-block" id="1402701071#vedsen_172"><pre><code class="language-none">public class URLGenerationService {
    
    public static Map&lt;String, Object&gt; generatePaymentURL(Map&lt;String, Object&gt; paymentData) {
        try {
            // Crear instancia del handler
            GenerateURLServiceHandler handler = new GenerateURLServiceHandler();
            
            // Preparar opciones
            Map&lt;String, Object&gt; options = new Map&lt;String, Object&gt;{
                'PlatformEventEnabled' =&gt; true,
                'ignoreHash' =&gt; false
            };
            
            // Preparar datos de entrada
            Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
                'amount' =&gt; paymentData.get('amount'),
                'currency' =&gt; paymentData.get('currency'),
                'customerInfo' =&gt; paymentData.get('customerInfo'),
                'returnUrl' =&gt; paymentData.get('returnUrl')
            };
            
            // Ejecutar el procesamiento
            Map&lt;String, Object&gt; result = handler.invokeProcess(input, new Map&lt;String, Object&gt;(), options);
            
            if (result != null &amp;&amp; result.containsKey('body')) {
                Map&lt;String, Object&gt; responseBody = (Map&lt;String, Object&gt;) result.get('body');
                return new Map&lt;String, Object&gt;{
                    'success' =&gt; true,
                    'paymentUrl' =&gt; responseBody.get('url'),
                    'transactionId' =&gt; responseBody.get('transactionId')
                };
            } else {
                return new Map&lt;String, Object&gt;{
                    'success' =&gt; false,
                    'error' =&gt; 'No se pudo generar la URL de pago'
                };
            }
        } catch (Exception e) {
            System.debug('Error generando URL de pago: ' + e.getMessage());
            return new Map&lt;String, Object&gt;{
                'success' =&gt; false,
                'error' =&gt; e.getMessage()
            };
        }
    }
}

// Uso del servicio
Map&lt;String, Object&gt; paymentData = new Map&lt;String, Object&gt;{
    'amount' =&gt; 150000,
    'currency' =&gt; 'COP',
    'customerInfo' =&gt; new Map&lt;String, Object&gt;{
        'name' =&gt; 'Juan Pérez',
        'email' =&gt; 'juan@example.com',
        'phone' =&gt; '3001234567'
    },
    'returnUrl' =&gt; 'https://mysite.com/payment/return'
};

Map&lt;String, Object&gt; result = URLGenerationService.generatePaymentURL(paymentData);

if ((Boolean) result.get('success')) {
    String paymentUrl = (String) result.get('paymentUrl');
    System.debug('URL de pago generada: ' + paymentUrl);
} else {
    System.debug('Error: ' + result.get('error'));
}</code></pre></div></section><section><h3 id="1402701071#ejemplo-2-extensi-n-de-la-clase-para-funcionalidad-espec-fica" data-toc="ejemplo-2-extensi-n-de-la-clase-para-funcionalidad-espec-fica#GenerateURLServiceHandler.md-ejemplo-2-extensi-n-de-la-clase-para-funcionalidad-espec-fica">Ejemplo 2: Extensi&oacute;n de la Clase para Funcionalidad Espec&iacute;fica</h3><div class="detached code-block" id="1402701071#vedsen_173"><pre><code class="language-none">public class EnhancedURLServiceHandler extends GenerateURLServiceHandler {
    
    // Sobrescribir pre-procesamiento para validaciones adicionales
    global override Map&lt;String, Object&gt; preProcess(
        Map&lt;String, Object&gt; input,
        Map&lt;String, Object&gt; options
    ) {
        Core.debug('Starting Enhanced URL Service Pre Process');
        
        // Ejecutar validaciones personalizadas
        validateInputData(input);
        
        // Enriquecer datos de entrada
        input = enrichInputData(input);
        
        // Llamar al método padre para mantener funcionalidad base
        return super.preProcess(input, options);
    }
    
    // Sobrescribir post-procesamiento para transformaciones adicionales
    global override Map&lt;String, Object&gt; postProcess(
        Map&lt;String, Object&gt; response,
        Map&lt;String, Object&gt; options
    ) {
        Core.debug('Starting Enhanced URL Service Post Process');
        
        // Procesar respuesta
        response = transformResponse(response);
        
        // Crear registros de auditoría
        createAuditRecord(response, options);
        
        // Llamar al método padre
        return super.postProcess(response, options);
    }
    
    private void validateInputData(Map&lt;String, Object&gt; input) {
        if (!input.containsKey('amount') || input.get('amount') == null) {
            throw new CumuloMissingParameterException('El monto es requerido para generar la URL de pago');
        }
        
        Decimal amount = (Decimal) input.get('amount');
        if (amount &lt;= 0) {
            throw new IllegalArgumentException('El monto debe ser mayor que cero');
        }
        
        if (!input.containsKey('customerInfo')) {
            throw new CumuloMissingParameterException('La información del cliente es requerida');
        }
    }
    
    private Map&lt;String, Object&gt; enrichInputData(Map&lt;String, Object&gt; input) {
        // Añadir timestamp
        input.put('timestamp', System.now().getTime());
        
        // Añadir información de la organización
        input.put('organizationId', UserInfo.getOrganizationId());
        
        // Generar ID de transacción único
        input.put('transactionRef', generateTransactionReference());
        
        return input;
    }
    
    private Map&lt;String, Object&gt; transformResponse(Map&lt;String, Object&gt; response) {
        if (response.containsKey('body')) {
            Map&lt;String, Object&gt; body = (Map&lt;String, Object&gt;) response.get('body');
            
            // Añadir información adicional a la respuesta
            body.put('processedAt', System.now());
            body.put('processedBy', UserInfo.getUserId());
            
            response.put('body', body);
        }
        
        return response;
    }
    
    private void createAuditRecord(Map&lt;String, Object&gt; response, Map&lt;String, Object&gt; options) {
        try {
            // Crear registro de auditoría en objeto personalizado
            URL_Generation_Audit__c audit = new URL_Generation_Audit__c(
                Response_Status_Code__c = (Integer) response.get('statusCode'),
                Response_Status__c = (String) response.get('status'),
                Platform_Events_Enabled__c = (Boolean) options.get('PlatformEventEnabled'),
                Processing_Date__c = System.now()
            );
            
            insert audit;
        } catch (Exception e) {
            System.debug('Error creando registro de auditoría: ' + e.getMessage());
        }
    }
    
    private String generateTransactionReference() {
        return 'TXN_' + String.valueOf(System.currentTimeMillis()) + '_' + 
               String.valueOf(Math.random()).substring(2, 8);
    }
}</code></pre></div></section><section><h3 id="1402701071#ejemplo-3-uso-en-procedimiento-de-integraci-n" data-toc="ejemplo-3-uso-en-procedimiento-de-integraci-n#GenerateURLServiceHandler.md-ejemplo-3-uso-en-procedimiento-de-integraci-n">Ejemplo 3: Uso en Procedimiento de Integraci&oacute;n</h3><div class="detached code-block" id="1402701071#vedsen_174"><pre><code class="language-none">public class PaymentIntegrationProcedure {
    
    public static Map&lt;String, Object&gt; generatePaymentURL(Map&lt;String, Object&gt; input) {
        try {
            // Extraer datos del input del procedimiento de integración
            Map&lt;String, Object&gt; paymentInfo = (Map&lt;String, Object&gt;) input.get('paymentInfo');
            Map&lt;String, Object&gt; options = (Map&lt;String, Object&gt;) input.get('options');
            
            if (options == null) {
                options = new Map&lt;String, Object&gt;{
                    'PlatformEventEnabled' =&gt; true
                };
            }
            
            // Crear handler y procesar
            GenerateURLServiceHandler handler = new GenerateURLServiceHandler();
            Map&lt;String, Object&gt; result = handler.invokeProcess(
                paymentInfo, 
                new Map&lt;String, Object&gt;(), 
                options
            );
            
            // Estructurar respuesta para el procedimiento de integración
            if (result != null) {
                return new Map&lt;String, Object&gt;{
                    'success' =&gt; true,
                    'data' =&gt; result,
                    'message' =&gt; 'URL de pago generada exitosamente'
                };
            } else {
                return new Map&lt;String, Object&gt;{
                    'success' =&gt; false,
                    'data' =&gt; null,
                    'message' =&gt; 'Error al generar URL de pago'
                };
            }
        } catch (ExternalServiceException e) {
            return new Map&lt;String, Object&gt;{
                'success' =&gt; false,
                'data' =&gt; null,
                'message' =&gt; 'Error de servicio externo: ' + e.getMessage(),
                'errorType' =&gt; 'EXTERNAL_SERVICE_ERROR'
            };
        } catch (Exception e) {
            return new Map&lt;String, Object&gt;{
                'success' =&gt; false,
                'data' =&gt; null,
                'message' =&gt; 'Error inesperado: ' + e.getMessage(),
                'errorType' =&gt; 'UNEXPECTED_ERROR'
            };
        }
    }
}</code></pre></div></section></section><section><h2 id="1402701071#configuraci-n-de-metadatos-personalizados" data-toc="configuraci-n-de-metadatos-personalizados#GenerateURLServiceHandler.md-configuraci-n-de-metadatos-personalizados">Configuraci&oacute;n de Metadatos Personalizados</h2><p id="1402701071#vedsen_175">La clase utiliza el registro de metadatos personalizados <span class="inline-code" id="1402701071#vedsen_179">SF_IntegrationSetting__mdt</span> con el nombre <span class="inline-code" id="1402701071#vedsen_180">url_endpoint</span>. Este registro debe contener:</p><div class="table-wrapper detached"><table id="1402701071#vedsen_176"><tr class="header-row" id="1402701071#vedsen_181"><th id="1402701071#vedsen_184"><p>Campo</p></th><th id="1402701071#vedsen_185"><p>Descripci&oacute;n</p></th></tr><tr class="" id="1402701071#vedsen_182"><td id="1402701071#vedsen_186"><p><span class="inline-code" id="1402701071#vedsen_188">Platform_Events_Enabled__c</span></p></td><td id="1402701071#vedsen_187"><p>Boolean que indica si los eventos de plataforma est&aacute;n habilitados</p></td></tr><tr class="" id="1402701071#vedsen_183"><td id="1402701071#vedsen_189"><p>Campos de endpoint</p></td><td id="1402701071#vedsen_190"><p>URL del servicio externo, credenciales, timeouts, etc.</p></td></tr></table></div><p id="1402701071#vedsen_177">Ejemplo de configuraci&oacute;n:</p><div class="detached code-block" id="1402701071#vedsen_178"><pre><code class="language-none">Label: URL Endpoint Configuration
Developer Name: url_endpoint
Platform_Events_Enabled__c: true
Endpoint__c: https://api.payment-provider.com/v1/generate-url
Timeout__c: 30000
API_Key__c: [encrypted]</code></pre></div></section><section><h2 id="1402701071#mejores-pr-cticas-implementadas" data-toc="mejores-pr-cticas-implementadas#GenerateURLServiceHandler.md-mejores-pr-cticas-implementadas">Mejores Pr&aacute;cticas Implementadas</h2><ol class="list list-decimal" id="1402701071#vedsen_191" type="1" start="1"><li class="list-item" id="1402701071#vedsen_192"><p id="1402701071#vedsen_197"><span class="control" id="1402701071#vedsen_198">Separaci&oacute;n de Responsabilidades</span>: La clase separa claramente las fases de pre-procesamiento, procesamiento principal y post-procesamiento.</p></li><li class="list-item" id="1402701071#vedsen_193"><p id="1402701071#vedsen_199"><span class="control" id="1402701071#vedsen_200">Configuraci&oacute;n Externalizada</span>: Utiliza metadatos personalizados para la configuraci&oacute;n, permitiendo cambios sin modificar c&oacute;digo.</p></li><li class="list-item" id="1402701071#vedsen_194"><p id="1402701071#vedsen_201"><span class="control" id="1402701071#vedsen_202">Manejo de Errores</span>: Implementa manejo centralizado de excepciones.</p></li><li class="list-item" id="1402701071#vedsen_195"><p id="1402701071#vedsen_203"><span class="control" id="1402701071#vedsen_204">Observabilidad</span>: Proporciona eventos de plataforma para monitoreo y auditor&iacute;a.</p></li><li class="list-item" id="1402701071#vedsen_196"><p id="1402701071#vedsen_205"><span class="control" id="1402701071#vedsen_206">Testabilidad</span>: Incluye soporte para mocks durante las pruebas.</p></li></ol></section><section><h2 id="1402701071#consideraciones-de-seguridad" data-toc="consideraciones-de-seguridad#GenerateURLServiceHandler.md-consideraciones-de-seguridad">Consideraciones de Seguridad</h2><ol class="list list-decimal" id="1402701071#vedsen_207" type="1" start="1"><li class="list-item" id="1402701071#vedsen_208"><p id="1402701071#vedsen_211"><span class="control" id="1402701071#vedsen_212">Datos Sensibles</span>: La clase serializa datos de entrada y respuesta para eventos de plataforma. Asegurar que no se expongan datos sensibles.</p></li><li class="list-item" id="1402701071#vedsen_209"><p id="1402701071#vedsen_213"><span class="control" id="1402701071#vedsen_214">Configuraci&oacute;n de Metadatos</span>: Las credenciales y endpoints deben estar adecuadamente protegidos en los metadatos personalizados.</p></li><li class="list-item" id="1402701071#vedsen_210"><p id="1402701071#vedsen_215"><span class="control" id="1402701071#vedsen_216">Validaci&oacute;n de Entrada</span>: Aunque hay comentarios sobre validaci&oacute;n de esquema, la implementaci&oacute;n actual no incluye validaciones robustas.</p></li></ol></section><section><h2 id="1402701071#consideraciones-de-rendimiento" data-toc="consideraciones-de-rendimiento#GenerateURLServiceHandler.md-consideraciones-de-rendimiento">Consideraciones de Rendimiento</h2><ol class="list list-decimal" id="1402701071#vedsen_217" type="1" start="1"><li class="list-item" id="1402701071#vedsen_218"><p id="1402701071#vedsen_221"><span class="control" id="1402701071#vedsen_222">Llamadas HTTP</span>: Las operaciones son s&iacute;ncronas y pueden afectar el tiempo de respuesta total.</p></li><li class="list-item" id="1402701071#vedsen_219"><p id="1402701071#vedsen_223"><span class="control" id="1402701071#vedsen_224">Eventos de Plataforma</span>: La publicaci&oacute;n de m&uacute;ltiples eventos puede tener un impacto en el rendimiento.</p></li><li class="list-item" id="1402701071#vedsen_220"><p id="1402701071#vedsen_225"><span class="control" id="1402701071#vedsen_226">Serializaci&oacute;n JSON</span>: La serializaci&oacute;n repetida de objetos grandes puede ser costosa.</p></li></ol></section><section><h2 id="1402701071#notas-adicionales" data-toc="notas-adicionales#GenerateURLServiceHandler.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="1402701071#vedsen_227" type="1" start="1"><li class="list-item" id="1402701071#vedsen_228"><p id="1402701071#vedsen_233"><span class="control" id="1402701071#vedsen_234">C&oacute;digo Comentado</span>: La clase contiene c&oacute;digo comentado que sugiere funcionalidades planeadas o alternativas (como <span class="inline-code" id="1402701071#vedsen_235">INTEGRATION_PROCEDURE_NAME</span> y <span class="inline-code" id="1402701071#vedsen_236">SERVICE_NAME</span>).</p></li><li class="list-item" id="1402701071#vedsen_229"><p id="1402701071#vedsen_237"><span class="control" id="1402701071#vedsen_238">Par&aacute;metro Ignorado</span>: El par&aacute;metro <span class="inline-code" id="1402701071#vedsen_239">ignoreHash</span> se lee pero no se utiliza en la l&oacute;gica actual.</p></li><li class="list-item" id="1402701071#vedsen_230"><p id="1402701071#vedsen_240"><span class="control" id="1402701071#vedsen_241">M&eacute;todos Virtuales</span>: Los m&eacute;todos <span class="inline-code" id="1402701071#vedsen_242">preProcess</span> y <span class="inline-code" id="1402701071#vedsen_243">postProcess</span> son virtuales, permitiendo su sobrescritura en subclases.</p></li><li class="list-item" id="1402701071#vedsen_231"><p id="1402701071#vedsen_244"><span class="control" id="1402701071#vedsen_245">Autor Modificado</span>: El campo &quot;last modified by&quot; muestra un placeholder, sugiriendo un proceso de configuraci&oacute;n incompleto.</p></li><li class="list-item" id="1402701071#vedsen_232"><p id="1402701071#vedsen_246"><span class="control" id="1402701071#vedsen_247">Flexibilidad</span>: La naturaleza virtual de la clase permite extensi&oacute;n y personalizaci&oacute;n para diferentes tipos de servicios de generaci&oacute;n de URL.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-583978235">ExternalServiceValidationUtil</h1><section><h2 id="-583978235#descripci-n-general" data-toc="descripci-n-general#ExternalServiceValidationUtil.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-583978235#aw5wpl_13"><span class="inline-code" id="-583978235#aw5wpl_14">ExternalServiceValidationUtil</span> es una clase de utilidad que proporciona m&eacute;todos para validar datos utilizados en servicios externos, espec&iacute;ficamente enfocada en la validaci&oacute;n de placas de veh&iacute;culos y el registro de eventos de integraci&oacute;n.</p></section><section><h2 id="-583978235#autor" data-toc="autor#ExternalServiceValidationUtil.md-autor">Autor</h2><p id="-583978235#aw5wpl_15">Felipe Correa \&lt;felipe.correa@nespon.com\&gt;</p></section><section><h2 id="-583978235#proyecto" data-toc="proyecto#ExternalServiceValidationUtil.md-proyecto">Proyecto</h2><p id="-583978235#aw5wpl_16">Foundation Salesforce - Suratech - UH-17585</p></section><section><h2 id="-583978235#ltima-modificaci-n" data-toc="ltima-modificaci-n#ExternalServiceValidationUtil.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="-583978235#aw5wpl_17">17 de enero de 2025</p></section><section><h2 id="-583978235#estructura-y-m-todos" data-toc="estructura-y-m-todos#ExternalServiceValidationUtil.md-estructura-y-m-todos">Estructura y M&eacute;todos</h2><section><h3 id="-583978235#validaci-n-de-placas" data-toc="validaci-n-de-placas#ExternalServiceValidationUtil.md-validaci-n-de-placas">Validaci&oacute;n de Placas</h3><section><h4 id="-583978235#platevalidation-string-plate" data-toc="platevalidation-string-plate#ExternalServiceValidationUtil.md-platevalidation-string-plate">plateValidation(String plate)</h4><section><h5 id="-583978235#descripci-n" data-toc="descripci-n#ExternalServiceValidationUtil.md-descripci-n">Descripci&oacute;n</h5><p id="-583978235#aw5wpl_30">M&eacute;todo p&uacute;blico que procesa y valida una placa de veh&iacute;culo. Convierte la placa a may&uacute;sculas y luego realiza la validaci&oacute;n.</p></section><section><h5 id="-583978235#par-metros" data-toc="par-metros#ExternalServiceValidationUtil.md-par-metros">Par&aacute;metros</h5><ul class="list" id="-583978235#aw5wpl_31" start="1"><li class="list-item" id="-583978235#aw5wpl_32"><p><span class="inline-code" id="-583978235#aw5wpl_33">plate</span> (String): La placa del veh&iacute;culo a validar.</p></li></ul></section><section><h5 id="-583978235#excepciones" data-toc="excepciones#ExternalServiceValidationUtil.md-excepciones">Excepciones</h5><ul class="list" id="-583978235#aw5wpl_34" start="1"><li class="list-item" id="-583978235#aw5wpl_35"><p><span class="inline-code" id="-583978235#aw5wpl_36">ExternalServiceValidationException</span>: Si la placa no cumple con los criterios de validaci&oacute;n.</p></li></ul></section><section><h5 id="-583978235#c-digo" data-toc="c-digo#ExternalServiceValidationUtil.md-c-digo">C&oacute;digo</h5><div class="detached code-block" id="-583978235#aw5wpl_37"><pre><code class="language-none">public static void plateValidation(String plate) {
  plate = parseUpperCase(plate);
  validatePlate(plate);
}</code></pre></div></section></section><section><h4 id="-583978235#parseuppercase-string-param" data-toc="parseuppercase-string-param#ExternalServiceValidationUtil.md-parseuppercase-string-param">parseUpperCase(String param)</h4><section><h5 id="-583978235#descripci-n" data-toc="descripci-n#ExternalServiceValidationUtil.md-descripci-n">Descripci&oacute;n</h5><p id="-583978235#aw5wpl_44">Convierte una cadena a may&uacute;sculas.</p></section><section><h5 id="-583978235#par-metros" data-toc="par-metros#ExternalServiceValidationUtil.md-par-metros">Par&aacute;metros</h5><ul class="list" id="-583978235#aw5wpl_45" start="1"><li class="list-item" id="-583978235#aw5wpl_46"><p><span class="inline-code" id="-583978235#aw5wpl_47">param</span> (String): La cadena a convertir.</p></li></ul></section><section><h5 id="-583978235#retorno" data-toc="retorno#ExternalServiceValidationUtil.md-retorno">Retorno</h5><ul class="list" id="-583978235#aw5wpl_48" start="1"><li class="list-item" id="-583978235#aw5wpl_49"><p><span class="inline-code" id="-583978235#aw5wpl_50">String</span>: La cadena convertida a may&uacute;sculas.</p></li></ul></section><section><h5 id="-583978235#c-digo" data-toc="c-digo#ExternalServiceValidationUtil.md-c-digo">C&oacute;digo</h5><div class="detached code-block" id="-583978235#aw5wpl_51"><pre><code class="language-none">public static String parseUpperCase(String param) {
  return param.toUpperCase();
}</code></pre></div></section></section><section><h4 id="-583978235#validateplate-string-plate" data-toc="validateplate-string-plate#ExternalServiceValidationUtil.md-validateplate-string-plate">validatePlate(String plate)</h4><section><h5 id="-583978235#descripci-n" data-toc="descripci-n#ExternalServiceValidationUtil.md-descripci-n">Descripci&oacute;n</h5><p id="-583978235#aw5wpl_58">Valida una placa de veh&iacute;culo seg&uacute;n criterios espec&iacute;ficos:</p><ul class="list" id="-583978235#aw5wpl_59" start="1"><li class="list-item" id="-583978235#aw5wpl_60"><p>No puede ser nula o vac&iacute;a</p></li><li class="list-item" id="-583978235#aw5wpl_61"><p>Debe tener exactamente 6 caracteres</p></li><li class="list-item" id="-583978235#aw5wpl_62"><p>Debe seguir un patr&oacute;n espec&iacute;fico para autom&oacute;viles o motocicletas</p></li></ul></section><section><h5 id="-583978235#par-metros" data-toc="par-metros#ExternalServiceValidationUtil.md-par-metros">Par&aacute;metros</h5><ul class="list" id="-583978235#aw5wpl_63" start="1"><li class="list-item" id="-583978235#aw5wpl_64"><p><span class="inline-code" id="-583978235#aw5wpl_65">plate</span> (String): La placa del veh&iacute;culo a validar.</p></li></ul></section><section><h5 id="-583978235#excepciones" data-toc="excepciones#ExternalServiceValidationUtil.md-excepciones">Excepciones</h5><ul class="list" id="-583978235#aw5wpl_66" start="1"><li class="list-item" id="-583978235#aw5wpl_67"><p><span class="inline-code" id="-583978235#aw5wpl_68">ExternalServiceValidationException</span>: Si la placa no cumple con alguno de los criterios.</p></li></ul></section><section><h5 id="-583978235#c-digo" data-toc="c-digo#ExternalServiceValidationUtil.md-c-digo">C&oacute;digo</h5><div class="detached code-block" id="-583978235#aw5wpl_69"><pre><code class="language-none">public static void validatePlate(String plate) {
  if (plate == null || String.isEmpty(plate))
    throw new ExternalServiceValidationException(
      'The plate cannot be empty or Null!'
    );
  else if (plate.length() != 6) {
    throw new ExternalServiceValidationException(
      'The plate must contain 6 characters! Actual Length = ' + plate.length()
    );
  } else if (!platePattern(plate)) {
    throw new ExternalServiceValidationException(
      'The plate format must be correct!'
    );
  }
}</code></pre></div></section></section><section><h4 id="-583978235#platepattern-string-plate" data-toc="platepattern-string-plate#ExternalServiceValidationUtil.md-platepattern-string-plate">platePattern(String plate)</h4><section><h5 id="-583978235#descripci-n" data-toc="descripci-n#ExternalServiceValidationUtil.md-descripci-n">Descripci&oacute;n</h5><p id="-583978235#aw5wpl_77">M&eacute;todo privado que verifica si una placa sigue uno de los patrones definidos para autom&oacute;viles o motocicletas utilizando expresiones regulares.</p></section><section><h5 id="-583978235#par-metros" data-toc="par-metros#ExternalServiceValidationUtil.md-par-metros">Par&aacute;metros</h5><ul class="list" id="-583978235#aw5wpl_78" start="1"><li class="list-item" id="-583978235#aw5wpl_79"><p><span class="inline-code" id="-583978235#aw5wpl_80">plate</span> (String): La placa a validar.</p></li></ul></section><section><h5 id="-583978235#retorno" data-toc="retorno#ExternalServiceValidationUtil.md-retorno">Retorno</h5><ul class="list" id="-583978235#aw5wpl_81" start="1"><li class="list-item" id="-583978235#aw5wpl_82"><p><span class="inline-code" id="-583978235#aw5wpl_83">Boolean</span>: <span class="inline-code" id="-583978235#aw5wpl_84">true</span> si la placa sigue alguno de los patrones definidos, <span class="inline-code" id="-583978235#aw5wpl_85">false</span> en caso contrario.</p></li></ul></section><section><h5 id="-583978235#patrones" data-toc="patrones#ExternalServiceValidationUtil.md-patrones">Patrones</h5><ul class="list" id="-583978235#aw5wpl_86" start="1"><li class="list-item" id="-583978235#aw5wpl_87"><p><span class="control" id="-583978235#aw5wpl_89">Autom&oacute;viles</span>: <span class="inline-code" id="-583978235#aw5wpl_90">(^[A-Z]([A-Z0-9][0-9]|[A-Z]{2})[0-9]{2}[A-Z0-9]$)</span></p><ul class="list" id="-583978235#aw5wpl_91" start="1"><li class="list-item" id="-583978235#aw5wpl_92"><p>Comienza con una letra may&uacute;scula</p></li><li class="list-item" id="-583978235#aw5wpl_93"><p>Seguida por una letra may&uacute;scula o n&uacute;mero y un n&uacute;mero, o dos letras may&uacute;sculas</p></li><li class="list-item" id="-583978235#aw5wpl_94"><p>Seguida por dos n&uacute;meros</p></li><li class="list-item" id="-583978235#aw5wpl_95"><p>Termina con una letra may&uacute;scula o n&uacute;mero</p></li></ul></li><li class="list-item" id="-583978235#aw5wpl_88"><p><span class="control" id="-583978235#aw5wpl_96">Motocicletas</span>: <span class="inline-code" id="-583978235#aw5wpl_97">(^[A-Z][0-9]{4}[A-Z0-9]$)</span></p><ul class="list" id="-583978235#aw5wpl_98" start="1"><li class="list-item" id="-583978235#aw5wpl_99"><p>Comienza con una letra may&uacute;scula</p></li><li class="list-item" id="-583978235#aw5wpl_100"><p>Seguida por cuatro n&uacute;meros</p></li><li class="list-item" id="-583978235#aw5wpl_101"><p>Termina con una letra may&uacute;scula o n&uacute;mero</p></li></ul></li></ul></section><section><h5 id="-583978235#c-digo" data-toc="c-digo#ExternalServiceValidationUtil.md-c-digo">C&oacute;digo</h5><div class="detached code-block" id="-583978235#aw5wpl_102"><pre><code class="language-none">private static boolean platePattern(String plate) {
  String carPattern = '(^[A-Z]([A-Z0-9][0-9]|[A-Z]{2})[0-9]{2}[A-Z0-9]$)';
  String motoPattern = '(^[A-Z][0-9]{4}[A-Z0-9]$)';
  // return validatePattern(plate, carPattern+'|'+motoPattern);
  return Pattern.matches(carPattern + '|' + motoPattern, plate);
}</code></pre></div></section></section></section><section><h3 id="-583978235#registro-de-eventos" data-toc="registro-de-eventos#ExternalServiceValidationUtil.md-registro-de-eventos">Registro de Eventos</h3><section><h4 id="-583978235#publishserviceeventlog-string-type-string-details" data-toc="publishserviceeventlog-string-type-string-details#ExternalServiceValidationUtil.md-publishserviceeventlog-string-type-string-details">publishServiceEventLog(String type, String details)</h4><section><h5 id="-583978235#descripci-n" data-toc="descripci-n#ExternalServiceValidationUtil.md-descripci-n">Descripci&oacute;n</h5><p id="-583978235#aw5wpl_110">Publica un registro de evento relacionado con servicios externos si la funci&oacute;n de registros de eventos est&aacute; habilitada a trav&eacute;s de <span class="inline-code" id="-583978235#aw5wpl_111">FeatureFlags</span>.</p></section><section><h5 id="-583978235#par-metros" data-toc="par-metros#ExternalServiceValidationUtil.md-par-metros">Par&aacute;metros</h5><ul class="list" id="-583978235#aw5wpl_112" start="1"><li class="list-item" id="-583978235#aw5wpl_113"><p><span class="inline-code" id="-583978235#aw5wpl_115">type</span> (String): El tipo o nivel del evento (por ejemplo, 'ERROR', 'INFO', etc.).</p></li><li class="list-item" id="-583978235#aw5wpl_114"><p><span class="inline-code" id="-583978235#aw5wpl_116">details</span> (String): Detalles del evento a registrar.</p></li></ul></section><section><h5 id="-583978235#proceso" data-toc="proceso#ExternalServiceValidationUtil.md-proceso">Proceso</h5><ol class="list list-decimal" id="-583978235#aw5wpl_117" type="1" start="1"><li class="list-item" id="-583978235#aw5wpl_118"><p>Verifica si la funci&oacute;n <span class="inline-code" id="-583978235#aw5wpl_120">sura_foundation_event_logs</span> est&aacute; habilitada.</p></li><li class="list-item" id="-583978235#aw5wpl_119"><p>Si est&aacute; habilitada, registra un evento asincr&oacute;nico con informaci&oacute;n sobre el servicio externo.</p></li></ol></section><section><h5 id="-583978235#c-digo" data-toc="c-digo#ExternalServiceValidationUtil.md-c-digo">C&oacute;digo</h5><div class="detached code-block" id="-583978235#aw5wpl_121"><pre><code class="language-none">public static void publishServiceEventLog(String type, String details) {
  if (new FeatureFlags().evaluate('sura_foundation_event_logs').isEnabled()) {
    Core.debug('Saving ' + type + ' Log...');
    EventLogManager.saveAsync(
      JSON.serialize(
        new List&lt;Map&lt;String, Object&gt;&gt;{
          new Map&lt;String, Object&gt;{
            'Product' =&gt; 'All',
            'Level' =&gt; type,
            'Platform' =&gt; 'Salesforce',
            'Details' =&gt; details,
            'Process' =&gt; 'External Service',
            'Type' =&gt; 'Integración'
          }
        }
      )
    );
  }
}</code></pre></div></section></section></section></section><section><h2 id="-583978235#dependencias" data-toc="dependencias#ExternalServiceValidationUtil.md-dependencias">Dependencias</h2><ul class="list" id="-583978235#aw5wpl_122" start="1"><li class="list-item" id="-583978235#aw5wpl_123"><p><span class="inline-code" id="-583978235#aw5wpl_127">ExternalServiceValidationException</span>: Excepci&oacute;n personalizada lanzada cuando se incumplen los criterios de validaci&oacute;n.</p></li><li class="list-item" id="-583978235#aw5wpl_124"><p><span class="inline-code" id="-583978235#aw5wpl_128">FeatureFlags</span>: Clase que gestiona la habilitaci&oacute;n de caracter&iacute;sticas a trav&eacute;s de indicadores.</p></li><li class="list-item" id="-583978235#aw5wpl_125"><p><span class="inline-code" id="-583978235#aw5wpl_129">Core</span>: Clase de utilidad que proporciona el m&eacute;todo <span class="inline-code" id="-583978235#aw5wpl_130">debug</span> para registro.</p></li><li class="list-item" id="-583978235#aw5wpl_126"><p><span class="inline-code" id="-583978235#aw5wpl_131">EventLogManager</span>: Gestor que proporciona funcionalidades para guardar registros de eventos.</p></li></ul></section><section><h2 id="-583978235#ejemplo-de-uso" data-toc="ejemplo-de-uso#ExternalServiceValidationUtil.md-ejemplo-de-uso">Ejemplo de Uso</h2><section><h3 id="-583978235#validaci-n-de-placa" data-toc="validaci-n-de-placa#ExternalServiceValidationUtil.md-validaci-n-de-placa">Validaci&oacute;n de Placa</h3><div class="detached code-block" id="-583978235#aw5wpl_134"><pre><code class="language-none">try {
    // Validar una placa de automóvil
    ExternalServiceValidationUtil.plateValidation('ABC123');
    System.debug('La placa es válida.');
    
    // Proceder con operaciones relacionadas con la placa
    // ...
} catch (ExternalServiceValidationException e) {
    // Manejar error de validación
    System.debug('Error de validación: ' + e.getMessage());
    
    // Registrar el error
    ExternalServiceValidationUtil.publishServiceEventLog('ERROR', e.getMessage());
    
    // Informar al usuario
    ApexPages.addMessage(new ApexPages.Message(
        ApexPages.Severity.ERROR,
        'La placa proporcionada no es válida: ' + e.getMessage()
    ));
}</code></pre></div></section><section><h3 id="-583978235#publicaci-n-de-evento-de-servicio" data-toc="publicaci-n-de-evento-de-servicio#ExternalServiceValidationUtil.md-publicaci-n-de-evento-de-servicio">Publicaci&oacute;n de Evento de Servicio</h3><div class="detached code-block" id="-583978235#aw5wpl_135"><pre><code class="language-none">// Registrar un evento informativo
ExternalServiceValidationUtil.publishServiceEventLog(
    'INFO', 
    'Consulta exitosa a servicio externo de validación de placas. Placa: ABC123'
);

// Registrar un evento de error
try {
    // Operación del servicio externo
    // ...
} catch (Exception e) {
    ExternalServiceValidationUtil.publishServiceEventLog(
        'ERROR', 
        'Error en servicio externo: ' + e.getMessage()
    );
}</code></pre></div></section></section><section><h2 id="-583978235#patrones-v-lidos-de-placas" data-toc="patrones-v-lidos-de-placas#ExternalServiceValidationUtil.md-patrones-v-lidos-de-placas">Patrones V&aacute;lidos de Placas</h2><section><h3 id="-583978235#autom-viles-carpattern" data-toc="autom-viles-carpattern#ExternalServiceValidationUtil.md-autom-viles-carpattern">Autom&oacute;viles (carPattern)</h3><ul class="list" id="-583978235#aw5wpl_138" start="1"><li class="list-item" id="-583978235#aw5wpl_139"><p><span class="control" id="-583978235#aw5wpl_141">Patr&oacute;n</span>: <span class="inline-code" id="-583978235#aw5wpl_142">(^[A-Z]([A-Z0-9][0-9]|[A-Z]{2})[0-9]{2}[A-Z0-9]$)</span></p></li><li class="list-item" id="-583978235#aw5wpl_140"><p><span class="control" id="-583978235#aw5wpl_143">Ejemplos v&aacute;lidos</span>: </p><ul class="list" id="-583978235#aw5wpl_144" start="1"><li class="list-item" id="-583978235#aw5wpl_145"><p><span class="inline-code" id="-583978235#aw5wpl_147">ABC123</span>: Primera letra (A) + dos letras (BC) + dos n&uacute;meros (12) + letra/n&uacute;mero (3)</p></li><li class="list-item" id="-583978235#aw5wpl_146"><p><span class="inline-code" id="-583978235#aw5wpl_148">A1D234</span>: Primera letra (A) + letra/n&uacute;mero y n&uacute;mero (1D) + dos n&uacute;meros (23) + letra/n&uacute;mero (4)</p></li></ul></li></ul></section><section><h3 id="-583978235#motocicletas-motopattern" data-toc="motocicletas-motopattern#ExternalServiceValidationUtil.md-motocicletas-motopattern">Motocicletas (motoPattern)</h3><ul class="list" id="-583978235#aw5wpl_149" start="1"><li class="list-item" id="-583978235#aw5wpl_150"><p><span class="control" id="-583978235#aw5wpl_152">Patr&oacute;n</span>: <span class="inline-code" id="-583978235#aw5wpl_153">(^[A-Z][0-9]{4}[A-Z0-9]$)</span></p></li><li class="list-item" id="-583978235#aw5wpl_151"><p><span class="control" id="-583978235#aw5wpl_154">Ejemplos v&aacute;lidos</span>: </p><ul class="list" id="-583978235#aw5wpl_155" start="1"><li class="list-item" id="-583978235#aw5wpl_156"><p><span class="inline-code" id="-583978235#aw5wpl_158">A1234B</span>: Primera letra (A) + cuatro n&uacute;meros (1234) + letra/n&uacute;mero (B)</p></li><li class="list-item" id="-583978235#aw5wpl_157"><p><span class="inline-code" id="-583978235#aw5wpl_159">Z9876X</span>: Primera letra (Z) + cuatro n&uacute;meros (9876) + letra/n&uacute;mero (X)</p></li></ul></li></ul></section></section><section><h2 id="-583978235#notas-adicionales" data-toc="notas-adicionales#ExternalServiceValidationUtil.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-583978235#aw5wpl_160" type="1" start="1"><li class="list-item" id="-583978235#aw5wpl_161"><p>La clase contiene c&oacute;digo comentado que sugiere una implementaci&oacute;n alternativa para la validaci&oacute;n de patrones y el guardado sincr&oacute;nico de eventos. Estas l&iacute;neas est&aacute;n actualmente inactivas.</p></li><li class="list-item" id="-583978235#aw5wpl_162"><p>El m&eacute;todo <span class="inline-code" id="-583978235#aw5wpl_166">publishServiceEventLog</span> utiliza <span class="inline-code" id="-583978235#aw5wpl_167">saveAsync</span> para guardar los eventos de manera asincr&oacute;nica, lo que optimiza el rendimiento al no bloquear la transacci&oacute;n actual.</p></li><li class="list-item" id="-583978235#aw5wpl_163"><p>La validaci&oacute;n de placas est&aacute; dise&ntilde;ada espec&iacute;ficamente para un formato que tiene 6 caracteres, siguiendo patrones diferentes para autom&oacute;viles y motocicletas.</p></li><li class="list-item" id="-583978235#aw5wpl_164"><p>La clase utiliza regiones de c&oacute;digo (<span class="inline-code" id="-583978235#aw5wpl_168">#region</span>) para organizar l&oacute;gicamente los m&eacute;todos relacionados, mejorando la legibilidad del c&oacute;digo.</p></li><li class="list-item" id="-583978235#aw5wpl_165"><p>El uso de <span class="inline-code" id="-583978235#aw5wpl_169">FeatureFlags</span> permite habilitar o deshabilitar el registro de eventos sin modificar el c&oacute;digo, facilitando los despliegues y pruebas.</p></li></ol></section><section><h2 id="-583978235#posibles-mejoras" data-toc="posibles-mejoras#ExternalServiceValidationUtil.md-posibles-mejoras">Posibles Mejoras</h2><ol class="list list-decimal" id="-583978235#aw5wpl_170" type="1" start="1"><li class="list-item" id="-583978235#aw5wpl_171"><p>A&ntilde;adir documentaci&oacute;n JavaDoc completa a todos los m&eacute;todos.</p></li><li class="list-item" id="-583978235#aw5wpl_172"><p>Implementar validaciones adicionales para otros tipos de datos utilizados en servicios externos.</p></li><li class="list-item" id="-583978235#aw5wpl_173"><p>Proporcionar m&eacute;todos de utilidad para validar y formatear otros tipos comunes de informaci&oacute;n (como n&uacute;meros de identificaci&oacute;n, correos electr&oacute;nicos, etc.).</p></li><li class="list-item" id="-583978235#aw5wpl_174"><p>Implementar m&eacute;todos para validar placas de diferentes longitudes o formatos, para adaptarse a posibles cambios en los requisitos de formato.</p></li><li class="list-item" id="-583978235#aw5wpl_175"><p>A&ntilde;adir tests unitarios exhaustivos para cubrir todos los casos posibles de validaci&oacute;n.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-513411284">ExternalServiceValidationException</h1><section><h2 id="-513411284#descripci-n-general" data-toc="descripci-n-general#ExternalServiceValidationException.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-513411284#-mwpojk_13"><span class="inline-code" id="-513411284#-mwpojk_14">ExternalServiceValidationException</span> es una clase de excepci&oacute;n personalizada que extiende la clase base <span class="inline-code" id="-513411284#-mwpojk_15">Exception</span> de Apex. Esta excepci&oacute;n est&aacute; dise&ntilde;ada espec&iacute;ficamente para representar errores de validaci&oacute;n que ocurren durante la interacci&oacute;n con servicios externos.</p></section><section><h2 id="-513411284#estructura-de-la-clase" data-toc="estructura-de-la-clase#ExternalServiceValidationException.md-estructura-de-la-clase">Estructura de la Clase</h2><div class="detached code-block" id="-513411284#-mwpojk_16"><pre><code class="language-none">public class ExternalServiceValidationException extends Exception {
}</code></pre></div></section><section><h2 id="-513411284#caracter-sticas" data-toc="caracter-sticas#ExternalServiceValidationException.md-caracter-sticas">Caracter&iacute;sticas</h2><section><h3 id="-513411284#herencia" data-toc="herencia#ExternalServiceValidationException.md-herencia">Herencia</h3><p id="-513411284#-mwpojk_19">La clase <span class="inline-code" id="-513411284#-mwpojk_20">ExternalServiceValidationException</span> hereda de la clase base <span class="inline-code" id="-513411284#-mwpojk_21">Exception</span> de Apex, lo que significa que hereda todos los m&eacute;todos y propiedades est&aacute;ndar de las excepciones de Apex.</p></section><section><h3 id="-513411284#accesibilidad" data-toc="accesibilidad#ExternalServiceValidationException.md-accesibilidad">Accesibilidad</h3><ul class="list" id="-513411284#-mwpojk_22" start="1"><li class="list-item" id="-513411284#-mwpojk_23"><p><span class="control" id="-513411284#-mwpojk_25">Modificador de Acceso</span>: <span class="inline-code" id="-513411284#-mwpojk_26">public</span></p></li><li class="list-item" id="-513411284#-mwpojk_24"><p><span class="control" id="-513411284#-mwpojk_27">Descripci&oacute;n</span>: La excepci&oacute;n es accesible desde cualquier contexto dentro de la organizaci&oacute;n.</p></li></ul></section></section><section><h2 id="-513411284#funcionalidad" data-toc="funcionalidad#ExternalServiceValidationException.md-funcionalidad">Funcionalidad</h2><p id="-513411284#-mwpojk_28">Esta excepci&oacute;n personalizada proporciona una forma espec&iacute;fica de indicar errores relacionados con la validaci&oacute;n de servicios externos. Al utilizar una clase de excepci&oacute;n dedicada, el c&oacute;digo que interact&uacute;a con servicios externos puede capturar y manejar espec&iacute;ficamente los errores de validaci&oacute;n, separ&aacute;ndolos de otros tipos de excepciones.</p></section><section><h2 id="-513411284#m-todos-heredados" data-toc="m-todos-heredados#ExternalServiceValidationException.md-m-todos-heredados">M&eacute;todos Heredados</h2><p id="-513411284#-mwpojk_29">Al extender la clase base <span class="inline-code" id="-513411284#-mwpojk_35">Exception</span>, esta clase hereda los siguientes m&eacute;todos importantes:</p><section><h3 id="-513411284#getmessage" data-toc="getmessage#ExternalServiceValidationException.md-getmessage">getMessage()</h3><ul class="list" id="-513411284#-mwpojk_37" start="1"><li class="list-item" id="-513411284#-mwpojk_39"><p><span class="control" id="-513411284#-mwpojk_41">Retorno</span>: <span class="inline-code" id="-513411284#-mwpojk_42">String</span></p></li><li class="list-item" id="-513411284#-mwpojk_40"><p><span class="control" id="-513411284#-mwpojk_43">Descripci&oacute;n</span>: Devuelve el mensaje de error asociado con la excepci&oacute;n.</p></li></ul></section><section><h3 id="-513411284#gettypename" data-toc="gettypename#ExternalServiceValidationException.md-gettypename">getTypeName()</h3><ul class="list" id="-513411284#-mwpojk_45" start="1"><li class="list-item" id="-513411284#-mwpojk_47"><p><span class="control" id="-513411284#-mwpojk_49">Retorno</span>: <span class="inline-code" id="-513411284#-mwpojk_50">String</span></p></li><li class="list-item" id="-513411284#-mwpojk_48"><p><span class="control" id="-513411284#-mwpojk_51">Descripci&oacute;n</span>: Devuelve el nombre completo de la clase de excepci&oacute;n.</p></li></ul></section><section><h3 id="-513411284#getcause" data-toc="getcause#ExternalServiceValidationException.md-getcause">getCause()</h3><ul class="list" id="-513411284#-mwpojk_53" start="1"><li class="list-item" id="-513411284#-mwpojk_55"><p><span class="control" id="-513411284#-mwpojk_57">Retorno</span>: <span class="inline-code" id="-513411284#-mwpojk_58">Exception</span></p></li><li class="list-item" id="-513411284#-mwpojk_56"><p><span class="control" id="-513411284#-mwpojk_59">Descripci&oacute;n</span>: Devuelve la excepci&oacute;n causante, si existe.</p></li></ul></section><section><h3 id="-513411284#getlinenumber" data-toc="getlinenumber#ExternalServiceValidationException.md-getlinenumber">getLineNumber()</h3><ul class="list" id="-513411284#-mwpojk_61" start="1"><li class="list-item" id="-513411284#-mwpojk_63"><p><span class="control" id="-513411284#-mwpojk_65">Retorno</span>: <span class="inline-code" id="-513411284#-mwpojk_66">Integer</span></p></li><li class="list-item" id="-513411284#-mwpojk_64"><p><span class="control" id="-513411284#-mwpojk_67">Descripci&oacute;n</span>: Devuelve el n&uacute;mero de l&iacute;nea donde se produjo la excepci&oacute;n.</p></li></ul></section><section><h3 id="-513411284#getstacktracestring" data-toc="getstacktracestring#ExternalServiceValidationException.md-getstacktracestring">getStackTraceString()</h3><ul class="list" id="-513411284#-mwpojk_69" start="1"><li class="list-item" id="-513411284#-mwpojk_71"><p><span class="control" id="-513411284#-mwpojk_73">Retorno</span>: <span class="inline-code" id="-513411284#-mwpojk_74">String</span></p></li><li class="list-item" id="-513411284#-mwpojk_72"><p><span class="control" id="-513411284#-mwpojk_75">Descripci&oacute;n</span>: Devuelve la traza de la pila como una cadena.</p></li></ul></section></section><section><h2 id="-513411284#constructores-impl-citos" data-toc="constructores-impl-citos#ExternalServiceValidationException.md-constructores-impl-citos">Constructores Impl&iacute;citos</h2><p id="-513411284#-mwpojk_76">Aunque no est&aacute;n expl&iacute;citamente definidos en el c&oacute;digo, la clase hereda los siguientes constructores de la clase base <span class="inline-code" id="-513411284#-mwpojk_81">Exception</span>:</p><section><h3 id="-513411284#externalservicevalidationexception" data-toc="externalservicevalidationexception#ExternalServiceValidationException.md-externalservicevalidationexception">ExternalServiceValidationException()</h3><ul class="list" id="-513411284#-mwpojk_83" start="1"><li class="list-item" id="-513411284#-mwpojk_85"><p><span class="control" id="-513411284#-mwpojk_86">Descripci&oacute;n</span>: Constructor por defecto que crea una instancia de la excepci&oacute;n sin mensaje.</p></li></ul></section><section><h3 id="-513411284#externalservicevalidationexception-string-message" data-toc="externalservicevalidationexception-string-message#ExternalServiceValidationException.md-externalservicevalidationexception-string-message">ExternalServiceValidationException(String message)</h3><ul class="list" id="-513411284#-mwpojk_88" start="1"><li class="list-item" id="-513411284#-mwpojk_90"><p><span class="control" id="-513411284#-mwpojk_92">Descripci&oacute;n</span>: Constructor que crea una instancia de la excepci&oacute;n con un mensaje espec&iacute;fico.</p></li><li class="list-item" id="-513411284#-mwpojk_91"><p><span class="control" id="-513411284#-mwpojk_93">Par&aacute;metros</span>: </p><ul class="list" id="-513411284#-mwpojk_94" start="1"><li class="list-item" id="-513411284#-mwpojk_95"><p><span class="inline-code" id="-513411284#-mwpojk_96">message</span> (String): Mensaje descriptivo de la excepci&oacute;n.</p></li></ul></li></ul></section><section><h3 id="-513411284#externalservicevalidationexception-exception-cause" data-toc="externalservicevalidationexception-exception-cause#ExternalServiceValidationException.md-externalservicevalidationexception-exception-cause">ExternalServiceValidationException(Exception cause)</h3><ul class="list" id="-513411284#-mwpojk_98" start="1"><li class="list-item" id="-513411284#-mwpojk_100"><p><span class="control" id="-513411284#-mwpojk_102">Descripci&oacute;n</span>: Constructor que crea una instancia de la excepci&oacute;n con una excepci&oacute;n causante.</p></li><li class="list-item" id="-513411284#-mwpojk_101"><p><span class="control" id="-513411284#-mwpojk_103">Par&aacute;metros</span>: </p><ul class="list" id="-513411284#-mwpojk_104" start="1"><li class="list-item" id="-513411284#-mwpojk_105"><p><span class="inline-code" id="-513411284#-mwpojk_106">cause</span> (Exception): Excepci&oacute;n causante.</p></li></ul></li></ul></section><section><h3 id="-513411284#externalservicevalidationexception-string-message-exception-cause" data-toc="externalservicevalidationexception-string-message-exception-cause#ExternalServiceValidationException.md-externalservicevalidationexception-string-message-exception-cause">ExternalServiceValidationException(String message, Exception cause)</h3><ul class="list" id="-513411284#-mwpojk_108" start="1"><li class="list-item" id="-513411284#-mwpojk_110"><p><span class="control" id="-513411284#-mwpojk_112">Descripci&oacute;n</span>: Constructor que crea una instancia de la excepci&oacute;n con un mensaje y una excepci&oacute;n causante.</p></li><li class="list-item" id="-513411284#-mwpojk_111"><p><span class="control" id="-513411284#-mwpojk_113">Par&aacute;metros</span>: </p><ul class="list" id="-513411284#-mwpojk_114" start="1"><li class="list-item" id="-513411284#-mwpojk_115"><p><span class="inline-code" id="-513411284#-mwpojk_117">message</span> (String): Mensaje descriptivo de la excepci&oacute;n.</p></li><li class="list-item" id="-513411284#-mwpojk_116"><p><span class="inline-code" id="-513411284#-mwpojk_118">cause</span> (Exception): Excepci&oacute;n causante.</p></li></ul></li></ul></section></section><section><h2 id="-513411284#ejemplo-de-uso" data-toc="ejemplo-de-uso#ExternalServiceValidationException.md-ejemplo-de-uso">Ejemplo de Uso</h2><div class="detached code-block" id="-513411284#-mwpojk_119"><pre><code class="language-none">public class ExternalServiceConnector {
    
    /**
     * @description Valida y procesa datos con un servicio externo
     * @param data Los datos a procesar
     * @return Los datos procesados
     * @throws ExternalServiceValidationException Si los datos no pasan la validación
     */
    public Map&lt;String, Object&gt; processWithExternalService(Map&lt;String, Object&gt; data) {
        // Validar los datos antes de enviarlos al servicio externo
        if (!isValidForExternalService(data)) {
            throw new ExternalServiceValidationException(
                'Los datos proporcionados no cumplen con los requisitos del servicio externo');
        }
        
        try {
            // Código para interactuar con el servicio externo
            HttpRequest req = new HttpRequest();
            req.setEndpoint('https://api.ejemplo.com/procesar');
            req.setMethod('POST');
            req.setHeader('Content-Type', 'application/json');
            req.setBody(JSON.serialize(data));
            
            Http http = new Http();
            HttpResponse res = http.send(req);
            
            // Validar la respuesta
            if (res.getStatusCode() != 200) {
                Map&lt;String, Object&gt; errorResponse = (Map&lt;String, Object&gt;)JSON.deserializeUntyped(res.getBody());
                throw new ExternalServiceValidationException(
                    'Error del servicio externo: ' + errorResponse.get('error_message'));
            }
            
            return (Map&lt;String, Object&gt;)JSON.deserializeUntyped(res.getBody());
        } catch (Exception e) {
            if (e instanceof ExternalServiceValidationException) {
                throw e; // Relanzar excepciones de validación
            }
            throw new ExternalServiceValidationException(
                'Error al procesar con el servicio externo: ' + e.getMessage(), e);
        }
    }
    
    /**
     * @description Valida si los datos cumplen con los requisitos del servicio externo
     * @param data Los datos a validar
     * @return true si los datos son válidos, false en caso contrario
     */
    private Boolean isValidForExternalService(Map&lt;String, Object&gt; data) {
        // Implementación de la lógica de validación
        if (data == null || data.isEmpty()) {
            return false;
        }
        
        // Verificar campos requeridos
        String[] requiredFields = new String[] {'id', 'nombre', 'tipo'};
        for (String field : requiredFields) {
            if (!data.containsKey(field) || data.get(field) == null) {
                return false;
            }
        }
        
        return true;
    }
}</code></pre></div></section><section><h2 id="-513411284#manejo-de-la-excepci-n" data-toc="manejo-de-la-excepci-n#ExternalServiceValidationException.md-manejo-de-la-excepci-n">Manejo de la Excepci&oacute;n</h2><div class="detached code-block" id="-513411284#-mwpojk_120"><pre><code class="language-none">try {
    Map&lt;String, Object&gt; data = new Map&lt;String, Object&gt; {
        'id' =&gt; '12345',
        'nombre' =&gt; 'Ejemplo',
        // Falta el campo 'tipo'
    };
    
    ExternalServiceConnector connector = new ExternalServiceConnector();
    Map&lt;String, Object&gt; result = connector.processWithExternalService(data);
    
    // Procesar el resultado exitoso
    System.debug('Procesamiento exitoso: ' + result);
} catch (ExternalServiceValidationException e) {
    // Manejar específicamente los errores de validación
    System.debug('Error de validación: ' + e.getMessage());
    
    // Registrar el error
    LoggerUtility.logError('ExternalServiceValidation', e.getMessage(), e.getStackTraceString());
    
    // Notificar al usuario con un mensaje amigable
    ApexPages.addMessage(new ApexPages.Message(
        ApexPages.Severity.ERROR,
        'No se pudo completar la operación debido a un problema de validación con el servicio externo. ' +
        'Por favor, verifique los datos proporcionados.'));
} catch (Exception e) {
    // Manejar otros tipos de excepciones
    System.debug('Error general: ' + e.getMessage());
    LoggerUtility.logError('ExternalServiceGeneral', e.getMessage(), e.getStackTraceString());
}</code></pre></div></section><section><h2 id="-513411284#buenas-pr-cticas" data-toc="buenas-pr-cticas#ExternalServiceValidationException.md-buenas-pr-cticas">Buenas Pr&aacute;cticas</h2><ol class="list list-decimal" id="-513411284#-mwpojk_121" type="1" start="1"><li class="list-item" id="-513411284#-mwpojk_122"><p id="-513411284#-mwpojk_127"><span class="control" id="-513411284#-mwpojk_128">Mensajes descriptivos</span>: Al lanzar una <span class="inline-code" id="-513411284#-mwpojk_129">ExternalServiceValidationException</span>, proporcione mensajes descriptivos que ayuden a identificar la causa exacta del error de validaci&oacute;n.</p></li><li class="list-item" id="-513411284#-mwpojk_123"><p id="-513411284#-mwpojk_130"><span class="control" id="-513411284#-mwpojk_131">Captura espec&iacute;fica</span>: Capture espec&iacute;ficamente esta excepci&oacute;n cuando sea relevante para el contexto de validaci&oacute;n de servicios externos.</p></li><li class="list-item" id="-513411284#-mwpojk_124"><p id="-513411284#-mwpojk_132"><span class="control" id="-513411284#-mwpojk_133">Jerarqu&iacute;a de excepciones</span>: Considere crear una jerarqu&iacute;a de excepciones m&aacute;s detallada si necesita distinguir entre diferentes tipos de errores de validaci&oacute;n de servicios externos.</p></li><li class="list-item" id="-513411284#-mwpojk_125"><p id="-513411284#-mwpojk_134"><span class="control" id="-513411284#-mwpojk_135">Encapsular excepciones originales</span>: Cuando sea apropiado, encapsule la excepci&oacute;n original como causa al lanzar una <span class="inline-code" id="-513411284#-mwpojk_136">ExternalServiceValidationException</span>, para mantener la informaci&oacute;n completa del error.</p></li><li class="list-item" id="-513411284#-mwpojk_126"><p id="-513411284#-mwpojk_137"><span class="control" id="-513411284#-mwpojk_138">Registro adecuado</span>: Aseg&uacute;rese de registrar adecuadamente las excepciones para facilitar la depuraci&oacute;n y el an&aacute;lisis de problemas.</p></li></ol></section><section><h2 id="-513411284#notas-adicionales" data-toc="notas-adicionales#ExternalServiceValidationException.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-513411284#-mwpojk_139" type="1" start="1"><li class="list-item" id="-513411284#-mwpojk_140"><p id="-513411284#-mwpojk_143">Esta excepci&oacute;n personalizada ayuda a mejorar la legibilidad y mantenibilidad del c&oacute;digo al proporcionar un tipo espec&iacute;fico para los errores de validaci&oacute;n de servicios externos.</p></li><li class="list-item" id="-513411284#-mwpojk_141"><p id="-513411284#-mwpojk_144">Aunque la implementaci&oacute;n actual es m&iacute;nima, la clase podr&iacute;a ampliarse en el futuro para incluir propiedades adicionales espec&iacute;ficas de validaci&oacute;n de servicios externos, como c&oacute;digos de error, detalles de campo, o informaci&oacute;n sobre el servicio externo espec&iacute;fico.</p></li><li class="list-item" id="-513411284#-mwpojk_142"><p id="-513411284#-mwpojk_145">En una arquitectura compleja que interact&uacute;e con m&uacute;ltiples servicios externos, podr&iacute;a ser beneficioso extender esta excepci&oacute;n base para crear excepciones m&aacute;s espec&iacute;ficas para cada servicio.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1327318235">ExternalServiceException</h1><section><h2 id="-1327318235#descripci-n-general" data-toc="descripci-n-general#ExternalServiceException.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-1327318235#jwe947_15"><span class="inline-code" id="-1327318235#jwe947_16">ExternalServiceException</span> es una clase de excepci&oacute;n personalizada que extiende la clase <span class="inline-code" id="-1327318235#jwe947_17">Exception</span> est&aacute;ndar de Apex. Esta clase est&aacute; dise&ntilde;ada para representar errores espec&iacute;ficos que ocurren durante la interacci&oacute;n con servicios externos.</p></section><section><h2 id="-1327318235#estructura" data-toc="estructura#ExternalServiceException.md-estructura">Estructura</h2><div class="detached code-block" id="-1327318235#jwe947_18"><pre><code class="language-none">public class ExternalServiceException extends Exception {

}</code></pre></div><p id="-1327318235#jwe947_19">La clase no define m&eacute;todos o propiedades adicionales m&aacute;s all&aacute; de los heredados de la clase base <span class="inline-code" id="-1327318235#jwe947_20">Exception</span>.</p></section><section><h2 id="-1327318235#herencia" data-toc="herencia#ExternalServiceException.md-herencia">Herencia</h2><ul class="list" id="-1327318235#jwe947_21" start="1"><li class="list-item" id="-1327318235#jwe947_22"><p><span class="control" id="-1327318235#jwe947_24">Clase Base</span>: <span class="inline-code" id="-1327318235#jwe947_25">Exception</span></p></li><li class="list-item" id="-1327318235#jwe947_23"><p><span class="control" id="-1327318235#jwe947_26">Paquete</span>: Est&aacute;ndar de Salesforce</p></li></ul></section><section><h2 id="-1327318235#prop-sito" data-toc="prop-sito#ExternalServiceException.md-prop-sito">Prop&oacute;sito</h2><p id="-1327318235#jwe947_27">El prop&oacute;sito principal de esta clase es proporcionar un tipo de excepci&oacute;n espec&iacute;fico para errores relacionados con servicios externos, permitiendo:</p><ol class="list list-decimal" id="-1327318235#jwe947_28" type="1" start="1"><li class="list-item" id="-1327318235#jwe947_29"><p><span class="control" id="-1327318235#jwe947_32">Categorizaci&oacute;n de Errores</span>: Distinguir errores de servicios externos de otros tipos de excepciones en el sistema.</p></li><li class="list-item" id="-1327318235#jwe947_30"><p><span class="control" id="-1327318235#jwe947_33">Manejo Espec&iacute;fico</span>: Permitir que el c&oacute;digo que captura excepciones pueda identificar y manejar espec&iacute;ficamente errores de servicios externos.</p></li><li class="list-item" id="-1327318235#jwe947_31"><p><span class="control" id="-1327318235#jwe947_34">Claridad en el C&oacute;digo</span>: Mejorar la legibilidad del c&oacute;digo al indicar expl&iacute;citamente cuando un error est&aacute; relacionado con un servicio externo.</p></li></ol></section><section><h2 id="-1327318235#m-todos-heredados" data-toc="m-todos-heredados#ExternalServiceException.md-m-todos-heredados">M&eacute;todos Heredados</h2><p id="-1327318235#jwe947_35">Al extender la clase <span class="inline-code" id="-1327318235#jwe947_38">Exception</span> est&aacute;ndar, <span class="inline-code" id="-1327318235#jwe947_39">ExternalServiceException</span> hereda los siguientes m&eacute;todos y propiedades:</p><section><h3 id="-1327318235#constructores" data-toc="constructores#ExternalServiceException.md-constructores">Constructores</h3><ul class="list" id="-1327318235#jwe947_40" start="1"><li class="list-item" id="-1327318235#jwe947_41"><p><span class="control" id="-1327318235#jwe947_45"><span class="inline-code" id="-1327318235#jwe947_46">ExternalServiceException()</span></span>: Constructor por defecto.</p></li><li class="list-item" id="-1327318235#jwe947_42"><p><span class="control" id="-1327318235#jwe947_47"><span class="inline-code" id="-1327318235#jwe947_48">ExternalServiceException(String message)</span></span>: Constructor que acepta un mensaje de error.</p></li><li class="list-item" id="-1327318235#jwe947_43"><p><span class="control" id="-1327318235#jwe947_49"><span class="inline-code" id="-1327318235#jwe947_50">ExternalServiceException(Exception cause)</span></span>: Constructor que acepta otra excepci&oacute;n como causa.</p></li><li class="list-item" id="-1327318235#jwe947_44"><p><span class="control" id="-1327318235#jwe947_51"><span class="inline-code" id="-1327318235#jwe947_52">ExternalServiceException(String message, Exception cause)</span></span>: Constructor que acepta un mensaje y otra excepci&oacute;n como causa.</p></li></ul></section><section><h3 id="-1327318235#m-todos" data-toc="m-todos#ExternalServiceException.md-m-todos">M&eacute;todos</h3><ul class="list" id="-1327318235#jwe947_53" start="1"><li class="list-item" id="-1327318235#jwe947_54"><p><span class="control" id="-1327318235#jwe947_60"><span class="inline-code" id="-1327318235#jwe947_61">getMessage()</span></span>: Devuelve el mensaje de error asociado con la excepci&oacute;n.</p></li><li class="list-item" id="-1327318235#jwe947_55"><p><span class="control" id="-1327318235#jwe947_62"><span class="inline-code" id="-1327318235#jwe947_63">getCause()</span></span>: Devuelve la excepci&oacute;n que caus&oacute; esta excepci&oacute;n, si existe.</p></li><li class="list-item" id="-1327318235#jwe947_56"><p><span class="control" id="-1327318235#jwe947_64"><span class="inline-code" id="-1327318235#jwe947_65">getTypeName()</span></span>: Devuelve el nombre del tipo de excepci&oacute;n.</p></li><li class="list-item" id="-1327318235#jwe947_57"><p><span class="control" id="-1327318235#jwe947_66"><span class="inline-code" id="-1327318235#jwe947_67">setMessage(String message)</span></span>: Establece el mensaje de error para la excepci&oacute;n.</p></li><li class="list-item" id="-1327318235#jwe947_58"><p><span class="control" id="-1327318235#jwe947_68"><span class="inline-code" id="-1327318235#jwe947_69">getLineNumber()</span></span>: Devuelve el n&uacute;mero de l&iacute;nea donde se gener&oacute; la excepci&oacute;n.</p></li><li class="list-item" id="-1327318235#jwe947_59"><p><span class="control" id="-1327318235#jwe947_70"><span class="inline-code" id="-1327318235#jwe947_71">getStackTraceString()</span></span>: Devuelve una representaci&oacute;n de texto del seguimiento de la pila.</p></li></ul></section></section><section><h2 id="-1327318235#uso-en-el-sistema" data-toc="uso-en-el-sistema#ExternalServiceException.md-uso-en-el-sistema">Uso en el Sistema</h2><p id="-1327318235#jwe947_72">Esta excepci&oacute;n es utilizada por varias clases en el sistema que interact&uacute;an con servicios externos, tales como:</p><ol class="list list-decimal" id="-1327318235#jwe947_73" type="1" start="1"><li class="list-item" id="-1327318235#jwe947_74"><p><span class="control" id="-1327318235#jwe947_77"><span class="inline-code" id="-1327318235#jwe947_78">ExternalNotificationHandler</span></span>: La utiliza para envolver excepciones espec&iacute;ficas durante las llamadas a servicios externos.</p></li><li class="list-item" id="-1327318235#jwe947_75"><p><span class="control" id="-1327318235#jwe947_79"><span class="inline-code" id="-1327318235#jwe947_80">RUNTServiceHandler</span></span>: La lanza cuando hay problemas para obtener la configuraci&oacute;n del servicio RUNT.</p></li><li class="list-item" id="-1327318235#jwe947_76"><p><span class="control" id="-1327318235#jwe947_81">Otras clases de integraci&oacute;n</span>: Cualquier clase que realice llamadas a servicios web, APIs externas o sistemas integrados.</p></li></ol></section><section><h2 id="-1327318235#ejemplo-de-lanzamiento" data-toc="ejemplo-de-lanzamiento#ExternalServiceException.md-ejemplo-de-lanzamiento">Ejemplo de Lanzamiento</h2><div class="detached code-block" id="-1327318235#jwe947_82"><pre><code class="language-none">try {
    // Intentar realizar una operación con un servicio externo
    HttpRequest req = new HttpRequest();
    req.setEndpoint('https://api.example.com/resource');
    req.setMethod('GET');
    
    Http http = new Http();
    HttpResponse res = http.send(req);
    
    if (res.getStatusCode() != 200) {
        throw new ExternalServiceException(
            'Error en el servicio externo. Código: ' + res.getStatusCode() + 
            '. Respuesta: ' + res.getBody()
        );
    }
    
    // Procesar la respuesta exitosa
} catch (CalloutException e) {
    throw new ExternalServiceException(
        'Error de comunicación con el servicio externo: ' + e.getMessage(), 
        e
    );
} catch (Exception e) {
    // Manejar otras excepciones
    throw new ExternalServiceException(
        'Error inesperado al interactuar con el servicio externo: ' + e.getMessage(), 
        e
    );
}</code></pre></div></section><section><h2 id="-1327318235#ejemplo-de-captura" data-toc="ejemplo-de-captura#ExternalServiceException.md-ejemplo-de-captura">Ejemplo de Captura</h2><div class="detached code-block" id="-1327318235#jwe947_83"><pre><code class="language-none">try {
    // Llamar a un método que podría lanzar diferentes tipos de excepciones
    processExternalServiceRequest();
} catch (ExternalServiceException e) {
    // Manejo específico para errores de servicios externos
    System.debug('Error de servicio externo: ' + e.getMessage());
    
    // Registrar el error en un objeto personalizado
    External_Service_Error__c errorRecord = new External_Service_Error__c(
        Error_Message__c = e.getMessage(),
        Stack_Trace__c = e.getStackTraceString(),
        Timestamp__c = Datetime.now()
    );
    insert errorRecord;
    
    // Notificar al administrador
    sendErrorNotification('Error de servicio externo', e.getMessage());
} catch (Exception e) {
    // Manejo genérico para otros tipos de excepciones
    System.debug('Error general: ' + e.getMessage());
}</code></pre></div></section><section><h2 id="-1327318235#extensi-n-personalizada" data-toc="extensi-n-personalizada#ExternalServiceException.md-extensi-n-personalizada">Extensi&oacute;n Personalizada</h2><p id="-1327318235#jwe947_84">Aunque la implementaci&oacute;n actual es minimalista, la clase puede ser extendida para incluir informaci&oacute;n adicional espec&iacute;fica de servicios externos:</p><div class="detached code-block" id="-1327318235#jwe947_85"><pre><code class="language-none">public class EnhancedExternalServiceException extends ExternalServiceException {
    private Integer statusCode;
    private String endpoint;
    private String requestBody;
    private String responseBody;
    
    public EnhancedExternalServiceException(String message) {
        super(message);
    }
    
    public EnhancedExternalServiceException(String message, Integer statusCode, String endpoint) {
        super(message);
        this.statusCode = statusCode;
        this.endpoint = endpoint;
    }
    
    public EnhancedExternalServiceException(
        String message, 
        Integer statusCode, 
        String endpoint, 
        String requestBody, 
        String responseBody
    ) {
        super(message);
        this.statusCode = statusCode;
        this.endpoint = endpoint;
        this.requestBody = requestBody;
        this.responseBody = responseBody;
    }
    
    public Integer getStatusCode() {
        return this.statusCode;
    }
    
    public String getEndpoint() {
        return this.endpoint;
    }
    
    public String getRequestBody() {
        return this.requestBody;
    }
    
    public String getResponseBody() {
        return this.responseBody;
    }
}</code></pre></div></section><section><h2 id="-1327318235#mejores-pr-cticas" data-toc="mejores-pr-cticas#ExternalServiceException.md-mejores-pr-cticas">Mejores Pr&aacute;cticas</h2><ol class="list list-decimal" id="-1327318235#jwe947_86" type="1" start="1"><li class="list-item" id="-1327318235#jwe947_87"><p><span class="control" id="-1327318235#jwe947_92">Mensajes Descriptivos</span>: Incluir informaci&oacute;n espec&iacute;fica en los mensajes de error, como c&oacute;digos de estado, endpoints y respuestas.</p></li><li class="list-item" id="-1327318235#jwe947_88"><p><span class="control" id="-1327318235#jwe947_93">Captura Selectiva</span>: Capturar esta excepci&oacute;n espec&iacute;ficamente cuando se quiera manejar errores de servicios externos de manera diferenciada.</p></li><li class="list-item" id="-1327318235#jwe947_89"><p><span class="control" id="-1327318235#jwe947_94">Informaci&oacute;n de Contexto</span>: Al lanzar la excepci&oacute;n, proporcionar informaci&oacute;n de contexto que pueda ayudar a diagnosticar el problema.</p></li><li class="list-item" id="-1327318235#jwe947_90"><p><span class="control" id="-1327318235#jwe947_95">Encadenamiento de Excepciones</span>: Utilizar el constructor que acepta una excepci&oacute;n causa para preservar el seguimiento de la pila original.</p></li><li class="list-item" id="-1327318235#jwe947_91"><p><span class="control" id="-1327318235#jwe947_96">Registro Adecuado</span>: Registrar las excepciones capturadas para su posterior an&aacute;lisis y soluci&oacute;n de problemas.</p></li></ol></section><section><h2 id="-1327318235#puntos-a-considerar" data-toc="puntos-a-considerar#ExternalServiceException.md-puntos-a-considerar">Puntos a Considerar</h2><ol class="list list-decimal" id="-1327318235#jwe947_97" type="1" start="1"><li class="list-item" id="-1327318235#jwe947_98"><p><span class="control" id="-1327318235#jwe947_101">Simplicidad vs. Especializaci&oacute;n</span>: La implementaci&oacute;n actual es muy simple, lo que la hace flexible pero menos especializada. Considerar si se necesita una versi&oacute;n m&aacute;s especializada con campos adicionales.</p></li><li class="list-item" id="-1327318235#jwe947_99"><p><span class="control" id="-1327318235#jwe947_102">Seguridad</span>: Tener cuidado con la informaci&oacute;n sensible que se incluye en los mensajes de excepci&oacute;n, especialmente si estos se muestran a los usuarios finales.</p></li><li class="list-item" id="-1327318235#jwe947_100"><p><span class="control" id="-1327318235#jwe947_103">Rendimiento</span>: La creaci&oacute;n de objetos de excepci&oacute;n tiene un costo, por lo que deben utilizarse apropiadamente y no como mecanismo de control de flujo normal.</p></li></ol></section><section><h2 id="-1327318235#notas-adicionales" data-toc="notas-adicionales#ExternalServiceException.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-1327318235#jwe947_104" type="1" start="1"><li class="list-item" id="-1327318235#jwe947_105"><p>Esta clase forma parte del ecosistema de integraci&oacute;n de la organizaci&oacute;n y se utiliza en conjunto con otras clases como <span class="inline-code" id="-1327318235#jwe947_108">ExternalNotificationHandler</span> y <span class="inline-code" id="-1327318235#jwe947_109">RUNTServiceHandler</span>.</p></li><li class="list-item" id="-1327318235#jwe947_106"><p>La simplicidad de la implementaci&oacute;n sugiere que la clase se utiliza principalmente para categorizaci&oacute;n de errores m&aacute;s que para transportar informaci&oacute;n adicional espec&iacute;fica.</p></li><li class="list-item" id="-1327318235#jwe947_107"><p>En un entorno de producci&oacute;n, considerar la implementaci&oacute;n de mecanismos de registro y notificaci&oacute;n automatizados para errores de servicios externos.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1425473036">ExternalNotificationHandler</h1><section><h2 id="-1425473036#descripci-n-general" data-toc="descripci-n-general#ExternalNotificationHandler.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-1425473036#-sz7wae_17"><span class="inline-code" id="-1425473036#-sz7wae_18">ExternalNotificationHandler</span> es una clase virtual que extiende <span class="inline-code" id="-1425473036#-sz7wae_19">PlatformEventIntegrationObserver</span> y est&aacute; dise&ntilde;ada para manejar notificaciones a servicios externos. Esta clase implementa un mecanismo sofisticado de llamadas HTTP a servicios externos con capacidades de reintento, control de tiempos de espera, y registro de eventos de plataforma para monitoreo y depuraci&oacute;n.</p></section><section><h2 id="-1425473036#autor" data-toc="autor#ExternalNotificationHandler.md-autor">Autor</h2><p id="-1425473036#-sz7wae_20">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="-1425473036#ltima-modificaci-n" data-toc="ltima-modificaci-n#ExternalNotificationHandler.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="-1425473036#-sz7wae_21">9 de mayo de 2025 por Esneyder Zabala</p></section><section><h2 id="-1425473036#constantes-y-variables-est-ticas" data-toc="constantes-y-variables-est-ticas#ExternalNotificationHandler.md-constantes-y-variables-est-ticas">Constantes y Variables Est&aacute;ticas</h2><div class="table-wrapper detached"><table id="-1425473036#-sz7wae_22"><tr class="header-row" id="-1425473036#-sz7wae_23"><th id="-1425473036#-sz7wae_31"><p>Nombre</p></th><th id="-1425473036#-sz7wae_32"><p>Tipo</p></th><th id="-1425473036#-sz7wae_33"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-1425473036#-sz7wae_24"><td id="-1425473036#-sz7wae_34"><p><span class="inline-code" id="-1425473036#-sz7wae_37">NAMED_CREDENTIAL</span></p></td><td id="-1425473036#-sz7wae_35"><p><span class="inline-code" id="-1425473036#-sz7wae_38">String</span></p></td><td id="-1425473036#-sz7wae_36"><p>Nombre de la credencial con nombre utilizada para autenticaci&oacute;n: 'Suratech_Integration_Bus_Credentials'</p></td></tr><tr class="" id="-1425473036#-sz7wae_25"><td id="-1425473036#-sz7wae_39"><p><span class="inline-code" id="-1425473036#-sz7wae_42">skipLogDefault</span></p></td><td id="-1425473036#-sz7wae_40"><p><span class="inline-code" id="-1425473036#-sz7wae_43">Boolean</span></p></td><td id="-1425473036#-sz7wae_41"><p>Controla si se deben registrar logs de eventos. Valor por defecto: <span class="inline-code" id="-1425473036#-sz7wae_44">false</span></p></td></tr><tr class="" id="-1425473036#-sz7wae_26"><td id="-1425473036#-sz7wae_45"><p><span class="inline-code" id="-1425473036#-sz7wae_48">retryQuantity</span></p></td><td id="-1425473036#-sz7wae_46"><p><span class="inline-code" id="-1425473036#-sz7wae_49">Integer</span></p></td><td id="-1425473036#-sz7wae_47"><p>N&uacute;mero de reintentos realizados. Valor inicial: <span class="inline-code" id="-1425473036#-sz7wae_50">1</span></p></td></tr><tr class="" id="-1425473036#-sz7wae_27"><td id="-1425473036#-sz7wae_51"><p><span class="inline-code" id="-1425473036#-sz7wae_54">familyProductControl</span></p></td><td id="-1425473036#-sz7wae_52"><p><span class="inline-code" id="-1425473036#-sz7wae_55">String</span></p></td><td id="-1425473036#-sz7wae_53"><p>Familia de producto para el control de logs. Valor por defecto: 'All'</p></td></tr><tr class="" id="-1425473036#-sz7wae_28"><td id="-1425473036#-sz7wae_56"><p><span class="inline-code" id="-1425473036#-sz7wae_59">accumulatedRetryTime</span></p></td><td id="-1425473036#-sz7wae_57"><p><span class="inline-code" id="-1425473036#-sz7wae_60">Long</span></p></td><td id="-1425473036#-sz7wae_58"><p>Tiempo acumulado en milisegundos para los reintentos</p></td></tr><tr class="" id="-1425473036#-sz7wae_29"><td id="-1425473036#-sz7wae_61"><p><span class="inline-code" id="-1425473036#-sz7wae_64">MAX_RETRY_TIME</span></p></td><td id="-1425473036#-sz7wae_62"><p><span class="inline-code" id="-1425473036#-sz7wae_65">Long</span></p></td><td id="-1425473036#-sz7wae_63"><p>Tiempo m&aacute;ximo permitido para los reintentos, obtenido desde un metadata personalizado</p></td></tr><tr class="" id="-1425473036#-sz7wae_30"><td id="-1425473036#-sz7wae_66"><p><span class="inline-code" id="-1425473036#-sz7wae_69">bodyInput</span></p></td><td id="-1425473036#-sz7wae_67"><p><span class="inline-code" id="-1425473036#-sz7wae_70">String</span></p></td><td id="-1425473036#-sz7wae_68"><p>Almacena el cuerpo de la solicitud para su uso en logs</p></td></tr></table></div></section><section><h2 id="-1425473036#variables-de-instancia" data-toc="variables-de-instancia#ExternalNotificationHandler.md-variables-de-instancia">Variables de Instancia</h2><div class="table-wrapper detached"><table id="-1425473036#-sz7wae_71"><tr class="header-row" id="-1425473036#-sz7wae_72"><th id="-1425473036#-sz7wae_74"><p>Nombre</p></th><th id="-1425473036#-sz7wae_75"><p>Tipo</p></th><th id="-1425473036#-sz7wae_76"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-1425473036#-sz7wae_73"><td id="-1425473036#-sz7wae_77"><p><span class="inline-code" id="-1425473036#-sz7wae_80">startTimeGlobal</span></p></td><td id="-1425473036#-sz7wae_78"><p><span class="inline-code" id="-1425473036#-sz7wae_81">Long</span></p></td><td id="-1425473036#-sz7wae_79"><p>Tiempo de inicio global para medir el tiempo total de ejecuci&oacute;n</p></td></tr></table></div></section><section><h2 id="-1425473036#inicializaci-n-est-tica" data-toc="inicializaci-n-est-tica#ExternalNotificationHandler.md-inicializaci-n-est-tica">Inicializaci&oacute;n Est&aacute;tica</h2><p id="-1425473036#-sz7wae_82">La clase inicializa <span class="inline-code" id="-1425473036#-sz7wae_84">MAX_RETRY_TIME</span> a trav&eacute;s de un bloque est&aacute;tico que obtiene el valor desde un registro de metadatos personalizado <span class="inline-code" id="-1425473036#-sz7wae_85">SF_ConfigTimeRetryIntegrations__mdt</span>.</p><div class="detached code-block" id="-1425473036#-sz7wae_83"><pre><code class="language-none">static {
  MAX_RETRY_TIME = getMaxRetryTimeFromMetadata();
}</code></pre></div></section><section><h2 id="-1425473036#m-todos-de-acceso-getters-y-setters" data-toc="m-todos-de-acceso-getters-y-setters#ExternalNotificationHandler.md-m-todos-de-acceso-getters-y-setters">M&eacute;todos de Acceso (Getters y Setters)</h2><div class="table-wrapper detached"><table id="-1425473036#-sz7wae_86"><tr class="header-row" id="-1425473036#-sz7wae_87"><th id="-1425473036#-sz7wae_96"><p>M&eacute;todo</p></th><th id="-1425473036#-sz7wae_97"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-1425473036#-sz7wae_88"><td id="-1425473036#-sz7wae_98"><p><span class="inline-code" id="-1425473036#-sz7wae_100">setBodyInput(String value)</span></p></td><td id="-1425473036#-sz7wae_99"><p>Establece el valor del cuerpo de la solicitud para su uso en logs</p></td></tr><tr class="" id="-1425473036#-sz7wae_89"><td id="-1425473036#-sz7wae_101"><p><span class="inline-code" id="-1425473036#-sz7wae_103">getBodyInput()</span></p></td><td id="-1425473036#-sz7wae_102"><p>Obtiene el valor del cuerpo de la solicitud</p></td></tr><tr class="" id="-1425473036#-sz7wae_90"><td id="-1425473036#-sz7wae_104"><p><span class="inline-code" id="-1425473036#-sz7wae_106">setFamilyProduct(String value)</span></p></td><td id="-1425473036#-sz7wae_105"><p>Establece la familia de producto para control de logs</p></td></tr><tr class="" id="-1425473036#-sz7wae_91"><td id="-1425473036#-sz7wae_107"><p><span class="inline-code" id="-1425473036#-sz7wae_109">getFamilyProduct()</span></p></td><td id="-1425473036#-sz7wae_108"><p>Obtiene la familia de producto actual</p></td></tr><tr class="" id="-1425473036#-sz7wae_92"><td id="-1425473036#-sz7wae_110"><p><span class="inline-code" id="-1425473036#-sz7wae_112">setretryQuantity(Integer value)</span></p></td><td id="-1425473036#-sz7wae_111"><p>Establece el n&uacute;mero de reintentos (m&eacute;todo est&aacute;tico)</p></td></tr><tr class="" id="-1425473036#-sz7wae_93"><td id="-1425473036#-sz7wae_113"><p><span class="inline-code" id="-1425473036#-sz7wae_115">getretryQuantity()</span></p></td><td id="-1425473036#-sz7wae_114"><p>Obtiene el n&uacute;mero actual de reintentos (m&eacute;todo est&aacute;tico)</p></td></tr><tr class="" id="-1425473036#-sz7wae_94"><td id="-1425473036#-sz7wae_116"><p><span class="inline-code" id="-1425473036#-sz7wae_118">setskipLogDefault(Boolean value)</span></p></td><td id="-1425473036#-sz7wae_117"><p>Establece si se deben omitir los logs por defecto</p></td></tr><tr class="" id="-1425473036#-sz7wae_95"><td id="-1425473036#-sz7wae_119"><p><span class="inline-code" id="-1425473036#-sz7wae_121">getskipLogDefault()</span></p></td><td id="-1425473036#-sz7wae_120"><p>Obtiene el valor actual de omisi&oacute;n de logs</p></td></tr></table></div></section><section><h2 id="-1425473036#m-todos-principales" data-toc="m-todos-principales#ExternalNotificationHandler.md-m-todos-principales">M&eacute;todos Principales</h2><section><h3 id="-1425473036#emit-string-methodtype-sf-integrationsetting-mdt-config-string-serviceparameters-object-payload-string-family" data-toc="emit-string-methodtype-sf-integrationsetting-mdt-config-string-serviceparameters-object-payload-string-family#ExternalNotificationHandler.md-emit-string-methodtype-sf-integrationsetting-mdt-config-string-serviceparameters-object-payload-string-family">emit(String methodType, SF_IntegrationSetting__mdt config, String serviceParameters, Object payload, String family)</h3><section><h4 id="-1425473036#descripci-n" data-toc="descripci-n#ExternalNotificationHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1425473036#-sz7wae_133">Emite una solicitud HTTP a un servicio externo utilizando la configuraci&oacute;n proporcionada.</p></section><section><h4 id="-1425473036#par-metros" data-toc="par-metros#ExternalNotificationHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1425473036#-sz7wae_134" start="1"><li class="list-item" id="-1425473036#-sz7wae_135"><p><span class="inline-code" id="-1425473036#-sz7wae_140">methodType</span> (String): Tipo de m&eacute;todo HTTP (GET, POST, etc.).</p></li><li class="list-item" id="-1425473036#-sz7wae_136"><p><span class="inline-code" id="-1425473036#-sz7wae_141">config</span> (SF_IntegrationSetting__mdt): Configuraci&oacute;n de integraci&oacute;n desde metadatos personalizados.</p></li><li class="list-item" id="-1425473036#-sz7wae_137"><p><span class="inline-code" id="-1425473036#-sz7wae_142">serviceParameters</span> (String): Par&aacute;metros adicionales para la URL del servicio.</p></li><li class="list-item" id="-1425473036#-sz7wae_138"><p><span class="inline-code" id="-1425473036#-sz7wae_143">payload</span> (Object): Carga &uacute;til para enviar en la solicitud (para m&eacute;todo POST).</p></li><li class="list-item" id="-1425473036#-sz7wae_139"><p><span class="inline-code" id="-1425473036#-sz7wae_144">family</span> (String): Familia de producto para los logs.</p></li></ul></section><section><h4 id="-1425473036#retorno" data-toc="retorno#ExternalNotificationHandler.md-retorno">Retorno</h4><ul class="list" id="-1425473036#-sz7wae_145" start="1"><li class="list-item" id="-1425473036#-sz7wae_146"><p><span class="inline-code" id="-1425473036#-sz7wae_147">System.HTTPResponse</span>: Respuesta HTTP del servicio externo.</p></li></ul></section><section><h4 id="-1425473036#proceso" data-toc="proceso#ExternalNotificationHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1425473036#-sz7wae_148" type="1" start="1"><li class="list-item" id="-1425473036#-sz7wae_149"><p>Almacena la carga &uacute;til para el registro.</p></li><li class="list-item" id="-1425473036#-sz7wae_150"><p>Construye la URL del servicio combinando la ruta base con los par&aacute;metros.</p></li><li class="list-item" id="-1425473036#-sz7wae_151"><p>Crea y configura una solicitud HTTP con credenciales nombradas.</p></li><li class="list-item" id="-1425473036#-sz7wae_152"><p>Establece encabezados y cuerpo para solicitudes POST.</p></li><li class="list-item" id="-1425473036#-sz7wae_153"><p>Configura el tiempo de espera seg&uacute;n la configuraci&oacute;n.</p></li><li class="list-item" id="-1425473036#-sz7wae_154"><p>Crea un wrapper con toda la informaci&oacute;n necesaria para gestionar el env&iacute;o.</p></li><li class="list-item" id="-1425473036#-sz7wae_155"><p>Llama al m&eacute;todo <span class="inline-code" id="-1425473036#-sz7wae_156">send</span> para ejecutar la solicitud con l&oacute;gica de reintento.</p></li></ol></section><section><h4 id="-1425473036#c-digo" data-toc="c-digo#ExternalNotificationHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1425473036#-sz7wae_157"><pre><code class="language-none">public System.HTTPResponse emit(
  String methodType,
  SF_IntegrationSetting__mdt config,
  String serviceParameters,
  Object payload,
  String family
) {
  setBodyInput(String.valueOf(payload));
  String service = (config.Path__c ?? '') + serviceParameters;
  
  Core.debug('Using Named Credentials=&quot;' + NAMED_CREDENTIAL + '&quot;');
  HttpRequest req = new HttpRequest();
  req.setEndpoint('callout:' + NAMED_CREDENTIAL + service);
  req.setMethod(methodType);
  if (methodType == 'POST') {
    Core.debug(
      'Emitting ' +
        config.MasterLabel +
        ' to external service=&quot;' +
        service +
        '&quot; with payload=' +
        JSON.serialize(payload)
    );
    req.setHeader('Content-Type', 'application/json');
    req.setBody(JSON.serialize(payload));
    req.setTimeout(Integer.valueOf(config.TimeOutLimit__c) ?? 120000);
  }

  SendMethodResourceWrapper sendWrapper = new SendMethodResourceWrapper(
    req,
    (config.RetryOnResponseCode__c ?? '').split(';'),
    config.TimeoutType__c,
    Integer.valueOf(config.RetryQuantity__c)
  );
  String familyProduct = family != null ? family : '';
  System.HttpResponse res = send(
    sendWrapper,
    String.valueOf(config.MasterLabel),
    familyProduct
  );

  return res;
}</code></pre></div></section></section><section><h3 id="-1425473036#send-sendmethodresourcewrapper-resourcewrapper-string-process-string-family" data-toc="send-sendmethodresourcewrapper-resourcewrapper-string-process-string-family#ExternalNotificationHandler.md-send-sendmethodresourcewrapper-resourcewrapper-string-process-string-family">send(SendMethodResourceWrapper resourceWrapper, String process, String family)</h3><section><h4 id="-1425473036#descripci-n" data-toc="descripci-n#ExternalNotificationHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1425473036#-sz7wae_165">M&eacute;todo est&aacute;tico que realiza la solicitud HTTP con l&oacute;gica de reintento basada en la configuraci&oacute;n proporcionada.</p></section><section><h4 id="-1425473036#par-metros" data-toc="par-metros#ExternalNotificationHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1425473036#-sz7wae_166" start="1"><li class="list-item" id="-1425473036#-sz7wae_167"><p><span class="inline-code" id="-1425473036#-sz7wae_170">resourceWrapper</span> (SendMethodResourceWrapper): Wrapper que contiene la solicitud y la configuraci&oacute;n de reintentos.</p></li><li class="list-item" id="-1425473036#-sz7wae_168"><p><span class="inline-code" id="-1425473036#-sz7wae_171">process</span> (String): Nombre del proceso para incluir en los logs.</p></li><li class="list-item" id="-1425473036#-sz7wae_169"><p><span class="inline-code" id="-1425473036#-sz7wae_172">family</span> (String): Familia de producto para los logs.</p></li></ul></section><section><h4 id="-1425473036#retorno" data-toc="retorno#ExternalNotificationHandler.md-retorno">Retorno</h4><ul class="list" id="-1425473036#-sz7wae_173" start="1"><li class="list-item" id="-1425473036#-sz7wae_174"><p><span class="inline-code" id="-1425473036#-sz7wae_175">System.HTTPResponse</span>: Respuesta HTTP del servicio externo.</p></li></ul></section><section><h4 id="-1425473036#proceso" data-toc="proceso#ExternalNotificationHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1425473036#-sz7wae_176" type="1" start="1"><li class="list-item" id="-1425473036#-sz7wae_177"><p>Realiza la solicitud HTTP y mide el tiempo de ejecuci&oacute;n.</p></li><li class="list-item" id="-1425473036#-sz7wae_178"><p>Acumula el tiempo de reintento para control de l&iacute;mites.</p></li><li class="list-item" id="-1425473036#-sz7wae_179"><p>Verifica si el tiempo de CPU consumido excede el l&iacute;mite m&aacute;ximo.</p></li><li class="list-item" id="-1425473036#-sz7wae_180"><p>Determina si se debe realizar un reintento basado en el c&oacute;digo de respuesta y el n&uacute;mero de reintentos restantes.</p></li><li class="list-item" id="-1425473036#-sz7wae_181"><p>Registra eventos de &eacute;xito o error seg&uacute;n corresponda.</p></li><li class="list-item" id="-1425473036#-sz7wae_182"><p>Si es necesario un reintento, aplica un tiempo de espera seg&uacute;n la estrategia configurada y llama recursivamente al m&eacute;todo.</p></li></ol></section><section><h4 id="-1425473036#c-digo" data-toc="c-digo#ExternalNotificationHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1425473036#-sz7wae_183"><pre><code class="language-none">public static System.HttpResponse send(
  SendMethodResourceWrapper resourceWrapper,
  String process,
  String family
) {
  Http http = new Http();
  Long startTime = System.currentTimeMillis();
  Core.debug('Waiting response...');
  System.HttpResponse res = http.send(resourceWrapper.request);

  Long endTime = System.currentTimeMillis();
  Long retryTime = endTime - startTime;
  accumulatedRetryTime += retryTime;

  Integer activeTime = Limits.getCpuTime();
  if (activeTime &gt; MAX_RETRY_TIME) {
    ExternalServiceValidationUtil.publishServiceEventLog(
      'Error',
      'Error trying connect to remote ' +
        resourceWrapper.request.getEndpoint() +
        ' failed with response= tiempo de cpu consumido supera el limite' +
        ' reintento numero = ' +
        getretryQuantity() +
        ' | Tiempo acumulado de CPU= ' +
        activeTime,
      process,
      family,
      getBodyInput(),
      JSON.serialize(res.getBody())
    );
    return res;
  }

  if (
    resourceWrapper.retriesLeft == 0 ||
    !resourceWrapper.retriesCodes.contains(
      String.valueOf(res.getStatusCode())
    )
  ) {
    if (!skipLogDefault) {
      switch on res.getStatusCode() {
        when 200 {
          ExternalServiceValidationUtil.publishServiceEventLog(
            'Success',
            'Success connecting to remote ' +
              resourceWrapper.request.getEndpoint() +
              ' reintento numero = ' +
              getretryQuantity() +
              ' | Tiempo acumulado = ' +
              accumulatedRetryTime +
              ' milisegundos',
            process,
            family,
            getBodyInput(),
            JSON.serialize(res.getBody())
          );
        }
        when else {
          ExternalServiceValidationUtil.publishServiceEventLog(
            'Error',
            'Error trying connect to remote ' +
              resourceWrapper.request.getEndpoint() +
              ' reintento numero = ' +
              getretryQuantity() +
              ' | Tiempo acumulado = ' +
              accumulatedRetryTime +
              ' milisegundos',
            process,
            family,
            getBodyInput(),
            JSON.serialize(res.getBody())
          );
        }
      }
    }
    return res;
  }

  Core.debug('Retry Code found, retrying...');
  applyTimeOut(
    resourceWrapper.timeOutType,
    resourceWrapper.retriesCurrentNumber
  );
  resourceWrapper.substractRetryLeft();
  resourceWrapper.addRetry();
  return send(resourceWrapper, process, family);
}</code></pre></div></section></section><section><h3 id="-1425473036#controlexception-string-integration-exception-e-string-payload" data-toc="controlexception-string-integration-exception-e-string-payload#ExternalNotificationHandler.md-controlexception-string-integration-exception-e-string-payload">controlException(String integration, Exception e, String payload)</h3><section><h4 id="-1425473036#descripci-n" data-toc="descripci-n#ExternalNotificationHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1425473036#-sz7wae_190">Maneja excepciones relacionadas con llamadas a servicios externos, registrando eventos de plataforma y relanzando excepciones apropiadas.</p></section><section><h4 id="-1425473036#par-metros" data-toc="par-metros#ExternalNotificationHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1425473036#-sz7wae_191" start="1"><li class="list-item" id="-1425473036#-sz7wae_192"><p><span class="inline-code" id="-1425473036#-sz7wae_195">integration</span> (String): Nombre de la integraci&oacute;n donde ocurri&oacute; la excepci&oacute;n.</p></li><li class="list-item" id="-1425473036#-sz7wae_193"><p><span class="inline-code" id="-1425473036#-sz7wae_196">e</span> (Exception): La excepci&oacute;n capturada.</p></li><li class="list-item" id="-1425473036#-sz7wae_194"><p><span class="inline-code" id="-1425473036#-sz7wae_197">payload</span> (String): Carga &uacute;til que se estaba enviando cuando ocurri&oacute; la excepci&oacute;n.</p></li></ul></section><section><h4 id="-1425473036#proceso" data-toc="proceso#ExternalNotificationHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1425473036#-sz7wae_198" type="1" start="1"><li class="list-item" id="-1425473036#-sz7wae_199"><p>Determina el tipo de excepci&oacute;n (CalloutException, ExternalServiceValidationException, u otra).</p></li><li class="list-item" id="-1425473036#-sz7wae_200"><p>Publica un evento de plataforma con c&oacute;digo 400 o 500 seg&uacute;n el tipo de excepci&oacute;n.</p></li><li class="list-item" id="-1425473036#-sz7wae_201"><p>Lanza una ExternalServiceException o relanza la excepci&oacute;n original seg&uacute;n corresponda.</p></li></ol></section><section><h4 id="-1425473036#c-digo" data-toc="c-digo#ExternalNotificationHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1425473036#-sz7wae_202"><pre><code class="language-none">public void controlException(
  String integration,
  Exception e,
  String payload
) {
  if (
    e instanceof CalloutException ||
    e instanceof ExternalServiceValidationException
  ) {
    if (
      e.getMessage().contains('400') ||
      e instanceof ExternalServiceValidationException
    )
      this.publishPlatformEvent(
        400,
        JSON.serialize(payload),
        'A  has ocurred during ' +
          integration +
          ' Execution: ' +
          e.getMessage()
      );
    else
      this.publishPlatformEvent(
        500,
        JSON.serialize(payload),
        'A callout Exception has ocurred during ' +
          integration +
          ' Execution: ' +
          e.getMessage()
      );
    throw new ExternalServiceException(
      integration + ' has failed. Exception: ' + e.getMessage()
    );
  } else {
    this.publishPlatformEvent(
      500,
      JSON.serialize(payload),
      'An Exception has ocurred during ' +
        integration +
        ' Execution: ' +
        e.getMessage()
    );
    throw e;
  }
}</code></pre></div></section></section><section><h3 id="-1425473036#controlexceptionsavinglog-string-integration-string-messaje-string-process" data-toc="controlexceptionsavinglog-string-integration-string-messaje-string-process#ExternalNotificationHandler.md-controlexceptionsavinglog-string-integration-string-messaje-string-process">controlExceptionSavingLog(String integration, String messaje, String process)</h3><section><h4 id="-1425473036#descripci-n" data-toc="descripci-n#ExternalNotificationHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1425473036#-sz7wae_209">Registra informaci&oacute;n de excepciones en logs de eventos si el registro est&aacute; habilitado.</p></section><section><h4 id="-1425473036#par-metros" data-toc="par-metros#ExternalNotificationHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1425473036#-sz7wae_210" start="1"><li class="list-item" id="-1425473036#-sz7wae_211"><p><span class="inline-code" id="-1425473036#-sz7wae_214">integration</span> (String): Nombre de la integraci&oacute;n donde ocurri&oacute; la excepci&oacute;n.</p></li><li class="list-item" id="-1425473036#-sz7wae_212"><p><span class="inline-code" id="-1425473036#-sz7wae_215">messaje</span> (String): Mensaje de error.</p></li><li class="list-item" id="-1425473036#-sz7wae_213"><p><span class="inline-code" id="-1425473036#-sz7wae_216">process</span> (String): Nombre del proceso para incluir en los logs.</p></li></ul></section><section><h4 id="-1425473036#proceso" data-toc="proceso#ExternalNotificationHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1425473036#-sz7wae_217" type="1" start="1"><li class="list-item" id="-1425473036#-sz7wae_218"><p>Verifica si el registro de logs est&aacute; habilitado.</p></li><li class="list-item" id="-1425473036#-sz7wae_219"><p>Calcula el tiempo transcurrido desde el inicio global.</p></li><li class="list-item" id="-1425473036#-sz7wae_220"><p>Formatea el mensaje seg&uacute;n el tipo de error.</p></li><li class="list-item" id="-1425473036#-sz7wae_221"><p>Publica un evento de log con la informaci&oacute;n recopilada.</p></li></ol></section><section><h4 id="-1425473036#c-digo" data-toc="c-digo#ExternalNotificationHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1425473036#-sz7wae_222"><pre><code class="language-none">public void controlExceptionSavingLog(
  String integration,
  String messaje,
  String process
) {
  if (!skipLogDefault) {
    System.debug('Generating eventlog');
    Long endTime = System.currentTimeMillis();
    Long retryTime = endTime - startTimeGlobal;

    String setMensaje = messaje.equals('Read timed out')
      ? 'failed with response= tiempo de espera del callout a superado el limite' +
        ' reintento numero = ' +
        getretryQuantity() +
        ' | Tiempo acumulado de cpu= ' +
        Limits.getCpuTime() +
        ' y tiempo acumulado de logica: ' +
        retryTime
      : 'Error trying connect to ' + integration + '.... ' + messaje;
    ExternalServiceValidationUtil.publishServiceEventLog(
      'ERROR',
      setMensaje,
      process,
      familyProductControl,
      getBodyInput(),
      ''
    );
  }
}</code></pre></div></section></section></section><section><h2 id="-1425473036#m-todos-de-gesti-n-de-tiempo-de-espera" data-toc="m-todos-de-gesti-n-de-tiempo-de-espera#ExternalNotificationHandler.md-m-todos-de-gesti-n-de-tiempo-de-espera">M&eacute;todos de Gesti&oacute;n de Tiempo de Espera</h2><section><h3 id="-1425473036#applytimeout-string-timeouttype-integer-retriescurrentnumber" data-toc="applytimeout-string-timeouttype-integer-retriescurrentnumber#ExternalNotificationHandler.md-applytimeout-string-timeouttype-integer-retriescurrentnumber">applyTimeOut(String timeOutType, Integer retriesCurrentNumber)</h3><section><h4 id="-1425473036#descripci-n" data-toc="descripci-n#ExternalNotificationHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1425473036#-sz7wae_231">Aplica una estrategia de tiempo de espera seg&uacute;n el tipo configurado.</p></section><section><h4 id="-1425473036#par-metros" data-toc="par-metros#ExternalNotificationHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1425473036#-sz7wae_232" start="1"><li class="list-item" id="-1425473036#-sz7wae_233"><p><span class="inline-code" id="-1425473036#-sz7wae_235">timeOutType</span> (String): Tipo de estrategia de tiempo de espera ('FIXED', 'INCREMENTAL', 'FIBONACCI').</p></li><li class="list-item" id="-1425473036#-sz7wae_234"><p><span class="inline-code" id="-1425473036#-sz7wae_236">retriesCurrentNumber</span> (Integer): N&uacute;mero actual de reintentos.</p></li></ul></section><section><h4 id="-1425473036#proceso" data-toc="proceso#ExternalNotificationHandler.md-proceso">Proceso</h4><p id="-1425473036#-sz7wae_237">Aplica la estrategia de tiempo de espera correspondiente seg&uacute;n el tipo especificado.</p></section><section><h4 id="-1425473036#c-digo" data-toc="c-digo#ExternalNotificationHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1425473036#-sz7wae_238"><pre><code class="language-none">private static void applyTimeOut(
  String timeOutType,
  Integer retriesCurrentNumber
) {
  Integer miliseconds = 100;
  switch on timeOutType.toUpperCase() {
    when 'FIXED' {
      fixedTimeOut(miliseconds);
    }
    when 'INCREMENTAL' {
      incrementalTimeOut(retriesCurrentNumber, miliseconds);
    }
    when 'FIBONACCI' {
      waitMethod(miliseconds * fibonacciTimeOut(retriesCurrentNumber));
    }
  }
}</code></pre></div></section></section><section><h3 id="-1425473036#m-todos-de-estrategia-de-tiempo-de-espera" data-toc="m-todos-de-estrategia-de-tiempo-de-espera#ExternalNotificationHandler.md-m-todos-de-estrategia-de-tiempo-de-espera">M&eacute;todos de Estrategia de Tiempo de Espera</h3><ul class="list" id="-1425473036#-sz7wae_239" start="1"><li class="list-item" id="-1425473036#-sz7wae_240"><p><span class="control" id="-1425473036#-sz7wae_244"><span class="inline-code" id="-1425473036#-sz7wae_245">fixedTimeOut(Integer miliseconds)</span></span>: Aplica un tiempo de espera fijo.</p></li><li class="list-item" id="-1425473036#-sz7wae_241"><p><span class="control" id="-1425473036#-sz7wae_246"><span class="inline-code" id="-1425473036#-sz7wae_247">incrementalTimeOut(Integer numberOfRetry, Integer miliseconds)</span></span>: Aplica un tiempo de espera que incrementa linealmente con el n&uacute;mero de reintentos.</p></li><li class="list-item" id="-1425473036#-sz7wae_242"><p><span class="control" id="-1425473036#-sz7wae_248"><span class="inline-code" id="-1425473036#-sz7wae_249">fibonacciTimeOut(Integer numberOfRetry)</span></span>: Calcula el t&eacute;rmino de Fibonacci correspondiente al n&uacute;mero de reintento.</p></li><li class="list-item" id="-1425473036#-sz7wae_243"><p><span class="control" id="-1425473036#-sz7wae_250"><span class="inline-code" id="-1425473036#-sz7wae_251">waitMethod(Integer miliseconds)</span></span>: Implementa la espera activa durante el n&uacute;mero de milisegundos especificado.</p></li></ul></section></section><section><h2 id="-1425473036#clase-interna" data-toc="clase-interna#ExternalNotificationHandler.md-clase-interna">Clase Interna</h2><section><h3 id="-1425473036#sendmethodresourcewrapper" data-toc="sendmethodresourcewrapper#ExternalNotificationHandler.md-sendmethodresourcewrapper">SendMethodResourceWrapper</h3><section><h4 id="-1425473036#descripci-n" data-toc="descripci-n#ExternalNotificationHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1425473036#-sz7wae_258">Clase interna privada que encapsula la informaci&oacute;n necesaria para gestionar solicitudes HTTP con l&oacute;gica de reintento.</p></section><section><h4 id="-1425473036#atributos" data-toc="atributos#ExternalNotificationHandler.md-atributos">Atributos</h4><ul class="list" id="-1425473036#-sz7wae_259" start="1"><li class="list-item" id="-1425473036#-sz7wae_260"><p><span class="inline-code" id="-1425473036#-sz7wae_265">request</span> (HttpRequest): La solicitud HTTP a enviar.</p></li><li class="list-item" id="-1425473036#-sz7wae_261"><p><span class="inline-code" id="-1425473036#-sz7wae_266">retriesCodes</span> (List</p><p>): Lista de c&oacute;digos de respuesta que deber&iacute;an desencadenar un reintento.</p></li><li class="list-item" id="-1425473036#-sz7wae_262"><p><span class="inline-code" id="-1425473036#-sz7wae_268">timeOutType</span> (String): Tipo de estrategia de tiempo de espera.</p></li><li class="list-item" id="-1425473036#-sz7wae_263"><p><span class="inline-code" id="-1425473036#-sz7wae_269">retriesCurrentNumber</span> (Integer): N&uacute;mero actual de reintento.</p></li><li class="list-item" id="-1425473036#-sz7wae_264"><p><span class="inline-code" id="-1425473036#-sz7wae_270">retriesLeft</span> (Integer): N&uacute;mero de reintentos restantes.</p></li></ul></section><section><h4 id="-1425473036#m-todos" data-toc="m-todos#ExternalNotificationHandler.md-m-todos">M&eacute;todos</h4><ul class="list" id="-1425473036#-sz7wae_271" start="1"><li class="list-item" id="-1425473036#-sz7wae_272"><p><span class="control" id="-1425473036#-sz7wae_275">Constructor</span>: Inicializa los atributos con los valores proporcionados.</p></li><li class="list-item" id="-1425473036#-sz7wae_273"><p><span class="control" id="-1425473036#-sz7wae_276"><span class="inline-code" id="-1425473036#-sz7wae_277">substractRetryLeft()</span></span>: Decrementa el contador de reintentos restantes.</p></li><li class="list-item" id="-1425473036#-sz7wae_274"><p><span class="control" id="-1425473036#-sz7wae_278"><span class="inline-code" id="-1425473036#-sz7wae_279">addRetry()</span></span>: Incrementa el contador de reintentos actuales y actualiza el contador global.</p></li></ul></section></section></section><section><h2 id="-1425473036#dependencias" data-toc="dependencias#ExternalNotificationHandler.md-dependencias">Dependencias</h2><ul class="list" id="-1425473036#-sz7wae_280" start="1"><li class="list-item" id="-1425473036#-sz7wae_281"><p><span class="inline-code" id="-1425473036#-sz7wae_288">PlatformEventIntegrationObserver</span>: Clase base que proporciona m&eacute;todos para publicar eventos de plataforma.</p></li><li class="list-item" id="-1425473036#-sz7wae_282"><p><span class="inline-code" id="-1425473036#-sz7wae_289">SF_IntegrationSetting__mdt</span>: Tipo de metadatos personalizado que contiene la configuraci&oacute;n para la integraci&oacute;n.</p></li><li class="list-item" id="-1425473036#-sz7wae_283"><p><span class="inline-code" id="-1425473036#-sz7wae_290">SF_ConfigTimeRetryIntegrations__mdt</span>: Tipo de metadatos personalizado que contiene la configuraci&oacute;n de tiempo m&aacute;ximo de reintento.</p></li><li class="list-item" id="-1425473036#-sz7wae_284"><p><span class="inline-code" id="-1425473036#-sz7wae_291">Core</span>: Clase de utilidad que proporciona el m&eacute;todo <span class="inline-code" id="-1425473036#-sz7wae_292">debug</span> para registro.</p></li><li class="list-item" id="-1425473036#-sz7wae_285"><p><span class="inline-code" id="-1425473036#-sz7wae_293">ExternalServiceValidationUtil</span>: Clase que proporciona m&eacute;todos para validar y registrar eventos de servicio.</p></li><li class="list-item" id="-1425473036#-sz7wae_286"><p><span class="inline-code" id="-1425473036#-sz7wae_294">ExternalServiceException</span>: Excepci&oacute;n personalizada lanzada cuando hay problemas con el servicio externo.</p></li><li class="list-item" id="-1425473036#-sz7wae_287"><p><span class="inline-code" id="-1425473036#-sz7wae_295">ExternalServiceValidationException</span>: Excepci&oacute;n personalizada para errores de validaci&oacute;n.</p></li></ul></section><section><h2 id="-1425473036#estrategias-de-reintento" data-toc="estrategias-de-reintento#ExternalNotificationHandler.md-estrategias-de-reintento">Estrategias de Reintento</h2><p id="-1425473036#-sz7wae_296">La clase implementa tres estrategias diferentes de tiempo de espera para reintentos:</p><section><h3 id="-1425473036#1-fixed" data-toc="1-fixed#ExternalNotificationHandler.md-1-fixed">1. FIXED</h3><p id="-1425473036#-sz7wae_300">Espera un tiempo fijo (100 ms) entre cada reintento.</p></section><section><h3 id="-1425473036#2-incremental" data-toc="2-incremental#ExternalNotificationHandler.md-2-incremental">2. INCREMENTAL</h3><p id="-1425473036#-sz7wae_301">Espera un tiempo que aumenta linealmente con el n&uacute;mero de reintentos (n * 100 ms).</p></section><section><h3 id="-1425473036#3-fibonacci" data-toc="3-fibonacci#ExternalNotificationHandler.md-3-fibonacci">3. FIBONACCI</h3><p id="-1425473036#-sz7wae_302">Espera un tiempo basado en la secuencia de Fibonacci, multiplicado por un factor base (100 ms).</p></section></section><section><h2 id="-1425473036#ejemplo-de-uso" data-toc="ejemplo-de-uso#ExternalNotificationHandler.md-ejemplo-de-uso">Ejemplo de Uso</h2><div class="detached code-block" id="-1425473036#-sz7wae_303"><pre><code class="language-none">try {
    // Obtener la configuración de integración
    SF_IntegrationSetting__mdt config = SF_IntegrationSetting__mdt.getInstance('mi_servicio');
    
    // Crear el manejador de notificaciones
    ExternalNotificationHandler handler = new ExternalNotificationHandler();
    
    // Establecer configuraciones específicas (opcional)
    handler.setFamilyProduct('MiProducto');
    handler.setskipLogDefault(false);
    
    // Preparar la carga útil
    Map&lt;String, Object&gt; payload = new Map&lt;String, Object&gt;{
        'id' =&gt; '12345',
        'name' =&gt; 'Test Request',
        'date' =&gt; System.now().format()
    };
    
    // Emitir la solicitud
    System.HTTPResponse response = handler.emit(
        'POST',
        config,
        '/resource/endpoint',
        payload,
        'MiProducto'
    );
    
    // Procesar la respuesta
    if (response.getStatusCode() == 200) {
        Map&lt;String, Object&gt; responseBody = (Map&lt;String, Object&gt;)JSON.deserializeUntyped(response.getBody());
        System.debug('Respuesta exitosa: ' + responseBody);
    } else {
        System.debug('Error en la respuesta: ' + response.getStatus());
    }
} catch (Exception e) {
    // Manejar la excepción
    System.debug('Error: ' + e.getMessage());
}</code></pre></div></section><section><h2 id="-1425473036#notas-adicionales" data-toc="notas-adicionales#ExternalNotificationHandler.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-1425473036#-sz7wae_304" type="1" start="1"><li class="list-item" id="-1425473036#-sz7wae_305"><p>La clase utiliza un mecanismo sofisticado de reintentos con diferentes estrategias de tiempo de espera.</p></li><li class="list-item" id="-1425473036#-sz7wae_306"><p>Implementa un control de tiempo m&aacute;ximo para evitar que los reintentos consuman demasiados recursos.</p></li><li class="list-item" id="-1425473036#-sz7wae_307"><p>Registra detalladamente los eventos de integraci&oacute;n para facilitar la depuraci&oacute;n y el monitoreo.</p></li><li class="list-item" id="-1425473036#-sz7wae_308"><p>Est&aacute; dise&ntilde;ada para ser extendida, permitiendo personalizar comportamientos espec&iacute;ficos a trav&eacute;s de herencia.</p></li><li class="list-item" id="-1425473036#-sz7wae_309"><p>Utiliza metadatos personalizados para configurar aspectos como tiempos de espera, estrategias de reintento y c&oacute;digos de respuesta que deben desencadenar reintentos.</p></li><li class="list-item" id="-1425473036#-sz7wae_310"><p>Implementa un m&eacute;todo de espera activa (<span class="inline-code" id="-1425473036#-sz7wae_312">waitMethod</span>) que podr&iacute;a consumir significativamente recursos de CPU.</p></li><li class="list-item" id="-1425473036#-sz7wae_311"><p>La clase contiene c&oacute;digo comentado que podr&iacute;a representar versiones anteriores o alternativas de implementaci&oacute;n.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1598943198">CCMServiceHandler</h1><section><h2 id="-1598943198#descripci-n-general" data-toc="descripci-n-general#CCMServiceHandler.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-1598943198#-gig2qs_18"><span class="inline-code" id="-1598943198#-gig2qs_19">CCMServiceHandler</span> es una clase virtual global que extiende <span class="inline-code" id="-1598943198#-gig2qs_20">PlatformEventIntegrationObserver</span> y est&aacute; dise&ntilde;ada para manejar la integraci&oacute;n con servicios CCM (Customer Communication Management). Esta clase implementa un patr&oacute;n de procesamiento en tres fases y proporciona capacidades especializadas para el env&iacute;o de documentos a trav&eacute;s de un sistema de mensajer&iacute;a con enrutamiento espec&iacute;fico.</p></section><section><h2 id="-1598943198#autor" data-toc="autor#CCMServiceHandler.md-autor">Autor</h2><p id="-1598943198#-gig2qs_21">Felipe Correa \&lt;felipe.correa@nespon.com\&gt;</p></section><section><h2 id="-1598943198#proyecto" data-toc="proyecto#CCMServiceHandler.md-proyecto">Proyecto</h2><p id="-1598943198#-gig2qs_22">Foundation Salesforce - Suratech - UH-17589</p></section><section><h2 id="-1598943198#ltima-modificaci-n" data-toc="ltima-modificaci-n#CCMServiceHandler.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="-1598943198#-gig2qs_23">20 de febrero de 2025 por &quot;ChangeMeIn@UserSettingsUnder.SFDoc&quot;</p></section><section><h2 id="-1598943198#estructura-de-la-clase" data-toc="estructura-de-la-clase#CCMServiceHandler.md-estructura-de-la-clase">Estructura de la Clase</h2><div class="detached code-block" id="-1598943198#-gig2qs_24"><pre><code class="language-none">global virtual class CCMServiceHandler extends PlatformEventIntegrationObserver {
  // Constantes de configuración
  private static final String SERVICE_METHOD = 'POST';
  private static final String SURATECH_MDT_CONFIG_NAME = 'ccm_endpoint';
  
  // Métodos de procesamiento
  global virtual Map&lt;String, Object&gt; preProcess(Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; options);
  global Map&lt;String, Object&gt; invokeProcess(Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; output, Map&lt;String, Object&gt; options);
  global virtual Map&lt;String, Object&gt; postProcess(Map&lt;String, Object&gt; response, Map&lt;String, Object&gt; options);
  global void publishPlatformEventIntegration(String moment, String data);
}</code></pre></div></section><section><h2 id="-1598943198#herencia" data-toc="herencia#CCMServiceHandler.md-herencia">Herencia</h2><ul class="list" id="-1598943198#-gig2qs_25" start="1"><li class="list-item" id="-1598943198#-gig2qs_26"><p><span class="control" id="-1598943198#-gig2qs_28">Clase Base</span>: <span class="inline-code" id="-1598943198#-gig2qs_29">PlatformEventIntegrationObserver</span></p></li><li class="list-item" id="-1598943198#-gig2qs_27"><p><span class="control" id="-1598943198#-gig2qs_30">Modificadores</span>: <span class="inline-code" id="-1598943198#-gig2qs_31">global virtual</span></p></li></ul></section><section><h2 id="-1598943198#constantes" data-toc="constantes#CCMServiceHandler.md-constantes">Constantes</h2><div class="table-wrapper detached"><table id="-1598943198#-gig2qs_32"><tr class="header-row" id="-1598943198#-gig2qs_33"><th id="-1598943198#-gig2qs_36"><p>Nombre</p></th><th id="-1598943198#-gig2qs_37"><p>Valor</p></th><th id="-1598943198#-gig2qs_38"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-1598943198#-gig2qs_34"><td id="-1598943198#-gig2qs_39"><p><span class="inline-code" id="-1598943198#-gig2qs_42">SERVICE_METHOD</span></p></td><td id="-1598943198#-gig2qs_40"><p><span class="inline-code" id="-1598943198#-gig2qs_43">'POST'</span></p></td><td id="-1598943198#-gig2qs_41"><p>M&eacute;todo HTTP utilizado para las llamadas al servicio CCM</p></td></tr><tr class="" id="-1598943198#-gig2qs_35"><td id="-1598943198#-gig2qs_44"><p><span class="inline-code" id="-1598943198#-gig2qs_47">SURATECH_MDT_CONFIG_NAME</span></p></td><td id="-1598943198#-gig2qs_45"><p><span class="inline-code" id="-1598943198#-gig2qs_48">'ccm_endpoint'</span></p></td><td id="-1598943198#-gig2qs_46"><p>Nombre del registro de metadatos personalizados que contiene la configuraci&oacute;n del servicio CCM</p></td></tr></table></div></section><section><h2 id="-1598943198#m-todos" data-toc="m-todos#CCMServiceHandler.md-m-todos">M&eacute;todos</h2><section><h3 id="-1598943198#preprocess-map-string-object-input-map-string-object-options" data-toc="preprocess-map-string-object-input-map-string-object-options#CCMServiceHandler.md-preprocess-map-string-object-input-map-string-object-options">preProcess(Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; options)</h3><section><h4 id="-1598943198#descripci-n" data-toc="descripci-n#CCMServiceHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1598943198#-gig2qs_60">M&eacute;todo virtual que se ejecuta antes del procesamiento principal. Realiza la preparaci&oacute;n inicial de los datos y opcionalmente publica eventos de plataforma para el monitoreo del proceso CCM.</p></section><section><h4 id="-1598943198#par-metros" data-toc="par-metros#CCMServiceHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1598943198#-gig2qs_61" start="1"><li class="list-item" id="-1598943198#-gig2qs_62"><p><span class="inline-code" id="-1598943198#-gig2qs_64">input</span> (Map&lt;String, Object&gt;): Datos de entrada para el procesamiento CCM.</p></li><li class="list-item" id="-1598943198#-gig2qs_63"><p><span class="inline-code" id="-1598943198#-gig2qs_65">options</span> (Map&lt;String, Object&gt;): Opciones de configuraci&oacute;n para el procesamiento.</p></li></ul></section><section><h4 id="-1598943198#retorno" data-toc="retorno#CCMServiceHandler.md-retorno">Retorno</h4><ul class="list" id="-1598943198#-gig2qs_66" start="1"><li class="list-item" id="-1598943198#-gig2qs_67"><p><span class="inline-code" id="-1598943198#-gig2qs_68">Map&lt;String, Object&gt;</span>: Los datos de entrada, potencialmente modificados durante el pre-procesamiento.</p></li></ul></section><section><h4 id="-1598943198#proceso" data-toc="proceso#CCMServiceHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1598943198#-gig2qs_69" type="1" start="1"><li class="list-item" id="-1598943198#-gig2qs_70"><p>Registra el inicio del pre-procesamiento CCM.</p></li><li class="list-item" id="-1598943198#-gig2qs_71"><p>Verifica si los eventos de plataforma est&aacute;n habilitados en las opciones.</p></li><li class="list-item" id="-1598943198#-gig2qs_72"><p>Si est&aacute;n habilitados, publica un evento de plataforma con los datos de entrada.</p></li><li class="list-item" id="-1598943198#-gig2qs_73"><p>Devuelve los datos de entrada sin modificaciones.</p></li></ol></section><section><h4 id="-1598943198#c-digo" data-toc="c-digo#CCMServiceHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1598943198#-gig2qs_74"><pre><code class="language-none">global virtual Map&lt;String, Object&gt; preProcess(
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; options
) {
  Core.debug('Starting CCM Integration Service Pre Process');
  if (
    options.containsKey('PlatformEventEnabled') &amp;&amp;
    ((Boolean) options.get('PlatformEventEnabled')) == true
  )
    publishPlatformEventIntegration('pre', JSON.serialize(input));
  return input;
}</code></pre></div></section></section><section><h3 id="-1598943198#invokeprocess-map-string-object-input-map-string-object-output-map-string-object-options" data-toc="invokeprocess-map-string-object-input-map-string-object-output-map-string-object-options#CCMServiceHandler.md-invokeprocess-map-string-object-input-map-string-object-output-map-string-object-options">invokeProcess(Map&lt;String, Object&gt; input, Map&lt;String, Object&gt; output, Map&lt;String, Object&gt; options)</h3><section><h4 id="-1598943198#descripci-n" data-toc="descripci-n#CCMServiceHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1598943198#-gig2qs_83">M&eacute;todo principal que ejecuta la l&oacute;gica de integraci&oacute;n con el servicio CCM. Maneja la configuraci&oacute;n, codificaci&oacute;n especial de datos, comunicaci&oacute;n con el sistema de mensajer&iacute;a y procesamiento de respuestas.</p></section><section><h4 id="-1598943198#par-metros" data-toc="par-metros#CCMServiceHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1598943198#-gig2qs_84" start="1"><li class="list-item" id="-1598943198#-gig2qs_85"><p><span class="inline-code" id="-1598943198#-gig2qs_88">input</span> (Map&lt;String, Object&gt;): Datos de entrada para el procesamiento CCM.</p></li><li class="list-item" id="-1598943198#-gig2qs_86"><p><span class="inline-code" id="-1598943198#-gig2qs_89">output</span> (Map&lt;String, Object&gt;): Mapa de salida (no utilizado en la implementaci&oacute;n actual).</p></li><li class="list-item" id="-1598943198#-gig2qs_87"><p><span class="inline-code" id="-1598943198#-gig2qs_90">options</span> (Map&lt;String, Object&gt;): Opciones de configuraci&oacute;n para el procesamiento.</p></li></ul></section><section><h4 id="-1598943198#retorno" data-toc="retorno#CCMServiceHandler.md-retorno">Retorno</h4><ul class="list" id="-1598943198#-gig2qs_91" start="1"><li class="list-item" id="-1598943198#-gig2qs_92"><p><span class="inline-code" id="-1598943198#-gig2qs_93">Map&lt;String, Object&gt;</span>: Respuesta procesada del servicio CCM, o <span class="inline-code" id="-1598943198#-gig2qs_94">null</span> en caso de error.</p></li></ul></section><section><h4 id="-1598943198#proceso" data-toc="proceso#CCMServiceHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1598943198#-gig2qs_95" type="1" start="1"><li class="list-item" id="-1598943198#-gig2qs_96"><p>Obtiene la configuraci&oacute;n desde metadatos personalizados.</p></li><li class="list-item" id="-1598943198#-gig2qs_97"><p>Configura las opciones de eventos de plataforma.</p></li><li class="list-item" id="-1598943198#-gig2qs_98"><p>Ejecuta el pre-procesamiento.</p></li><li class="list-item" id="-1598943198#-gig2qs_99"><p>Codifica el payload en Base64 para transmisi&oacute;n segura.</p></li><li class="list-item" id="-1598943198#-gig2qs_100"><p>Estructura el mensaje con propiedades espec&iacute;ficas para el sistema de mensajer&iacute;a.</p></li><li class="list-item" id="-1598943198#-gig2qs_101"><p>Realiza la llamada HTTP al servicio CCM.</p></li><li class="list-item" id="-1598943198#-gig2qs_102"><p>Procesa la respuesta y la estructura en un formato est&aacute;ndar.</p></li><li class="list-item" id="-1598943198#-gig2qs_103"><p>Publica eventos de plataforma con los resultados.</p></li><li class="list-item" id="-1598943198#-gig2qs_104"><p>Ejecuta el post-procesamiento.</p></li></ol></section><section><h4 id="-1598943198#caracter-sticas-espec-ficas-de-ccm" data-toc="caracter-sticas-espec-ficas-de-ccm#CCMServiceHandler.md-caracter-sticas-espec-ficas-de-ccm">Caracter&iacute;sticas Espec&iacute;ficas de CCM</h4><ul class="list" id="-1598943198#-gig2qs_105" start="1"><li class="list-item" id="-1598943198#-gig2qs_106"><p><span class="control" id="-1598943198#-gig2qs_109">Codificaci&oacute;n Base64</span>: Los datos se codifican en Base64 para transmisi&oacute;n segura.</p></li><li class="list-item" id="-1598943198#-gig2qs_107"><p><span class="control" id="-1598943198#-gig2qs_110">Sistema de Mensajer&iacute;a</span>: Utiliza un routing key espec&iacute;fico ('CDD.ccm.document').</p></li><li class="list-item" id="-1598943198#-gig2qs_108"><p><span class="control" id="-1598943198#-gig2qs_111">Metadata de Mensaje</span>: Incluye propiedades como content-type y payload_encoding.</p></li></ul></section><section><h4 id="-1598943198#c-digo" data-toc="c-digo#CCMServiceHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1598943198#-gig2qs_112"><pre><code class="language-none">global Map&lt;String, Object&gt; invokeProcess(
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; output,
  Map&lt;String, Object&gt; options
) {
  // Obtener configuración
  SF_IntegrationSetting__mdt config = Test.isRunningTest()
    ? ExternalServiceMetadataIntegrationMock.getIntegrationSettings(SURATECH_MDT_CONFIG_NAME)
    : SF_IntegrationSetting__mdt.getInstance(SURATECH_MDT_CONFIG_NAME);
    
  if (config == null) {
    throw new ExternalServiceException(
      'No existing &quot;' + SURATECH_MDT_CONFIG_NAME + 
      '&quot; custom metadata type record at Integration Setting'
    );
  }

  options.put('PlatformEventEnabled', config.Platform_Events_Enabled__c);

  ExternalNotificationHandler enh = new ExternalNotificationHandler();
  Map&lt;String, Object&gt; payload = new Map&lt;String, Object&gt;();
  
  try {
    input = this.preProcess(input, options);
    Core.debug('Starting CCM Integration Service In Process');
    publishPlatformEventIntegration('in', JSON.serialize(input));

    // Codificación especial para CCM
    String payloadString = JSON.serialize(input);
    String encoded = EncodingUtil.base64Encode(Blob.valueOf(JSON.serialize(payloadString)));

    // Estructura del mensaje para CCM
    payload.put('payload_encoding', 'base64');
    payload.put('properties', new Map&lt;String, Object&gt;{ 'content-type' =&gt; 'application/json' });
    payload.put('routing_key', 'CDD.ccm.document');
    payload.put('payload', '{&quot;Content&quot;:&quot;' + encoded + '&quot;}');

    // Enviar al servicio
    System.HTTPResponse response = enh.emit(SERVICE_METHOD, config, '', (Object) payload);

    // Procesar respuesta
    Map&lt;String, Object&gt; responseMap = new Map&lt;String, Object&gt;{
      'body' =&gt; (Map&lt;String, Object&gt;) JSON.deserializeUntyped(response.getBody()),
      'status' =&gt; response.getStatus(),
      'statusCode' =&gt; response.getStatusCode()
    };

    this.publishPlatFormEvent(
      response.getStatusCode(),
      JSON.serialize(payload),
      JSON.serialize(response.getBody())
    );

    System.debug('Response Wrapper: ' + responseMap);
    return this.postProcess(responseMap, options);
  } catch (Exception e) {
    enh.controlException('CCM remote service', e, JSON.serialize(payload));
    return null;
  }
}</code></pre></div></section></section><section><h3 id="-1598943198#postprocess-map-string-object-response-map-string-object-options" data-toc="postprocess-map-string-object-response-map-string-object-options#CCMServiceHandler.md-postprocess-map-string-object-response-map-string-object-options">postProcess(Map&lt;String, Object&gt; response, Map&lt;String, Object&gt; options)</h3><section><h4 id="-1598943198#descripci-n" data-toc="descripci-n#CCMServiceHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1598943198#-gig2qs_119">M&eacute;todo virtual que se ejecuta despu&eacute;s del procesamiento principal. Realiza tareas de finalizaci&oacute;n espec&iacute;ficas de CCM y opcionalmente publica eventos de plataforma con la respuesta final.</p></section><section><h4 id="-1598943198#par-metros" data-toc="par-metros#CCMServiceHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1598943198#-gig2qs_120" start="1"><li class="list-item" id="-1598943198#-gig2qs_121"><p><span class="inline-code" id="-1598943198#-gig2qs_123">response</span> (Map&lt;String, Object&gt;): Respuesta del procesamiento principal CCM.</p></li><li class="list-item" id="-1598943198#-gig2qs_122"><p><span class="inline-code" id="-1598943198#-gig2qs_124">options</span> (Map&lt;String, Object&gt;): Opciones de configuraci&oacute;n.</p></li></ul></section><section><h4 id="-1598943198#retorno" data-toc="retorno#CCMServiceHandler.md-retorno">Retorno</h4><ul class="list" id="-1598943198#-gig2qs_125" start="1"><li class="list-item" id="-1598943198#-gig2qs_126"><p><span class="inline-code" id="-1598943198#-gig2qs_127">Map&lt;String, Object&gt;</span>: La respuesta, potencialmente modificada durante el post-procesamiento.</p></li></ul></section><section><h4 id="-1598943198#c-digo" data-toc="c-digo#CCMServiceHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1598943198#-gig2qs_128"><pre><code class="language-none">global virtual Map&lt;String, Object&gt; postProcess(
  Map&lt;String, Object&gt; response,
  Map&lt;String, Object&gt; options
) {
  Core.debug('Starting CCM Integration Service Post Process');
  if (
    options.containsKey('PlatformEventEnabled') &amp;&amp;
    ((Boolean) options.get('PlatformEventEnabled')) == true
  )
    publishPlatformEventIntegration('post', JSON.serialize(response));
  return response;
}</code></pre></div></section></section><section><h3 id="-1598943198#publishplatformeventintegration-string-moment-string-data" data-toc="publishplatformeventintegration-string-moment-string-data#CCMServiceHandler.md-publishplatformeventintegration-string-moment-string-data">publishPlatformEventIntegration(String moment, String data)</h3><section><h4 id="-1598943198#descripci-n" data-toc="descripci-n#CCMServiceHandler.md-descripci-n">Descripci&oacute;n</h4><p id="-1598943198#-gig2qs_136">M&eacute;todo que publica eventos de plataforma espec&iacute;ficos para CCM en diferentes momentos del procesamiento para proporcionar visibilidad y auditor&iacute;a del proceso de integraci&oacute;n CCM.</p></section><section><h4 id="-1598943198#par-metros" data-toc="par-metros#CCMServiceHandler.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1598943198#-gig2qs_137" start="1"><li class="list-item" id="-1598943198#-gig2qs_138"><p><span class="inline-code" id="-1598943198#-gig2qs_140">moment</span> (String): Momento del procesamiento ('pre', 'in', 'post').</p></li><li class="list-item" id="-1598943198#-gig2qs_139"><p><span class="inline-code" id="-1598943198#-gig2qs_141">data</span> (String): Datos a incluir en el evento de plataforma.</p></li></ul></section><section><h4 id="-1598943198#retorno" data-toc="retorno#CCMServiceHandler.md-retorno">Retorno</h4><ul class="list" id="-1598943198#-gig2qs_142" start="1"><li class="list-item" id="-1598943198#-gig2qs_143"><p><span class="inline-code" id="-1598943198#-gig2qs_144">void</span>: Este m&eacute;todo no devuelve ning&uacute;n valor.</p></li></ul></section><section><h4 id="-1598943198#proceso" data-toc="proceso#CCMServiceHandler.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1598943198#-gig2qs_145" type="1" start="1"><li class="list-item" id="-1598943198#-gig2qs_146"><p>Eval&uacute;a el momento especificado usando un switch.</p></li><li class="list-item" id="-1598943198#-gig2qs_147"><p>Llama al m&eacute;todo de publicaci&oacute;n de evento apropiado seg&uacute;n el momento.</p></li><li class="list-item" id="-1598943198#-gig2qs_148"><p>Incluye informaci&oacute;n contextual espec&iacute;fica para CCM en cada momento.</p></li></ol></section><section><h4 id="-1598943198#c-digo" data-toc="c-digo#CCMServiceHandler.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1598943198#-gig2qs_149"><pre><code class="language-none">global void publishPlatformEventIntegration(String moment, String data) {
  switch on moment.toLowerCase() {
    when 'pre' {
      publishInitPrePlatformEvent(data, 'CCM Integration Service');
    }
    when 'post' {
      publishInitPosPlatformEvent(data, 'CCM Integration Service');
    }
    when 'in' {
      publishPlatFormEvent(200, data, 'Starting CCM In process');
    }
  }
}</code></pre></div></section></section></section><section><h2 id="-1598943198#dependencias" data-toc="dependencias#CCMServiceHandler.md-dependencias">Dependencias</h2><ul class="list" id="-1598943198#-gig2qs_150" start="1"><li class="list-item" id="-1598943198#-gig2qs_151"><p><span class="control" id="-1598943198#-gig2qs_157"><span class="inline-code" id="-1598943198#-gig2qs_158">PlatformEventIntegrationObserver</span></span>: Clase base que proporciona funcionalidad de eventos de plataforma.</p></li><li class="list-item" id="-1598943198#-gig2qs_152"><p><span class="control" id="-1598943198#-gig2qs_159"><span class="inline-code" id="-1598943198#-gig2qs_160">SF_IntegrationSetting__mdt</span></span>: Tipo de metadatos personalizados que almacena la configuraci&oacute;n de integraci&oacute;n CCM.</p></li><li class="list-item" id="-1598943198#-gig2qs_153"><p><span class="control" id="-1598943198#-gig2qs_161"><span class="inline-code" id="-1598943198#-gig2qs_162">ExternalNotificationHandler</span></span>: Clase que maneja las comunicaciones HTTP con servicios externos.</p></li><li class="list-item" id="-1598943198#-gig2qs_154"><p><span class="control" id="-1598943198#-gig2qs_163"><span class="inline-code" id="-1598943198#-gig2qs_164">ExternalServiceException</span></span>: Excepci&oacute;n personalizada para errores de servicios externos.</p></li><li class="list-item" id="-1598943198#-gig2qs_155"><p><span class="control" id="-1598943198#-gig2qs_165"><span class="inline-code" id="-1598943198#-gig2qs_166">ExternalServiceMetadataIntegrationMock</span></span>: Clase mock para proporcionar configuraci&oacute;n durante las pruebas.</p></li><li class="list-item" id="-1598943198#-gig2qs_156"><p><span class="control" id="-1598943198#-gig2qs_167"><span class="inline-code" id="-1598943198#-gig2qs_168">Core</span></span>: Clase utilitaria que proporciona funcionalidad de depuraci&oacute;n.</p></li></ul></section><section><h2 id="-1598943198#caracter-sticas-espec-ficas-de-ccm" data-toc="caracter-sticas-espec-ficas-de-ccm#CCMServiceHandler.md-caracter-sticas-espec-ficas-de-ccm">Caracter&iacute;sticas Espec&iacute;ficas de CCM</h2><section><h3 id="-1598943198#sistema-de-mensajer-a" data-toc="sistema-de-mensajer-a#CCMServiceHandler.md-sistema-de-mensajer-a">Sistema de Mensajer&iacute;a</h3><p id="-1598943198#-gig2qs_171">La clase est&aacute; dise&ntilde;ada para trabajar con un sistema de mensajer&iacute;a que utiliza:</p><ul class="list" id="-1598943198#-gig2qs_172" start="1"><li class="list-item" id="-1598943198#-gig2qs_173"><p><span class="control" id="-1598943198#-gig2qs_176">Routing Key</span>: <span class="inline-code" id="-1598943198#-gig2qs_177">'CDD.ccm.document'</span> para enrutar mensajes CCM</p></li><li class="list-item" id="-1598943198#-gig2qs_174"><p><span class="control" id="-1598943198#-gig2qs_178">Codificaci&oacute;n Base64</span>: Para transmisi&oacute;n segura de documentos</p></li><li class="list-item" id="-1598943198#-gig2qs_175"><p><span class="control" id="-1598943198#-gig2qs_179">Propiedades de Mensaje</span>: Metadatos espec&iacute;ficos del mensaje</p></li></ul></section><section><h3 id="-1598943198#estructura-del-payload" data-toc="estructura-del-payload#CCMServiceHandler.md-estructura-del-payload">Estructura del Payload</h3><div class="detached code-block" id="-1598943198#-gig2qs_180"><pre><code class="language-json">{
  &quot;payload_encoding&quot;: &quot;base64&quot;,
  &quot;properties&quot;: {
    &quot;content-type&quot;: &quot;application/json&quot;
  },
  &quot;routing_key&quot;: &quot;CDD.ccm.document&quot;,
  &quot;payload&quot;: &quot;{\&quot;Content\&quot;:\&quot;&lt;base64_encoded_data&gt;\&quot;}&quot;
}</code></pre></div></section></section><section><h2 id="-1598943198#ejemplos-de-uso" data-toc="ejemplos-de-uso#CCMServiceHandler.md-ejemplos-de-uso">Ejemplos de Uso</h2><section><h3 id="-1598943198#ejemplo-1-env-o-de-documento-ccm-b-sico" data-toc="ejemplo-1-env-o-de-documento-ccm-b-sico#CCMServiceHandler.md-ejemplo-1-env-o-de-documento-ccm-b-sico">Ejemplo 1: Env&iacute;o de Documento CCM B&aacute;sico</h3><div class="detached code-block" id="-1598943198#-gig2qs_185"><pre><code class="language-none">public class CCMDocumentService {
    
    public static Map&lt;String, Object&gt; sendDocument(Map&lt;String, Object&gt; documentData) {
        try {
            // Crear instancia del handler CCM
            CCMServiceHandler handler = new CCMServiceHandler();
            
            // Preparar opciones
            Map&lt;String, Object&gt; options = new Map&lt;String, Object&gt;{
                'PlatformEventEnabled' =&gt; true
            };
            
            // Preparar datos del documento
            Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
                'documentType' =&gt; documentData.get('documentType'),
                'recipientEmail' =&gt; documentData.get('recipientEmail'),
                'templateId' =&gt; documentData.get('templateId'),
                'documentData' =&gt; documentData.get('documentData'),
                'metadata' =&gt; new Map&lt;String, Object&gt;{
                    'senderId' =&gt; UserInfo.getUserId(),
                    'organizationId' =&gt; UserInfo.getOrganizationId(),
                    'timestamp' =&gt; System.now()
                }
            };
            
            // Ejecutar el procesamiento CCM
            Map&lt;String, Object&gt; result = handler.invokeProcess(input, new Map&lt;String, Object&gt;(), options);
            
            if (result != null &amp;&amp; result.containsKey('body')) {
                Map&lt;String, Object&gt; responseBody = (Map&lt;String, Object&gt;) result.get('body');
                return new Map&lt;String, Object&gt;{
                    'success' =&gt; true,
                    'messageId' =&gt; responseBody.get('messageId'),
                    'status' =&gt; result.get('status'),
                    'statusCode' =&gt; result.get('statusCode')
                };
            } else {
                return new Map&lt;String, Object&gt;{
                    'success' =&gt; false,
                    'error' =&gt; 'No se pudo enviar el documento CCM'
                };
            }
        } catch (Exception e) {
            System.debug('Error enviando documento CCM: ' + e.getMessage());
            return new Map&lt;String, Object&gt;{
                'success' =&gt; false,
                'error' =&gt; e.getMessage()
            };
        }
    }
}

// Uso del servicio
Map&lt;String, Object&gt; documentData = new Map&lt;String, Object&gt;{
    'documentType' =&gt; 'POLICY_CERTIFICATE',
    'recipientEmail' =&gt; 'customer@example.com',
    'templateId' =&gt; 'TEMPLATE_001',
    'documentData' =&gt; new Map&lt;String, Object&gt;{
        'policyNumber' =&gt; 'POL-123456',
        'customerName' =&gt; 'Juan Pérez',
        'effectiveDate' =&gt; Date.today(),
        'premium' =&gt; 150000
    }
};

Map&lt;String, Object&gt; result = CCMDocumentService.sendDocument(documentData);

if ((Boolean) result.get('success')) {
    String messageId = (String) result.get('messageId');
    System.debug('Documento CCM enviado exitosamente. Message ID: ' + messageId);
} else {
    System.debug('Error: ' + result.get('error'));
}</code></pre></div></section><section><h3 id="-1598943198#ejemplo-2-extensi-n-especializada-para-comunicaciones-de-seguros" data-toc="ejemplo-2-extensi-n-especializada-para-comunicaciones-de-seguros#CCMServiceHandler.md-ejemplo-2-extensi-n-especializada-para-comunicaciones-de-seguros">Ejemplo 2: Extensi&oacute;n Especializada para Comunicaciones de Seguros</h3><div class="detached code-block" id="-1598943198#-gig2qs_186"><pre><code class="language-none">public class InsuranceCCMHandler extends CCMServiceHandler {
    
    // Sobrescribir pre-procesamiento para validaciones específicas de seguros
    global override Map&lt;String, Object&gt; preProcess(
        Map&lt;String, Object&gt; input,
        Map&lt;String, Object&gt; options
    ) {
        Core.debug('Starting Insurance CCM Service Pre Process');
        
        // Validar datos específicos de seguros
        validateInsuranceDocument(input);
        
        // Enriquecer con datos de la póliza
        input = enrichWithPolicyData(input);
        
        // Llamar al método padre
        return super.preProcess(input, options);
    }
    
    // Sobrescribir post-procesamiento para acciones específicas
    global override Map&lt;String, Object&gt; postProcess(
        Map&lt;String, Object&gt; response,
        Map&lt;String, Object&gt; options
    ) {
        Core.debug('Starting Insurance CCM Service Post Process');
        
        // Crear registro de comunicación
        createCommunicationRecord(response, options);
        
        // Actualizar estado de la póliza si es necesario
        updatePolicyStatus(response);
        
        // Llamar al método padre
        return super.postProcess(response, options);
    }
    
    private void validateInsuranceDocument(Map&lt;String, Object&gt; input) {
        if (!input.containsKey('policyNumber')) {
            throw new CumuloMissingParameterException('El número de póliza es requerido para documentos de seguros');
        }
        
        if (!input.containsKey('documentType')) {
            throw new CumuloMissingParameterException('El tipo de documento es requerido');
        }
        
        String documentType = (String) input.get('documentType');
        Set&lt;String&gt; validTypes = new Set&lt;String&gt;{'POLICY_CERTIFICATE', 'CLAIM_NOTICE', 'PAYMENT_RECEIPT', 'RENEWAL_NOTICE'};
        
        if (!validTypes.contains(documentType)) {
            throw new IllegalArgumentException('Tipo de documento no válido para seguros: ' + documentType);
        }
    }
    
    private Map&lt;String, Object&gt; enrichWithPolicyData(Map&lt;String, Object&gt; input) {
        String policyNumber = (String) input.get('policyNumber');
        
        // Consultar información adicional de la póliza
        List&lt;Policy__c&gt; policies = [
            SELECT Id, PolicyNumber, Status, Premium, EffectiveDate, ExpirationDate, Account__r.Name, Account__r.Email
            FROM Policy__c 
            WHERE PolicyNumber = :policyNumber 
            LIMIT 1
        ];
        
        if (!policies.isEmpty()) {
            Policy__c policy = policies[0];
            input.put('policyId', policy.Id);
            input.put('policyStatus', policy.Status);
            input.put('customerName', policy.Account__r.Name);
            input.put('customerEmail', policy.Account__r.Email);
            input.put('effectiveDate', policy.EffectiveDate);
            input.put('expirationDate', policy.ExpirationDate);
        }
        
        return input;
    }
    
    private void createCommunicationRecord(Map&lt;String, Object&gt; response, Map&lt;String, Object&gt; options) {
        try {
            // Crear registro de comunicación en objeto personalizado
            Communication_Log__c commLog = new Communication_Log__c(
                Type__c = 'CCM_DOCUMENT',
                Status__c = (Integer) response.get('statusCode') == 200 ? 'Sent' : 'Failed',
                Response_Status_Code__c = (Integer) response.get('statusCode'),
                Sent_Date__c = System.now(),
                Platform_Events_Enabled__c = (Boolean) options.get('PlatformEventEnabled')
            );
            
            insert commLog;
        } catch (Exception e) {
            System.debug('Error creando registro de comunicación: ' + e.getMessage());
        }
    }
    
    private void updatePolicyStatus(Map&lt;String, Object&gt; response) {
        // Lógica para actualizar estado de póliza basada en la respuesta CCM
        // Por ejemplo, marcar como &quot;Notificada&quot; después de enviar certificado
    }
}</code></pre></div></section><section><h3 id="-1598943198#ejemplo-3-uso-en-procedimiento-de-integraci-n" data-toc="ejemplo-3-uso-en-procedimiento-de-integraci-n#CCMServiceHandler.md-ejemplo-3-uso-en-procedimiento-de-integraci-n">Ejemplo 3: Uso en Procedimiento de Integraci&oacute;n</h3><div class="detached code-block" id="-1598943198#-gig2qs_187"><pre><code class="language-none">public class CCMIntegrationProcedure {
    
    public static Map&lt;String, Object&gt; sendCCMDocument(Map&lt;String, Object&gt; input) {
        try {
            // Extraer datos del input del procedimiento
            Map&lt;String, Object&gt; documentInfo = (Map&lt;String, Object&gt;) input.get('documentInfo');
            Map&lt;String, Object&gt; options = (Map&lt;String, Object&gt;) input.get('options');
            
            if (options == null) {
                options = new Map&lt;String, Object&gt;{
                    'PlatformEventEnabled' =&gt; true
                };
            }
            
            // Determinar el tipo de handler a usar
            CCMServiceHandler handler;
            String documentType = (String) documentInfo.get('documentType');
            
            if (documentType != null &amp;&amp; documentType.startsWith('INSURANCE_')) {
                handler = new InsuranceCCMHandler();
            } else {
                handler = new CCMServiceHandler();
            }
            
            // Procesar con CCM
            Map&lt;String, Object&gt; result = handler.invokeProcess(
                documentInfo, 
                new Map&lt;String, Object&gt;(), 
                options
            );
            
            // Estructurar respuesta para el procedimiento de integración
            if (result != null) {
                return new Map&lt;String, Object&gt;{
                    'success' =&gt; true,
                    'data' =&gt; result,
                    'message' =&gt; 'Documento CCM enviado exitosamente'
                };
            } else {
                return new Map&lt;String, Object&gt;{
                    'success' =&gt; false,
                    'data' =&gt; null,
                    'message' =&gt; 'Error al enviar documento CCM'
                };
            }
        } catch (ExternalServiceException e) {
            return new Map&lt;String, Object&gt;{
                'success' =&gt; false,
                'data' =&gt; null,
                'message' =&gt; 'Error de servicio CCM: ' + e.getMessage(),
                'errorType' =&gt; 'CCM_SERVICE_ERROR'
            };
        } catch (Exception e) {
            return new Map&lt;String, Object&gt;{
                'success' =&gt; false,
                'data' =&gt; null,
                'message' =&gt; 'Error inesperado: ' + e.getMessage(),
                'errorType' =&gt; 'UNEXPECTED_ERROR'
            };
        }
    }
}</code></pre></div></section><section><h3 id="-1598943198#ejemplo-4-env-o-masivo-de-documentos-ccm" data-toc="ejemplo-4-env-o-masivo-de-documentos-ccm#CCMServiceHandler.md-ejemplo-4-env-o-masivo-de-documentos-ccm">Ejemplo 4: Env&iacute;o Masivo de Documentos CCM</h3><div class="detached code-block" id="-1598943198#-gig2qs_188"><pre><code class="language-none">public class BulkCCMService {
    
    @future(callout=true)
    public static void sendBulkDocuments(String serializedDocuments) {
        List&lt;Map&lt;String, Object&gt;&gt; documents = 
            (List&lt;Map&lt;String, Object&gt;&gt;) JSON.deserializeUntyped(serializedDocuments);
        
        CCMServiceHandler handler = new CCMServiceHandler();
        List&lt;Map&lt;String, Object&gt;&gt; results = new List&lt;Map&lt;String, Object&gt;&gt;();
        
        Map&lt;String, Object&gt; options = new Map&lt;String, Object&gt;{
            'PlatformEventEnabled' =&gt; true
        };
        
        for (Map&lt;String, Object&gt; doc : documents) {
            try {
                Map&lt;String, Object&gt; result = handler.invokeProcess(
                    doc, 
                    new Map&lt;String, Object&gt;(), 
                    options
                );
                
                results.add(new Map&lt;String, Object&gt;{
                    'documentId' =&gt; doc.get('documentId'),
                    'success' =&gt; result != null,
                    'result' =&gt; result
                });
                
                // Pausa breve entre llamadas para evitar throttling
                if (!Test.isRunningTest()) {
                    System.debug('Documento procesado, continuando...');
                }
            } catch (Exception e) {
                results.add(new Map&lt;String, Object&gt;{
                    'documentId' =&gt; doc.get('documentId'),
                    'success' =&gt; false,
                    'error' =&gt; e.getMessage()
                });
            }
        }
        
        // Procesar resultados (guardar en base de datos, enviar notificaciones, etc.)
        processBulkResults(results);
    }
    
    private static void processBulkResults(List&lt;Map&lt;String, Object&gt;&gt; results) {
        Integer successCount = 0;
        Integer failureCount = 0;
        
        for (Map&lt;String, Object&gt; result : results) {
            if ((Boolean) result.get('success')) {
                successCount++;
            } else {
                failureCount++;
                System.debug('Error en documento ' + result.get('documentId') + ': ' + result.get('error'));
            }
        }
        
        System.debug('Procesamiento masivo CCM completado. Éxitos: ' + successCount + ', Fallos: ' + failureCount);
        
        // Crear registro de resumen
        createBulkProcessingSummary(successCount, failureCount, results.size());
    }
    
    private static void createBulkProcessingSummary(Integer success, Integer failures, Integer total) {
        try {
            Bulk_Processing_Log__c summary = new Bulk_Processing_Log__c(
                Process_Type__c = 'CCM_BULK_SEND',
                Total_Records__c = total,
                Successful_Records__c = success,
                Failed_Records__c = failures,
                Processing_Date__c = System.now(),
                Success_Rate__c = total &gt; 0 ? (Decimal.valueOf(success) / total * 100).setScale(2) : 0
            );
            
            insert summary;
        } catch (Exception e) {
            System.debug('Error creando resumen de procesamiento masivo: ' + e.getMessage());
        }
    }
}</code></pre></div></section></section><section><h2 id="-1598943198#configuraci-n-de-metadatos-personalizados" data-toc="configuraci-n-de-metadatos-personalizados#CCMServiceHandler.md-configuraci-n-de-metadatos-personalizados">Configuraci&oacute;n de Metadatos Personalizados</h2><p id="-1598943198#-gig2qs_189">La clase utiliza el registro de metadatos personalizados <span class="inline-code" id="-1598943198#-gig2qs_193">SF_IntegrationSetting__mdt</span> con el nombre <span class="inline-code" id="-1598943198#-gig2qs_194">ccm_endpoint</span>. Este registro debe contener:</p><div class="table-wrapper detached"><table id="-1598943198#-gig2qs_190"><tr class="header-row" id="-1598943198#-gig2qs_195"><th id="-1598943198#-gig2qs_198"><p>Campo</p></th><th id="-1598943198#-gig2qs_199"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-1598943198#-gig2qs_196"><td id="-1598943198#-gig2qs_200"><p><span class="inline-code" id="-1598943198#-gig2qs_202">Platform_Events_Enabled__c</span></p></td><td id="-1598943198#-gig2qs_201"><p>Boolean que indica si los eventos de plataforma est&aacute;n habilitados</p></td></tr><tr class="" id="-1598943198#-gig2qs_197"><td id="-1598943198#-gig2qs_203"><p>Campos de endpoint CCM</p></td><td id="-1598943198#-gig2qs_204"><p>URL del servicio CCM, credenciales, timeouts, etc.</p></td></tr></table></div><p id="-1598943198#-gig2qs_191">Ejemplo de configuraci&oacute;n:</p><div class="detached code-block" id="-1598943198#-gig2qs_192"><pre><code class="language-none">Label: CCM Endpoint Configuration
Developer Name: ccm_endpoint
Platform_Events_Enabled__c: true
Endpoint__c: https://ccm.suratech.com/api/v1/messages
Timeout__c: 45000
API_Key__c: [encrypted]</code></pre></div></section><section><h2 id="-1598943198#consideraciones-de-seguridad-ccm" data-toc="consideraciones-de-seguridad-ccm#CCMServiceHandler.md-consideraciones-de-seguridad-ccm">Consideraciones de Seguridad CCM</h2><ol class="list list-decimal" id="-1598943198#-gig2qs_205" type="1" start="1"><li class="list-item" id="-1598943198#-gig2qs_206"><p><span class="control" id="-1598943198#-gig2qs_210">Codificaci&oacute;n Base64</span>: Los datos se codifican en Base64 para transmisi&oacute;n segura.</p></li><li class="list-item" id="-1598943198#-gig2qs_207"><p><span class="control" id="-1598943198#-gig2qs_211">Datos Sensibles</span>: El contenido del documento puede contener informaci&oacute;n personal sensible.</p></li><li class="list-item" id="-1598943198#-gig2qs_208"><p><span class="control" id="-1598943198#-gig2qs_212">Enrutamiento</span>: El routing key espec&iacute;fico asegura que los documentos lleguen al destino correcto.</p></li><li class="list-item" id="-1598943198#-gig2qs_209"><p><span class="control" id="-1598943198#-gig2qs_213">Configuraci&oacute;n Segura</span>: Las credenciales deben estar protegidas en los metadatos personalizados.</p></li></ol></section><section><h2 id="-1598943198#consideraciones-de-rendimiento" data-toc="consideraciones-de-rendimiento#CCMServiceHandler.md-consideraciones-de-rendimiento">Consideraciones de Rendimiento</h2><ol class="list list-decimal" id="-1598943198#-gig2qs_214" type="1" start="1"><li class="list-item" id="-1598943198#-gig2qs_215"><p><span class="control" id="-1598943198#-gig2qs_219">Codificaci&oacute;n</span>: La doble serializaci&oacute;n y codificaci&oacute;n Base64 puede impactar el rendimiento con documentos grandes.</p></li><li class="list-item" id="-1598943198#-gig2qs_216"><p><span class="control" id="-1598943198#-gig2qs_220">Tama&ntilde;o de Payload</span>: Los documentos grandes pueden exceder l&iacute;mites de tama&ntilde;o de HTTP.</p></li><li class="list-item" id="-1598943198#-gig2qs_217"><p><span class="control" id="-1598943198#-gig2qs_221">Latencia de Red</span>: Las comunicaciones con CCM pueden tener latencia variable.</p></li><li class="list-item" id="-1598943198#-gig2qs_218"><p><span class="control" id="-1598943198#-gig2qs_222">Throttling</span>: El servicio CCM puede tener l&iacute;mites de velocidad que deben considerarse.</p></li></ol></section><section><h2 id="-1598943198#notas-adicionales" data-toc="notas-adicionales#CCMServiceHandler.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-1598943198#-gig2qs_223" type="1" start="1"><li class="list-item" id="-1598943198#-gig2qs_224"><p><span class="control" id="-1598943198#-gig2qs_229">Doble Serializaci&oacute;n</span>: El c&oacute;digo realiza una doble serializaci&oacute;n del payload, lo que puede ser optimizado.</p></li><li class="list-item" id="-1598943198#-gig2qs_225"><p><span class="control" id="-1598943198#-gig2qs_230">Routing Key Espec&iacute;fico</span>: El routing key 'CDD.ccm.document' sugiere un sistema de mensajer&iacute;a empresarial espec&iacute;fico.</p></li><li class="list-item" id="-1598943198#-gig2qs_226"><p><span class="control" id="-1598943198#-gig2qs_231">M&eacute;todos Virtuales</span>: Permite extensi&oacute;n para casos de uso espec&iacute;ficos como seguros o otros dominios.</p></li><li class="list-item" id="-1598943198#-gig2qs_227"><p><span class="control" id="-1598943198#-gig2qs_232">Sistema de Colas</span>: La estructura del payload sugiere integraci&oacute;n con un sistema de colas o mensaje broker.</p></li><li class="list-item" id="-1598943198#-gig2qs_228"><p><span class="control" id="-1598943198#-gig2qs_233">Validaci&oacute;n Comentada</span>: Existe c&oacute;digo comentado para validaci&oacute;n de esquema CCM que podr&iacute;a implementarse.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="791714434">MetaDataUtils</h1><section><h2 id="791714434#descripci-n-general" data-toc="descripci-n-general#MetaDataUtils.md-descripci-n-general">Descripci&oacute;n General</h2><p id="791714434#-5j6bb8_10"><span class="inline-code" id="791714434#-5j6bb8_11">MetaDataUtils</span> es una clase Apex que proporciona utilidades para trabajar con metadatos personalizados en Salesforce. Esta clase facilita la creaci&oacute;n y actualizaci&oacute;n (upsert) de registros de metadatos personalizados mediante la API de Metadata.</p></section><section><h2 id="791714434#autor" data-toc="autor#MetaDataUtils.md-autor">Autor</h2><p id="791714434#-5j6bb8_12">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="791714434#ltima-modificaci-n" data-toc="ltima-modificaci-n#MetaDataUtils.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="791714434#-5j6bb8_13">28 de octubre de 2024</p></section><section><h2 id="791714434#m-todos-p-blicos" data-toc="m-todos-p-blicos#MetaDataUtils.md-m-todos-p-blicos">M&eacute;todos P&uacute;blicos</h2><section><h3 id="791714434#upsertmetadata-list-sobject-custommetadatalist" data-toc="upsertmetadata-list-sobject-custommetadatalist#MetaDataUtils.md-upsertmetadata-list-sobject-custommetadatalist">upsertMetadata(List&lt;sObject&gt; customMetadataList)</h3><section><h4 id="791714434#descripci-n" data-toc="descripci-n#MetaDataUtils.md-descripci-n">Descripci&oacute;n</h4><p id="791714434#-5j6bb8_23">Este m&eacute;todo permite crear o actualizar (upsert) m&uacute;ltiples registros de metadatos personalizados en una sola operaci&oacute;n.</p></section><section><h4 id="791714434#par-metros" data-toc="par-metros#MetaDataUtils.md-par-metros">Par&aacute;metros</h4><ul class="list" id="791714434#-5j6bb8_24" start="1"><li class="list-item" id="791714434#-5j6bb8_25"><p><span class="inline-code" id="791714434#-5j6bb8_26">customMetadataList</span> (List\&lt;sObject\&gt;): Lista de objetos SObject que representan los registros de metadatos personalizados a insertar o actualizar.</p></li></ul></section><section><h4 id="791714434#retorno" data-toc="retorno#MetaDataUtils.md-retorno">Retorno</h4><ul class="list" id="791714434#-5j6bb8_27" start="1"><li class="list-item" id="791714434#-5j6bb8_28"><p><span class="inline-code" id="791714434#-5j6bb8_29">String</span>: ID del despliegue de metadatos. Este ID puede utilizarse para rastrear el estado del despliegue.</p></li></ul></section><section><h4 id="791714434#proceso" data-toc="proceso#MetaDataUtils.md-proceso">Proceso</h4><ol class="list list-decimal" id="791714434#-5j6bb8_30" type="1" start="1"><li class="list-item" id="791714434#-5j6bb8_31"><p>Crea un contenedor de despliegue (<span class="inline-code" id="791714434#-5j6bb8_35">Metadata.DeployContainer</span>) para los metadatos personalizados.</p></li><li class="list-item" id="791714434#-5j6bb8_32"><p>Para cada objeto en la lista de metadatos: </p><ul class="list" id="791714434#-5j6bb8_36" start="1"><li class="list-item" id="791714434#-5j6bb8_37"><p>Obtiene el nombre del objeto y sus detalles.</p></li><li class="list-item" id="791714434#-5j6bb8_38"><p>Crea una instancia de metadatos personalizados.</p></li><li class="list-item" id="791714434#-5j6bb8_39"><p>Establece el nombre completo y la etiqueta del registro.</p></li><li class="list-item" id="791714434#-5j6bb8_40"><p>Obtiene todos los campos del objeto.</p></li><li class="list-item" id="791714434#-5j6bb8_41"><p>Define un conjunto de campos para omitir ('developername', 'masterlabel', etc.).</p></li><li class="list-item" id="791714434#-5j6bb8_42"><p>Itera sobre los campos populados en el objeto.</p></li><li class="list-item" id="791714434#-5j6bb8_43"><p>Para cada campo no omitido y con valor no nulo: </p><ul class="list" id="791714434#-5j6bb8_45" start="1"><li class="list-item" id="791714434#-5j6bb8_46"><p>Crea una instancia de valor de metadatos personalizados.</p></li><li class="list-item" id="791714434#-5j6bb8_47"><p>Asigna el nombre del campo y su valor.</p></li><li class="list-item" id="791714434#-5j6bb8_48"><p>A&ntilde;ade el campo al objeto de metadatos.</p></li></ul></li><li class="list-item" id="791714434#-5j6bb8_44"><p>A&ntilde;ade el objeto de metadatos al contenedor de despliegue.</p></li></ul></li><li class="list-item" id="791714434#-5j6bb8_33"><p>Crea una instancia de la clase callback (<span class="inline-code" id="791714434#-5j6bb8_49">CustomMetadataCallback</span>).</p></li><li class="list-item" id="791714434#-5j6bb8_34"><p>Encola el despliegue y retorna el ID de despliegue o un ID fijo ('04tO9000000ScNJ') si est&aacute; ejecut&aacute;ndose en un contexto de prueba.</p></li></ol></section><section><h4 id="791714434#c-digo" data-toc="c-digo#MetaDataUtils.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="791714434#-5j6bb8_50"><pre><code class="language-none">public static String upsertMetadata(List&lt;sObject&gt; customMetadataList) {
  //Create Deployment container for custom Metadata
  Metadata.DeployContainer mdContainer = new Metadata.DeployContainer();
  for (sobject sObMD : customMetadataList) {
    //Get metadata object name and details
    String sObjectname = sObMD.getSObjectType().getDescribe().getName();

    //Create custom Metadata instance
    Metadata.CustomMetadata customMetadata = new Metadata.CustomMetadata();
    String recordName = String.valueOf(sObMD.get('DeveloperName'))
      .replaceAll(' ', '_');
    customMetadata.fullName = sObjectname + '.' + recordName;
    customMetadata.label = (String) sObMD.get('MasterLabel');

    //Get all fields
    schema.SObjectType sobjType = Schema.getGlobalDescribe().get(sObjectname);

    Map&lt;String, Schema.sObjectField&gt; sObjectFields = sobjType.getDescribe()
      .fields.getMap();
    Set&lt;String&gt; skipFieldSet = new Set&lt;String&gt;{
      'developername',
      'masterlabel',
      'language',
      'namespaceprefix',
      'label',
      'qualifiedapiname',
      'id'
    };

    // Use getPopulatedFieldsAsMap to get the populate field and iterate over them
    for (String fieldName : sObMD.getPopulatedFieldsAsMap().keySet()) {
      if (
        skipFieldSet.contains(fieldName.toLowerCase()) ||
        sObMD.get(fieldName) == null
      ) {
        continue;
      }

      Object value = sObMD.get(fieldName);
      //create field instance and populate it with field API name and value
      Metadata.CustomMetadataValue customField = new Metadata.CustomMetadataValue();
      customField.field = fieldName;

      Schema.DisplayType valueType = sObjectFields.get(fieldName)
        .getDescribe()
        .getType();
      customField.value = value;
      //Add fields in the object, similar to creating sObject instance
      customMetadata.values.add(customField);
    }
    //Add metadata in container
    mdContainer.addMetadata(customMetadata);
  }

  // Callback class instance
  CustomMetadataCallback callback = new CustomMetadataCallback();
  return Test.isRunningTest()
    ? '04tO9000000ScNJ'
    : Metadata.Operations.enqueueDeployment(mdContainer, callback);
}</code></pre></div></section></section><section><h3 id="791714434#upsertmetadata-sobject-custommetadata" data-toc="upsertmetadata-sobject-custommetadata#MetaDataUtils.md-upsertmetadata-sobject-custommetadata">upsertMetadata(sObject customMetadata)</h3><section><h4 id="791714434#descripci-n" data-toc="descripci-n#MetaDataUtils.md-descripci-n">Descripci&oacute;n</h4><p id="791714434#-5j6bb8_57">Sobrecarga del m&eacute;todo <span class="inline-code" id="791714434#-5j6bb8_58">upsertMetadata</span> que acepta un solo objeto SObject en lugar de una lista. Internamente, convierte el objeto en una lista y llama al m&eacute;todo principal.</p></section><section><h4 id="791714434#par-metros" data-toc="par-metros#MetaDataUtils.md-par-metros">Par&aacute;metros</h4><ul class="list" id="791714434#-5j6bb8_59" start="1"><li class="list-item" id="791714434#-5j6bb8_60"><p><span class="inline-code" id="791714434#-5j6bb8_61">customMetadata</span> (sObject): Objeto SObject que representa el registro de metadatos personalizado a insertar o actualizar.</p></li></ul></section><section><h4 id="791714434#retorno" data-toc="retorno#MetaDataUtils.md-retorno">Retorno</h4><ul class="list" id="791714434#-5j6bb8_62" start="1"><li class="list-item" id="791714434#-5j6bb8_63"><p><span class="inline-code" id="791714434#-5j6bb8_64">String</span>: ID del despliegue de metadatos.</p></li></ul></section><section><h4 id="791714434#c-digo" data-toc="c-digo#MetaDataUtils.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="791714434#-5j6bb8_65"><pre><code class="language-none">public static String upsertMetadata(sObject customMetadata) {
  return upsertMetadata(new List&lt;sObject&gt;{ customMetadata });
}</code></pre></div></section></section></section><section><h2 id="791714434#observaciones" data-toc="observaciones#MetaDataUtils.md-observaciones">Observaciones</h2><ol class="list list-decimal" id="791714434#-5j6bb8_66" type="1" start="1"><li class="list-item" id="791714434#-5j6bb8_67"><p>La clase incluye c&oacute;digo comentado relacionado con la conversi&oacute;n de tipos de datos, particularmente para fechas, horas, porcentajes, monedas, etc. Este c&oacute;digo est&aacute; actualmente inactivo pero podr&iacute;a ser &uacute;til para manejar conversiones de tipos especiales si es necesario.</p></li><li class="list-item" id="791714434#-5j6bb8_68"><p>El m&eacute;todo utiliza <span class="inline-code" id="791714434#-5j6bb8_71">getPopulatedFieldsAsMap()</span> para obtener solo los campos que han sido expl&iacute;citamente asignados en el objeto, lo que mejora la eficiencia.</p></li><li class="list-item" id="791714434#-5j6bb8_69"><p>Se utiliza una clase de callback (<span class="inline-code" id="791714434#-5j6bb8_72">CustomMetadataCallback</span>) para manejar las respuestas del proceso de despliegue, aunque esta clase no est&aacute; definida en el c&oacute;digo proporcionado.</p></li><li class="list-item" id="791714434#-5j6bb8_70"><p>En entornos de prueba (<span class="inline-code" id="791714434#-5j6bb8_73">Test.isRunningTest()</span>), el m&eacute;todo retorna un ID fijo ('04tO9000000ScNJ') en lugar de realizar el despliegue real.</p></li></ol></section><section><h2 id="791714434#dependencias" data-toc="dependencias#MetaDataUtils.md-dependencias">Dependencias</h2><ul class="list" id="791714434#-5j6bb8_74" start="1"><li class="list-item" id="791714434#-5j6bb8_75"><p><span class="inline-code" id="791714434#-5j6bb8_76">CustomMetadataCallback</span>: Una clase que implementa la interfaz <span class="inline-code" id="791714434#-5j6bb8_77">Metadata.DeployCallback</span> para manejar las respuestas del proceso de despliegue. Esta clase no est&aacute; incluida en el c&oacute;digo proporcionado.</p></li></ul></section><section><h2 id="791714434#ejemplo-de-uso" data-toc="ejemplo-de-uso#MetaDataUtils.md-ejemplo-de-uso">Ejemplo de Uso</h2><div class="detached code-block" id="791714434#-5j6bb8_78"><pre><code class="language-none">// Crear un registro de metadatos personalizado
My_Custom_Metadata__mdt customMD = new My_Custom_Metadata__mdt();
customMD.DeveloperName = 'Test_Record';
customMD.MasterLabel = 'Test Record';
customMD.Field_1__c = 'Value 1';
customMD.Field_2__c = 100;

// Realizar el upsert
String deploymentId = MetaDataUtils.upsertMetadata(customMD);
System.debug('Deployment ID: ' + deploymentId);</code></pre></div></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="312447433">LocalEmisionNotificationHandlerMock</h1><section><h2 id="312447433#descripci-n" data-toc="descripci-n#LocalEmisionHandlerMock.md-descripci-n">Descripci&oacute;n</h2><p id="312447433#-zape3v_12">Clase mock para simular respuestas HTTP durante pruebas del manejador de notificaciones de emisi&oacute;n local. Implementa la interfaz HttpCalloutMock para interceptar llamadas HTTP salientes durante pruebas.</p></section><section><h2 id="312447433#autor" data-toc="autor#LocalEmisionHandlerMock.md-autor">Autor</h2><p id="312447433#-zape3v_13">ChangeMeIn@UserSettingsUnder.SFDoc</p></section><section><h2 id="312447433#ltima-modificaci-n" data-toc="ltima-modificaci-n#LocalEmisionHandlerMock.md-ltima-modificaci-n">&Uacute;ltima modificaci&oacute;n</h2><p id="312447433#-zape3v_14">31 de enero de 2025 por ChangeMeIn@UserSettingsUnder.SFDoc</p></section><section><h2 id="312447433#detalles" data-toc="detalles#LocalEmisionHandlerMock.md-detalles">Detalles</h2><p id="312447433#-zape3v_15">Esta clase de prueba permite simular diferentes respuestas del servicio de notificaciones de emisi&oacute;n local, incluyendo respuestas exitosas y escenarios de error.</p></section><section><h2 id="312447433#anotaciones" data-toc="anotaciones#LocalEmisionHandlerMock.md-anotaciones">Anotaciones</h2><ul class="list" id="312447433#-zape3v_16" start="1"><li class="list-item" id="312447433#-zape3v_17"><p><span class="inline-code" id="312447433#-zape3v_19">@isTest</span>: Indica que esta clase es exclusivamente para pruebas.</p></li><li class="list-item" id="312447433#-zape3v_18"><p><span class="inline-code" id="312447433#-zape3v_20">global</span>: Visibilidad m&aacute;xima para permitir su uso en cualquier contexto de prueba.</p></li></ul></section><section><h2 id="312447433#implementaci-n" data-toc="implementaci-n#LocalEmisionHandlerMock.md-implementaci-n">Implementaci&oacute;n</h2><p id="312447433#-zape3v_21">Implementa la interfaz <span class="inline-code" id="312447433#-zape3v_22">HttpCalloutMock</span> para simular respuestas HTTP durante pruebas.</p></section><section><h2 id="312447433#propiedades" data-toc="propiedades#LocalEmisionHandlerMock.md-propiedades">Propiedades</h2><div class="table-wrapper detached"><table id="312447433#-zape3v_23"><tr class="header-row" id="312447433#-zape3v_24"><th id="312447433#-zape3v_28"><p>Nombre</p></th><th id="312447433#-zape3v_29"><p>Tipo</p></th><th id="312447433#-zape3v_30"><p>Visibilidad</p></th><th id="312447433#-zape3v_31"><p>Descripci&oacute;n</p></th></tr><tr class="" id="312447433#-zape3v_25"><td id="312447433#-zape3v_32"><p>statusCode</p></td><td id="312447433#-zape3v_33"><p>Integer</p></td><td id="312447433#-zape3v_34"><p>private</p></td><td id="312447433#-zape3v_35"><p>C&oacute;digo de estado HTTP a devolver en la respuesta simulada</p></td></tr><tr class="" id="312447433#-zape3v_26"><td id="312447433#-zape3v_36"><p>status</p></td><td id="312447433#-zape3v_37"><p>String</p></td><td id="312447433#-zape3v_38"><p>private</p></td><td id="312447433#-zape3v_39"><p>Mensaje de estado HTTP a devolver</p></td></tr><tr class="" id="312447433#-zape3v_27"><td id="312447433#-zape3v_40"><p>cException</p></td><td id="312447433#-zape3v_41"><p>Boolean</p></td><td id="312447433#-zape3v_42"><p>private</p></td><td id="312447433#-zape3v_43"><p>Bandera para indicar si se debe lanzar una excepci&oacute;n</p></td></tr></table></div></section><section><h2 id="312447433#constructor" data-toc="constructor#LocalEmisionHandlerMock.md-constructor">Constructor</h2><div class="detached code-block" id="312447433#-zape3v_44"><pre><code class="language-none">global LocalEmisionNotificationHandlerMock(Integer statusCode, String status, boolean cException)</code></pre></div><p id="312447433#-zape3v_45">Configura la instancia mock con los par&aacute;metros especificados para controlar su comportamiento.</p><section><h3 id="312447433#par-metros" data-toc="par-metros#LocalEmisionHandlerMock.md-par-metros">Par&aacute;metros</h3><ul class="list" id="312447433#-zape3v_47" start="1"><li class="list-item" id="312447433#-zape3v_48"><p><span class="inline-code" id="312447433#-zape3v_51">statusCode</span>: C&oacute;digo de estado HTTP que devolver&aacute; la respuesta simulada</p></li><li class="list-item" id="312447433#-zape3v_49"><p><span class="inline-code" id="312447433#-zape3v_52">status</span>: Mensaje de estado HTTP que devolver&aacute; la respuesta</p></li><li class="list-item" id="312447433#-zape3v_50"><p><span class="inline-code" id="312447433#-zape3v_53">cException</span>: Si es <span class="inline-code" id="312447433#-zape3v_54">true</span>, el mock lanzar&aacute; una excepci&oacute;n de callout en lugar de devolver una respuesta</p></li></ul></section></section><section><h2 id="312447433#m-todos" data-toc="m-todos#LocalEmisionHandlerMock.md-m-todos">M&eacute;todos</h2><section><h3 id="312447433#respond" data-toc="respond#LocalEmisionHandlerMock.md-respond">respond</h3><div class="detached code-block" id="312447433#-zape3v_58"><pre><code class="language-none">global HTTPResponse respond(HTTPRequest req)</code></pre></div><p id="312447433#-zape3v_59">M&eacute;todo principal que implementa la interfaz HttpCalloutMock. Genera y devuelve una respuesta HTTP simulada basada en la configuraci&oacute;n del mock.</p><section><h4 id="312447433#par-metros" data-toc="par-metros#LocalEmisionHandlerMock.md-par-metros">Par&aacute;metros</h4><ul class="list" id="312447433#-zape3v_63" start="1"><li class="list-item" id="312447433#-zape3v_64"><p><span class="inline-code" id="312447433#-zape3v_65">req</span>: La solicitud HTTP interceptada</p></li></ul></section><section><h4 id="312447433#retorno" data-toc="retorno#LocalEmisionHandlerMock.md-retorno">Retorno</h4><ul class="list" id="312447433#-zape3v_66" start="1"><li class="list-item" id="312447433#-zape3v_67"><p>Objeto <span class="inline-code" id="312447433#-zape3v_68">HTTPResponse</span> con la respuesta simulada seg&uacute;n la configuraci&oacute;n</p></li></ul></section><section><h4 id="312447433#comportamiento" data-toc="comportamiento#LocalEmisionHandlerMock.md-comportamiento">Comportamiento</h4><ul class="list" id="312447433#-zape3v_69" start="1"><li class="list-item" id="312447433#-zape3v_70"><p>Si <span class="inline-code" id="312447433#-zape3v_73">cException</span> es verdadero, lanza una excepci&oacute;n <span class="inline-code" id="312447433#-zape3v_74">CalloutException</span> con el mensaje &quot;Error en el servicio&quot;</p></li><li class="list-item" id="312447433#-zape3v_71"><p>De lo contrario, construye una respuesta HTTP con el c&oacute;digo y estado configurados</p></li><li class="list-item" id="312447433#-zape3v_72"><p>El cuerpo de la respuesta depende del endpoint: </p><ul class="list" id="312447433#-zape3v_75" start="1"><li class="list-item" id="312447433#-zape3v_76"><p>Para requests a &quot;https://api.ipify.org&quot;, devuelve una IP simulada</p></li><li class="list-item" id="312447433#-zape3v_77"><p>Para otros endpoints, devuelve un objeto JSON vac&iacute;o</p></li></ul></li></ul></section></section><section><h3 id="312447433#localemisionbodyresponse-private" data-toc="localemisionbodyresponse-private#LocalEmisionHandlerMock.md-localemisionbodyresponse-private">localEmisionBodyResponse (private)</h3><div class="detached code-block" id="312447433#-zape3v_78"><pre><code class="language-none">private static String localEmisionBodyResponse()</code></pre></div><p id="312447433#-zape3v_79">Genera el cuerpo de respuesta est&aacute;ndar para el servicio de emisi&oacute;n local.</p><section><h4 id="312447433#retorno" data-toc="retorno#LocalEmisionHandlerMock.md-retorno">Retorno</h4><ul class="list" id="312447433#-zape3v_81" start="1"><li class="list-item" id="312447433#-zape3v_82"><p>Un objeto JSON vac&iacute;o como string: <span class="inline-code" id="312447433#-zape3v_83">&quot;{}&quot;</span></p></li></ul></section></section><section><h3 id="312447433#salesforceexternalip-private" data-toc="salesforceexternalip-private#LocalEmisionHandlerMock.md-salesforceexternalip-private">salesforceExternalIP (private)</h3><div class="detached code-block" id="312447433#-zape3v_84"><pre><code class="language-none">private static String salesforceExternalIP()</code></pre></div><p id="312447433#-zape3v_85">Proporciona una direcci&oacute;n IP simulada para las solicitudes al servicio de identificaci&oacute;n de IP externa.</p><section><h4 id="312447433#retorno" data-toc="retorno#LocalEmisionHandlerMock.md-retorno">Retorno</h4><ul class="list" id="312447433#-zape3v_87" start="1"><li class="list-item" id="312447433#-zape3v_88"><p>Una direcci&oacute;n IP simulada como string: <span class="inline-code" id="312447433#-zape3v_89">&quot;155.226.129.250&quot;</span></p></li></ul></section></section></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="632001157">EventLog_Subset_CleanupScheduleClass</h1><section><h2 id="632001157#descripci-n-general" data-toc="descripci-n-general#EventLog_Subset_CleanupScheduleClass.md-descripci-n-general">Descripci&oacute;n General</h2><p id="632001157#-fip8ah_16"><span class="inline-code" id="632001157#-fip8ah_17">EventLog_Subset_CleanupScheduleClass</span> es una clase que implementa la interfaz <span class="inline-code" id="632001157#-fip8ah_18">Schedulable</span> de Salesforce. Esta clase est&aacute; dise&ntilde;ada para programar y ejecutar autom&aacute;ticamente la limpieza de registros antiguos del objeto <span class="inline-code" id="632001157#-fip8ah_19">EventLog_Subset__c</span>, eliminando entradas que tienen m&aacute;s de un d&iacute;a de antig&uuml;edad.</p></section><section><h2 id="632001157#ltima-modificaci-n" data-toc="ltima-modificaci-n#EventLog_Subset_CleanupScheduleClass.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="632001157#-fip8ah_20">7 de marzo de 2025</p></section><section><h2 id="632001157#implementaci-n-de-interfaz" data-toc="implementaci-n-de-interfaz#EventLog_Subset_CleanupScheduleClass.md-implementaci-n-de-interfaz">Implementaci&oacute;n de Interfaz</h2><ul class="list" id="632001157#-fip8ah_21" start="1"><li class="list-item" id="632001157#-fip8ah_22"><p><span class="control" id="632001157#-fip8ah_24">Interfaz Implementada</span>: <span class="inline-code" id="632001157#-fip8ah_25">Schedulable</span></p></li><li class="list-item" id="632001157#-fip8ah_23"><p><span class="control" id="632001157#-fip8ah_26">Prop&oacute;sito</span>: Permite que la clase sea programada para ejecuci&oacute;n utilizando el sistema de trabajos programados de Salesforce.</p></li></ul></section><section><h2 id="632001157#m-todo-principal" data-toc="m-todo-principal#EventLog_Subset_CleanupScheduleClass.md-m-todo-principal">M&eacute;todo Principal</h2><section><h3 id="632001157#execute-schedulablecontext-sc" data-toc="execute-schedulablecontext-sc#EventLog_Subset_CleanupScheduleClass.md-execute-schedulablecontext-sc">execute(SchedulableContext sc)</h3><section><h4 id="632001157#descripci-n" data-toc="descripci-n#EventLog_Subset_CleanupScheduleClass.md-descripci-n">Descripci&oacute;n</h4><p id="632001157#-fip8ah_35">Este m&eacute;todo es requerido por la interfaz <span class="inline-code" id="632001157#-fip8ah_36">Schedulable</span> y se ejecuta autom&aacute;ticamente seg&uacute;n la programaci&oacute;n establecida. Configura y ejecuta un trabajo por lotes para eliminar registros antiguos de <span class="inline-code" id="632001157#-fip8ah_37">EventLog_Subset__c</span>.</p></section><section><h4 id="632001157#par-metros" data-toc="par-metros#EventLog_Subset_CleanupScheduleClass.md-par-metros">Par&aacute;metros</h4><ul class="list" id="632001157#-fip8ah_38" start="1"><li class="list-item" id="632001157#-fip8ah_39"><p><span class="inline-code" id="632001157#-fip8ah_40">sc</span> (SchedulableContext): El contexto de programaci&oacute;n proporcionado por el sistema de Salesforce.</p></li></ul></section><section><h4 id="632001157#retorno" data-toc="retorno#EventLog_Subset_CleanupScheduleClass.md-retorno">Retorno</h4><ul class="list" id="632001157#-fip8ah_41" start="1"><li class="list-item" id="632001157#-fip8ah_42"><p><span class="inline-code" id="632001157#-fip8ah_43">void</span></p></li></ul></section><section><h4 id="632001157#proceso" data-toc="proceso#EventLog_Subset_CleanupScheduleClass.md-proceso">Proceso</h4><ol class="list list-decimal" id="632001157#-fip8ah_44" type="1" start="1"><li class="list-item" id="632001157#-fip8ah_45"><p>Obtiene la configuraci&oacute;n desde el metadato personalizado <span class="inline-code" id="632001157#-fip8ah_50">Suratech_Foundation_Schedule_Event__mdt</span> con el nombre desarrollador 'schedule'.</p></li><li class="list-item" id="632001157#-fip8ah_46"><p>En caso de estar en un contexto de prueba, crea una configuraci&oacute;n por defecto.</p></li><li class="list-item" id="632001157#-fip8ah_47"><p>Verifica si la configuraci&oacute;n existe, lanzando una excepci&oacute;n si no se encuentra.</p></li><li class="list-item" id="632001157#-fip8ah_48"><p>Comprueba si la programaci&oacute;n est&aacute; activa seg&uacute;n la configuraci&oacute;n.</p></li><li class="list-item" id="632001157#-fip8ah_49"><p>Si est&aacute; activa: </p><ul class="list" id="632001157#-fip8ah_51" start="1"><li class="list-item" id="632001157#-fip8ah_52"><p>Calcula la fecha de un d&iacute;a atr&aacute;s.</p></li><li class="list-item" id="632001157#-fip8ah_53"><p>Formatea la fecha para su uso en una consulta SOQL.</p></li><li class="list-item" id="632001157#-fip8ah_54"><p>Construye una consulta para seleccionar registros de <span class="inline-code" id="632001157#-fip8ah_56">EventLog_Subset__c</span> creados antes o en la fecha calculada.</p></li><li class="list-item" id="632001157#-fip8ah_55"><p>Ejecuta un trabajo por lotes (<span class="inline-code" id="632001157#-fip8ah_57">EventLog_Subset_CleanupBatchClass</span>) con la consulta construida y un tama&ntilde;o de lote de 150 registros.</p></li></ul></li></ol></section><section><h4 id="632001157#c-digo" data-toc="c-digo#EventLog_Subset_CleanupScheduleClass.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="632001157#-fip8ah_58"><pre><code class="language-none">public void execute(SchedulableContext sc) {
  Suratech_Foundation_Schedule_Event__mdt config = Suratech_Foundation_Schedule_Event__mdt.getInstance(
    'schedule'
  );

  if (Test.isRunningTest()) {
    config = new Suratech_Foundation_Schedule_Event__mdt(
      MasterLabel = 'DefaultConfig',
      DeveloperName = 'DefaultConfig',
      Frequency__c = '',
      Is_Active__c = true,
      Schedule_Job_Id__c = ''
    );
  }

  if (config == null) {
    throw new MetadataNotFoundException(
      'No Suratech_Foundation_Schedule_Event__mdt Custom Metadata found'
    );
  }

  if (config.Is_Active__c) {
    Datetime todaySubstracted = dateTime.now().addDays(-1);
    String formattedDatetime = todaySubstracted.format(
      'yyyy-MM-dd\'T\'HH:mm:ss\'Z\''
    );
    String query =
      'SELECT Id, CreatedDate FROM EventLog_Subset__c WHERE CreatedDate&lt;=' +
      formattedDatetime;

    Id batchId = Database.executeBatch(
      new EventLog_Subset_CleanupBatchClass(query),
      150
    );
  }
}</code></pre></div></section></section></section><section><h2 id="632001157#excepciones" data-toc="excepciones#EventLog_Subset_CleanupScheduleClass.md-excepciones">Excepciones</h2><section><h3 id="632001157#metadatanotfoundexception" data-toc="metadatanotfoundexception#EventLog_Subset_CleanupScheduleClass.md-metadatanotfoundexception">MetadataNotFoundException</h3><p id="632001157#-fip8ah_61">Esta excepci&oacute;n personalizada se lanza cuando no se encuentra la configuraci&oacute;n de metadatos personalizada necesaria para la ejecuci&oacute;n del trabajo programado.</p></section></section><section><h2 id="632001157#dependencias" data-toc="dependencias#EventLog_Subset_CleanupScheduleClass.md-dependencias">Dependencias</h2><ul class="list" id="632001157#-fip8ah_63" start="1"><li class="list-item" id="632001157#-fip8ah_64"><p><span class="inline-code" id="632001157#-fip8ah_69">Schedulable</span>: Interfaz est&aacute;ndar de Salesforce para trabajos programados.</p></li><li class="list-item" id="632001157#-fip8ah_65"><p><span class="inline-code" id="632001157#-fip8ah_70">Suratech_Foundation_Schedule_Event__mdt</span>: Tipo de metadatos personalizado que contiene la configuraci&oacute;n para el trabajo programado.</p></li><li class="list-item" id="632001157#-fip8ah_66"><p><span class="inline-code" id="632001157#-fip8ah_71">EventLog_Subset_CleanupBatchClass</span>: Clase de lotes que realiza la eliminaci&oacute;n efectiva de los registros.</p></li><li class="list-item" id="632001157#-fip8ah_67"><p><span class="inline-code" id="632001157#-fip8ah_72">EventLog_Subset__c</span>: Objeto personalizado cuyos registros antiguos se eliminar&aacute;n.</p></li><li class="list-item" id="632001157#-fip8ah_68"><p><span class="inline-code" id="632001157#-fip8ah_73">MetadataNotFoundException</span>: Excepci&oacute;n personalizada utilizada cuando no se encuentra la configuraci&oacute;n.</p></li></ul></section><section><h2 id="632001157#configuraci-n-de-metadatos-personalizada" data-toc="configuraci-n-de-metadatos-personalizada#EventLog_Subset_CleanupScheduleClass.md-configuraci-n-de-metadatos-personalizada">Configuraci&oacute;n de Metadatos Personalizada</h2><section><h3 id="632001157#suratech-foundation-schedule-event-mdt" data-toc="suratech-foundation-schedule-event-mdt#EventLog_Subset_CleanupScheduleClass.md-suratech-foundation-schedule-event-mdt">Suratech_Foundation_Schedule_Event__mdt</h3><p id="632001157#-fip8ah_76">La clase depende de un registro de metadatos personalizado con el nombre desarrollador 'schedule' que tiene los siguientes campos:</p><ul class="list" id="632001157#-fip8ah_77" start="1"><li class="list-item" id="632001157#-fip8ah_79"><p><span class="inline-code" id="632001157#-fip8ah_84">MasterLabel</span>: Etiqueta principal del registro.</p></li><li class="list-item" id="632001157#-fip8ah_80"><p><span class="inline-code" id="632001157#-fip8ah_85">DeveloperName</span>: Nombre de desarrollador &uacute;nico.</p></li><li class="list-item" id="632001157#-fip8ah_81"><p><span class="inline-code" id="632001157#-fip8ah_86">Frequency__c</span>: Frecuencia de ejecuci&oacute;n (no utilizado directamente en el c&oacute;digo).</p></li><li class="list-item" id="632001157#-fip8ah_82"><p><span class="inline-code" id="632001157#-fip8ah_87">Is_Active__c</span>: Indicador booleano que determina si la programaci&oacute;n est&aacute; activa.</p></li><li class="list-item" id="632001157#-fip8ah_83"><p><span class="inline-code" id="632001157#-fip8ah_88">Schedule_Job_Id__c</span>: ID del trabajo programado (no utilizado directamente en el c&oacute;digo).</p></li></ul></section></section><section><h2 id="632001157#comportamiento-en-contexto-de-prueba" data-toc="comportamiento-en-contexto-de-prueba#EventLog_Subset_CleanupScheduleClass.md-comportamiento-en-contexto-de-prueba">Comportamiento en Contexto de Prueba</h2><p id="632001157#-fip8ah_89">En un contexto de prueba (<span class="inline-code" id="632001157#-fip8ah_90">Test.isRunningTest()</span>), la clase crea una configuraci&oacute;n por defecto con valores predefinidos para evitar depender de la existencia de registros de metadatos personalizados durante las pruebas.</p></section><section><h2 id="632001157#ejemplo-de-uso" data-toc="ejemplo-de-uso#EventLog_Subset_CleanupScheduleClass.md-ejemplo-de-uso">Ejemplo de Uso</h2><section><h3 id="632001157#programaci-n-manual" data-toc="programaci-n-manual#EventLog_Subset_CleanupScheduleClass.md-programaci-n-manual">Programaci&oacute;n Manual</h3><div class="detached code-block" id="632001157#-fip8ah_93"><pre><code class="language-none">// Programar la ejecución diaria a la 1:00 AM
String jobId = System.schedule(
    'EventLog Subset Cleanup - Daily',
    '0 0 1 * * ?',
    new EventLog_Subset_CleanupScheduleClass()
);</code></pre></div></section><section><h3 id="632001157#programaci-n-din-mica" data-toc="programaci-n-din-mica#EventLog_Subset_CleanupScheduleClass.md-programaci-n-din-mica">Programaci&oacute;n Din&aacute;mica</h3><div class="detached code-block" id="632001157#-fip8ah_94"><pre><code class="language-none">// Obtener la configuración actual
Suratech_Foundation_Schedule_Event__mdt config = Suratech_Foundation_Schedule_Event__mdt.getInstance('schedule');

// Verificar si existe y está activa
if (config != null &amp;&amp; config.Is_Active__c) {
    // Utilizar la frecuencia configurada, o usar un valor predeterminado
    String cronExpression = !String.isBlank(config.Frequency__c) ? 
                            config.Frequency__c : '0 0 1 * * ?'; // 1 AM diariamente por defecto
    
    // Abortar cualquier trabajo existente
    if (!String.isBlank(config.Schedule_Job_Id__c)) {
        try {
            System.abortJob(config.Schedule_Job_Id__c);
        } catch (Exception e) {
            // Manejar el caso donde el trabajo ya no existe
        }
    }
    
    // Programar el nuevo trabajo
    String jobId = System.schedule(
        'EventLog Subset Cleanup - ' + System.now(),
        cronExpression,
        new EventLog_Subset_CleanupScheduleClass()
    );
    
    // Actualizar el ID del trabajo en la configuración
    // (Requiere una implementación personalizada para actualizar metadatos)
    updateScheduleJobId(jobId);
}</code></pre></div></section></section><section><h2 id="632001157#clase-de-lotes-relacionada-referencia" data-toc="clase-de-lotes-relacionada-referencia#EventLog_Subset_CleanupScheduleClass.md-clase-de-lotes-relacionada-referencia">Clase de Lotes Relacionada (Referencia)</h2><section><h3 id="632001157#eventlog-subset-cleanupbatchclass" data-toc="eventlog-subset-cleanupbatchclass#EventLog_Subset_CleanupScheduleClass.md-eventlog-subset-cleanupbatchclass">EventLog_Subset_CleanupBatchClass</h3><p id="632001157#-fip8ah_97">Esta clase de lotes es la encargada de ejecutar la eliminaci&oacute;n real de los registros seleccionados por la consulta.</p><div class="detached code-block" id="632001157#-fip8ah_98"><pre><code class="language-none">public class EventLog_Subset_CleanupBatchClass implements Database.Batchable&lt;sObject&gt; {
    private String query;
    
    public EventLog_Subset_CleanupBatchClass(String query) {
        this.query = query;
    }
    
    public Database.QueryLocator start(Database.BatchableContext bc) {
        return Database.getQueryLocator(query);
    }
    
    public void execute(Database.BatchableContext bc, List&lt;EventLog_Subset__c&gt; scope) {
        if (!scope.isEmpty()) {
            delete scope;
        }
    }
    
    public void finish(Database.BatchableContext bc) {
        // Acciones posteriores a la eliminación, si son necesarias
    }
}</code></pre></div></section></section><section><h2 id="632001157#nota-no-incluida-en-este-c-digo-pero-referenciada" data-toc="nota-no-incluida-en-este-c-digo-pero-referenciada#EventLog_Subset_CleanupScheduleClass.md-nota-no-incluida-en-este-c-digo-pero-referenciada">Nota: No incluida en este c&oacute;digo, pero referenciada</h2></section><section><h2 id="632001157#impacto-y-consideraciones" data-toc="impacto-y-consideraciones#EventLog_Subset_CleanupScheduleClass.md-impacto-y-consideraciones">Impacto y Consideraciones</h2><section><h3 id="632001157#rendimiento-y-gobernadores" data-toc="rendimiento-y-gobernadores#EventLog_Subset_CleanupScheduleClass.md-rendimiento-y-gobernadores">Rendimiento y Gobernadores</h3><ul class="list" id="632001157#-fip8ah_103" start="1"><li class="list-item" id="632001157#-fip8ah_104"><p>El tama&ntilde;o del lote est&aacute; establecido en 150 registros, lo que permite un equilibrio entre velocidad de procesamiento y riesgo de alcanzar l&iacute;mites de gobernadores.</p></li><li class="list-item" id="632001157#-fip8ah_105"><p>La eliminaci&oacute;n de registros se realiza en lotes para evitar alcanzar el l&iacute;mite de registros DML en una sola transacci&oacute;n.</p></li></ul></section><section><h3 id="632001157#mantenimiento-de-datos" data-toc="mantenimiento-de-datos#EventLog_Subset_CleanupScheduleClass.md-mantenimiento-de-datos">Mantenimiento de Datos</h3><ul class="list" id="632001157#-fip8ah_106" start="1"><li class="list-item" id="632001157#-fip8ah_107"><p>La clase elimina registros que tienen m&aacute;s de un d&iacute;a de antig&uuml;edad, lo que ayuda a controlar el tama&ntilde;o de la base de datos.</p></li><li class="list-item" id="632001157#-fip8ah_108"><p>Es importante asegurarse de que los registros de <span class="inline-code" id="632001157#-fip8ah_109">EventLog_Subset__c</span> que deben conservarse por m&aacute;s tiempo est&eacute;n adecuadamente protegidos o archivados antes de que se ejecute esta limpieza.</p></li></ul></section><section><h3 id="632001157#programaci-n" data-toc="programaci-n#EventLog_Subset_CleanupScheduleClass.md-programaci-n">Programaci&oacute;n</h3><ul class="list" id="632001157#-fip8ah_110" start="1"><li class="list-item" id="632001157#-fip8ah_111"><p>La frecuencia real de ejecuci&oacute;n depende de c&oacute;mo se programe la clase a trav&eacute;s del sistema de trabajos programados de Salesforce.</p></li><li class="list-item" id="632001157#-fip8ah_112"><p>Se recomienda programarla para ejecutarse durante horas de baja actividad para minimizar el impacto en el rendimiento del sistema.</p></li></ul></section></section><section><h2 id="632001157#notas-adicionales" data-toc="notas-adicionales#EventLog_Subset_CleanupScheduleClass.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="632001157#-fip8ah_113" type="1" start="1"><li class="list-item" id="632001157#-fip8ah_114"><p>La clase utiliza un enfoque configurable a trav&eacute;s de metadatos personalizados, lo que permite activar o desactivar la limpieza sin necesidad de modificar el c&oacute;digo.</p></li><li class="list-item" id="632001157#-fip8ah_115"><p>La construcci&oacute;n de la consulta SOQL concatena directamente la fecha formateada, lo que es seguro en este contexto ya que la fecha se genera internamente y no proviene de entrada de usuario.</p></li><li class="list-item" id="632001157#-fip8ah_116"><p>La clase no maneja directamente errores durante la ejecuci&oacute;n del lote, confiando en el comportamiento predeterminado de los lotes de Salesforce.</p></li><li class="list-item" id="632001157#-fip8ah_117"><p>La configuraci&oacute;n en metadatos personalizados permite una f&aacute;cil adaptaci&oacute;n a diferentes entornos (desarrollo, prueba, producci&oacute;n), ya que cada entorno puede tener su propia configuraci&oacute;n.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1004768122">EventLog_Subset_CleanupBatchClass</h1><section><h2 id="1004768122#descripci-n-general" data-toc="descripci-n-general#EventLog_Subset_CleanupBatchClass.md-descripci-n-general">Descripci&oacute;n General</h2><p id="1004768122#dxjmx0_20"><span class="inline-code" id="1004768122#dxjmx0_21">EventLog_Subset_CleanupBatchClass</span> es una clase que implementa la interfaz <span class="inline-code" id="1004768122#dxjmx0_22">Database.Batchable&lt;sObject&gt;</span> de Salesforce. Esta clase est&aacute; dise&ntilde;ada para ejecutar operaciones de eliminaci&oacute;n en lotes sobre registros del objeto <span class="inline-code" id="1004768122#dxjmx0_23">EventLog_Subset__c</span> (inferido por el nombre de la clase), permitiendo procesar grandes vol&uacute;menes de datos de manera eficiente y dentro de los l&iacute;mites de gobernabilidad de la plataforma.</p></section><section><h2 id="1004768122#autor" data-toc="autor#EventLog_Subset_CleanupBatchClass.md-autor">Autor</h2><p id="1004768122#dxjmx0_24">No especificado (aparece como &quot;ChangeMeIn@UserSettingsUnder.SFDoc&quot;)</p></section><section><h2 id="1004768122#ltima-modificaci-n" data-toc="ltima-modificaci-n#EventLog_Subset_CleanupBatchClass.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="1004768122#dxjmx0_25">25 de febrero de 2025</p></section><section><h2 id="1004768122#estructura-de-la-clase" data-toc="estructura-de-la-clase#EventLog_Subset_CleanupBatchClass.md-estructura-de-la-clase">Estructura de la Clase</h2><div class="detached code-block" id="1004768122#dxjmx0_26"><pre><code class="language-none">public class EventLog_Subset_CleanupBatchClass implements Database.Batchable&lt;sObject&gt; {
  private String query;

  public EventLog_Subset_CleanupBatchClass(String query) {
    this.query = query;
  }

  public Database.QueryLocator start(Database.BatchableContext bc) {
    return Database.getQueryLocator(this.query);
  }

  public void execute(Database.BatchableContext bc, List&lt;sObject&gt; scope) {
    delete scope;
  }

  public void finish(Database.BatchableContext bc) {
    System.debug('Finish Method');
  }
}</code></pre></div></section><section><h2 id="1004768122#interfaz-implementada" data-toc="interfaz-implementada#EventLog_Subset_CleanupBatchClass.md-interfaz-implementada">Interfaz Implementada</h2><section><h3 id="1004768122#database-batchable-sobject" data-toc="database-batchable-sobject#EventLog_Subset_CleanupBatchClass.md-database-batchable-sobject">Database.Batchable&lt;sObject&gt;</h3><p id="1004768122#dxjmx0_29">La clase implementa la interfaz <span class="inline-code" id="1004768122#dxjmx0_32">Database.Batchable&lt;sObject&gt;</span> de Salesforce, que define tres m&eacute;todos que deben ser implementados:</p><ul class="list" id="1004768122#dxjmx0_30" start="1"><li class="list-item" id="1004768122#dxjmx0_33"><p><span class="inline-code" id="1004768122#dxjmx0_36">start</span>: M&eacute;todo que inicia el proceso por lotes y define el conjunto de registros a procesar.</p></li><li class="list-item" id="1004768122#dxjmx0_34"><p><span class="inline-code" id="1004768122#dxjmx0_37">execute</span>: M&eacute;todo que se ejecuta para cada lote de registros.</p></li><li class="list-item" id="1004768122#dxjmx0_35"><p><span class="inline-code" id="1004768122#dxjmx0_38">finish</span>: M&eacute;todo que se ejecuta despu&eacute;s de que todos los lotes han sido procesados.</p></li></ul></section></section><section><h2 id="1004768122#propiedades" data-toc="propiedades#EventLog_Subset_CleanupBatchClass.md-propiedades">Propiedades</h2><section><h3 id="1004768122#query" data-toc="query#EventLog_Subset_CleanupBatchClass.md-query">query</h3><ul class="list" id="1004768122#dxjmx0_41" start="1"><li class="list-item" id="1004768122#dxjmx0_43"><p><span class="control" id="1004768122#dxjmx0_46">Tipo</span>: <span class="inline-code" id="1004768122#dxjmx0_47">String</span></p></li><li class="list-item" id="1004768122#dxjmx0_44"><p><span class="control" id="1004768122#dxjmx0_48">Descripci&oacute;n</span>: Almacena la consulta SOQL que determina qu&eacute; registros ser&aacute;n procesados por el trabajo por lotes.</p></li><li class="list-item" id="1004768122#dxjmx0_45"><p><span class="control" id="1004768122#dxjmx0_49">Visibilidad</span>: Privada</p></li></ul></section></section><section><h2 id="1004768122#constructor" data-toc="constructor#EventLog_Subset_CleanupBatchClass.md-constructor">Constructor</h2><section><h3 id="1004768122#eventlog-subset-cleanupbatchclass-string-query" data-toc="eventlog-subset-cleanupbatchclass-string-query#EventLog_Subset_CleanupBatchClass.md-eventlog-subset-cleanupbatchclass-string-query">EventLog_Subset_CleanupBatchClass(String query)</h3><section><h4 id="1004768122#descripci-n" data-toc="descripci-n#EventLog_Subset_CleanupBatchClass.md-descripci-n">Descripci&oacute;n</h4><p id="1004768122#dxjmx0_56">Constructor que inicializa la clase con la consulta SOQL que determinar&aacute; qu&eacute; registros ser&aacute;n procesados.</p></section><section><h4 id="1004768122#par-metros" data-toc="par-metros#EventLog_Subset_CleanupBatchClass.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1004768122#dxjmx0_57" start="1"><li class="list-item" id="1004768122#dxjmx0_58"><p><span class="inline-code" id="1004768122#dxjmx0_59">query</span> (String): Consulta SOQL que especifica los registros a procesar.</p></li></ul></section><section><h4 id="1004768122#c-digo" data-toc="c-digo#EventLog_Subset_CleanupBatchClass.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1004768122#dxjmx0_60"><pre><code class="language-none">public EventLog_Subset_CleanupBatchClass(String query) {
  this.query = query;
}</code></pre></div></section></section></section><section><h2 id="1004768122#m-todos" data-toc="m-todos#EventLog_Subset_CleanupBatchClass.md-m-todos">M&eacute;todos</h2><section><h3 id="1004768122#start-database-batchablecontext-bc" data-toc="start-database-batchablecontext-bc#EventLog_Subset_CleanupBatchClass.md-start-database-batchablecontext-bc">start(Database.BatchableContext bc)</h3><section><h4 id="1004768122#descripci-n" data-toc="descripci-n#EventLog_Subset_CleanupBatchClass.md-descripci-n">Descripci&oacute;n</h4><p id="1004768122#dxjmx0_70">M&eacute;todo que se ejecuta al inicio del proceso por lotes. Define el conjunto de registros que ser&aacute;n procesados utilizando un QueryLocator basado en la consulta SOQL proporcionada.</p></section><section><h4 id="1004768122#par-metros" data-toc="par-metros#EventLog_Subset_CleanupBatchClass.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1004768122#dxjmx0_71" start="1"><li class="list-item" id="1004768122#dxjmx0_72"><p><span class="inline-code" id="1004768122#dxjmx0_73">bc</span> (Database.BatchableContext): Contexto del trabajo por lotes, proporcionado por la plataforma Salesforce.</p></li></ul></section><section><h4 id="1004768122#retorno" data-toc="retorno#EventLog_Subset_CleanupBatchClass.md-retorno">Retorno</h4><ul class="list" id="1004768122#dxjmx0_74" start="1"><li class="list-item" id="1004768122#dxjmx0_75"><p><span class="inline-code" id="1004768122#dxjmx0_76">Database.QueryLocator</span>: Un QueryLocator que define el conjunto de registros a procesar.</p></li></ul></section><section><h4 id="1004768122#c-digo" data-toc="c-digo#EventLog_Subset_CleanupBatchClass.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1004768122#dxjmx0_77"><pre><code class="language-none">public Database.QueryLocator start(Database.BatchableContext bc) {
  return Database.getQueryLocator(this.query);
}</code></pre></div></section></section><section><h3 id="1004768122#execute-database-batchablecontext-bc-list-sobject-scope" data-toc="execute-database-batchablecontext-bc-list-sobject-scope#EventLog_Subset_CleanupBatchClass.md-execute-database-batchablecontext-bc-list-sobject-scope">execute(Database.BatchableContext bc, List&lt;sObject&gt; scope)</h3><section><h4 id="1004768122#descripci-n" data-toc="descripci-n#EventLog_Subset_CleanupBatchClass.md-descripci-n">Descripci&oacute;n</h4><p id="1004768122#dxjmx0_85">M&eacute;todo que se ejecuta para cada lote de registros definido por el QueryLocator. Elimina todos los registros en el lote actual.</p></section><section><h4 id="1004768122#par-metros" data-toc="par-metros#EventLog_Subset_CleanupBatchClass.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1004768122#dxjmx0_86" start="1"><li class="list-item" id="1004768122#dxjmx0_87"><p><span class="inline-code" id="1004768122#dxjmx0_89">bc</span> (Database.BatchableContext): Contexto del trabajo por lotes, proporcionado por la plataforma Salesforce.</p></li><li class="list-item" id="1004768122#dxjmx0_88"><p><span class="inline-code" id="1004768122#dxjmx0_90">scope</span> (List</p><p>): Lista de registros a procesar en el lote actual.</p></li></ul></section><section><h4 id="1004768122#retorno" data-toc="retorno#EventLog_Subset_CleanupBatchClass.md-retorno">Retorno</h4><ul class="list" id="1004768122#dxjmx0_92" start="1"><li class="list-item" id="1004768122#dxjmx0_93"><p><span class="inline-code" id="1004768122#dxjmx0_94">void</span>: Este m&eacute;todo no devuelve ning&uacute;n valor.</p></li></ul></section><section><h4 id="1004768122#proceso" data-toc="proceso#EventLog_Subset_CleanupBatchClass.md-proceso">Proceso</h4><ol class="list list-decimal" id="1004768122#dxjmx0_95" type="1" start="1"><li class="list-item" id="1004768122#dxjmx0_96"><p>Elimina todos los registros en el lote actual utilizando la operaci&oacute;n DML <span class="inline-code" id="1004768122#dxjmx0_97">delete</span>.</p></li></ol></section><section><h4 id="1004768122#c-digo" data-toc="c-digo#EventLog_Subset_CleanupBatchClass.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1004768122#dxjmx0_98"><pre><code class="language-none">public void execute(Database.BatchableContext bc, List&lt;sObject&gt; scope) {
  delete scope;
}</code></pre></div></section></section><section><h3 id="1004768122#finish-database-batchablecontext-bc" data-toc="finish-database-batchablecontext-bc#EventLog_Subset_CleanupBatchClass.md-finish-database-batchablecontext-bc">finish(Database.BatchableContext bc)</h3><section><h4 id="1004768122#descripci-n" data-toc="descripci-n#EventLog_Subset_CleanupBatchClass.md-descripci-n">Descripci&oacute;n</h4><p id="1004768122#dxjmx0_106">M&eacute;todo que se ejecuta despu&eacute;s de que todos los lotes han sido procesados. Actualmente solo registra un mensaje de depuraci&oacute;n.</p></section><section><h4 id="1004768122#par-metros" data-toc="par-metros#EventLog_Subset_CleanupBatchClass.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1004768122#dxjmx0_107" start="1"><li class="list-item" id="1004768122#dxjmx0_108"><p><span class="inline-code" id="1004768122#dxjmx0_109">bc</span> (Database.BatchableContext): Contexto del trabajo por lotes, proporcionado por la plataforma Salesforce.</p></li></ul></section><section><h4 id="1004768122#retorno" data-toc="retorno#EventLog_Subset_CleanupBatchClass.md-retorno">Retorno</h4><ul class="list" id="1004768122#dxjmx0_110" start="1"><li class="list-item" id="1004768122#dxjmx0_111"><p><span class="inline-code" id="1004768122#dxjmx0_112">void</span>: Este m&eacute;todo no devuelve ning&uacute;n valor.</p></li></ul></section><section><h4 id="1004768122#proceso" data-toc="proceso#EventLog_Subset_CleanupBatchClass.md-proceso">Proceso</h4><ol class="list list-decimal" id="1004768122#dxjmx0_113" type="1" start="1"><li class="list-item" id="1004768122#dxjmx0_114"><p>Registra un mensaje de depuraci&oacute;n indicando que el m&eacute;todo de finalizaci&oacute;n ha sido ejecutado.</p></li></ol></section><section><h4 id="1004768122#c-digo" data-toc="c-digo#EventLog_Subset_CleanupBatchClass.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1004768122#dxjmx0_115"><pre><code class="language-none">public void finish(Database.BatchableContext bc) {
  System.debug('Finish Method');
}</code></pre></div></section></section></section><section><h2 id="1004768122#relaci-n-con-eventlog-subset-cleanupscheduleclass" data-toc="relaci-n-con-eventlog-subset-cleanupscheduleclass#EventLog_Subset_CleanupBatchClass.md-relaci-n-con-eventlog-subset-cleanupscheduleclass">Relaci&oacute;n con EventLog_Subset_CleanupScheduleClass</h2><p id="1004768122#dxjmx0_116">Esta clase est&aacute; dise&ntilde;ada para ser utilizada en conjunto con <span class="inline-code" id="1004768122#dxjmx0_118">EventLog_Subset_CleanupScheduleClass</span>, que es una clase programable que configura y ejecuta este trabajo por lotes. La clase programable:</p><ol class="list list-decimal" id="1004768122#dxjmx0_117" type="1" start="1"><li class="list-item" id="1004768122#dxjmx0_119"><p>Verifica si la limpieza debe ejecutarse bas&aacute;ndose en la configuraci&oacute;n de metadatos personalizados.</p></li><li class="list-item" id="1004768122#dxjmx0_120"><p>Construye una consulta SOQL para seleccionar registros <span class="inline-code" id="1004768122#dxjmx0_122">EventLog_Subset__c</span> que sean m&aacute;s antiguos que un d&iacute;a.</p></li><li class="list-item" id="1004768122#dxjmx0_121"><p>Inicia este trabajo por lotes pas&aacute;ndole la consulta y un tama&ntilde;o de lote de 150 registros.</p></li></ol></section><section><h2 id="1004768122#flujo-de-trabajo" data-toc="flujo-de-trabajo#EventLog_Subset_CleanupBatchClass.md-flujo-de-trabajo">Flujo de Trabajo</h2><ol class="list list-decimal" id="1004768122#dxjmx0_123" type="1" start="1"><li class="list-item" id="1004768122#dxjmx0_124"><p>Una clase programable o alg&uacute;n otro proceso construye una consulta SOQL para seleccionar los registros de <span class="inline-code" id="1004768122#dxjmx0_130">EventLog_Subset__c</span> que deben ser eliminados.</p></li><li class="list-item" id="1004768122#dxjmx0_125"><p>Se crea una instancia de <span class="inline-code" id="1004768122#dxjmx0_131">EventLog_Subset_CleanupBatchClass</span> pas&aacute;ndole la consulta.</p></li><li class="list-item" id="1004768122#dxjmx0_126"><p>Se ejecuta el trabajo por lotes utilizando <span class="inline-code" id="1004768122#dxjmx0_132">Database.executeBatch()</span>, especificando opcionalmente un tama&ntilde;o de lote.</p></li><li class="list-item" id="1004768122#dxjmx0_127"><p>El m&eacute;todo <span class="inline-code" id="1004768122#dxjmx0_133">start</span> se ejecuta, definiendo el conjunto completo de registros a procesar.</p></li><li class="list-item" id="1004768122#dxjmx0_128"><p>El m&eacute;todo <span class="inline-code" id="1004768122#dxjmx0_134">execute</span> se ejecuta para cada lote de registros, elimin&aacute;ndolos.</p></li><li class="list-item" id="1004768122#dxjmx0_129"><p>Despu&eacute;s de que todos los lotes han sido procesados, se ejecuta el m&eacute;todo <span class="inline-code" id="1004768122#dxjmx0_135">finish</span>, que actualmente solo registra un mensaje de depuraci&oacute;n.</p></li></ol></section><section><h2 id="1004768122#mejores-pr-cticas-implementadas" data-toc="mejores-pr-cticas-implementadas#EventLog_Subset_CleanupBatchClass.md-mejores-pr-cticas-implementadas">Mejores Pr&aacute;cticas Implementadas</h2><ol class="list list-decimal" id="1004768122#dxjmx0_136" type="1" start="1"><li class="list-item" id="1004768122#dxjmx0_137"><p><span class="control" id="1004768122#dxjmx0_140">Procesamiento por Lotes</span>: La clase utiliza el framework de procesamiento por lotes de Salesforce para manejar grandes vol&uacute;menes de datos de manera eficiente.</p></li><li class="list-item" id="1004768122#dxjmx0_138"><p><span class="control" id="1004768122#dxjmx0_141">Configurabilidad</span>: La consulta SOQL que determina qu&eacute; registros se procesan se proporciona externamente, lo que permite flexibilidad en la selecci&oacute;n de registros.</p></li><li class="list-item" id="1004768122#dxjmx0_139"><p><span class="control" id="1004768122#dxjmx0_142">Simplicidad</span>: El c&oacute;digo es conciso y se enfoca en una &uacute;nica responsabilidad: eliminar los registros especificados.</p></li></ol></section><section><h2 id="1004768122#mejoras-posibles" data-toc="mejoras-posibles#EventLog_Subset_CleanupBatchClass.md-mejoras-posibles">Mejoras Posibles</h2><ol class="list list-decimal" id="1004768122#dxjmx0_143" type="1" start="1"><li class="list-item" id="1004768122#dxjmx0_144"><p><span class="control" id="1004768122#dxjmx0_148">Manejo de Errores</span>: La implementaci&oacute;n actual no incluye manejo de errores durante la eliminaci&oacute;n. Podr&iacute;a mejorar incluyendo bloques try-catch para manejar y registrar posibles errores.</p></li><li class="list-item" id="1004768122#dxjmx0_145"><p><span class="control" id="1004768122#dxjmx0_149">Registro de Actividad</span>: Podr&iacute;a a&ntilde;adir m&aacute;s registro de actividad para facilitar el seguimiento y la depuraci&oacute;n.</p></li><li class="list-item" id="1004768122#dxjmx0_146"><p><span class="control" id="1004768122#dxjmx0_150">Notificaciones</span>: Podr&iacute;a implementar notificaciones para informar sobre el resultado del proceso de limpieza.</p></li><li class="list-item" id="1004768122#dxjmx0_147"><p><span class="control" id="1004768122#dxjmx0_151">Informaci&oacute;n de Resumen</span>: El m&eacute;todo <span class="inline-code" id="1004768122#dxjmx0_152">finish</span> podr&iacute;a proporcionar informaci&oacute;n resumida sobre cu&aacute;ntos registros se procesaron y eliminaron.</p></li></ol></section><section><h2 id="1004768122#implementaci-n-mejorada-propuesta" data-toc="implementaci-n-mejorada-propuesta#EventLog_Subset_CleanupBatchClass.md-implementaci-n-mejorada-propuesta">Implementaci&oacute;n Mejorada Propuesta</h2><div class="detached code-block" id="1004768122#dxjmx0_153"><pre><code class="language-none">/**
 * @description       : Clase por lotes para eliminar registros antiguos de EventLog_Subset__c
 * @author            : [Nombre del Autor]
 * @group             : Mantenimiento
 * @last modified on  : 02-25-2025
 * @last modified by  : [Nombre del Modificador]
 **/
public class EventLog_Subset_CleanupBatchClass implements Database.Batchable&lt;sObject&gt;, Database.Stateful {
  private String query;
  private Integer totalRecordsProcessed = 0;
  private Integer totalRecordsDeleted = 0;
  private List&lt;String&gt; errors = new List&lt;String&gt;();
  
  /**
   * @description Constructor que inicializa la clase con la consulta SOQL para seleccionar los registros a eliminar
   * @param query Consulta SOQL que define los registros a procesar
   */
  public EventLog_Subset_CleanupBatchClass(String query) {
    this.query = query;
    System.debug(LoggingLevel.INFO, 'Iniciando trabajo de limpieza con consulta: ' + query);
  }
  
  /**
   * @description Define el conjunto de registros que serán procesados
   * @param bc Contexto del trabajo por lotes
   * @return QueryLocator que define el conjunto de registros a procesar
   */
  public Database.QueryLocator start(Database.BatchableContext bc) {
    try {
      return Database.getQueryLocator(this.query);
    } catch (Exception e) {
      System.debug(LoggingLevel.ERROR, 'Error en método start: ' + e.getMessage());
      errors.add('Error en método start: ' + e.getMessage());
      // Retornar un QueryLocator vacío en caso de error
      return Database.getQueryLocator('SELECT Id FROM EventLog_Subset__c WHERE Id = null');
    }
  }
  
  /**
   * @description Procesa cada lote de registros, eliminándolos
   * @param bc Contexto del trabajo por lotes
   * @param scope Lista de registros a procesar en el lote actual
   */
  public void execute(Database.BatchableContext bc, List&lt;sObject&gt; scope) {
    if (scope == null || scope.isEmpty()) {
      return;
    }
    
    totalRecordsProcessed += scope.size();
    System.debug(LoggingLevel.INFO, 'Procesando lote de ' + scope.size() + ' registros');
    
    try {
      // Opcionalmente, registrar algunos detalles de los registros antes de eliminarlos
      if (System.isBatch()) {
        for (SObject record : scope) {
          System.debug(LoggingLevel.FINE, 'Eliminando registro: ' + record.Id);
        }
      }
      
      // Eliminar los registros
      Database.DeleteResult[] results = Database.delete(scope, false); // Allownos some partial success
      
      // Procesar resultados
      for (Database.DeleteResult result : results) {
        if (result.isSuccess()) {
          totalRecordsDeleted++;
        } else {
          for (Database.Error error : result.getErrors()) {
            String errorMsg = 'Error al eliminar registro: ' + error.getStatusCode() + ' - ' + error.getMessage();
            System.debug(LoggingLevel.ERROR, errorMsg);
            errors.add(errorMsg);
          }
        }
      }
    } catch (Exception e) {
      String errorMsg = 'Error en ejecución de lote: ' + e.getMessage() + ' ' + e.getStackTraceString();
      System.debug(LoggingLevel.ERROR, errorMsg);
      errors.add(errorMsg);
    }
  }
  
  /**
   * @description Se ejecuta después de que todos los lotes han sido procesados
   * @param bc Contexto del trabajo por lotes
   */
  public void finish(Database.BatchableContext bc) {
    // Generar mensaje de resumen
    String summary = 'Proceso de limpieza de EventLog_Subset__c completado. ' +
                    'Registros procesados: ' + totalRecordsProcessed + '. ' +
                    'Registros eliminados: ' + totalRecordsDeleted + '. ' +
                    'Errores: ' + errors.size();
    
    System.debug(LoggingLevel.INFO, summary);
    
    // Registrar errores si los hay
    if (!errors.isEmpty()) {
      System.debug(LoggingLevel.ERROR, 'Errores encontrados durante el proceso:');
      for (String error : errors) {
        System.debug(LoggingLevel.ERROR, error);
      }
    }
    
    // Aquí se podría añadir código para enviar notificaciones, crear registros de auditoría, etc.
    try {
      sendCompletionNotification(summary, errors);
    } catch (Exception e) {
      System.debug(LoggingLevel.ERROR, 'Error al enviar notificación: ' + e.getMessage());
    }
  }
  
  /**
   * @description Envía una notificación con el resumen de la ejecución del trabajo
   * @param summary Resumen de la ejecución
   * @param errors Lista de errores encontrados
   */
  private void sendCompletionNotification(String summary, List&lt;String&gt; errors) {
    // Implementación del envío de notificación
    // Esto podría incluir envío de email, creación de registro de log, etc.
    
    // Ejemplo: Crear un registro de log
    /*
    Event_Log__c log = new Event_Log__c(
      Type__c = 'Batch Execution',
      Level__c = errors.isEmpty() ? 'Info' : 'Error',
      Message__c = summary,
      Details__c = String.join(errors, '\n').left(32000) // Límite de caracteres para campo de texto largo
    );
    
    insert log;
    */
  }
}</code></pre></div></section><section><h2 id="1004768122#ejemplos-de-uso" data-toc="ejemplos-de-uso#EventLog_Subset_CleanupBatchClass.md-ejemplos-de-uso">Ejemplos de Uso</h2><section><h3 id="1004768122#uso-b-sico-directamente" data-toc="uso-b-sico-directamente#EventLog_Subset_CleanupBatchClass.md-uso-b-sico-directamente">Uso B&aacute;sico Directamente</h3><div class="detached code-block" id="1004768122#dxjmx0_157"><pre><code class="language-none">// Construir la consulta para seleccionar registros de más de un día de antigüedad
Datetime cutoffDate = Datetime.now().addDays(-1);
String formattedCutoffDate = cutoffDate.format('yyyy-MM-dd\'T\'HH:mm:ss\'Z\'');
String query = 'SELECT Id, CreatedDate FROM EventLog_Subset__c WHERE CreatedDate &lt;= ' + formattedCutoffDate;

// Ejecutar el trabajo por lotes con un tamaño de lote de 150
Id batchId = Database.executeBatch(new EventLog_Subset_CleanupBatchClass(query), 150);

System.debug('Trabajo por lotes iniciado con ID: ' + batchId);</code></pre></div></section><section><h3 id="1004768122#uso-desde-una-clase-programable" data-toc="uso-desde-una-clase-programable#EventLog_Subset_CleanupBatchClass.md-uso-desde-una-clase-programable">Uso desde una Clase Programable</h3><div class="detached code-block" id="1004768122#dxjmx0_158"><pre><code class="language-none">public class EventLog_Subset_CleanupScheduleClass implements Schedulable {
  public void execute(SchedulableContext sc) {
    // Verificar configuración (ejemplo simplificado)
    Boolean shouldRun = true;
    
    if (shouldRun) {
      // Construir consulta para registros de más de un día
      Datetime cutoffDate = Datetime.now().addDays(-1);
      String formattedCutoffDate = cutoffDate.format('yyyy-MM-dd\'T\'HH:mm:ss\'Z\'');
      String query = 'SELECT Id, CreatedDate FROM EventLog_Subset__c WHERE CreatedDate &lt;= ' + formattedCutoffDate;
      
      // Ejecutar el trabajo por lotes
      Id batchId = Database.executeBatch(new EventLog_Subset_CleanupBatchClass(query), 150);
      
      System.debug('Trabajo de limpieza programado iniciado con ID: ' + batchId);
    }
  }
}</code></pre></div></section><section><h3 id="1004768122#programaci-n-del-trabajo" data-toc="programaci-n-del-trabajo#EventLog_Subset_CleanupBatchClass.md-programaci-n-del-trabajo">Programaci&oacute;n del Trabajo</h3><div class="detached code-block" id="1004768122#dxjmx0_159"><pre><code class="language-none">// Programar el trabajo para ejecutarse todos los días a la 1 AM
String jobId = System.schedule(
    'EventLog Subset Cleanup - Daily',
    '0 0 1 * * ?',
    new EventLog_Subset_CleanupScheduleClass()
);

System.debug('Trabajo programado con ID: ' + jobId);</code></pre></div></section></section><section><h2 id="1004768122#consideraciones-de-rendimiento" data-toc="consideraciones-de-rendimiento#EventLog_Subset_CleanupBatchClass.md-consideraciones-de-rendimiento">Consideraciones de Rendimiento</h2><ol class="list list-decimal" id="1004768122#dxjmx0_160" type="1" start="1"><li class="list-item" id="1004768122#dxjmx0_161"><p><span class="control" id="1004768122#dxjmx0_165">Tama&ntilde;o del Lote</span>: La clase est&aacute; dise&ntilde;ada para ser ejecutada con un tama&ntilde;o de lote espec&iacute;fico (150 registros seg&uacute;n se infiere de la clase programable relacionada). Este valor puede ajustarse seg&uacute;n las necesidades espec&iacute;ficas y las caracter&iacute;sticas de los registros.</p></li><li class="list-item" id="1004768122#dxjmx0_162"><p><span class="control" id="1004768122#dxjmx0_166">Consulta Eficiente</span>: La eficiencia de la consulta SOQL proporcionada afectar&aacute; el rendimiento del trabajo. Es importante asegurarse de que la consulta est&eacute; optimizada y utilice &iacute;ndices cuando sea posible.</p></li><li class="list-item" id="1004768122#dxjmx0_163"><p><span class="control" id="1004768122#dxjmx0_167">Operaciones DML</span>: La clase realiza operaciones de eliminaci&oacute;n directamente, lo que consume l&iacute;mites de DML. Aseg&uacute;rese de que el tama&ntilde;o de lote sea apropiado para no exceder estos l&iacute;mites.</p></li><li class="list-item" id="1004768122#dxjmx0_164"><p><span class="control" id="1004768122#dxjmx0_168">Datos en Cascada</span>: Si los registros que se eliminan tienen relaciones y est&aacute;n configurados para eliminaci&oacute;n en cascada, esto podr&iacute;a aumentar el consumo de recursos y afectar el rendimiento.</p></li></ol></section><section><h2 id="1004768122#pruebas-unitarias" data-toc="pruebas-unitarias#EventLog_Subset_CleanupBatchClass.md-pruebas-unitarias">Pruebas Unitarias</h2><p id="1004768122#dxjmx0_169">A continuaci&oacute;n se presenta un ejemplo de c&oacute;mo podr&iacute;an ser las pruebas unitarias para esta clase:</p><div class="detached code-block" id="1004768122#dxjmx0_170"><pre><code class="language-none">@IsTest
private class EventLog_Subset_CleanupBatchClassTest {
    
    @TestSetup
    static void setupTestData() {
        // Crear registros de prueba
        List&lt;EventLog_Subset__c&gt; testLogs = new List&lt;EventLog_Subset__c&gt;();
        for (Integer i = 0; i &lt; 200; i++) {
            testLogs.add(new EventLog_Subset__c());
        }
        
        insert testLogs;
    }
    
    @IsTest
    static void testBatchExecution() {
        // Verificar que existen registros antes de la prueba
        System.assertEquals(200, [SELECT COUNT() FROM EventLog_Subset__c], 'Deberían existir 200 registros antes de la prueba');
        
        // Construir consulta para seleccionar todos los registros
        String query = 'SELECT Id FROM EventLog_Subset__c';
        
        Test.startTest();
        // Ejecutar el trabajo por lotes
        Id batchId = Database.executeBatch(new EventLog_Subset_CleanupBatchClass(query), 50);
        Test.stopTest();
        
        // Verificar que todos los registros han sido eliminados
        System.assertEquals(0, [SELECT COUNT() FROM EventLog_Subset__c], 'Todos los registros deberían haber sido eliminados');
    }
    
    @IsTest
    static void testBatchWithNoRecords() {
        // Eliminar todos los registros creados en setup
        delete [SELECT Id FROM EventLog_Subset__c];
        
        // Verificar que no hay registros antes de la prueba
        System.assertEquals(0, [SELECT COUNT() FROM EventLog_Subset__c], 'No deberían existir registros antes de la prueba');
        
        // Construir consulta para seleccionar todos los registros (que serán ninguno)
        String query = 'SELECT Id FROM EventLog_Subset__c';
        
        Test.startTest();
        // Ejecutar el trabajo por lotes
        Id batchId = Database.executeBatch(new EventLog_Subset_CleanupBatchClass(query), 50);
        Test.stopTest();
        
        // Verificar que no hay errores (el trabajo debería completarse sin problemas)
        // No hay aserciones específicas aquí ya que solo estamos verificando que no hay excepciones
    }
    
    @IsTest
    static void testBatchWithInvalidQuery() {
        // Construir una consulta inválida
        String invalidQuery = 'SELECT InvalidField FROM EventLog_Subset__c';
        
        Test.startTest();
        
        // Capturar la excepción que debería ocurrir
        try {
            Id batchId = Database.executeBatch(new EventLog_Subset_CleanupBatchClass(invalidQuery), 50);
            System.assert(false, 'Debería haber lanzado una excepción');
        } catch (Exception e) {
            // Verificar que se lanzó la excepción esperada
            System.assert(e.getMessage().contains('InvalidField'), 'La excepción debería estar relacionada con el campo inválido');
        }
        
        Test.stopTest();
    }
}</code></pre></div></section><section><h2 id="1004768122#notas-adicionales" data-toc="notas-adicionales#EventLog_Subset_CleanupBatchClass.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="1004768122#dxjmx0_171" type="1" start="1"><li class="list-item" id="1004768122#dxjmx0_172"><p>La clase est&aacute; dise&ntilde;ada con un prop&oacute;sito espec&iacute;fico: eliminar registros de <span class="inline-code" id="1004768122#dxjmx0_177">EventLog_Subset__c</span> seg&uacute;n una consulta proporcionada.</p></li><li class="list-item" id="1004768122#dxjmx0_173"><p>La implementaci&oacute;n actual es muy simple y directa, sin manejo de errores o registro detallado de actividad.</p></li><li class="list-item" id="1004768122#dxjmx0_174"><p>El nombre de la clase sugiere que es parte de un sistema de mantenimiento para limpiar registros antiguos del objeto <span class="inline-code" id="1004768122#dxjmx0_178">EventLog_Subset__c</span>.</p></li><li class="list-item" id="1004768122#dxjmx0_175"><p>Esta clase trabaja en conjunto con <span class="inline-code" id="1004768122#dxjmx0_179">EventLog_Subset_CleanupScheduleClass</span>, que es la clase programable que la configura y ejecuta.</p></li><li class="list-item" id="1004768122#dxjmx0_176"><p>La simplicidad de la implementaci&oacute;n actual puede ser adecuada si los vol&uacute;menes de datos son peque&ntilde;os y el riesgo de errores es bajo, pero para entornos de producci&oacute;n con grandes vol&uacute;menes de datos, se recomendar&iacute;a una implementaci&oacute;n m&aacute;s robusta como la propuesta en la secci&oacute;n &quot;Implementaci&oacute;n Mejorada&quot;.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-472222476">EventLogManagerProvider</h1><section><h2 id="-472222476#descripci-n-general" data-toc="descripci-n-general#EventLogManagerProvider.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-472222476#-c1rnhy_15"><span class="inline-code" id="-472222476#-c1rnhy_16">EventLogManagerProvider</span> es una clase que proporciona funcionalidad para generar registros de eventos de prueba o datos de muestra en el objeto Big Object <span class="inline-code" id="-472222476#-c1rnhy_17">EventLog__b</span>. Esta clase est&aacute; dise&ntilde;ada para facilitar la carga masiva de datos de eventos simulados con valores aleatorios dentro de un conjunto predefinido de opciones.</p></section><section><h2 id="-472222476#autor" data-toc="autor#EventLogManagerProvider.md-autor">Autor</h2><p id="-472222476#-c1rnhy_18">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="-472222476#ltima-modificaci-n" data-toc="ltima-modificaci-n#EventLogManagerProvider.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="-472222476#-c1rnhy_19">30 de octubre de 2024</p></section><section><h2 id="-472222476#estructura-de-la-clase" data-toc="estructura-de-la-clase#EventLogManagerProvider.md-estructura-de-la-clase">Estructura de la Clase</h2><div class="detached code-block" id="-472222476#-c1rnhy_20"><pre><code class="language-none">public with sharing class EventLogManagerProvider {
  public static void generate() {
    // Implementación del método para generar registros de eventos
  }
}</code></pre></div></section><section><h2 id="-472222476#m-todos" data-toc="m-todos#EventLogManagerProvider.md-m-todos">M&eacute;todos</h2><section><h3 id="-472222476#generate" data-toc="generate#EventLogManagerProvider.md-generate">generate()</h3><section><h4 id="-472222476#descripci-n" data-toc="descripci-n#EventLogManagerProvider.md-descripci-n">Descripci&oacute;n</h4><p id="-472222476#-c1rnhy_29">M&eacute;todo est&aacute;tico que genera y guarda un conjunto de registros de eventos simulados (hasta 5000) en el objeto Big Object <span class="inline-code" id="-472222476#-c1rnhy_30">EventLog__b</span>. Los registros se generan con valores aleatorios para diversos campos, seleccionados de listas predefinidas.</p></section><section><h4 id="-472222476#par-metros" data-toc="par-metros#EventLogManagerProvider.md-par-metros">Par&aacute;metros</h4><p id="-472222476#-c1rnhy_31">Ninguno.</p></section><section><h4 id="-472222476#retorno" data-toc="retorno#EventLogManagerProvider.md-retorno">Retorno</h4><ul class="list" id="-472222476#-c1rnhy_32" start="1"><li class="list-item" id="-472222476#-c1rnhy_33"><p><span class="inline-code" id="-472222476#-c1rnhy_34">void</span>: Este m&eacute;todo no devuelve ning&uacute;n valor.</p></li></ul></section><section><h4 id="-472222476#proceso" data-toc="proceso#EventLogManagerProvider.md-proceso">Proceso</h4><ol class="list list-decimal" id="-472222476#-c1rnhy_35" type="1" start="1"><li class="list-item" id="-472222476#-c1rnhy_36"><p>Inicializa un array para almacenar los resultados de las operaciones de guardado y una lista para acumular los registros de eventos.</p></li><li class="list-item" id="-472222476#-c1rnhy_37"><p>Define listas constantes con valores predefinidos para diferentes campos: </p><ul class="list" id="-472222476#-c1rnhy_40" start="1"><li class="list-item" id="-472222476#-c1rnhy_41"><p><span class="inline-code" id="-472222476#-c1rnhy_46">PRODUCTS</span>: Lista de productos ('Moto', 'Auto', 'Arrendmiento', 'Viaje').</p></li><li class="list-item" id="-472222476#-c1rnhy_42"><p><span class="inline-code" id="-472222476#-c1rnhy_47">LEVELS</span>: Lista de niveles de registro ('Info', 'Warning', 'Error', 'Alert').</p></li><li class="list-item" id="-472222476#-c1rnhy_43"><p><span class="inline-code" id="-472222476#-c1rnhy_48">PLATFORMS</span>: Lista de plataformas ('Salesforce', 'Mulesoft').</p></li><li class="list-item" id="-472222476#-c1rnhy_44"><p><span class="inline-code" id="-472222476#-c1rnhy_49">TYPES</span>: Lista de tipos de evento ('INFO', 'ERROR').</p></li><li class="list-item" id="-472222476#-c1rnhy_45"><p><span class="inline-code" id="-472222476#-c1rnhy_50">PROCESSES</span>: Lista de procesos ('Knowing', 'Rating', 'Quoting', 'Issuing', 'Notifying').</p></li></ul></li><li class="list-item" id="-472222476#-c1rnhy_38"><p>Itera hasta 5000 veces, generando en cada iteraci&oacute;n: </p><ul class="list" id="-472222476#-c1rnhy_51" start="1"><li class="list-item" id="-472222476#-c1rnhy_52"><p>Selecciona valores aleatorios de cada lista para crear un registro de evento &uacute;nico.</p></li><li class="list-item" id="-472222476#-c1rnhy_53"><p>Crea un nuevo registro <span class="inline-code" id="-472222476#-c1rnhy_56">EventLog__b</span> con los valores seleccionados y la fecha actual.</p></li><li class="list-item" id="-472222476#-c1rnhy_54"><p>A&ntilde;ade el registro a la lista de eventos.</p></li><li class="list-item" id="-472222476#-c1rnhy_55"><p>Cuando la lista alcanza 200 registros, los inserta en la base de datos en modo inmediato y limpia la lista.</p></li></ul></li><li class="list-item" id="-472222476#-c1rnhy_39"><p>Despu&eacute;s del bucle, inserta cualquier registro restante (menos de 200) en la base de datos.</p></li></ol></section><section><h4 id="-472222476#c-digo" data-toc="c-digo#EventLogManagerProvider.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-472222476#-c1rnhy_57"><pre><code class="language-none">public static void generate() {
  Database.SaveResult[] results;
  List&lt;EventLog__b&gt; eventLogs = new List&lt;EventLog__b&gt;();

  final List&lt;String&gt; PRODUCTS = new List&lt;String&gt;{
    'Moto',
    'Auto',
    'Arrendmiento',
    'Viaje'
  };
  final List&lt;String&gt; LEVELS = new List&lt;String&gt;{
    'Info',
    'Warning',
    'Error',
    'Alert'
  };
  final List&lt;String&gt; PLATFORMS = new List&lt;String&gt;{ 'Salesforce', 'Mulesoft' };
  final List&lt;String&gt; TYPES = new List&lt;String&gt;{ 'INFO', 'ERROR' };
  final List&lt;String&gt; PROCESSES = new List&lt;String&gt;{
    'Knowing',
    'Rating',
    'Quoting',
    'Issuing',
    'Notifying'
  };

  for (Integer i = 0; i &lt; 5000; i++) {
    String product = PRODUCTS.get(
      (Math.random() * PRODUCTS.size()).intValue()
    );
    String platform = PLATFORMS.get(
      (Math.random() * PLATFORMS.size()).intValue()
    );
    String level = LEVELS.get((Math.random() * LEVELS.size()).intValue());
    String type = TYPES.get((Math.random() * TYPES.size()).intValue());
    String process = PROCESSES.get(
      (Math.random() * PROCESSES.size()).intValue()
    );

    EventLog__b eventLog = new EventLog__b(
      Date__c = System.now(),
      Product__c = product,
      Level__c = level,
      Platform__c = Platform,
      Process__c = process,
      Type__c = type
    );
    eventLogs.add(eventLog);

    // Insert records in batches
    if (eventLogs.size() == 200) {
      Database.insertImmediate(eventLogs);
      eventLogs.clear();
    }
  }

  // Insert any remaining records
  if (!eventLogs.isEmpty()) {
    results = Database.insertImmediate(eventLogs);
  }
}</code></pre></div></section></section></section><section><h2 id="-472222476#dependencias" data-toc="dependencias#EventLogManagerProvider.md-dependencias">Dependencias</h2><ul class="list" id="-472222476#-c1rnhy_58" start="1"><li class="list-item" id="-472222476#-c1rnhy_59"><p><span class="inline-code" id="-472222476#-c1rnhy_60">EventLog__b</span>: Objeto Big Object que almacena los registros de eventos. Este objeto debe estar definido en la organizaci&oacute;n con los siguientes campos: </p><ul class="list" id="-472222476#-c1rnhy_61" start="1"><li class="list-item" id="-472222476#-c1rnhy_62"><p><span class="inline-code" id="-472222476#-c1rnhy_68">Date__c</span>: Campo de fecha y hora para el momento del evento.</p></li><li class="list-item" id="-472222476#-c1rnhy_63"><p><span class="inline-code" id="-472222476#-c1rnhy_69">Product__c</span>: Campo de texto para el producto relacionado.</p></li><li class="list-item" id="-472222476#-c1rnhy_64"><p><span class="inline-code" id="-472222476#-c1rnhy_70">Level__c</span>: Campo de texto para el nivel de importancia del evento.</p></li><li class="list-item" id="-472222476#-c1rnhy_65"><p><span class="inline-code" id="-472222476#-c1rnhy_71">Platform__c</span>: Campo de texto para la plataforma donde ocurri&oacute; el evento.</p></li><li class="list-item" id="-472222476#-c1rnhy_66"><p><span class="inline-code" id="-472222476#-c1rnhy_72">Process__c</span>: Campo de texto para el proceso relacionado.</p></li><li class="list-item" id="-472222476#-c1rnhy_67"><p><span class="inline-code" id="-472222476#-c1rnhy_73">Type__c</span>: Campo de texto para el tipo de evento.</p></li></ul></li></ul></section><section><h2 id="-472222476#observaciones-sobre-el-c-digo" data-toc="observaciones-sobre-el-c-digo#EventLogManagerProvider.md-observaciones-sobre-el-c-digo">Observaciones sobre el C&oacute;digo</h2><section><h3 id="-472222476#puntos-fuertes" data-toc="puntos-fuertes#EventLogManagerProvider.md-puntos-fuertes">Puntos Fuertes</h3><ol class="list list-decimal" id="-472222476#-c1rnhy_77" type="1" start="1"><li class="list-item" id="-472222476#-c1rnhy_78"><p><span class="control" id="-472222476#-c1rnhy_82">Eficiencia en inserci&oacute;n masiva</span>: Utiliza un enfoque por lotes (batch) para insertar registros, lo que es m&aacute;s eficiente que insertar registros individualmente.</p></li><li class="list-item" id="-472222476#-c1rnhy_79"><p><span class="control" id="-472222476#-c1rnhy_83">Versatilidad en datos generados</span>: Crea una variedad de combinaciones de datos utilizando selecci&oacute;n aleatoria de valores predefinidos.</p></li><li class="list-item" id="-472222476#-c1rnhy_80"><p><span class="control" id="-472222476#-c1rnhy_84">Uso de Big Objects</span>: Aprovecha la capacidad de Big Objects para almacenar grandes vol&uacute;menes de datos de eventos.</p></li><li class="list-item" id="-472222476#-c1rnhy_81"><p><span class="control" id="-472222476#-c1rnhy_85">M&eacute;todo inmediato de inserci&oacute;n</span>: Utiliza <span class="inline-code" id="-472222476#-c1rnhy_86">Database.insertImmediate()</span>, que es el m&eacute;todo adecuado para insertar registros en Big Objects.</p></li></ol></section><section><h3 id="-472222476#posibles-errores-y-mejoras" data-toc="posibles-errores-y-mejoras#EventLogManagerProvider.md-posibles-errores-y-mejoras">Posibles Errores y Mejoras</h3><ol class="list list-decimal" id="-472222476#-c1rnhy_87" type="1" start="1"><li class="list-item" id="-472222476#-c1rnhy_88"><p><span class="control" id="-472222476#-c1rnhy_93">Error de variable</span>: En la asignaci&oacute;n <span class="inline-code" id="-472222476#-c1rnhy_94">Platform__c = Platform</span>, se usa <span class="inline-code" id="-472222476#-c1rnhy_95">Platform</span> (may&uacute;scula) como valor, pero la variable es <span class="inline-code" id="-472222476#-c1rnhy_96">platform</span> (min&uacute;scula). Esto provocar&aacute; un error en tiempo de ejecuci&oacute;n.</p></li><li class="list-item" id="-472222476#-c1rnhy_89"><p><span class="control" id="-472222476#-c1rnhy_97">Manejo de errores</span>: No hay manejo de errores para las operaciones de inserci&oacute;n. Ser&iacute;a recomendable a&ntilde;adir c&oacute;digo para verificar los resultados de <span class="inline-code" id="-472222476#-c1rnhy_98">Database.insertImmediate()</span>.</p></li><li class="list-item" id="-472222476#-c1rnhy_90"><p><span class="control" id="-472222476#-c1rnhy_99">N&uacute;mero fijo de registros</span>: La generaci&oacute;n de 5000 registros est&aacute; codificada de forma fija. Podr&iacute;a ser beneficioso hacer este n&uacute;mero configurable.</p></li><li class="list-item" id="-472222476#-c1rnhy_91"><p><span class="control" id="-472222476#-c1rnhy_100">Distribuci&oacute;n aleatoria simple</span>: Utiliza una distribuci&oacute;n uniforme simple para seleccionar valores, lo que podr&iacute;a no reflejar patrones reales de eventos en un sistema de producci&oacute;n.</p></li><li class="list-item" id="-472222476#-c1rnhy_92"><p><span class="control" id="-472222476#-c1rnhy_101">No verifica l&iacute;mites del sistema</span>: No verifica los l&iacute;mites del sistema (como l&iacute;mites de API, DML, etc.) antes de intentar insertar registros.</p></li></ol></section><section><h3 id="-472222476#correcci-n-del-error-de-variable" data-toc="correcci-n-del-error-de-variable#EventLogManagerProvider.md-correcci-n-del-error-de-variable">Correcci&oacute;n del Error de Variable</h3><p id="-472222476#-c1rnhy_102">El error en <span class="inline-code" id="-472222476#-c1rnhy_104">Platform__c = Platform</span> deber&iacute;a corregirse a <span class="inline-code" id="-472222476#-c1rnhy_105">Platform__c = platform</span> para utilizar la variable correctamente:</p><div class="detached code-block" id="-472222476#-c1rnhy_103"><pre><code class="language-none">EventLog__b eventLog = new EventLog__b(
  Date__c = System.now(),
  Product__c = product,
  Level__c = level,
  Platform__c = platform,  // Corregido: platform en minúscula
  Process__c = process,
  Type__c = type
);</code></pre></div></section></section><section><h2 id="-472222476#mejoras-propuestas" data-toc="mejoras-propuestas#EventLogManagerProvider.md-mejoras-propuestas">Mejoras Propuestas</h2><section><h3 id="-472222476#versi-n-mejorada-con-manejo-de-errores-y-par-metros-configurables" data-toc="versi-n-mejorada-con-manejo-de-errores-y-par-metros-configurables#EventLogManagerProvider.md-versi-n-mejorada-con-manejo-de-errores-y-par-metros-configurables">Versi&oacute;n Mejorada con Manejo de Errores y Par&aacute;metros Configurables</h3><div class="detached code-block" id="-472222476#-c1rnhy_107"><pre><code class="language-none">public with sharing class EventLogManagerProvider {
  /**
   * @description Genera registros de eventos simulados en el objeto Big Object EventLog__b
   * @param count Número de registros a generar (predeterminado: 5000, máximo: 10000)
   * @param batchSize Tamaño del lote para inserción (predeterminado: 200, máximo: 200)
   * @return ResultInfo Información sobre el resultado de la operación
   */
  public static ResultInfo generate(Integer count, Integer batchSize) {
    // Validar y establecer valores predeterminados para los parámetros
    count = (count != null &amp;&amp; count &gt; 0) ? Math.min(count, 10000) : 5000;
    batchSize = (batchSize != null &amp;&amp; batchSize &gt; 0) ? Math.min(batchSize, 200) : 200;
    
    ResultInfo result = new ResultInfo();
    List&lt;EventLog__b&gt; eventLogs = new List&lt;EventLog__b&gt;();

    // Listas predefinidas de valores
    final List&lt;String&gt; PRODUCTS = new List&lt;String&gt;{
      'Moto', 'Auto', 'Arrendmiento', 'Viaje'
    };
    final List&lt;String&gt; LEVELS = new List&lt;String&gt;{
      'Info', 'Warning', 'Error', 'Alert'
    };
    final List&lt;String&gt; PLATFORMS = new List&lt;String&gt;{ 
      'Salesforce', 'Mulesoft' 
    };
    final List&lt;String&gt; TYPES = new List&lt;String&gt;{ 
      'INFO', 'ERROR' 
    };
    final List&lt;String&gt; PROCESSES = new List&lt;String&gt;{
      'Knowing', 'Rating', 'Quoting', 'Issuing', 'Notifying'
    };

    try {
      for (Integer i = 0; i &lt; count; i++) {
        // Generar valores aleatorios
        String product = getRandomValue(PRODUCTS);
        String platform = getRandomValue(PLATFORMS);
        String level = getRandomValue(LEVELS);
        String type = getRandomValue(TYPES);
        String process = getRandomValue(PROCESSES);

        // Crear registro de evento
        EventLog__b eventLog = new EventLog__b(
          Date__c = System.now(),
          Product__c = product,
          Level__c = level,
          Platform__c = platform,
          Process__c = process,
          Type__c = type
        );
        eventLogs.add(eventLog);

        // Insertar registros en lotes
        if (eventLogs.size() == batchSize) {
          insertAndProcessResults(eventLogs, result);
          eventLogs.clear();
        }
      }

      // Insertar registros restantes
      if (!eventLogs.isEmpty()) {
        insertAndProcessResults(eventLogs, result);
      }
      
      result.success = true;
      result.message = 'Generación completada: ' + result.totalRecords + ' registros insertados con ' + 
                      result.failedRecords + ' fallos.';
    } catch (Exception e) {
      result.success = false;
      result.message = 'Error en la generación: ' + e.getMessage() + ' en la línea ' + e.getLineNumber();
      result.exception = e;
    }
    
    return result;
  }
  
  // Método sobrecargado para usar valores predeterminados
  public static ResultInfo generate() {
    return generate(5000, 200);
  }
  
  // Método ayudante para seleccionar un valor aleatorio de una lista
  private static String getRandomValue(List&lt;String&gt; values) {
    return values.get((Math.random() * values.size()).intValue());
  }
  
  // Método auxiliar para insertar registros y procesar resultados
  private static void insertAndProcessResults(List&lt;EventLog__b&gt; eventLogs, ResultInfo result) {
    Database.SaveResult[] saveResults = Database.insertImmediate(eventLogs);
    
    for (Database.SaveResult sr : saveResults) {
      result.totalRecords++;
      if (!sr.isSuccess()) {
        result.failedRecords++;
        for (Database.Error err : sr.getErrors()) {
          result.errors.add(err.getMessage());
        }
      }
    }
  }
  
  // Clase interna para devolver información sobre el resultado
  public class ResultInfo {
    public Boolean success = false;
    public String message = '';
    public Integer totalRecords = 0;
    public Integer failedRecords = 0;
    public List&lt;String&gt; errors = new List&lt;String&gt;();
    public Exception exception;
  }
}</code></pre></div></section></section><section><h2 id="-472222476#ejemplo-de-uso" data-toc="ejemplo-de-uso#EventLogManagerProvider.md-ejemplo-de-uso">Ejemplo de Uso</h2><section><h3 id="-472222476#uso-b-sico" data-toc="uso-b-sico#EventLogManagerProvider.md-uso-b-sico">Uso B&aacute;sico</h3><div class="detached code-block" id="-472222476#-c1rnhy_111"><pre><code class="language-none">// Generar 5000 registros usando el método predeterminado
EventLogManagerProvider.generate();</code></pre></div></section><section><h3 id="-472222476#uso-avanzado" data-toc="uso-avanzado#EventLogManagerProvider.md-uso-avanzado">Uso Avanzado</h3><div class="detached code-block" id="-472222476#-c1rnhy_112"><pre><code class="language-none">// Generar 1000 registros con un tamaño de lote de 150
EventLogManagerProvider.ResultInfo result = EventLogManagerProvider.generate(1000, 150);

// Verificar el resultado
if (result.success) {
    System.debug('Generación exitosa: ' + result.message);
} else {
    System.debug('Error en la generación: ' + result.message);
    for (String error : result.errors) {
        System.debug('Error: ' + error);
    }
}</code></pre></div></section><section><h3 id="-472222476#uso-en-un-trabajo-por-lotes" data-toc="uso-en-un-trabajo-por-lotes#EventLogManagerProvider.md-uso-en-un-trabajo-por-lotes">Uso en un Trabajo por Lotes</h3><div class="detached code-block" id="-472222476#-c1rnhy_113"><pre><code class="language-none">public class EventLogGeneratorBatch implements Database.Batchable&lt;Integer&gt;, Database.Stateful {
    private Integer totalRecords;
    private Integer batchSize;
    private List&lt;Integer&gt; iterations;
    private EventLogManagerProvider.ResultInfo finalResult;
    
    public EventLogGeneratorBatch(Integer totalRecords, Integer batchSize) {
        this.totalRecords = totalRecords;
        this.batchSize = batchSize;
        this.finalResult = new EventLogManagerProvider.ResultInfo();
        
        // Crear una lista de iteraciones para procesar
        this.iterations = new List&lt;Integer&gt;();
        Integer remainingRecords = totalRecords;
        Integer maxPerBatch = 5000; // Máximo de registros por ejecución de generate()
        
        while (remainingRecords &gt; 0) {
            Integer recordsThisBatch = Math.min(remainingRecords, maxPerBatch);
            iterations.add(recordsThisBatch);
            remainingRecords -= recordsThisBatch;
        }
    }
    
    public List&lt;Integer&gt; start(Database.BatchableContext bc) {
        return iterations;
    }
    
    public void execute(Database.BatchableContext bc, List&lt;Integer&gt; scope) {
        for (Integer recordCount : scope) {
            EventLogManagerProvider.ResultInfo result = EventLogManagerProvider.generate(recordCount, batchSize);
            
            // Acumular resultados
            finalResult.totalRecords += result.totalRecords;
            finalResult.failedRecords += result.failedRecords;
            finalResult.errors.addAll(result.errors);
            
            if (!result.success) {
                finalResult.success = false;
                finalResult.message += ' ' + result.message;
            }
        }
    }
    
    public void finish(Database.BatchableContext bc) {
        finalResult.message = 'Generación de registros completada. Total: ' + 
                             finalResult.totalRecords + ', Fallidos: ' + 
                             finalResult.failedRecords;
        
        // Registrar resultado final
        System.debug('Resultado final: ' + finalResult.message);
    }
}

// Uso del trabajo por lotes para generar 100,000 registros
Database.executeBatch(new EventLogGeneratorBatch(100000, 200), 1);</code></pre></div></section></section><section><h2 id="-472222476#consideraciones-de-rendimiento" data-toc="consideraciones-de-rendimiento#EventLogManagerProvider.md-consideraciones-de-rendimiento">Consideraciones de Rendimiento</h2><ol class="list list-decimal" id="-472222476#-c1rnhy_114" type="1" start="1"><li class="list-item" id="-472222476#-c1rnhy_115"><p><span class="control" id="-472222476#-c1rnhy_119">Volumen de Datos</span>: Generar 5000 registros puede ser intensivo en recursos. Para vol&uacute;menes m&aacute;s grandes, considerar un enfoque por lotes o as&iacute;ncrono.</p></li><li class="list-item" id="-472222476#-c1rnhy_116"><p><span class="control" id="-472222476#-c1rnhy_120">L&iacute;mites de Big Objects</span>: BigObjects tienen l&iacute;mites diferentes a los objetos est&aacute;ndar. Verificar la documentaci&oacute;n de Salesforce para conocer los l&iacute;mites actuales.</p></li><li class="list-item" id="-472222476#-c1rnhy_117"><p><span class="control" id="-472222476#-c1rnhy_121">L&iacute;mites de Transacci&oacute;n</span>: El m&eacute;todo <span class="inline-code" id="-472222476#-c1rnhy_122">Database.insertImmediate()</span> cuenta para los l&iacute;mites de la transacci&oacute;n actual.</p></li><li class="list-item" id="-472222476#-c1rnhy_118"><p><span class="control" id="-472222476#-c1rnhy_123">Aleatoriedad</span>: El m&eacute;todo <span class="inline-code" id="-472222476#-c1rnhy_124">Math.random()</span> proporciona una distribuci&oacute;n uniforme simple, que puede no ser &oacute;ptima para todos los casos de prueba.</p></li></ol></section><section><h2 id="-472222476#uso-t-pico" data-toc="uso-t-pico#EventLogManagerProvider.md-uso-t-pico">Uso T&iacute;pico</h2><p id="-472222476#-c1rnhy_125">Esta clase es &uacute;til en varios escenarios:</p><ol class="list list-decimal" id="-472222476#-c1rnhy_126" type="1" start="1"><li class="list-item" id="-472222476#-c1rnhy_127"><p><span class="control" id="-472222476#-c1rnhy_131">Configuraci&oacute;n de Entornos</span>: Cargar datos de muestra en entornos de desarrollo o sandbox.</p></li><li class="list-item" id="-472222476#-c1rnhy_128"><p><span class="control" id="-472222476#-c1rnhy_132">Pruebas de Rendimiento</span>: Generar vol&uacute;menes grandes de datos para probar el rendimiento de componentes que procesan eventos.</p></li><li class="list-item" id="-472222476#-c1rnhy_129"><p><span class="control" id="-472222476#-c1rnhy_133">Demos y Presentaciones</span>: Crear datos realistas para demostraciones o presentaciones.</p></li><li class="list-item" id="-472222476#-c1rnhy_130"><p><span class="control" id="-472222476#-c1rnhy_134">Pruebas de Integraci&oacute;n</span>: Simular eventos para probar integraci&oacute;n con sistemas externos.</p></li></ol></section><section><h2 id="-472222476#notas-adicionales" data-toc="notas-adicionales#EventLogManagerProvider.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-472222476#-c1rnhy_135" type="1" start="1"><li class="list-item" id="-472222476#-c1rnhy_136"><p>El uso de Big Objects (<span class="inline-code" id="-472222476#-c1rnhy_141">EventLog__b</span>) es una buena elecci&oacute;n para almacenar grandes vol&uacute;menes de datos de registro, ya que est&aacute;n optimizados para este prop&oacute;sito.</p></li><li class="list-item" id="-472222476#-c1rnhy_137"><p>La clase utiliza una distribuci&oacute;n de valores aleatoria uniforme, lo que significa que cada opci&oacute;n tiene la misma probabilidad de ser seleccionada. En un sistema real, algunos tipos de eventos podr&iacute;an ser m&aacute;s comunes que otros.</p></li><li class="list-item" id="-472222476#-c1rnhy_138"><p>La inserci&oacute;n por lotes de 200 registros es una buena pr&aacute;ctica para evitar alcanzar los l&iacute;mites de Salesforce para operaciones DML.</p></li><li class="list-item" id="-472222476#-c1rnhy_139"><p>La clase no incluye la generaci&oacute;n de datos relacionados espec&iacute;ficos del negocio o contenido detallado de mensajes de error, que podr&iacute;an hacer los datos m&aacute;s realistas.</p></li><li class="list-item" id="-472222476#-c1rnhy_140"><p>La fecha utilizada para todos los registros es la misma (<span class="inline-code" id="-472222476#-c1rnhy_142">System.now()</span>). Para simular datos hist&oacute;ricos, podr&iacute;a ser &uacute;til generar fechas variadas dentro de un rango determinado.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1647977607">EventLogManagerFoundationAdapter</h1><section><h2 id="-1647977607#descripci-n-general" data-toc="descripci-n-general#EventLogManagerFoundationAdapter.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-1647977607#n90q8j_15"><span class="inline-code" id="-1647977607#n90q8j_16">EventLogManagerFoundationAdapter</span> es una clase abstracta global que proporciona una estructura base para la implementaci&oacute;n de adaptadores de gesti&oacute;n de registros de eventos. Esta clase define una interfaz com&uacute;n para aplicar la l&oacute;gica de registro de eventos, permitiendo diferentes implementaciones espec&iacute;ficas a trav&eacute;s de herencia.</p></section><section><h2 id="-1647977607#estructura" data-toc="estructura#EventLogManagerFoundationAdapter.md-estructura">Estructura</h2><div class="detached code-block" id="-1647977607#n90q8j_17"><pre><code class="language-none">global abstract class EventLogManagerFoundationAdapter {
    
    global abstract Boolean applyEventLog(
        Map&lt;String, Object&gt; inputMap,
        Map&lt;String, Object&gt; outputMap,
        Map&lt;String, Object&gt; optionMap
    );

    public Boolean invokeMethod(
        String methodName,
        Map&lt;String, Object&gt; inputMap,
        Map&lt;String, Object&gt; outputMap,
        Map&lt;String, Object&gt; optionMap
    ) {
        switch on methodName.toUpperCase() {
            when 'APPLYEVENTLOG' {
                return applyEventLog(inputMap, outputMap, optionMap);
            }
            when else {
                Core.debug('Unsupported method: ' + methodName);
                return false;
            }
        }
    }
}</code></pre></div></section><section><h2 id="-1647977607#m-todos" data-toc="m-todos#EventLogManagerFoundationAdapter.md-m-todos">M&eacute;todos</h2><section><h3 id="-1647977607#applyeventlog-map-string-object-inputmap-map-string-object-outputmap-map-string-object-optionmap" data-toc="applyeventlog-map-string-object-inputmap-map-string-object-outputmap-map-string-object-optionmap#EventLogManagerFoundationAdapter.md-applyeventlog-map-string-object-inputmap-map-string-object-outputmap-map-string-object-optionmap">applyEventLog(Map&lt;String, Object&gt; inputMap, Map&lt;String, Object&gt; outputMap, Map&lt;String, Object&gt; optionMap)</h3><section><h4 id="-1647977607#descripci-n" data-toc="descripci-n#EventLogManagerFoundationAdapter.md-descripci-n">Descripci&oacute;n</h4><p id="-1647977607#n90q8j_26">M&eacute;todo abstracto que debe ser implementado por las clases derivadas. Este m&eacute;todo aplica la l&oacute;gica de registro de eventos.</p></section><section><h4 id="-1647977607#par-metros" data-toc="par-metros#EventLogManagerFoundationAdapter.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1647977607#n90q8j_27" start="1"><li class="list-item" id="-1647977607#n90q8j_28"><p><span class="inline-code" id="-1647977607#n90q8j_31">inputMap</span> (Map&lt;String, Object&gt;): Mapa con los datos de entrada para el registro de eventos.</p></li><li class="list-item" id="-1647977607#n90q8j_29"><p><span class="inline-code" id="-1647977607#n90q8j_32">outputMap</span> (Map&lt;String, Object&gt;): Mapa donde se pueden guardar resultados o datos de salida.</p></li><li class="list-item" id="-1647977607#n90q8j_30"><p><span class="inline-code" id="-1647977607#n90q8j_33">optionMap</span> (Map&lt;String, Object&gt;): Mapa con opciones adicionales para configurar el comportamiento del registro.</p></li></ul></section><section><h4 id="-1647977607#retorno" data-toc="retorno#EventLogManagerFoundationAdapter.md-retorno">Retorno</h4><ul class="list" id="-1647977607#n90q8j_34" start="1"><li class="list-item" id="-1647977607#n90q8j_35"><p><span class="inline-code" id="-1647977607#n90q8j_36">Boolean</span>: Indica si el registro de eventos se aplic&oacute; con &eacute;xito (<span class="inline-code" id="-1647977607#n90q8j_37">true</span>) o no (<span class="inline-code" id="-1647977607#n90q8j_38">false</span>).</p></li></ul></section><section><h4 id="-1647977607#implementaci-n" data-toc="implementaci-n#EventLogManagerFoundationAdapter.md-implementaci-n">Implementaci&oacute;n</h4><p id="-1647977607#n90q8j_39">Por ser un m&eacute;todo abstracto, no tiene implementaci&oacute;n en esta clase. Las clases que extiendan <span class="inline-code" id="-1647977607#n90q8j_40">EventLogManagerFoundationAdapter</span> deben proporcionar una implementaci&oacute;n concreta.</p></section></section><section><h3 id="-1647977607#invokemethod-string-methodname-map-string-object-inputmap-map-string-object-outputmap-map-string-object-optionmap" data-toc="invokemethod-string-methodname-map-string-object-inputmap-map-string-object-outputmap-map-string-object-optionmap#EventLogManagerFoundationAdapter.md-invokemethod-string-methodname-map-string-object-inputmap-map-string-object-outputmap-map-string-object-optionmap">invokeMethod(String methodName, Map&lt;String, Object&gt; inputMap, Map&lt;String, Object&gt; outputMap, Map&lt;String, Object&gt; optionMap)</h3><section><h4 id="-1647977607#descripci-n" data-toc="descripci-n#EventLogManagerFoundationAdapter.md-descripci-n">Descripci&oacute;n</h4><p id="-1647977607#n90q8j_48">M&eacute;todo p&uacute;blico que sirve como punto de entrada para invocar m&eacute;todos espec&iacute;ficos del adaptador. Actualmente, soporta el m&eacute;todo 'APPLYEVENTLOG'.</p></section><section><h4 id="-1647977607#par-metros" data-toc="par-metros#EventLogManagerFoundationAdapter.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1647977607#n90q8j_49" start="1"><li class="list-item" id="-1647977607#n90q8j_50"><p><span class="inline-code" id="-1647977607#n90q8j_54">methodName</span> (String): Nombre del m&eacute;todo a invocar.</p></li><li class="list-item" id="-1647977607#n90q8j_51"><p><span class="inline-code" id="-1647977607#n90q8j_55">inputMap</span> (Map&lt;String, Object&gt;): Mapa con los datos de entrada para el m&eacute;todo.</p></li><li class="list-item" id="-1647977607#n90q8j_52"><p><span class="inline-code" id="-1647977607#n90q8j_56">outputMap</span> (Map&lt;String, Object&gt;): Mapa donde se pueden guardar resultados o datos de salida.</p></li><li class="list-item" id="-1647977607#n90q8j_53"><p><span class="inline-code" id="-1647977607#n90q8j_57">optionMap</span> (Map&lt;String, Object&gt;): Mapa con opciones adicionales para configurar el comportamiento del m&eacute;todo.</p></li></ul></section><section><h4 id="-1647977607#retorno" data-toc="retorno#EventLogManagerFoundationAdapter.md-retorno">Retorno</h4><ul class="list" id="-1647977607#n90q8j_58" start="1"><li class="list-item" id="-1647977607#n90q8j_59"><p><span class="inline-code" id="-1647977607#n90q8j_60">Boolean</span>: Resultado de la operaci&oacute;n, que depende del m&eacute;todo invocado: </p><ul class="list" id="-1647977607#n90q8j_61" start="1"><li class="list-item" id="-1647977607#n90q8j_62"><p>Para 'APPLYEVENTLOG': Devuelve el resultado del m&eacute;todo <span class="inline-code" id="-1647977607#n90q8j_64">applyEventLog</span>.</p></li><li class="list-item" id="-1647977607#n90q8j_63"><p>Para cualquier otro m&eacute;todo: Devuelve <span class="inline-code" id="-1647977607#n90q8j_65">false</span> e imprime un mensaje de depuraci&oacute;n indicando que el m&eacute;todo no est&aacute; soportado.</p></li></ul></li></ul></section><section><h4 id="-1647977607#proceso" data-toc="proceso#EventLogManagerFoundationAdapter.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1647977607#n90q8j_66" type="1" start="1"><li class="list-item" id="-1647977607#n90q8j_67"><p>Convierte el nombre del m&eacute;todo a may&uacute;sculas para una comparaci&oacute;n insensible a may&uacute;sculas/min&uacute;sculas.</p></li><li class="list-item" id="-1647977607#n90q8j_68"><p>Utiliza una declaraci&oacute;n <span class="inline-code" id="-1647977607#n90q8j_69">switch</span> para determinar qu&eacute; m&eacute;todo invocar: </p><ul class="list" id="-1647977607#n90q8j_70" start="1"><li class="list-item" id="-1647977607#n90q8j_71"><p>Si el m&eacute;todo es 'APPLYEVENTLOG', invoca el m&eacute;todo abstracto <span class="inline-code" id="-1647977607#n90q8j_73">applyEventLog</span>.</p></li><li class="list-item" id="-1647977607#n90q8j_72"><p>Para cualquier otro m&eacute;todo, registra un mensaje de depuraci&oacute;n y devuelve <span class="inline-code" id="-1647977607#n90q8j_74">false</span>.</p></li></ul></li></ol></section><section><h4 id="-1647977607#c-digo" data-toc="c-digo#EventLogManagerFoundationAdapter.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1647977607#n90q8j_75"><pre><code class="language-none">public Boolean invokeMethod(
    String methodName,
    Map&lt;String, Object&gt; inputMap,
    Map&lt;String, Object&gt; outputMap,
    Map&lt;String, Object&gt; optionMap
) {
    switch on methodName.toUpperCase() {
        when 'APPLYEVENTLOG' {
            return applyEventLog(inputMap, outputMap, optionMap);
        }
        when else {
            Core.debug('Unsupported method: ' + methodName);
            return false;
        }
    }
}</code></pre></div></section></section></section><section><h2 id="-1647977607#patrones-de-dise-o-utilizados" data-toc="patrones-de-dise-o-utilizados#EventLogManagerFoundationAdapter.md-patrones-de-dise-o-utilizados">Patrones de Dise&ntilde;o Utilizados</h2><section><h3 id="-1647977607#adaptador-adapter" data-toc="adaptador-adapter#EventLogManagerFoundationAdapter.md-adaptador-adapter">Adaptador (Adapter)</h3><p id="-1647977607#n90q8j_79">La clase implementa el patr&oacute;n de dise&ntilde;o Adaptador, proporcionando una interfaz com&uacute;n (a trav&eacute;s de <span class="inline-code" id="-1647977607#n90q8j_80">applyEventLog</span>) que puede ser implementada por diferentes adaptadores concretos para trabajar con distintos sistemas o mecanismos de registro de eventos.</p></section><section><h3 id="-1647977607#plantilla-template-method" data-toc="plantilla-template-method#EventLogManagerFoundationAdapter.md-plantilla-template-method">Plantilla (Template Method)</h3><p id="-1647977607#n90q8j_81">El m&eacute;todo <span class="inline-code" id="-1647977607#n90q8j_82">invokeMethod</span> sigue el patr&oacute;n Plantilla, definiendo la estructura de la operaci&oacute;n, pero delegando pasos espec&iacute;ficos (como <span class="inline-code" id="-1647977607#n90q8j_83">applyEventLog</span>) a las subclases.</p></section><section><h3 id="-1647977607#comando-command" data-toc="comando-command#EventLogManagerFoundationAdapter.md-comando-command">Comando (Command)</h3><p id="-1647977607#n90q8j_84">El m&eacute;todo <span class="inline-code" id="-1647977607#n90q8j_85">invokeMethod</span> implementa un patr&oacute;n similar al Comando, donde la acci&oacute;n a ejecutar se determina en funci&oacute;n del nombre del m&eacute;todo pasado como par&aacute;metro.</p></section></section><section><h2 id="-1647977607#dependencias" data-toc="dependencias#EventLogManagerFoundationAdapter.md-dependencias">Dependencias</h2><ul class="list" id="-1647977607#n90q8j_86" start="1"><li class="list-item" id="-1647977607#n90q8j_87"><p><span class="inline-code" id="-1647977607#n90q8j_88">Core</span>: Clase utilitaria que proporciona el m&eacute;todo <span class="inline-code" id="-1647977607#n90q8j_89">debug</span> para registrar mensajes de depuraci&oacute;n.</p></li></ul></section><section><h2 id="-1647977607#extensibilidad" data-toc="extensibilidad#EventLogManagerFoundationAdapter.md-extensibilidad">Extensibilidad</h2><p id="-1647977607#n90q8j_90">La clase est&aacute; dise&ntilde;ada para ser extendida. Las clases derivadas deben implementar el m&eacute;todo abstracto <span class="inline-code" id="-1647977607#n90q8j_91">applyEventLog</span> para proporcionar la l&oacute;gica espec&iacute;fica de registro de eventos.</p></section><section><h2 id="-1647977607#ejemplos-de-implementaci-n" data-toc="ejemplos-de-implementaci-n#EventLogManagerFoundationAdapter.md-ejemplos-de-implementaci-n">Ejemplos de Implementaci&oacute;n</h2><section><h3 id="-1647977607#implementaci-n-b-sica" data-toc="implementaci-n-b-sica#EventLogManagerFoundationAdapter.md-implementaci-n-b-sica">Implementaci&oacute;n B&aacute;sica</h3><div class="detached code-block" id="-1647977607#n90q8j_95"><pre><code class="language-none">public class SimpleEventLogAdapter extends EventLogManagerFoundationAdapter {
    
    global override Boolean applyEventLog(
        Map&lt;String, Object&gt; inputMap,
        Map&lt;String, Object&gt; outputMap,
        Map&lt;String, Object&gt; optionMap
    ) {
        try {
            // Extraer datos necesarios del inputMap
            String eventType = (String)inputMap.get('eventType');
            String message = (String)inputMap.get('message');
            String userId = UserInfo.getUserId();
            Datetime timestamp = Datetime.now();
            
            // Crear un registro de evento
            Event_Log__c eventLog = new Event_Log__c(
                Event_Type__c = eventType,
                Message__c = message,
                User__c = userId,
                Timestamp__c = timestamp
            );
            
            // Opcionalmente, añadir detalles adicionales si están presentes
            if (inputMap.containsKey('details')) {
                eventLog.Details__c = JSON.serialize(inputMap.get('details'));
            }
            
            // Insertar el registro
            insert eventLog;
            
            // Opcionalmente, guardar información en el outputMap
            outputMap.put('success', true);
            outputMap.put('eventLogId', eventLog.Id);
            
            return true;
        } catch (Exception e) {
            // Registrar el error
            System.debug('Error al aplicar registro de evento: ' + e.getMessage());
            
            // Opcionalmente, guardar información de error en el outputMap
            outputMap.put('success', false);
            outputMap.put('errorMessage', e.getMessage());
            
            return false;
        }
    }
}</code></pre></div></section><section><h3 id="-1647977607#implementaci-n-con-plataforma-de-eventos" data-toc="implementaci-n-con-plataforma-de-eventos#EventLogManagerFoundationAdapter.md-implementaci-n-con-plataforma-de-eventos">Implementaci&oacute;n con Plataforma de Eventos</h3><div class="detached code-block" id="-1647977607#n90q8j_96"><pre><code class="language-none">public class PlatformEventLogAdapter extends EventLogManagerFoundationAdapter {
    
    global override Boolean applyEventLog(
        Map&lt;String, Object&gt; inputMap,
        Map&lt;String, Object&gt; outputMap,
        Map&lt;String, Object&gt; optionMap
    ) {
        try {
            // Extraer datos necesarios del inputMap
            String eventName = (String)inputMap.get('eventName');
            
            // Determinar dinámicamente qué tipo de evento de plataforma publicar
            switch on eventName {
                when 'SystemAudit' {
                    return publishSystemAuditEvent(inputMap, outputMap);
                }
                when 'SecurityAlert' {
                    return publishSecurityAlertEvent(inputMap, outputMap);
                }
                when 'IntegrationLog' {
                    return publishIntegrationLogEvent(inputMap, outputMap);
                }
                when else {
                    outputMap.put('success', false);
                    outputMap.put('errorMessage', 'Tipo de evento no soportado: ' + eventName);
                    return false;
                }
            }
        } catch (Exception e) {
            // Registrar el error
            System.debug('Error al publicar evento de plataforma: ' + e.getMessage());
            
            // Guardar información de error en el outputMap
            outputMap.put('success', false);
            outputMap.put('errorMessage', e.getMessage());
            
            return false;
        }
    }
    
    private Boolean publishSystemAuditEvent(
        Map&lt;String, Object&gt; inputMap,
        Map&lt;String, Object&gt; outputMap
    ) {
        // Crear el evento de plataforma
        System_Audit_Event__e auditEvent = new System_Audit_Event__e(
            User_Id__c = UserInfo.getUserId(),
            Action__c = (String)inputMap.get('action'),
            Record_Id__c = (String)inputMap.get('recordId'),
            Details__c = (String)inputMap.get('details')
        );
        
        // Publicar el evento
        Database.SaveResult result = EventBus.publish(auditEvent);
        
        // Verificar el resultado
        if (result.isSuccess()) {
            outputMap.put('success', true);
            outputMap.put('eventId', result.getId());
            return true;
        } else {
            outputMap.put('success', false);
            outputMap.put('errors', result.getErrors());
            return false;
        }
    }
    
    private Boolean publishSecurityAlertEvent(
        Map&lt;String, Object&gt; inputMap,
        Map&lt;String, Object&gt; outputMap
    ) {
        // Implementación similar para eventos de alerta de seguridad
        // ...
        return true;
    }
    
    private Boolean publishIntegrationLogEvent(
        Map&lt;String, Object&gt; inputMap,
        Map&lt;String, Object&gt; outputMap
    ) {
        // Implementación similar para eventos de log de integración
        // ...
        return true;
    }
}</code></pre></div></section><section><h3 id="-1647977607#implementaci-n-con-m-ltiples-destinos" data-toc="implementaci-n-con-m-ltiples-destinos#EventLogManagerFoundationAdapter.md-implementaci-n-con-m-ltiples-destinos">Implementaci&oacute;n con M&uacute;ltiples Destinos</h3><div class="detached code-block" id="-1647977607#n90q8j_97"><pre><code class="language-none">public class MultiTargetEventLogAdapter extends EventLogManagerFoundationAdapter {
    
    global override Boolean applyEventLog(
        Map&lt;String, Object&gt; inputMap,
        Map&lt;String, Object&gt; outputMap,
        Map&lt;String, Object&gt; optionMap
    ) {
        // Determinar los destinos de registro basados en opciones
        Set&lt;String&gt; targetSystems = new Set&lt;String&gt;();
        
        if (optionMap.containsKey('targets')) {
            targetSystems = (Set&lt;String&gt;)optionMap.get('targets');
        } else {
            // Destinos predeterminados si no se especifican
            targetSystems.add('DATABASE');
            targetSystems.add('PLATFORM_EVENTS');
        }
        
        Boolean overallSuccess = true;
        Map&lt;String, Object&gt; results = new Map&lt;String, Object&gt;();
        
        // Aplicar el registro a cada destino
        for (String target : targetSystems) {
            Boolean targetSuccess = false;
            
            switch on target.toUpperCase() {
                when 'DATABASE' {
                    targetSuccess = logToDatabase(inputMap);
                }
                when 'PLATFORM_EVENTS' {
                    targetSuccess = logToPlatformEvents(inputMap);
                }
                when 'EXTERNAL_SYSTEM' {
                    targetSuccess = logToExternalSystem(inputMap);
                }
                when else {
                    System.debug('Destino de registro no soportado: ' + target);
                    targetSuccess = false;
                }
            }
            
            results.put(target, targetSuccess);
            overallSuccess = overallSuccess &amp;&amp; targetSuccess;
        }
        
        // Guardar resultados detallados
        outputMap.put('targetResults', results);
        outputMap.put('overallSuccess', overallSuccess);
        
        return overallSuccess;
    }
    
    private Boolean logToDatabase(Map&lt;String, Object&gt; inputMap) {
        // Implementación para registrar en la base de datos
        // ...
        return true;
    }
    
    private Boolean logToPlatformEvents(Map&lt;String, Object&gt; inputMap) {
        // Implementación para publicar eventos de plataforma
        // ...
        return true;
    }
    
    private Boolean logToExternalSystem(Map&lt;String, Object&gt; inputMap) {
        // Implementación para enviar a un sistema externo
        // ...
        return true;
    }
}</code></pre></div></section></section><section><h2 id="-1647977607#ejemplo-de-uso" data-toc="ejemplo-de-uso#EventLogManagerFoundationAdapter.md-ejemplo-de-uso">Ejemplo de Uso</h2><div class="detached code-block" id="-1647977607#n90q8j_98"><pre><code class="language-none">// Crear una instancia del adaptador concreto
EventLogManagerFoundationAdapter logAdapter = new SimpleEventLogAdapter();

// Preparar los mapas de entrada, salida y opciones
Map&lt;String, Object&gt; inputMap = new Map&lt;String, Object&gt;{
    'eventType' =&gt; 'User Activity',
    'message' =&gt; 'Usuario actualizó registro',
    'details' =&gt; new Map&lt;String, Object&gt;{
        'recordId' =&gt; '001xx000003G9abCDE',
        'action' =&gt; 'UPDATE',
        'fields' =&gt; new List&lt;String&gt;{'Name', 'Phone', 'Email'}
    }
};

Map&lt;String, Object&gt; outputMap = new Map&lt;String, Object&gt;();
Map&lt;String, Object&gt; optionMap = new Map&lt;String, Object&gt;{
    'storeDetails' =&gt; true,
    'notifyAdmin' =&gt; false
};

// Invocar el método para aplicar el registro de eventos
Boolean success = logAdapter.invokeMethod('applyEventLog', inputMap, outputMap, optionMap);

// Verificar el resultado
if (success) {
    System.debug('Registro de evento aplicado con éxito. ID: ' + outputMap.get('eventLogId'));
} else {
    System.debug('Error al aplicar registro de evento: ' + outputMap.get('errorMessage'));
}</code></pre></div></section><section><h2 id="-1647977607#ejemplo-de-uso-en-sistema-m-s-amplio" data-toc="ejemplo-de-uso-en-sistema-m-s-amplio#EventLogManagerFoundationAdapter.md-ejemplo-de-uso-en-sistema-m-s-amplio">Ejemplo de Uso en Sistema M&aacute;s Amplio</h2><div class="detached code-block" id="-1647977607#n90q8j_99"><pre><code class="language-none">public class TransactionManager {
    
    private EventLogManagerFoundationAdapter eventLogAdapter;
    
    public TransactionManager(EventLogManagerFoundationAdapter logAdapter) {
        this.eventLogAdapter = logAdapter;
    }
    
    public Boolean processTransaction(Map&lt;String, Object&gt; transactionData) {
        try {
            // 1. Validar datos de transacción
            validateTransaction(transactionData);
            
            // 2. Procesar la transacción
            String transactionId = executeTransaction(transactionData);
            
            // 3. Registrar evento de éxito
            Map&lt;String, Object&gt; logInput = new Map&lt;String, Object&gt;{
                'eventType' =&gt; 'Transaction',
                'message' =&gt; 'Transacción completada con éxito',
                'details' =&gt; new Map&lt;String, Object&gt;{
                    'transactionId' =&gt; transactionId,
                    'amount' =&gt; transactionData.get('amount'),
                    'accountId' =&gt; transactionData.get('accountId'),
                    'timestamp' =&gt; Datetime.now()
                }
            };
            
            Map&lt;String, Object&gt; logOutput = new Map&lt;String, Object&gt;();
            Map&lt;String, Object&gt; logOptions = new Map&lt;String, Object&gt;{
                'priority' =&gt; 'High',
                'retainDays' =&gt; 90
            };
            
            eventLogAdapter.invokeMethod('applyEventLog', logInput, logOutput, logOptions);
            
            return true;
        } catch (Exception e) {
            // Registrar evento de error
            Map&lt;String, Object&gt; errorLogInput = new Map&lt;String, Object&gt;{
                'eventType' =&gt; 'Error',
                'message' =&gt; 'Error en transacción: ' + e.getMessage(),
                'details' =&gt; new Map&lt;String, Object&gt;{
                    'errorType' =&gt; e.getTypeName(),
                    'stackTrace' =&gt; e.getStackTraceString(),
                    'transactionData' =&gt; transactionData
                }
            };
            
            Map&lt;String, Object&gt; errorLogOutput = new Map&lt;String, Object&gt;();
            Map&lt;String, Object&gt; errorLogOptions = new Map&lt;String, Object&gt;{
                'priority' =&gt; 'Critical',
                'notifyAdmin' =&gt; true
            };
            
            eventLogAdapter.invokeMethod('applyEventLog', errorLogInput, errorLogOutput, errorLogOptions);
            
            return false;
        }
    }
    
    private void validateTransaction(Map&lt;String, Object&gt; transactionData) {
        // Lógica de validación
        // ...
    }
    
    private String executeTransaction(Map&lt;String, Object&gt; transactionData) {
        // Lógica de ejecución de transacción
        // ...
        return 'TX-' + String.valueOf(Math.random()).substring(2, 10);
    }
}</code></pre></div></section><section><h2 id="-1647977607#consideraciones-de-dise-o" data-toc="consideraciones-de-dise-o#EventLogManagerFoundationAdapter.md-consideraciones-de-dise-o">Consideraciones de Dise&ntilde;o</h2><section><h3 id="-1647977607#ventajas" data-toc="ventajas#EventLogManagerFoundationAdapter.md-ventajas">Ventajas</h3><ol class="list list-decimal" id="-1647977607#n90q8j_102" type="1" start="1"><li class="list-item" id="-1647977607#n90q8j_103"><p><span class="control" id="-1647977607#n90q8j_107">Flexibilidad</span>: Permite diferentes implementaciones de registro de eventos sin cambiar la interfaz.</p></li><li class="list-item" id="-1647977607#n90q8j_104"><p><span class="control" id="-1647977607#n90q8j_108">Extensibilidad</span>: Facilita la adici&oacute;n de nuevos tipos de adaptadores de registro.</p></li><li class="list-item" id="-1647977607#n90q8j_105"><p><span class="control" id="-1647977607#n90q8j_109">Separaci&oacute;n de Responsabilidades</span>: Separa la l&oacute;gica de invocaci&oacute;n de m&eacute;todos de la implementaci&oacute;n espec&iacute;fica de registro.</p></li><li class="list-item" id="-1647977607#n90q8j_106"><p><span class="control" id="-1647977607#n90q8j_110">Reutilizaci&oacute;n</span>: La estructura com&uacute;n puede ser reutilizada por m&uacute;ltiples adaptadores.</p></li></ol></section><section><h3 id="-1647977607#desaf-os" data-toc="desaf-os#EventLogManagerFoundationAdapter.md-desaf-os">Desaf&iacute;os</h3><ol class="list list-decimal" id="-1647977607#n90q8j_111" type="1" start="1"><li class="list-item" id="-1647977607#n90q8j_112"><p><span class="control" id="-1647977607#n90q8j_115">Complejidad</span>: Introduce una capa adicional de abstracci&oacute;n.</p></li><li class="list-item" id="-1647977607#n90q8j_113"><p><span class="control" id="-1647977607#n90q8j_116">Mantenimiento</span>: Requiere mantener la coherencia entre diferentes implementaciones.</p></li><li class="list-item" id="-1647977607#n90q8j_114"><p><span class="control" id="-1647977607#n90q8j_117">Rendimiento</span>: Puede tener un impacto en el rendimiento debido a la abstracci&oacute;n adicional.</p></li></ol></section></section><section><h2 id="-1647977607#mejores-pr-cticas" data-toc="mejores-pr-cticas#EventLogManagerFoundationAdapter.md-mejores-pr-cticas">Mejores Pr&aacute;cticas</h2><ol class="list list-decimal" id="-1647977607#n90q8j_118" type="1" start="1"><li class="list-item" id="-1647977607#n90q8j_119"><p><span class="control" id="-1647977607#n90q8j_124">Documentaci&oacute;n Clara</span>: Documentar claramente la estructura esperada de los mapas de entrada, salida y opciones para cada implementaci&oacute;n.</p></li><li class="list-item" id="-1647977607#n90q8j_120"><p><span class="control" id="-1647977607#n90q8j_125">Manejo de Errores Robusto</span>: Implementar un manejo de errores coherente en todas las implementaciones.</p></li><li class="list-item" id="-1647977607#n90q8j_121"><p><span class="control" id="-1647977607#n90q8j_126">Pruebas Unitarias</span>: Crear pruebas unitarias exhaustivas para cada implementaci&oacute;n concreta.</p></li><li class="list-item" id="-1647977607#n90q8j_122"><p><span class="control" id="-1647977607#n90q8j_127">Uso Consistente</span>: Mantener una estructura consistente para los datos de entrada y salida entre diferentes implementaciones.</p></li><li class="list-item" id="-1647977607#n90q8j_123"><p><span class="control" id="-1647977607#n90q8j_128">Extender seg&uacute;n Necesidades</span>: Considerar extender la funcionalidad a&ntilde;adiendo m&aacute;s m&eacute;todos soportados en <span class="inline-code" id="-1647977607#n90q8j_129">invokeMethod</span> si es necesario.</p></li></ol></section><section><h2 id="-1647977607#notas-adicionales" data-toc="notas-adicionales#EventLogManagerFoundationAdapter.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-1647977607#n90q8j_130" type="1" start="1"><li class="list-item" id="-1647977607#n90q8j_131"><p>La clase utiliza mapas gen&eacute;ricos (<span class="inline-code" id="-1647977607#n90q8j_136">Map&lt;String, Object&gt;</span>) para los datos de entrada, salida y opciones, proporcionando flexibilidad pero requiriendo un cuidado adicional para garantizar la consistencia de los datos.</p></li><li class="list-item" id="-1647977607#n90q8j_132"><p>El uso de <span class="inline-code" id="-1647977607#n90q8j_137">Core.debug</span> para los mensajes de depuraci&oacute;n sugiere que hay una clase utilitaria <span class="inline-code" id="-1647977607#n90q8j_138">Core</span> disponible en el sistema.</p></li><li class="list-item" id="-1647977607#n90q8j_133"><p>La naturaleza abstracta de la clase asegura que solo se pueden crear instancias de subclases concretas.</p></li><li class="list-item" id="-1647977607#n90q8j_134"><p>El modificador <span class="inline-code" id="-1647977607#n90q8j_139">global</span> indica que la clase est&aacute; dise&ntilde;ada para ser accesible desde diferentes paquetes o namespaces.</p></li><li class="list-item" id="-1647977607#n90q8j_135"><p>Actualmente, el m&eacute;todo <span class="inline-code" id="-1647977607#n90q8j_140">invokeMethod</span> solo soporta 'APPLYEVENTLOG', pero el dise&ntilde;o permite a&ntilde;adir f&aacute;cilmente soporte para m&aacute;s m&eacute;todos en el futuro.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1679465955">EventLogManager</h1><section><h2 id="1679465955#descripci-n-general" data-toc="descripci-n-general#EventLogManager.md-descripci-n-general">Descripci&oacute;n General</h2><p id="1679465955#-8i0r2d_15"><span class="inline-code" id="1679465955#-8i0r2d_16">EventLogManager</span> es una clase global con sharing que proporciona funcionalidad completa para la gesti&oacute;n de registros de eventos en el sistema. Esta clase maneja tanto Big Objects (<span class="inline-code" id="1679465955#-8i0r2d_17">EventLog__b</span>) como objetos personalizados est&aacute;ndar (<span class="inline-code" id="1679465955#-8i0r2d_18">EventLog_Subset__c</span>), ofreciendo capacidades de consulta, guardado, an&aacute;lisis y limpieza de logs de eventos.</p></section><section><h2 id="1679465955#autor" data-toc="autor#EventLogManager.md-autor">Autor</h2><p id="1679465955#-8i0r2d_19">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="1679465955#ltima-modificaci-n" data-toc="ltima-modificaci-n#EventLogManager.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="1679465955#-8i0r2d_20">17 de marzo de 2025 por Esneyder Zabala</p></section><section><h2 id="1679465955#estructura-de-la-clase" data-toc="estructura-de-la-clase#EventLogManager.md-estructura-de-la-clase">Estructura de la Clase</h2><div class="detached code-block" id="1679465955#-8i0r2d_21"><pre><code class="language-none">global with sharing class EventLogManager {
  public static List&lt;EventLog__b&gt; fetchAll(Datetime startAt, Datetime endAt);
  public static Boolean save(List&lt;Object&gt; inputMapList);
  @future(callout=true) global static void saveAsync(String serializeInputMapList);
  public static Boolean refreshAnalytics(Datetime startAt, Datetime endAt, Boolean reset);
  @future public static void refreshAnalyticsAsync(Datetime startAt, Datetime endAt, Boolean reset);
  public static Boolean clearAnalytics();
  @future public static void clearLogsAsync();
}</code></pre></div></section><section><h2 id="1679465955#m-todos" data-toc="m-todos#EventLogManager.md-m-todos">M&eacute;todos</h2><section><h3 id="1679465955#fetchall-datetime-startat-datetime-endat" data-toc="fetchall-datetime-startat-datetime-endat#EventLogManager.md-fetchall-datetime-startat-datetime-endat">fetchAll(Datetime startAt, Datetime endAt)</h3><section><h4 id="1679465955#descripci-n" data-toc="descripci-n#EventLogManager.md-descripci-n">Descripci&oacute;n</h4><p id="1679465955#-8i0r2d_36">Recupera registros de eventos del Big Object <span class="inline-code" id="1679465955#-8i0r2d_37">EventLog__b</span> dentro de un rango de fechas espec&iacute;fico. Incluye soporte para testing a trav&eacute;s de mocks.</p></section><section><h4 id="1679465955#par-metros" data-toc="par-metros#EventLogManager.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1679465955#-8i0r2d_38" start="1"><li class="list-item" id="1679465955#-8i0r2d_39"><p><span class="inline-code" id="1679465955#-8i0r2d_41">startAt</span> (Datetime): Fecha y hora de inicio del rango de consulta.</p></li><li class="list-item" id="1679465955#-8i0r2d_40"><p><span class="inline-code" id="1679465955#-8i0r2d_42">endAt</span> (Datetime): Fecha y hora de fin del rango de consulta.</p></li></ul></section><section><h4 id="1679465955#retorno" data-toc="retorno#EventLogManager.md-retorno">Retorno</h4><ul class="list" id="1679465955#-8i0r2d_43" start="1"><li class="list-item" id="1679465955#-8i0r2d_44"><p><span class="inline-code" id="1679465955#-8i0r2d_45">List&lt;EventLog__b&gt;</span>: Lista de registros de eventos encontrados en el rango especificado.</p></li></ul></section><section><h4 id="1679465955#proceso" data-toc="proceso#EventLogManager.md-proceso">Proceso</h4><ol class="list list-decimal" id="1679465955#-8i0r2d_46" type="1" start="1"><li class="list-item" id="1679465955#-8i0r2d_47"><p>Registra informaci&oacute;n de depuraci&oacute;n sobre el rango de consulta.</p></li><li class="list-item" id="1679465955#-8i0r2d_48"><p>Ejecuta una consulta SOQL al Big Object <span class="inline-code" id="1679465955#-8i0r2d_52">EventLog__b</span> con l&iacute;mite de 50,000 registros.</p></li><li class="list-item" id="1679465955#-8i0r2d_49"><p>Registra el n&uacute;mero de registros encontrados.</p></li><li class="list-item" id="1679465955#-8i0r2d_50"><p>Si se ejecuta en contexto de prueba, devuelve datos mock.</p></li><li class="list-item" id="1679465955#-8i0r2d_51"><p>Retorna los registros encontrados.</p></li></ol></section><section><h4 id="1679465955#c-digo" data-toc="c-digo#EventLogManager.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1679465955#-8i0r2d_53"><pre><code class="language-none">public static List&lt;EventLog__b&gt; fetchAll(Datetime startAt, Datetime endAt) {
  Core.debug('Querying Event Logs from ' + startAt + ' to ' + endAt);
  List&lt;EventLog__b&gt; records = [
    SELECT
      Id,
      Date__c,
      Product__c,
      Level__c,
      Platform__c,
      Process__c,
      Details__c,
      Data__c,
      Type__c,
      UserId__c
    FROM EventLog__b
    WHERE Date__c &gt;= :startAt AND Date__c &lt;= :endAt
    LIMIT 50000
  ];
  Core.debug('Found ' + records.size() + ' records on the specified range...');

  if (Test.isRunningTest()) {
    return EventLogManagerMock.getMockLogs();
  }

  return records;
}</code></pre></div></section></section><section><h3 id="1679465955#save-list-object-inputmaplist" data-toc="save-list-object-inputmaplist#EventLogManager.md-save-list-object-inputmaplist">save(List&lt;Object&gt; inputMapList)</h3><section><h4 id="1679465955#descripci-n" data-toc="descripci-n#EventLogManager.md-descripci-n">Descripci&oacute;n</h4><p id="1679465955#-8i0r2d_61">Guarda una lista de registros de eventos tanto en el Big Object <span class="inline-code" id="1679465955#-8i0r2d_62">EventLog__b</span> como en el objeto personalizado <span class="inline-code" id="1679465955#-8i0r2d_63">EventLog_Subset__c</span>. Incluye validaci&oacute;n de campos obligatorios y procesamiento por lotes.</p></section><section><h4 id="1679465955#par-metros" data-toc="par-metros#EventLogManager.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1679465955#-8i0r2d_64" start="1"><li class="list-item" id="1679465955#-8i0r2d_65"><p><span class="inline-code" id="1679465955#-8i0r2d_66">inputMapList</span> (List</p><p>): Lista de mapas que contienen los datos de eventos a guardar.</p></li></ul></section><section><h4 id="1679465955#retorno" data-toc="retorno#EventLogManager.md-retorno">Retorno</h4><ul class="list" id="1679465955#-8i0r2d_68" start="1"><li class="list-item" id="1679465955#-8i0r2d_69"><p><span class="inline-code" id="1679465955#-8i0r2d_70">Boolean</span>: <span class="inline-code" id="1679465955#-8i0r2d_71">true</span> si el guardado fue exitoso, <span class="inline-code" id="1679465955#-8i0r2d_72">false</span> en caso de error.</p></li></ul></section><section><h4 id="1679465955#proceso" data-toc="proceso#EventLogManager.md-proceso">Proceso</h4><ol class="list list-decimal" id="1679465955#-8i0r2d_73" type="1" start="1"><li class="list-item" id="1679465955#-8i0r2d_74"><p>Verifica si la feature flag 'sura_foundation_event_logs' est&aacute; habilitada.</p></li><li class="list-item" id="1679465955#-8i0r2d_75"><p>Itera sobre la lista de mapas de entrada.</p></li><li class="list-item" id="1679465955#-8i0r2d_76"><p>Valida que cada mapa contenga los campos obligatorios (Level, Type, Product).</p></li><li class="list-item" id="1679465955#-8i0r2d_77"><p>Crea registros para ambos objetos: <span class="inline-code" id="1679465955#-8i0r2d_81">EventLog__b</span> y <span class="inline-code" id="1679465955#-8i0r2d_82">EventLog_Subset__c</span>.</p></li><li class="list-item" id="1679465955#-8i0r2d_78"><p>Procesa en lotes de 200 registros para optimizar el rendimiento.</p></li><li class="list-item" id="1679465955#-8i0r2d_79"><p>Ejecuta las operaciones de inserci&oacute;n correspondientes.</p></li><li class="list-item" id="1679465955#-8i0r2d_80"><p>Maneja excepciones y retorna el resultado.</p></li></ol></section><section><h4 id="1679465955#campos-procesados" data-toc="campos-procesados#EventLogManager.md-campos-procesados">Campos Procesados</h4><ul class="list" id="1679465955#-8i0r2d_83" start="1"><li class="list-item" id="1679465955#-8i0r2d_84"><p><span class="control" id="1679465955#-8i0r2d_94">Date__c</span>: Fecha y hora actual</p></li><li class="list-item" id="1679465955#-8i0r2d_85"><p><span class="control" id="1679465955#-8i0r2d_95">Product__c</span>: Producto (obligatorio)</p></li><li class="list-item" id="1679465955#-8i0r2d_86"><p><span class="control" id="1679465955#-8i0r2d_96">Level__c</span>: Nivel del evento (obligatorio)</p></li><li class="list-item" id="1679465955#-8i0r2d_87"><p><span class="control" id="1679465955#-8i0r2d_97">Platform__c</span>: Plataforma de origen</p></li><li class="list-item" id="1679465955#-8i0r2d_88"><p><span class="control" id="1679465955#-8i0r2d_98">Process__c</span>: Proceso relacionado</p></li><li class="list-item" id="1679465955#-8i0r2d_89"><p><span class="control" id="1679465955#-8i0r2d_99">Details__c</span>: Detalles del evento</p></li><li class="list-item" id="1679465955#-8i0r2d_90"><p><span class="control" id="1679465955#-8i0r2d_100">Data__c</span>: Datos adicionales</p></li><li class="list-item" id="1679465955#-8i0r2d_91"><p><span class="control" id="1679465955#-8i0r2d_101">Type__c</span>: Tipo de evento (obligatorio)</p></li><li class="list-item" id="1679465955#-8i0r2d_92"><p><span class="control" id="1679465955#-8i0r2d_102">UserId__c</span>: ID del usuario</p></li><li class="list-item" id="1679465955#-8i0r2d_93"><p><span class="control" id="1679465955#-8i0r2d_103">Response__c</span>: Respuesta del evento</p></li></ul></section></section><section><h3 id="1679465955#saveasync-string-serializeinputmaplist" data-toc="saveasync-string-serializeinputmaplist#EventLogManager.md-saveasync-string-serializeinputmaplist">saveAsync(String serializeInputMapList)</h3><section><h4 id="1679465955#descripci-n" data-toc="descripci-n#EventLogManager.md-descripci-n">Descripci&oacute;n</h4><p id="1679465955#-8i0r2d_111">Versi&oacute;n as&iacute;ncrona del m&eacute;todo <span class="inline-code" id="1679465955#-8i0r2d_112">save</span> que utiliza el decorador <span class="inline-code" id="1679465955#-8i0r2d_113">@future(callout=true)</span> para procesar el guardado de eventos de forma as&iacute;ncrona.</p></section><section><h4 id="1679465955#par-metros" data-toc="par-metros#EventLogManager.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1679465955#-8i0r2d_114" start="1"><li class="list-item" id="1679465955#-8i0r2d_115"><p><span class="inline-code" id="1679465955#-8i0r2d_116">serializeInputMapList</span> (String): Lista de mapas serializada en JSON que contiene los datos de eventos a guardar.</p></li></ul></section><section><h4 id="1679465955#retorno" data-toc="retorno#EventLogManager.md-retorno">Retorno</h4><ul class="list" id="1679465955#-8i0r2d_117" start="1"><li class="list-item" id="1679465955#-8i0r2d_118"><p><span class="inline-code" id="1679465955#-8i0r2d_119">void</span>: Al ser un m&eacute;todo future, no devuelve valor.</p></li></ul></section><section><h4 id="1679465955#proceso" data-toc="proceso#EventLogManager.md-proceso">Proceso</h4><ol class="list list-decimal" id="1679465955#-8i0r2d_120" type="1" start="1"><li class="list-item" id="1679465955#-8i0r2d_121"><p>Deserializa la cadena JSON a una lista de objetos.</p></li><li class="list-item" id="1679465955#-8i0r2d_122"><p>Llama al m&eacute;todo <span class="inline-code" id="1679465955#-8i0r2d_123">save</span> con la lista deserializada.</p></li></ol></section><section><h4 id="1679465955#c-digo" data-toc="c-digo#EventLogManager.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="1679465955#-8i0r2d_124"><pre><code class="language-none">@future(callout=true)
global static void saveAsync(String serializeInputMapList) {
  List&lt;Object&gt; inputMapList = (List&lt;Object&gt;) JSON.deserializeUntyped(
    serializeInputMapList
  );
  EventLogManager.save(inputMapList);
}</code></pre></div></section></section><section><h3 id="1679465955#refreshanalytics-datetime-startat-datetime-endat-boolean-reset" data-toc="refreshanalytics-datetime-startat-datetime-endat-boolean-reset#EventLogManager.md-refreshanalytics-datetime-startat-datetime-endat-boolean-reset">refreshAnalytics(Datetime startAt, Datetime endAt, Boolean reset)</h3><section><h4 id="1679465955#descripci-n" data-toc="descripci-n#EventLogManager.md-descripci-n">Descripci&oacute;n</h4><p id="1679465955#-8i0r2d_131">Actualiza los datos anal&iacute;ticos poblando el objeto <span class="inline-code" id="1679465955#-8i0r2d_132">EventLog_Subset__c</span> con datos del Big Object <span class="inline-code" id="1679465955#-8i0r2d_133">EventLog__b</span> dentro de un rango de fechas espec&iacute;fico.</p></section><section><h4 id="1679465955#par-metros" data-toc="par-metros#EventLogManager.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1679465955#-8i0r2d_134" start="1"><li class="list-item" id="1679465955#-8i0r2d_135"><p><span class="inline-code" id="1679465955#-8i0r2d_138">startAt</span> (Datetime): Fecha de inicio del rango para el an&aacute;lisis.</p></li><li class="list-item" id="1679465955#-8i0r2d_136"><p><span class="inline-code" id="1679465955#-8i0r2d_139">endAt</span> (Datetime): Fecha de fin del rango para el an&aacute;lisis.</p></li><li class="list-item" id="1679465955#-8i0r2d_137"><p><span class="inline-code" id="1679465955#-8i0r2d_140">reset</span> (Boolean): Indica si se deben limpiar los datos anal&iacute;ticos existentes antes de la actualizaci&oacute;n.</p></li></ul></section><section><h4 id="1679465955#retorno" data-toc="retorno#EventLogManager.md-retorno">Retorno</h4><ul class="list" id="1679465955#-8i0r2d_141" start="1"><li class="list-item" id="1679465955#-8i0r2d_142"><p><span class="inline-code" id="1679465955#-8i0r2d_143">Boolean</span>: <span class="inline-code" id="1679465955#-8i0r2d_144">true</span> si la actualizaci&oacute;n fue exitosa.</p></li></ul></section><section><h4 id="1679465955#proceso" data-toc="proceso#EventLogManager.md-proceso">Proceso</h4><ol class="list list-decimal" id="1679465955#-8i0r2d_145" type="1" start="1"><li class="list-item" id="1679465955#-8i0r2d_146"><p>Si <span class="inline-code" id="1679465955#-8i0r2d_150">reset</span> es true, limpia los datos anal&iacute;ticos existentes.</p></li><li class="list-item" id="1679465955#-8i0r2d_147"><p>Consulta eventos del Big Object usando <span class="inline-code" id="1679465955#-8i0r2d_151">fetchAll</span>.</p></li><li class="list-item" id="1679465955#-8i0r2d_148"><p>Crea registros correspondientes en <span class="inline-code" id="1679465955#-8i0r2d_152">EventLog_Subset__c</span>.</p></li><li class="list-item" id="1679465955#-8i0r2d_149"><p>Inserta los registros del subset si no se est&aacute; ejecutando en pruebas.</p></li></ol></section></section><section><h3 id="1679465955#refreshanalyticsasync-datetime-startat-datetime-endat-boolean-reset" data-toc="refreshanalyticsasync-datetime-startat-datetime-endat-boolean-reset#EventLogManager.md-refreshanalyticsasync-datetime-startat-datetime-endat-boolean-reset">refreshAnalyticsAsync(Datetime startAt, Datetime endAt, Boolean reset)</h3><section><h4 id="1679465955#descripci-n" data-toc="descripci-n#EventLogManager.md-descripci-n">Descripci&oacute;n</h4><p id="1679465955#-8i0r2d_158">Versi&oacute;n as&iacute;ncrona del m&eacute;todo <span class="inline-code" id="1679465955#-8i0r2d_159">refreshAnalytics</span> que utiliza el decorador <span class="inline-code" id="1679465955#-8i0r2d_160">@future</span>.</p></section><section><h4 id="1679465955#par-metros" data-toc="par-metros#EventLogManager.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1679465955#-8i0r2d_161" start="1"><li class="list-item" id="1679465955#-8i0r2d_162"><p><span class="inline-code" id="1679465955#-8i0r2d_165">startAt</span> (Datetime): Fecha de inicio del rango.</p></li><li class="list-item" id="1679465955#-8i0r2d_163"><p><span class="inline-code" id="1679465955#-8i0r2d_166">endAt</span> (Datetime): Fecha de fin del rango.</p></li><li class="list-item" id="1679465955#-8i0r2d_164"><p><span class="inline-code" id="1679465955#-8i0r2d_167">reset</span> (Boolean): Indica si se deben limpiar los datos existentes.</p></li></ul></section><section><h4 id="1679465955#retorno" data-toc="retorno#EventLogManager.md-retorno">Retorno</h4><ul class="list" id="1679465955#-8i0r2d_168" start="1"><li class="list-item" id="1679465955#-8i0r2d_169"><p><span class="inline-code" id="1679465955#-8i0r2d_170">void</span>: Al ser un m&eacute;todo future, no devuelve valor.</p></li></ul></section></section><section><h3 id="1679465955#clearanalytics" data-toc="clearanalytics#EventLogManager.md-clearanalytics">clearAnalytics()</h3><section><h4 id="1679465955#descripci-n" data-toc="descripci-n#EventLogManager.md-descripci-n">Descripci&oacute;n</h4><p id="1679465955#-8i0r2d_177">Elimina todos los registros del objeto <span class="inline-code" id="1679465955#-8i0r2d_178">EventLog_Subset__c</span> para limpiar los datos anal&iacute;ticos.</p></section><section><h4 id="1679465955#par-metros" data-toc="par-metros#EventLogManager.md-par-metros">Par&aacute;metros</h4><p id="1679465955#-8i0r2d_179">Ninguno.</p></section><section><h4 id="1679465955#retorno" data-toc="retorno#EventLogManager.md-retorno">Retorno</h4><ul class="list" id="1679465955#-8i0r2d_180" start="1"><li class="list-item" id="1679465955#-8i0r2d_181"><p><span class="inline-code" id="1679465955#-8i0r2d_182">Boolean</span>: <span class="inline-code" id="1679465955#-8i0r2d_183">true</span> si la limpieza fue exitosa, <span class="inline-code" id="1679465955#-8i0r2d_184">false</span> en caso de error.</p></li></ul></section><section><h4 id="1679465955#proceso" data-toc="proceso#EventLogManager.md-proceso">Proceso</h4><ol class="list list-decimal" id="1679465955#-8i0r2d_185" type="1" start="1"><li class="list-item" id="1679465955#-8i0r2d_186"><p>Consulta hasta 50,000 registros de <span class="inline-code" id="1679465955#-8i0r2d_189">EventLog_Subset__c</span>.</p></li><li class="list-item" id="1679465955#-8i0r2d_187"><p>Si existen registros, los elimina.</p></li><li class="list-item" id="1679465955#-8i0r2d_188"><p>Maneja excepciones y retorna el resultado.</p></li></ol></section></section><section><h3 id="1679465955#clearlogsasync" data-toc="clearlogsasync#EventLogManager.md-clearlogsasync">clearLogsAsync()</h3><section><h4 id="1679465955#descripci-n" data-toc="descripci-n#EventLogManager.md-descripci-n">Descripci&oacute;n</h4><p id="1679465955#-8i0r2d_196">M&eacute;todo as&iacute;ncrono que elimina registros del Big Object <span class="inline-code" id="1679465955#-8i0r2d_197">EventLog__b</span> para limpiar logs antiguos.</p></section><section><h4 id="1679465955#par-metros" data-toc="par-metros#EventLogManager.md-par-metros">Par&aacute;metros</h4><p id="1679465955#-8i0r2d_198">Ninguno.</p></section><section><h4 id="1679465955#retorno" data-toc="retorno#EventLogManager.md-retorno">Retorno</h4><ul class="list" id="1679465955#-8i0r2d_199" start="1"><li class="list-item" id="1679465955#-8i0r2d_200"><p><span class="inline-code" id="1679465955#-8i0r2d_201">void</span>: Al ser un m&eacute;todo future, no devuelve valor.</p></li></ul></section><section><h4 id="1679465955#proceso" data-toc="proceso#EventLogManager.md-proceso">Proceso</h4><ol class="list list-decimal" id="1679465955#-8i0r2d_202" type="1" start="1"><li class="list-item" id="1679465955#-8i0r2d_203"><p>Consulta hasta 5,000 registros de <span class="inline-code" id="1679465955#-8i0r2d_206">EventLog__b</span>.</p></li><li class="list-item" id="1679465955#-8i0r2d_204"><p>Si existen registros, los elimina usando <span class="inline-code" id="1679465955#-8i0r2d_207">Database.deleteImmediate</span>.</p></li><li class="list-item" id="1679465955#-8i0r2d_205"><p>Maneja excepciones internamente.</p></li></ol></section></section></section><section><h2 id="1679465955#dependencias" data-toc="dependencias#EventLogManager.md-dependencias">Dependencias</h2><ul class="list" id="1679465955#-8i0r2d_208" start="1"><li class="list-item" id="1679465955#-8i0r2d_209"><p><span class="control" id="1679465955#-8i0r2d_214"><span class="inline-code" id="1679465955#-8i0r2d_215">EventLog__b</span></span>: Big Object que almacena los registros de eventos principales.</p></li><li class="list-item" id="1679465955#-8i0r2d_210"><p><span class="control" id="1679465955#-8i0r2d_216"><span class="inline-code" id="1679465955#-8i0r2d_217">EventLog_Subset__c</span></span>: Objeto personalizado que almacena un subconjunto de eventos para an&aacute;lisis.</p></li><li class="list-item" id="1679465955#-8i0r2d_211"><p><span class="control" id="1679465955#-8i0r2d_218"><span class="inline-code" id="1679465955#-8i0r2d_219">FeatureFlags</span></span>: Clase que maneja feature flags para controlar la funcionalidad.</p></li><li class="list-item" id="1679465955#-8i0r2d_212"><p><span class="control" id="1679465955#-8i0r2d_220"><span class="inline-code" id="1679465955#-8i0r2d_221">Core</span></span>: Clase utilitaria para registro de depuraci&oacute;n.</p></li><li class="list-item" id="1679465955#-8i0r2d_213"><p><span class="control" id="1679465955#-8i0r2d_222"><span class="inline-code" id="1679465955#-8i0r2d_223">EventLogManagerMock</span></span>: Clase mock para proporcionar datos de prueba.</p></li></ul></section><section><h2 id="1679465955#arquitectura-de-datos" data-toc="arquitectura-de-datos#EventLogManager.md-arquitectura-de-datos">Arquitectura de Datos</h2><section><h3 id="1679465955#eventlog-b-big-object" data-toc="eventlog-b-big-object#EventLogManager.md-eventlog-b-big-object">EventLog__b (Big Object)</h3><p id="1679465955#-8i0r2d_226">Big Object optimizado para grandes vol&uacute;menes de datos de eventos:</p><div class="table-wrapper detached"><table id="1679465955#-8i0r2d_227"><tr class="header-row" id="1679465955#-8i0r2d_228"><th id="1679465955#-8i0r2d_240"><p>Campo</p></th><th id="1679465955#-8i0r2d_241"><p>Tipo</p></th><th id="1679465955#-8i0r2d_242"><p>Descripci&oacute;n</p></th></tr><tr class="" id="1679465955#-8i0r2d_229"><td id="1679465955#-8i0r2d_243"><p>Id</p></td><td id="1679465955#-8i0r2d_244"><p>Text</p></td><td id="1679465955#-8i0r2d_245"><p>Identificador &uacute;nico</p></td></tr><tr class="" id="1679465955#-8i0r2d_230"><td id="1679465955#-8i0r2d_246"><p>Date__c</p></td><td id="1679465955#-8i0r2d_247"><p>DateTime</p></td><td id="1679465955#-8i0r2d_248"><p>Fecha y hora del evento</p></td></tr><tr class="" id="1679465955#-8i0r2d_231"><td id="1679465955#-8i0r2d_249"><p>Product__c</p></td><td id="1679465955#-8i0r2d_250"><p>Text</p></td><td id="1679465955#-8i0r2d_251"><p>Producto relacionado</p></td></tr><tr class="" id="1679465955#-8i0r2d_232"><td id="1679465955#-8i0r2d_252"><p>Level__c</p></td><td id="1679465955#-8i0r2d_253"><p>Text</p></td><td id="1679465955#-8i0r2d_254"><p>Nivel del evento (Info, Warning, Error, etc.)</p></td></tr><tr class="" id="1679465955#-8i0r2d_233"><td id="1679465955#-8i0r2d_255"><p>Platform__c</p></td><td id="1679465955#-8i0r2d_256"><p>Text</p></td><td id="1679465955#-8i0r2d_257"><p>Plataforma de origen</p></td></tr><tr class="" id="1679465955#-8i0r2d_234"><td id="1679465955#-8i0r2d_258"><p>Process__c</p></td><td id="1679465955#-8i0r2d_259"><p>Text</p></td><td id="1679465955#-8i0r2d_260"><p>Proceso que gener&oacute; el evento</p></td></tr><tr class="" id="1679465955#-8i0r2d_235"><td id="1679465955#-8i0r2d_261"><p>Details__c</p></td><td id="1679465955#-8i0r2d_262"><p>LongTextArea</p></td><td id="1679465955#-8i0r2d_263"><p>Detalles del evento</p></td></tr><tr class="" id="1679465955#-8i0r2d_236"><td id="1679465955#-8i0r2d_264"><p>Data__c</p></td><td id="1679465955#-8i0r2d_265"><p>LongTextArea</p></td><td id="1679465955#-8i0r2d_266"><p>Datos adicionales</p></td></tr><tr class="" id="1679465955#-8i0r2d_237"><td id="1679465955#-8i0r2d_267"><p>Type__c</p></td><td id="1679465955#-8i0r2d_268"><p>Text</p></td><td id="1679465955#-8i0r2d_269"><p>Tipo de evento</p></td></tr><tr class="" id="1679465955#-8i0r2d_238"><td id="1679465955#-8i0r2d_270"><p>UserId__c</p></td><td id="1679465955#-8i0r2d_271"><p>Text</p></td><td id="1679465955#-8i0r2d_272"><p>ID del usuario</p></td></tr><tr class="" id="1679465955#-8i0r2d_239"><td id="1679465955#-8i0r2d_273"><p>Response__c</p></td><td id="1679465955#-8i0r2d_274"><p>LongTextArea</p></td><td id="1679465955#-8i0r2d_275"><p>Respuesta del evento</p></td></tr></table></div></section><section><h3 id="1679465955#eventlog-subset-c-objeto-personalizado" data-toc="eventlog-subset-c-objeto-personalizado#EventLogManager.md-eventlog-subset-c-objeto-personalizado">EventLog_Subset__c (Objeto Personalizado)</h3><p id="1679465955#-8i0r2d_276">Objeto est&aacute;ndar para an&aacute;lisis y reportes:</p><div class="table-wrapper detached"><table id="1679465955#-8i0r2d_277"><tr class="header-row" id="1679465955#-8i0r2d_278"><th id="1679465955#-8i0r2d_289"><p>Campo</p></th><th id="1679465955#-8i0r2d_290"><p>Tipo</p></th><th id="1679465955#-8i0r2d_291"><p>Descripci&oacute;n</p></th></tr><tr class="" id="1679465955#-8i0r2d_279"><td id="1679465955#-8i0r2d_292"><p>Name</p></td><td id="1679465955#-8i0r2d_293"><p>Text</p></td><td id="1679465955#-8i0r2d_294"><p>Nombre del registro</p></td></tr><tr class="" id="1679465955#-8i0r2d_280"><td id="1679465955#-8i0r2d_295"><p>Date__c</p></td><td id="1679465955#-8i0r2d_296"><p>DateTime</p></td><td id="1679465955#-8i0r2d_297"><p>Fecha y hora del evento</p></td></tr><tr class="" id="1679465955#-8i0r2d_281"><td id="1679465955#-8i0r2d_298"><p>Product__c</p></td><td id="1679465955#-8i0r2d_299"><p>Text</p></td><td id="1679465955#-8i0r2d_300"><p>Producto relacionado</p></td></tr><tr class="" id="1679465955#-8i0r2d_282"><td id="1679465955#-8i0r2d_301"><p>Level__c</p></td><td id="1679465955#-8i0r2d_302"><p>Text</p></td><td id="1679465955#-8i0r2d_303"><p>Nivel del evento</p></td></tr><tr class="" id="1679465955#-8i0r2d_283"><td id="1679465955#-8i0r2d_304"><p>Platform__c</p></td><td id="1679465955#-8i0r2d_305"><p>Text</p></td><td id="1679465955#-8i0r2d_306"><p>Plataforma de origen</p></td></tr><tr class="" id="1679465955#-8i0r2d_284"><td id="1679465955#-8i0r2d_307"><p>Process__c</p></td><td id="1679465955#-8i0r2d_308"><p>Text</p></td><td id="1679465955#-8i0r2d_309"><p>Proceso que gener&oacute; el evento</p></td></tr><tr class="" id="1679465955#-8i0r2d_285"><td id="1679465955#-8i0r2d_310"><p>Details__c</p></td><td id="1679465955#-8i0r2d_311"><p>LongTextArea</p></td><td id="1679465955#-8i0r2d_312"><p>Detalles del evento</p></td></tr><tr class="" id="1679465955#-8i0r2d_286"><td id="1679465955#-8i0r2d_313"><p>Type__c</p></td><td id="1679465955#-8i0r2d_314"><p>Text</p></td><td id="1679465955#-8i0r2d_315"><p>Tipo de evento</p></td></tr><tr class="" id="1679465955#-8i0r2d_287"><td id="1679465955#-8i0r2d_316"><p>Response__c</p></td><td id="1679465955#-8i0r2d_317"><p>LongTextArea</p></td><td id="1679465955#-8i0r2d_318"><p>Respuesta del evento</p></td></tr><tr class="" id="1679465955#-8i0r2d_288"><td id="1679465955#-8i0r2d_319"><p>Data__c</p></td><td id="1679465955#-8i0r2d_320"><p>LongTextArea</p></td><td id="1679465955#-8i0r2d_321"><p>Datos adicionales</p></td></tr></table></div></section></section><section><h2 id="1679465955#ejemplos-de-uso" data-toc="ejemplos-de-uso#EventLogManager.md-ejemplos-de-uso">Ejemplos de Uso</h2><section><h3 id="1679465955#ejemplo-1-guardar-eventos-de-forma-s-ncrona" data-toc="ejemplo-1-guardar-eventos-de-forma-s-ncrona#EventLogManager.md-ejemplo-1-guardar-eventos-de-forma-s-ncrona">Ejemplo 1: Guardar Eventos de Forma S&iacute;ncrona</h3><div class="detached code-block" id="1679465955#-8i0r2d_326"><pre><code class="language-none">public class EventLogger {
    
    public static void logUserActivity(String userId, String activity, String details) {
        List&lt;Object&gt; events = new List&lt;Object&gt;();
        
        Map&lt;String, Object&gt; eventData = new Map&lt;String, Object&gt;{
            'Level' =&gt; 'Info',
            'Type' =&gt; 'USER_ACTIVITY',
            'Product' =&gt; 'CRM',
            'Platform' =&gt; 'Salesforce',
            'Process' =&gt; 'User Management',
            'Details' =&gt; details,
            'UserId' =&gt; userId,
            'Data' =&gt; JSON.serialize(new Map&lt;String, Object&gt;{
                'activity' =&gt; activity,
                'timestamp' =&gt; System.now(),
                'sessionId' =&gt; UserInfo.getSessionId()
            })
        };
        
        events.add(eventData);
        
        Boolean success = EventLogManager.save(events);
        
        if (success) {
            System.debug('Evento de actividad de usuario registrado exitosamente');
        } else {
            System.debug('Error al registrar evento de actividad de usuario');
        }
    }
}

// Uso
EventLogger.logUserActivity(UserInfo.getUserId(), 'LOGIN', 'Usuario inició sesión exitosamente');</code></pre></div></section><section><h3 id="1679465955#ejemplo-2-guardar-m-ltiples-eventos-asincr-nicamente" data-toc="ejemplo-2-guardar-m-ltiples-eventos-asincr-nicamente#EventLogManager.md-ejemplo-2-guardar-m-ltiples-eventos-asincr-nicamente">Ejemplo 2: Guardar M&uacute;ltiples Eventos Asincr&oacute;nicamente</h3><div class="detached code-block" id="1679465955#-8i0r2d_327"><pre><code class="language-none">public class BatchEventLogger {
    
    public static void logIntegrationEvents(List&lt;Map&lt;String, Object&gt;&gt; integrationResults) {
        List&lt;Object&gt; events = new List&lt;Object&gt;();
        
        for (Map&lt;String, Object&gt; result : integrationResults) {
            String level = (Boolean) result.get('success') ? 'Info' : 'Error';
            
            Map&lt;String, Object&gt; eventData = new Map&lt;String, Object&gt;{
                'Level' =&gt; level,
                'Type' =&gt; 'INTEGRATION',
                'Product' =&gt; (String) result.get('product'),
                'Platform' =&gt; 'External API',
                'Process' =&gt; 'Data Integration',
                'Details' =&gt; (String) result.get('message'),
                'UserId' =&gt; UserInfo.getUserId(),
                'Response' =&gt; JSON.serialize(result.get('response')),
                'Data' =&gt; JSON.serialize(new Map&lt;String, Object&gt;{
                    'endpoint' =&gt; result.get('endpoint'),
                    'duration' =&gt; result.get('duration'),
                    'statusCode' =&gt; result.get('statusCode')
                })
            };
            
            events.add(eventData);
        }
        
        // Guardar asincrónicamente
        String serializedEvents = JSON.serialize(events);
        EventLogManager.saveAsync(serializedEvents);
        
        System.debug('Enviados ' + events.size() + ' eventos para procesamiento asíncrono');
    }
}

// Uso
List&lt;Map&lt;String, Object&gt;&gt; integrationResults = new List&lt;Map&lt;String, Object&gt;&gt;{
    new Map&lt;String, Object&gt;{
        'success' =&gt; true,
        'product' =&gt; 'Insurance',
        'message' =&gt; 'Póliza creada exitosamente',
        'endpoint' =&gt; '/api/v1/policies',
        'duration' =&gt; 1250,
        'statusCode' =&gt; 200,
        'response' =&gt; new Map&lt;String, Object&gt;{'policyId' =&gt; 'POL-123456'}
    },
    new Map&lt;String, Object&gt;{
        'success' =&gt; false,
        'product' =&gt; 'Insurance',
        'message' =&gt; 'Error al validar datos del cliente',
        'endpoint' =&gt; '/api/v1/customers/validate',
        'duration' =&gt; 500,
        'statusCode' =&gt; 400,
        'response' =&gt; new Map&lt;String, Object&gt;{'error' =&gt; 'Invalid customer data'}
    }
};

BatchEventLogger.logIntegrationEvents(integrationResults);</code></pre></div></section><section><h3 id="1679465955#ejemplo-3-an-lisis-y-consulta-de-eventos" data-toc="ejemplo-3-an-lisis-y-consulta-de-eventos#EventLogManager.md-ejemplo-3-an-lisis-y-consulta-de-eventos">Ejemplo 3: An&aacute;lisis y Consulta de Eventos</h3><div class="detached code-block" id="1679465955#-8i0r2d_328"><pre><code class="language-none">public class EventAnalytics {
    
    public static Map&lt;String, Object&gt; generateDailyReport(Date reportDate) {
        Datetime startOfDay = Datetime.newInstance(reportDate, Time.newInstance(0, 0, 0, 0));
        Datetime endOfDay = Datetime.newInstance(reportDate, Time.newInstance(23, 59, 59, 999));
        
        // Obtener eventos del día
        List&lt;EventLog__b&gt; dailyEvents = EventLogManager.fetchAll(startOfDay, endOfDay);
        
        // Análisis básico
        Map&lt;String, Integer&gt; eventsByLevel = new Map&lt;String, Integer&gt;();
        Map&lt;String, Integer&gt; eventsByProduct = new Map&lt;String, Integer&gt;();
        Map&lt;String, Integer&gt; eventsByType = new Map&lt;String, Integer&gt;();
        
        for (EventLog__b event : dailyEvents) {
            // Contar por nivel
            String level = event.Level__c;
            eventsByLevel.put(level, eventsByLevel.containsKey(level) ? 
                             eventsByLevel.get(level) + 1 : 1);
            
            // Contar por producto
            String product = event.Product__c;
            eventsByProduct.put(product, eventsByProduct.containsKey(product) ? 
                               eventsByProduct.get(product) + 1 : 1);
            
            // Contar por tipo
            String type = event.Type__c;
            eventsByType.put(type, eventsByType.containsKey(type) ? 
                            eventsByType.get(type) + 1 : 1);
        }
        
        return new Map&lt;String, Object&gt;{
            'date' =&gt; reportDate,
            'totalEvents' =&gt; dailyEvents.size(),
            'eventsByLevel' =&gt; eventsByLevel,
            'eventsByProduct' =&gt; eventsByProduct,
            'eventsByType' =&gt; eventsByType,
            'generatedAt' =&gt; System.now()
        };
    }
    
    public static void refreshAnalyticsForPeriod(Date startDate, Date endDate) {
        Datetime startDatetime = Datetime.newInstance(startDate, Time.newInstance(0, 0, 0, 0));
        Datetime endDatetime = Datetime.newInstance(endDate, Time.newInstance(23, 59, 59, 999));
        
        // Refrescar análisis asincrónicamente
        EventLogManager.refreshAnalyticsAsync(startDatetime, endDatetime, true);
        
        System.debug('Actualización de análisis iniciada para el período: ' + 
                    startDate + ' - ' + endDate);
    }
}

// Uso
Map&lt;String, Object&gt; dailyReport = EventAnalytics.generateDailyReport(Date.today());
System.debug('Reporte diario: ' + JSON.serializePretty(dailyReport));

// Refrescar análisis para la última semana
Date lastWeek = Date.today().addDays(-7);
EventAnalytics.refreshAnalyticsForPeriod(lastWeek, Date.today());</code></pre></div></section><section><h3 id="1679465955#ejemplo-4-mantenimiento-y-limpieza-de-logs" data-toc="ejemplo-4-mantenimiento-y-limpieza-de-logs#EventLogManager.md-ejemplo-4-mantenimiento-y-limpieza-de-logs">Ejemplo 4: Mantenimiento y Limpieza de Logs</h3><div class="detached code-block" id="1679465955#-8i0r2d_329"><pre><code class="language-none">public class EventLogMaintenance {
    
    @InvocableMethod(label='Limpiar Logs Antiguos' description='Elimina logs de eventos antiguos')
    public static void cleanupOldLogs() {
        // Limpiar logs del Big Object asincrónicamente
        EventLogManager.clearLogsAsync();
        
        System.debug('Proceso de limpieza de logs iniciado');
    }
    
    public static void scheduleAnalyticsRefresh() {
        // Refrescar análisis para los últimos 30 días
        Datetime thirtyDaysAgo = Datetime.now().addDays(-30);
        Datetime now = Datetime.now();
        
        EventLogManager.refreshAnalyticsAsync(thirtyDaysAgo, now, false);
        
        System.debug('Actualización programada de análisis iniciada');
    }
    
    public static void clearAnalyticsData() {
        Boolean success = EventLogManager.clearAnalytics();
        
        if (success) {
            System.debug('Datos analíticos limpiados exitosamente');
        } else {
            System.debug('Error al limpiar datos analíticos');
        }
    }
}

// Programar limpieza semanal
public class EventLogMaintenanceSchedule implements Schedulable {
    public void execute(SchedulableContext sc) {
        EventLogMaintenance.cleanupOldLogs();
        EventLogMaintenance.scheduleAnalyticsRefresh();
    }
}

// Programar la limpieza para ejecutarse cada domingo a las 2 AM
String cronExp = '0 0 2 ? * SUN';
String jobId = System.schedule('Weekly Event Log Cleanup', cronExp, new EventLogMaintenanceSchedule());</code></pre></div></section></section><section><h2 id="1679465955#mejores-pr-cticas-implementadas" data-toc="mejores-pr-cticas-implementadas#EventLogManager.md-mejores-pr-cticas-implementadas">Mejores Pr&aacute;cticas Implementadas</h2><ol class="list list-decimal" id="1679465955#-8i0r2d_330" type="1" start="1"><li class="list-item" id="1679465955#-8i0r2d_331"><p id="1679465955#-8i0r2d_337"><span class="control" id="1679465955#-8i0r2d_338">Procesamiento por Lotes</span>: La clase procesa registros en lotes de 200 para optimizar el rendimiento.</p></li><li class="list-item" id="1679465955#-8i0r2d_332"><p id="1679465955#-8i0r2d_339"><span class="control" id="1679465955#-8i0r2d_340">Validaci&oacute;n de Datos</span>: Valida campos obligatorios antes de procesar los eventos.</p></li><li class="list-item" id="1679465955#-8i0r2d_333"><p id="1679465955#-8i0r2d_341"><span class="control" id="1679465955#-8i0r2d_342">Feature Flags</span>: Utiliza feature flags para controlar la funcionalidad de logging.</p></li><li class="list-item" id="1679465955#-8i0r2d_334"><p id="1679465955#-8i0r2d_343"><span class="control" id="1679465955#-8i0r2d_344">Procesamiento As&iacute;ncrono</span>: Proporciona m&eacute;todos as&iacute;ncronos para operaciones que pueden tomar tiempo.</p></li><li class="list-item" id="1679465955#-8i0r2d_335"><p id="1679465955#-8i0r2d_345"><span class="control" id="1679465955#-8i0r2d_346">Manejo de Excepciones</span>: Incluye manejo robusto de excepciones con logging de errores.</p></li><li class="list-item" id="1679465955#-8i0r2d_336"><p id="1679465955#-8i0r2d_347"><span class="control" id="1679465955#-8i0r2d_348">Soporte para Testing</span>: Incluye verificaciones para contextos de prueba y usa mocks.</p></li></ol></section><section><h2 id="1679465955#consideraciones-de-rendimiento" data-toc="consideraciones-de-rendimiento#EventLogManager.md-consideraciones-de-rendimiento">Consideraciones de Rendimiento</h2><ol class="list list-decimal" id="1679465955#-8i0r2d_349" type="1" start="1"><li class="list-item" id="1679465955#-8i0r2d_350"><p id="1679465955#-8i0r2d_354"><span class="control" id="1679465955#-8i0r2d_355">L&iacute;mites de Consulta</span>: Las consultas est&aacute;n limitadas (50,000 para fetch, 5,000 para limpieza) para evitar timeouts.</p></li><li class="list-item" id="1679465955#-8i0r2d_351"><p id="1679465955#-8i0r2d_356"><span class="control" id="1679465955#-8i0r2d_357">Big Objects</span>: Utiliza Big Objects para almacenar grandes vol&uacute;menes de datos de eventos de forma eficiente.</p></li><li class="list-item" id="1679465955#-8i0r2d_352"><p id="1679465955#-8i0r2d_358"><span class="control" id="1679465955#-8i0r2d_359">Procesamiento As&iacute;ncrono</span>: Los m&eacute;todos future permiten procesar operaciones pesadas sin bloquear la transacci&oacute;n principal.</p></li><li class="list-item" id="1679465955#-8i0r2d_353"><p id="1679465955#-8i0r2d_360"><span class="control" id="1679465955#-8i0r2d_361">Lotes de Inserci&oacute;n</span>: Procesa inserciones en lotes para optimizar el uso de recursos.</p></li></ol></section><section><h2 id="1679465955#observaciones-sobre-el-c-digo" data-toc="observaciones-sobre-el-c-digo#EventLogManager.md-observaciones-sobre-el-c-digo">Observaciones sobre el C&oacute;digo</h2><section><h3 id="1679465955#c-digo-comentado" data-toc="c-digo-comentado#EventLogManager.md-c-digo-comentado">C&oacute;digo Comentado</h3><p id="1679465955#-8i0r2d_364">La clase contiene c&oacute;digo comentado que sugiere implementaciones alternativas o funcionalidades no activas:</p><ul class="list" id="1679465955#-8i0r2d_365" start="1"><li class="list-item" id="1679465955#-8i0r2d_366"><p>Limitaciones de longitud de campos comentadas</p></li><li class="list-item" id="1679465955#-8i0r2d_367"><p>L&oacute;gica de procesamiento por lotes comentada en algunos m&eacute;todos</p></li><li class="list-item" id="1679465955#-8i0r2d_368"><p>Diferentes enfoques para eliminar registros</p></li></ul></section><section><h3 id="1679465955#mejoras-potenciales" data-toc="mejoras-potenciales#EventLogManager.md-mejoras-potenciales">Mejoras Potenciales</h3><ol class="list list-decimal" id="1679465955#-8i0r2d_369" type="1" start="1"><li class="list-item" id="1679465955#-8i0r2d_370"><p id="1679465955#-8i0r2d_374"><span class="control" id="1679465955#-8i0r2d_375">Validaci&oacute;n de Entrada</span>: Podr&iacute;a beneficiarse de validaciones m&aacute;s robustas de los datos de entrada.</p></li><li class="list-item" id="1679465955#-8i0r2d_371"><p id="1679465955#-8i0r2d_376"><span class="control" id="1679465955#-8i0r2d_377">Gesti&oacute;n de Errores</span>: Mejorar el reporte de errores espec&iacute;ficos durante las operaciones batch.</p></li><li class="list-item" id="1679465955#-8i0r2d_372"><p id="1679465955#-8i0r2d_378"><span class="control" id="1679465955#-8i0r2d_379">Configuraci&oacute;n Externalizada</span>: Hacer configurables los l&iacute;mites de registros y tama&ntilde;os de lote.</p></li><li class="list-item" id="1679465955#-8i0r2d_373"><p id="1679465955#-8i0r2d_380"><span class="control" id="1679465955#-8i0r2d_381">M&eacute;tricas de Rendimiento</span>: A&ntilde;adir m&eacute;tricas para monitorear el rendimiento de las operaciones.</p></li></ol></section></section><section><h2 id="1679465955#notas-adicionales" data-toc="notas-adicionales#EventLogManager.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="1679465955#-8i0r2d_382" type="1" start="1"><li class="list-item" id="1679465955#-8i0r2d_383"><p id="1679465955#-8i0r2d_388"><span class="control" id="1679465955#-8i0r2d_389">Seguridad</span>: La clase utiliza <span class="inline-code" id="1679465955#-8i0r2d_390">WITH SECURITY_ENFORCED</span> en algunas consultas para respetar las reglas de seguridad.</p></li><li class="list-item" id="1679465955#-8i0r2d_384"><p id="1679465955#-8i0r2d_391"><span class="control" id="1679465955#-8i0r2d_392">Dual Storage</span>: Mantiene datos tanto en Big Objects (para volumen) como en objetos est&aacute;ndar (para an&aacute;lisis).</p></li><li class="list-item" id="1679465955#-8i0r2d_385"><p id="1679465955#-8i0r2d_393"><span class="control" id="1679465955#-8i0r2d_394">Feature Flag Integration</span>: La funcionalidad de guardado depende de la feature flag 'sura_foundation_event_logs'.</p></li><li class="list-item" id="1679465955#-8i0r2d_386"><p id="1679465955#-8i0r2d_395"><span class="control" id="1679465955#-8i0r2d_396">Testing Support</span>: Incluye soporte completo para testing con mocks y verificaciones de contexto.</p></li><li class="list-item" id="1679465955#-8i0r2d_387"><p id="1679465955#-8i0r2d_397"><span class="control" id="1679465955#-8i0r2d_398">Flexibilidad</span>: El dise&ntilde;o permite diferentes tipos de eventos y productos, siendo flexible para diversos casos de uso.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="315742789">CustomMetadataCallback</h1><section><h2 id="315742789#descripci-n-general" data-toc="descripci-n-general#CustomMetadataCallback.md-descripci-n-general">Descripci&oacute;n General</h2><p id="315742789#lwp5jb_17"><span class="inline-code" id="315742789#lwp5jb_18">CustomMetadataCallback</span> es una clase que implementa la interfaz <span class="inline-code" id="315742789#lwp5jb_19">Metadata.DeployCallback</span> de Salesforce. Esta clase est&aacute; dise&ntilde;ada para manejar los resultados de operaciones de despliegue de metadatos personalizados, proporcionando funcionalidad de callback que se ejecuta cuando una operaci&oacute;n de despliegue de metadatos se completa (exitosa o fallida).</p></section><section><h2 id="315742789#autor" data-toc="autor#CustomMetadataCallback.md-autor">Autor</h2><p id="315742789#lwp5jb_20">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="315742789#ltima-modificaci-n" data-toc="ltima-modificaci-n#CustomMetadataCallback.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="315742789#lwp5jb_21">28 de octubre de 2024</p></section><section><h2 id="315742789#estructura-de-la-clase" data-toc="estructura-de-la-clase#CustomMetadataCallback.md-estructura-de-la-clase">Estructura de la Clase</h2><div class="detached code-block" id="315742789#lwp5jb_22"><pre><code class="language-none">public class CustomMetadataCallback implements Metadata.DeployCallback {
  public void handleResult(
    Metadata.DeployResult result,
    Metadata.DeployCallbackContext context
  ) {
    if (!Test.isRunningTest()) {
      Core.debug(
        String.format(
          '[{0}] Metadata updated job queued with jobId=&quot;{1}&quot;',
          new List&lt;String&gt;{
            result.status == Metadata.DeployStatus.Succeeded
              ? 'Succeeded'
              : 'Failed',
            result.status == Metadata.DeployStatus.Succeeded
              ? context.getCallbackJobId().toString()
              : 'No created job'
          }
        )
      );
    }
  }
}</code></pre></div></section><section><h2 id="315742789#interfaz-implementada" data-toc="interfaz-implementada#CustomMetadataCallback.md-interfaz-implementada">Interfaz Implementada</h2><section><h3 id="315742789#metadata-deploycallback" data-toc="metadata-deploycallback#CustomMetadataCallback.md-metadata-deploycallback">Metadata.DeployCallback</h3><p id="315742789#lwp5jb_25">La clase implementa la interfaz <span class="inline-code" id="315742789#lwp5jb_27">Metadata.DeployCallback</span> de Salesforce, que es parte de la API de Metadatos. Esta interfaz define el m&eacute;todo <span class="inline-code" id="315742789#lwp5jb_28">handleResult</span> que debe ser implementado para procesar los resultados de operaciones de despliegue de metadatos.</p></section></section><section><h2 id="315742789#m-todos" data-toc="m-todos#CustomMetadataCallback.md-m-todos">M&eacute;todos</h2><section><h3 id="315742789#handleresult-metadata-deployresult-result-metadata-deploycallbackcontext-context" data-toc="handleresult-metadata-deployresult-result-metadata-deploycallbackcontext-context#CustomMetadataCallback.md-handleresult-metadata-deployresult-result-metadata-deploycallbackcontext-context">handleResult(Metadata.DeployResult result, Metadata.DeployCallbackContext context)</h3><section><h4 id="315742789#descripci-n" data-toc="descripci-n#CustomMetadataCallback.md-descripci-n">Descripci&oacute;n</h4><p id="315742789#lwp5jb_37">M&eacute;todo que se ejecuta autom&aacute;ticamente cuando una operaci&oacute;n de despliegue de metadatos se completa. Procesa el resultado de la operaci&oacute;n y registra informaci&oacute;n sobre el estado del despliegue.</p></section><section><h4 id="315742789#par-metros" data-toc="par-metros#CustomMetadataCallback.md-par-metros">Par&aacute;metros</h4><ul class="list" id="315742789#lwp5jb_38" start="1"><li class="list-item" id="315742789#lwp5jb_39"><p><span class="inline-code" id="315742789#lwp5jb_41">result</span> (Metadata.DeployResult): Objeto que contiene informaci&oacute;n sobre el resultado del despliegue de metadatos.</p></li><li class="list-item" id="315742789#lwp5jb_40"><p><span class="inline-code" id="315742789#lwp5jb_42">context</span> (Metadata.DeployCallbackContext): Contexto del callback que proporciona informaci&oacute;n adicional sobre la operaci&oacute;n.</p></li></ul></section><section><h4 id="315742789#retorno" data-toc="retorno#CustomMetadataCallback.md-retorno">Retorno</h4><ul class="list" id="315742789#lwp5jb_43" start="1"><li class="list-item" id="315742789#lwp5jb_44"><p><span class="inline-code" id="315742789#lwp5jb_45">void</span>: Este m&eacute;todo no devuelve ning&uacute;n valor.</p></li></ul></section><section><h4 id="315742789#proceso" data-toc="proceso#CustomMetadataCallback.md-proceso">Proceso</h4><ol class="list list-decimal" id="315742789#lwp5jb_46" type="1" start="1"><li class="list-item" id="315742789#lwp5jb_47"><p>Verifica si el c&oacute;digo no se est&aacute; ejecutando en un contexto de prueba.</p></li><li class="list-item" id="315742789#lwp5jb_48"><p>Determina el estado del despliegue (Succeeded o Failed).</p></li><li class="list-item" id="315742789#lwp5jb_49"><p>Obtiene el ID del trabajo de callback si el despliegue fue exitoso.</p></li><li class="list-item" id="315742789#lwp5jb_50"><p>Formatea y registra un mensaje de depuraci&oacute;n con la informaci&oacute;n del resultado.</p></li></ol></section><section><h4 id="315742789#c-digo" data-toc="c-digo#CustomMetadataCallback.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="315742789#lwp5jb_51"><pre><code class="language-none">public void handleResult(
  Metadata.DeployResult result,
  Metadata.DeployCallbackContext context
) {
  if (!Test.isRunningTest()) {
    Core.debug(
      String.format(
        '[{0}] Metadata updated job queued with jobId=&quot;{1}&quot;',
        new List&lt;String&gt;{
          result.status == Metadata.DeployStatus.Succeeded
            ? 'Succeeded'
            : 'Failed',
          result.status == Metadata.DeployStatus.Succeeded
            ? context.getCallbackJobId().toString()
            : 'No created job'
        }
      )
    );
  }
}</code></pre></div></section></section></section><section><h2 id="315742789#dependencias" data-toc="dependencias#CustomMetadataCallback.md-dependencias">Dependencias</h2><ul class="list" id="315742789#lwp5jb_52" start="1"><li class="list-item" id="315742789#lwp5jb_53"><p><span class="inline-code" id="315742789#lwp5jb_57">Metadata.DeployCallback</span>: Interfaz est&aacute;ndar de Salesforce para callbacks de despliegue de metadatos.</p></li><li class="list-item" id="315742789#lwp5jb_54"><p><span class="inline-code" id="315742789#lwp5jb_58">Metadata.DeployResult</span>: Clase que encapsula el resultado de una operaci&oacute;n de despliegue de metadatos.</p></li><li class="list-item" id="315742789#lwp5jb_55"><p><span class="inline-code" id="315742789#lwp5jb_59">Metadata.DeployCallbackContext</span>: Clase que proporciona contexto adicional para el callback.</p></li><li class="list-item" id="315742789#lwp5jb_56"><p><span class="inline-code" id="315742789#lwp5jb_60">Core</span>: Clase utilitaria que proporciona el m&eacute;todo <span class="inline-code" id="315742789#lwp5jb_61">debug</span> para registro de actividad.</p></li></ul></section><section><h2 id="315742789#prop-sito-y-casos-de-uso" data-toc="prop-sito-y-casos-de-uso#CustomMetadataCallback.md-prop-sito-y-casos-de-uso">Prop&oacute;sito y Casos de Uso</h2><p id="315742789#lwp5jb_62">Esta clase es especialmente &uacute;til en escenarios como:</p><ol class="list list-decimal" id="315742789#lwp5jb_63" type="1" start="1"><li class="list-item" id="315742789#lwp5jb_64"><p><span class="control" id="315742789#lwp5jb_68">Despliegue Program&aacute;tico de Metadatos</span>: Cuando se necesita desplegar metadatos personalizados desde c&oacute;digo Apex y monitorear el resultado.</p></li><li class="list-item" id="315742789#lwp5jb_65"><p><span class="control" id="315742789#lwp5jb_69">Operaciones As&iacute;ncronas</span>: Para manejar operaciones de metadatos que se ejecutan de forma as&iacute;ncrona.</p></li><li class="list-item" id="315742789#lwp5jb_66"><p><span class="control" id="315742789#lwp5jb_70">Auditor&iacute;a y Registro</span>: Para mantener un registro de las operaciones de despliegue de metadatos y su estado.</p></li><li class="list-item" id="315742789#lwp5jb_67"><p><span class="control" id="315742789#lwp5jb_71">Integraci&oacute;n con Procesos de Negocio</span>: Cuando las actualizaciones de metadatos forman parte de procesos de negocio m&aacute;s amplios.</p></li></ol></section><section><h2 id="315742789#contexto-de-la-api-de-metadatos-de-salesforce" data-toc="contexto-de-la-api-de-metadatos-de-salesforce#CustomMetadataCallback.md-contexto-de-la-api-de-metadatos-de-salesforce">Contexto de la API de Metadatos de Salesforce</h2><p id="315742789#lwp5jb_72">La API de Metadatos de Salesforce permite crear, actualizar y eliminar metadatos de forma program&aacute;tica. Los callbacks como este se utilizan porque las operaciones de metadatos son inherentemente as&iacute;ncronas y pueden tomar tiempo en completarse.</p></section><section><h2 id="315742789#ejemplos-de-uso" data-toc="ejemplos-de-uso#CustomMetadataCallback.md-ejemplos-de-uso">Ejemplos de Uso</h2><section><h3 id="315742789#ejemplo-1-despliegue-de-metadatos-personalizados-con-callback" data-toc="ejemplo-1-despliegue-de-metadatos-personalizados-con-callback#CustomMetadataCallback.md-ejemplo-1-despliegue-de-metadatos-personalizados-con-callback">Ejemplo 1: Despliegue de Metadatos Personalizados con Callback</h3><div class="detached code-block" id="315742789#lwp5jb_76"><pre><code class="language-none">public class MetadataDeploymentService {
    
    public static void deployCustomMetadata(String metadataName, Map&lt;String, Object&gt; fieldValues) {
        try {
            // Crear el registro de metadatos personalizados
            Metadata.CustomMetadata customMetadata = new Metadata.CustomMetadata();
            customMetadata.fullName = metadataName;
            customMetadata.label = metadataName;
            
            // Añadir valores de campos
            for (String fieldName : fieldValues.keySet()) {
                Metadata.CustomMetadataValue metadataValue = new Metadata.CustomMetadataValue();
                metadataValue.field = fieldName;
                metadataValue.value = fieldValues.get(fieldName);
                customMetadata.values.add(metadataValue);
            }
            
            // Crear el contenedor de despliegue
            Metadata.DeployContainer deployContainer = new Metadata.DeployContainer();
            deployContainer.addMetadata(customMetadata);
            
            // Crear la instancia del callback
            CustomMetadataCallback callback = new CustomMetadataCallback();
            
            // Ejecutar el despliegue con el callback
            Id deployJobId = Metadata.Operations.enqueueDeployment(deployContainer, callback);
            
            System.debug('Despliegue de metadatos iniciado con ID: ' + deployJobId);
        } catch (Exception e) {
            System.debug('Error al desplegar metadatos: ' + e.getMessage());
            throw e;
        }
    }
}

// Uso del servicio
Map&lt;String, Object&gt; configValues = new Map&lt;String, Object&gt;{
    'API_Endpoint__c' =&gt; 'https://api.example.com',
    'Timeout__c' =&gt; 30000,
    'Is_Active__c' =&gt; true
};

MetadataDeploymentService.deployCustomMetadata('MyConfig.Production', configValues);</code></pre></div></section><section><h3 id="315742789#ejemplo-2-clase-de-callback-extendida-con-funcionalidad-adicional" data-toc="ejemplo-2-clase-de-callback-extendida-con-funcionalidad-adicional#CustomMetadataCallback.md-ejemplo-2-clase-de-callback-extendida-con-funcionalidad-adicional">Ejemplo 2: Clase de Callback Extendida con Funcionalidad Adicional</h3><div class="detached code-block" id="315742789#lwp5jb_77"><pre><code class="language-none">public class EnhancedCustomMetadataCallback implements Metadata.DeployCallback {
    
    private String operationId;
    private String operationType;
    
    public EnhancedCustomMetadataCallback(String operationId, String operationType) {
        this.operationId = operationId;
        this.operationType = operationType;
    }
    
    public void handleResult(
        Metadata.DeployResult result,
        Metadata.DeployCallbackContext context
    ) {
        if (!Test.isRunningTest()) {
            // Registro detallado del resultado
            logDeploymentResult(result, context);
            
            // Enviar notificaciones según el resultado
            if (result.status == Metadata.DeployStatus.Succeeded) {
                handleSuccessfulDeployment(result, context);
            } else {
                handleFailedDeployment(result, context);
            }
        }
    }
    
    private void logDeploymentResult(
        Metadata.DeployResult result,
        Metadata.DeployCallbackContext context
    ) {
        String logMessage = String.format(
            '[{0}] Metadata deployment {1} - Operation: {2}, JobId: {3}',
            new List&lt;String&gt;{
                result.status.name(),
                result.status == Metadata.DeployStatus.Succeeded ? 'completed successfully' : 'failed',
                this.operationType,
                result.status == Metadata.DeployStatus.Succeeded 
                    ? context.getCallbackJobId().toString() 
                    : 'N/A'
            }
        );
        
        Core.debug(logMessage);
        
        // También registrar detalles adicionales si están disponibles
        if (result.details != null) {
            Core.debug('Deployment details: ' + JSON.serialize(result.details));
        }
    }
    
    private void handleSuccessfulDeployment(
        Metadata.DeployResult result,
        Metadata.DeployCallbackContext context
    ) {
        try {
            // Crear registro de auditoría
            createAuditRecord('SUCCESS', result, context);
            
            // Enviar notificación de éxito
            sendNotification('Deployment Successful', 
                           'Metadata deployment completed successfully for operation: ' + this.operationType);
            
            // Ejecutar acciones post-despliegue si las hay
            executePostDeploymentActions();
        } catch (Exception e) {
            Core.debug('Error in success handler: ' + e.getMessage());
        }
    }
    
    private void handleFailedDeployment(
        Metadata.DeployResult result,
        Metadata.DeployCallbackContext context
    ) {
        try {
            // Crear registro de auditoría para el fallo
            createAuditRecord('FAILED', result, context);
            
            // Enviar notificación de error
            sendNotification('Deployment Failed', 
                           'Metadata deployment failed for operation: ' + this.operationType);
            
            // Ejecutar acciones de rollback si las hay
            executeRollbackActions();
        } catch (Exception e) {
            Core.debug('Error in failure handler: ' + e.getMessage());
        }
    }
    
    private void createAuditRecord(
        String status, 
        Metadata.DeployResult result, 
        Metadata.DeployCallbackContext context
    ) {
        // Ejemplo de creación de registro de auditoría
        // Esto podría ser un objeto personalizado para tracking de deployments
        /*
        Metadata_Deployment_Log__c auditRecord = new Metadata_Deployment_Log__c(
            Operation_Id__c = this.operationId,
            Operation_Type__c = this.operationType,
            Status__c = status,
            Job_Id__c = context.getCallbackJobId()?.toString(),
            Deployment_Date__c = System.now(),
            Details__c = result.details != null ? JSON.serialize(result.details) : null
        );
        
        insert auditRecord;
        */
    }
    
    private void sendNotification(String subject, String body) {
        // Implementar lógica de notificación
        // Esto podría incluir emails, platform events, etc.
    }
    
    private void executePostDeploymentActions() {
        // Ejecutar acciones específicas después de un despliegue exitoso
        // Por ejemplo, actualizar caché, notificar a otros sistemas, etc.
    }
    
    private void executeRollbackActions() {
        // Ejecutar acciones de rollback en caso de fallo
        // Por ejemplo, restaurar configuraciones anteriores, notificar errores, etc.
    }
}</code></pre></div></section><section><h3 id="315742789#ejemplo-3-uso-en-un-proceso-de-configuraci-n-din-mico" data-toc="ejemplo-3-uso-en-un-proceso-de-configuraci-n-din-mico#CustomMetadataCallback.md-ejemplo-3-uso-en-un-proceso-de-configuraci-n-din-mico">Ejemplo 3: Uso en un Proceso de Configuraci&oacute;n Din&aacute;mico</h3><div class="detached code-block" id="315742789#lwp5jb_78"><pre><code class="language-none">public class DynamicConfigurationManager {
    
    public class ConfigurationItem {
        public String name;
        public String value;
        public String type;
        
        public ConfigurationItem(String name, String value, String type) {
            this.name = name;
            this.value = value;
            this.type = type;
        }
    }
    
    public static void updateConfiguration(
        String configurationSetName, 
        List&lt;ConfigurationItem&gt; items
    ) {
        try {
            // Crear metadatos para cada item de configuración
            Metadata.DeployContainer deployContainer = new Metadata.DeployContainer();
            
            for (ConfigurationItem item : items) {
                Metadata.CustomMetadata customMetadata = createMetadataFromItem(
                    configurationSetName, item
                );
                deployContainer.addMetadata(customMetadata);
            }
            
            // Crear callback con información contextual
            EnhancedCustomMetadataCallback callback = new EnhancedCustomMetadataCallback(
                generateOperationId(),
                'CONFIGURATION_UPDATE'
            );
            
            // Ejecutar el despliegue
            Id deployJobId = Metadata.Operations.enqueueDeployment(deployContainer, callback);
            
            System.debug('Configuration update initiated with job ID: ' + deployJobId);
        } catch (Exception e) {
            System.debug('Error updating configuration: ' + e.getMessage());
            throw new ConfigurationException('Failed to update configuration: ' + e.getMessage(), e);
        }
    }
    
    private static Metadata.CustomMetadata createMetadataFromItem(
        String setName, 
        ConfigurationItem item
    ) {
        Metadata.CustomMetadata customMetadata = new Metadata.CustomMetadata();
        customMetadata.fullName = setName + '.' + item.name;
        customMetadata.label = item.name;
        
        // Añadir valor del item
        Metadata.CustomMetadataValue valueField = new Metadata.CustomMetadataValue();
        valueField.field = 'Value__c';
        valueField.value = item.value;
        customMetadata.values.add(valueField);
        
        // Añadir tipo del item
        Metadata.CustomMetadataValue typeField = new Metadata.CustomMetadataValue();
        typeField.field = 'Type__c';
        typeField.value = item.type;
        customMetadata.values.add(typeField);
        
        return customMetadata;
    }
    
    private static String generateOperationId() {
        return 'OP_' + String.valueOf(System.currentTimeMillis());
    }
    
    public class ConfigurationException extends Exception {}
}

// Uso del manager
List&lt;DynamicConfigurationManager.ConfigurationItem&gt; configItems = 
    new List&lt;DynamicConfigurationManager.ConfigurationItem&gt;{
        new DynamicConfigurationManager.ConfigurationItem('API_URL', 'https://new-api.com', 'String'),
        new DynamicConfigurationManager.ConfigurationItem('TIMEOUT', '45000', 'Number'),
        new DynamicConfigurationManager.ConfigurationItem('ENABLED', 'true', 'Boolean')
    };

DynamicConfigurationManager.updateConfiguration('ProductionConfig', configItems);</code></pre></div></section></section><section><h2 id="315742789#mejoras-propuestas-para-la-implementaci-n-actual" data-toc="mejoras-propuestas-para-la-implementaci-n-actual#CustomMetadataCallback.md-mejoras-propuestas-para-la-implementaci-n-actual">Mejoras Propuestas para la Implementaci&oacute;n Actual</h2><section><h3 id="315742789#versi-n-mejorada-con-funcionalidad-adicional" data-toc="versi-n-mejorada-con-funcionalidad-adicional#CustomMetadataCallback.md-versi-n-mejorada-con-funcionalidad-adicional">Versi&oacute;n Mejorada con Funcionalidad Adicional</h3><div class="detached code-block" id="315742789#lwp5jb_80"><pre><code class="language-none">/**
 * @description       : Callback para manejar resultados de despliegue de metadatos personalizados
 * @author            : Soulberto Lorenzo &lt;soulberto@cloudblue.us&gt;
 * @group             : Metadata Management
 * @last modified on  : 10-28-2024
 * @last modified by  : Soulberto Lorenzo &lt;soulberto@cloudblue.us&gt;
 **/
public class CustomMetadataCallback implements Metadata.DeployCallback {
    
    private String operationContext;
    private Map&lt;String, Object&gt; additionalData;
    
    /**
     * Constructor por defecto
     */
    public CustomMetadataCallback() {
        this.operationContext = 'DEFAULT';
        this.additionalData = new Map&lt;String, Object&gt;();
    }
    
    /**
     * Constructor con contexto
     * @param operationContext Contexto de la operación
     */
    public CustomMetadataCallback(String operationContext) {
        this.operationContext = operationContext;
        this.additionalData = new Map&lt;String, Object&gt;();
    }
    
    /**
     * Constructor con contexto y datos adicionales
     * @param operationContext Contexto de la operación
     * @param additionalData Datos adicionales para el callback
     */
    public CustomMetadataCallback(String operationContext, Map&lt;String, Object&gt; additionalData) {
        this.operationContext = operationContext;
        this.additionalData = additionalData != null ? additionalData : new Map&lt;String, Object&gt;();
    }
    
    /**
     * Maneja el resultado del despliegue de metadatos
     * @param result Resultado del despliegue
     * @param context Contexto del callback
     */
    public void handleResult(
        Metadata.DeployResult result,
        Metadata.DeployCallbackContext context
    ) {
        if (!Test.isRunningTest()) {
            try {
                // Registro básico del resultado
                logBasicResult(result, context);
                
                // Registro detallado si está disponible
                logDetailedResult(result);
                
                // Procesar según el estado del resultado
                if (result.status == Metadata.DeployStatus.Succeeded) {
                    handleSuccess(result, context);
                } else {
                    handleFailure(result, context);
                }
            } catch (Exception e) {
                Core.debug('Error in CustomMetadataCallback.handleResult: ' + e.getMessage());
                logCallbackError(e);
            }
        }
    }
    
    /**
     * Registra información básica del resultado
     */
    private void logBasicResult(Metadata.DeployResult result, Metadata.DeployCallbackContext context) {
        String statusText = result.status == Metadata.DeployStatus.Succeeded ? 'Succeeded' : 'Failed';
        String jobId = result.status == Metadata.DeployStatus.Succeeded 
            ? context.getCallbackJobId()?.toString() 
            : 'No created job';
        
        Core.debug(
            String.format(
                '[{0}] Metadata deployment {1} - Context: {2}, JobId: {3}',
                new List&lt;String&gt;{ statusText, statusText.toLowerCase(), this.operationContext, jobId }
            )
        );
    }
    
    /**
     * Registra información detallada del resultado si está disponible
     */
    private void logDetailedResult(Metadata.DeployResult result) {
        if (result.details != null) {
            // Registrar detalles específicos del despliegue
            Core.debug('Deployment details available - Components: ' + 
                      (result.details.componentSuccesses?.size() ?? 0) + ' successful, ' +
                      (result.details.componentFailures?.size() ?? 0) + ' failed');
            
            // Registrar errores específicos si los hay
            if (result.details.componentFailures != null &amp;&amp; !result.details.componentFailures.isEmpty()) {
                for (Metadata.DeployMessage failure : result.details.componentFailures) {
                    Core.debug('Component failure: ' + failure.fullName + ' - ' + failure.problem);
                }
            }
        }
    }
    
    /**
     * Maneja el caso de despliegue exitoso
     */
    private void handleSuccess(Metadata.DeployResult result, Metadata.DeployCallbackContext context) {
        Core.debug('Metadata deployment completed successfully for context: ' + this.operationContext);
        
        // Ejecutar acciones post-éxito si están definidas en additionalData
        if (additionalData.containsKey('onSuccess') &amp;&amp; additionalData.get('onSuccess') != null) {
            executeCallback('onSuccess');
        }
    }
    
    /**
     * Maneja el caso de despliegue fallido
     */
    private void handleFailure(Metadata.DeployResult result, Metadata.DeployCallbackContext context) {
        Core.debug('Metadata deployment failed for context: ' + this.operationContext);
        
        // Ejecutar acciones post-fallo si están definidas en additionalData
        if (additionalData.containsKey('onFailure') &amp;&amp; additionalData.get('onFailure') != null) {
            executeCallback('onFailure');
        }
    }
    
    /**
     * Ejecuta callbacks adicionales definidos en additionalData
     */
    private void executeCallback(String callbackType) {
        try {
            // Aquí se podría implementar lógica para ejecutar callbacks específicos
            // Por ejemplo, invocar métodos específicos, enviar platform events, etc.
            Core.debug('Executing ' + callbackType + ' callback for context: ' + this.operationContext);
        } catch (Exception e) {
            Core.debug('Error executing ' + callbackType + ' callback: ' + e.getMessage());
        }
    }
    
    /**
     * Registra errores del callback mismo
     */
    private void logCallbackError(Exception e) {
        Core.debug('CustomMetadataCallback error - Context: ' + this.operationContext + 
                  ', Error: ' + e.getMessage() + ', Stack: ' + e.getStackTraceString());
    }
}</code></pre></div></section></section><section><h2 id="315742789#consideraciones-de-rendimiento-y-limitaciones" data-toc="consideraciones-de-rendimiento-y-limitaciones#CustomMetadataCallback.md-consideraciones-de-rendimiento-y-limitaciones">Consideraciones de Rendimiento y Limitaciones</h2><ol class="list list-decimal" id="315742789#lwp5jb_81" type="1" start="1"><li class="list-item" id="315742789#lwp5jb_82"><p id="315742789#lwp5jb_86"><span class="control" id="315742789#lwp5jb_87">L&iacute;mites de API de Metadatos</span>: Las operaciones de metadatos est&aacute;n sujetas a l&iacute;mites espec&iacute;ficos de Salesforce. Es importante estar consciente de estos l&iacute;mites al dise&ntilde;ar soluciones.</p></li><li class="list-item" id="315742789#lwp5jb_83"><p id="315742789#lwp5jb_88"><span class="control" id="315742789#lwp5jb_89">Asincron&iacute;a</span>: Las operaciones de metadatos son inherentemente as&iacute;ncronas. El callback se ejecuta cuando la operaci&oacute;n se completa, no inmediatamente.</p></li><li class="list-item" id="315742789#lwp5jb_84"><p id="315742789#lwp5jb_90"><span class="control" id="315742789#lwp5jb_91">Contexto de Ejecuci&oacute;n</span>: Los callbacks se ejecutan en un contexto espec&iacute;fico y pueden tener limitaciones en cuanto a las operaciones que pueden realizar.</p></li><li class="list-item" id="315742789#lwp5jb_85"><p id="315742789#lwp5jb_92"><span class="control" id="315742789#lwp5jb_93">Manejo de Errores</span>: Es importante incluir manejo robusto de errores en los callbacks para evitar que fallos en el callback afecten la operaci&oacute;n principal.</p></li></ol></section><section><h2 id="315742789#pruebas-unitarias" data-toc="pruebas-unitarias#CustomMetadataCallback.md-pruebas-unitarias">Pruebas Unitarias</h2><div class="detached code-block" id="315742789#lwp5jb_94"><pre><code class="language-none">@IsTest
private class CustomMetadataCallbackTest {
    
    @IsTest
    static void testSuccessfulDeployment() {
        Test.startTest();
        
        // Crear mock del resultado exitoso
        Metadata.DeployResult mockResult = new Metadata.DeployResult();
        mockResult.status = Metadata.DeployStatus.Succeeded;
        
        // Crear mock del contexto
        // Nota: En pruebas reales, necesitarías usar mocks más sofisticados
        // ya que Metadata.DeployCallbackContext no se puede instanciar directamente
        
        CustomMetadataCallback callback = new CustomMetadataCallback();
        
        // Ejecutar el método (no debería registrar nada durante las pruebas)
        callback.handleResult(mockResult, null);
        
        Test.stopTest();
        
        // En un escenario real, verificarías los efectos secundarios
        // como registros creados, notificaciones enviadas, etc.
        System.assert(true, 'Callback should execute without errors');
    }
    
    @IsTest
    static void testFailedDeployment() {
        Test.startTest();
        
        // Crear mock del resultado fallido
        Metadata.DeployResult mockResult = new Metadata.DeployResult();
        mockResult.status = Metadata.DeployStatus.Failed;
        
        CustomMetadataCallback callback = new CustomMetadataCallback();
        
        // Ejecutar el método
        callback.handleResult(mockResult, null);
        
        Test.stopTest();
        
        // Verificar que el método maneja correctamente los fallos
        System.assert(true, 'Callback should handle failures gracefully');
    }
}</code></pre></div></section><section><h2 id="315742789#notas-adicionales" data-toc="notas-adicionales#CustomMetadataCallback.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="315742789#lwp5jb_95" type="1" start="1"><li class="list-item" id="315742789#lwp5jb_96"><p>Esta clase forma parte del ecosistema de gesti&oacute;n de metadatos de la organizaci&oacute;n y trabaja en conjunto con la API de Metadatos de Salesforce.</p></li><li class="list-item" id="315742789#lwp5jb_97"><p>La verificaci&oacute;n <span class="inline-code" id="315742789#lwp5jb_101">!Test.isRunningTest()</span> es importante para evitar registrar informaci&oacute;n durante las pruebas unitarias.</p></li><li class="list-item" id="315742789#lwp5jb_98"><p>El uso de <span class="inline-code" id="315742789#lwp5jb_102">Core.debug()</span> sugiere que hay una clase utilitaria centralizada para el registro de actividad.</p></li><li class="list-item" id="315742789#lwp5jb_99"><p>Esta implementaci&oacute;n es b&aacute;sica pero funcional, y puede ser extendida seg&uacute;n las necesidades espec&iacute;ficas del proyecto.</p></li><li class="list-item" id="315742789#lwp5jb_100"><p>Las operaciones de metadatos son poderosas pero deben usarse con cuidado, especialmente en entornos de producci&oacute;n.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1384593519">CumuloMissingParameterException</h1><section><h2 id="1384593519#descripci-n-general" data-toc="descripci-n-general#CumuloMissingParameterException.md-descripci-n-general">Descripci&oacute;n General</h2><p id="1384593519#y8w7an_18"><span class="inline-code" id="1384593519#y8w7an_19">CumuloMissingParameterException</span> es una clase de excepci&oacute;n personalizada que extiende la clase <span class="inline-code" id="1384593519#y8w7an_20">Exception</span> est&aacute;ndar de Apex. Esta clase est&aacute; dise&ntilde;ada espec&iacute;ficamente para representar errores que ocurren cuando faltan par&aacute;metros requeridos en operaciones relacionadas con el framework Cumulo o procesos espec&iacute;ficos que requieren validaci&oacute;n de par&aacute;metros obligatorios.</p></section><section><h2 id="1384593519#autor" data-toc="autor#CumuloMissingParameterException.md-autor">Autor</h2><p id="1384593519#y8w7an_21">Felipe Correa \&lt;felipe.correa@nespon.com\&gt;</p></section><section><h2 id="1384593519#proyecto" data-toc="proyecto#CumuloMissingParameterException.md-proyecto">Proyecto</h2><p id="1384593519#y8w7an_22">Foundation Salesforce - Suratech - UH-17589</p></section><section><h2 id="1384593519#ltima-modificaci-n" data-toc="ltima-modificaci-n#CumuloMissingParameterException.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="1384593519#y8w7an_23">21 de noviembre de 2024</p></section><section><h2 id="1384593519#estructura" data-toc="estructura#CumuloMissingParameterException.md-estructura">Estructura</h2><div class="detached code-block" id="1384593519#y8w7an_24"><pre><code class="language-none">public with sharing class CumuloMissingParameterException extends Exception {
}</code></pre></div><p id="1384593519#y8w7an_25">La clase tiene una implementaci&oacute;n minimalista, sin agregar m&eacute;todos o propiedades adicionales m&aacute;s all&aacute; de los heredados de la clase base <span class="inline-code" id="1384593519#y8w7an_26">Exception</span>.</p></section><section><h2 id="1384593519#herencia" data-toc="herencia#CumuloMissingParameterException.md-herencia">Herencia</h2><ul class="list" id="1384593519#y8w7an_27" start="1"><li class="list-item" id="1384593519#y8w7an_28"><p><span class="control" id="1384593519#y8w7an_30">Clase Base</span>: <span class="inline-code" id="1384593519#y8w7an_31">Exception</span></p></li><li class="list-item" id="1384593519#y8w7an_29"><p><span class="control" id="1384593519#y8w7an_32">Modificadores</span>: <span class="inline-code" id="1384593519#y8w7an_33">public with sharing</span></p></li></ul></section><section><h2 id="1384593519#prop-sito" data-toc="prop-sito#CumuloMissingParameterException.md-prop-sito">Prop&oacute;sito</h2><p id="1384593519#y8w7an_34">El prop&oacute;sito principal de esta clase es proporcionar un tipo de excepci&oacute;n espec&iacute;fico para errores relacionados con par&aacute;metros faltantes en el contexto del framework Cumulo, permitiendo:</p><ol class="list list-decimal" id="1384593519#y8w7an_35" type="1" start="1"><li class="list-item" id="1384593519#y8w7an_36"><p><span class="control" id="1384593519#y8w7an_41">Especificidad del Error</span>: Distinguir claramente los errores de par&aacute;metros faltantes de otros tipos de excepciones en el sistema.</p></li><li class="list-item" id="1384593519#y8w7an_37"><p><span class="control" id="1384593519#y8w7an_42">Validaci&oacute;n de Entrada</span>: Facilitar la validaci&oacute;n de par&aacute;metros requeridos en m&eacute;todos y procesos cr&iacute;ticos.</p></li><li class="list-item" id="1384593519#y8w7an_38"><p><span class="control" id="1384593519#y8w7an_43">Manejo Espec&iacute;fico</span>: Permitir que el c&oacute;digo que captura excepciones pueda identificar y manejar espec&iacute;ficamente casos donde faltan par&aacute;metros obligatorios.</p></li><li class="list-item" id="1384593519#y8w7an_39"><p><span class="control" id="1384593519#y8w7an_44">Claridad en el C&oacute;digo</span>: Mejorar la legibilidad del c&oacute;digo al indicar expl&iacute;citamente cuando se est&aacute; tratando con un error de par&aacute;metro faltante.</p></li><li class="list-item" id="1384593519#y8w7an_40"><p><span class="control" id="1384593519#y8w7an_45">Debugging y Mantenimiento</span>: Facilitar la identificaci&oacute;n de problemas relacionados con configuraci&oacute;n o llamadas incorrectas a m&eacute;todos.</p></li></ol></section><section><h2 id="1384593519#contexto-del-framework-cumulo" data-toc="contexto-del-framework-cumulo#CumuloMissingParameterException.md-contexto-del-framework-cumulo">Contexto del Framework Cumulo</h2><p id="1384593519#y8w7an_46">El nombre &quot;Cumulo&quot; sugiere que esta excepci&oacute;n forma parte de un framework o sistema espec&iacute;fico dentro de la organizaci&oacute;n Suratech. Los frameworks suelen requerir configuraciones espec&iacute;ficas y par&aacute;metros obligatorios para funcionar correctamente, por lo que tener una excepci&oacute;n espec&iacute;fica para par&aacute;metros faltantes es una pr&aacute;ctica com&uacute;n y recomendada.</p></section><section><h2 id="1384593519#m-todos-heredados" data-toc="m-todos-heredados#CumuloMissingParameterException.md-m-todos-heredados">M&eacute;todos Heredados</h2><p id="1384593519#y8w7an_47">Al extender la clase <span class="inline-code" id="1384593519#y8w7an_50">Exception</span> est&aacute;ndar, <span class="inline-code" id="1384593519#y8w7an_51">CumuloMissingParameterException</span> hereda los siguientes m&eacute;todos y propiedades:</p><section><h3 id="1384593519#constructores" data-toc="constructores#CumuloMissingParameterException.md-constructores">Constructores</h3><ul class="list" id="1384593519#y8w7an_52" start="1"><li class="list-item" id="1384593519#y8w7an_53"><p><span class="control" id="1384593519#y8w7an_57"><span class="inline-code" id="1384593519#y8w7an_58">CumuloMissingParameterException()</span></span>: Constructor por defecto.</p></li><li class="list-item" id="1384593519#y8w7an_54"><p><span class="control" id="1384593519#y8w7an_59"><span class="inline-code" id="1384593519#y8w7an_60">CumuloMissingParameterException(String message)</span></span>: Constructor que acepta un mensaje de error.</p></li><li class="list-item" id="1384593519#y8w7an_55"><p><span class="control" id="1384593519#y8w7an_61"><span class="inline-code" id="1384593519#y8w7an_62">CumuloMissingParameterException(Exception cause)</span></span>: Constructor que acepta otra excepci&oacute;n como causa.</p></li><li class="list-item" id="1384593519#y8w7an_56"><p><span class="control" id="1384593519#y8w7an_63"><span class="inline-code" id="1384593519#y8w7an_64">CumuloMissingParameterException(String message, Exception cause)</span></span>: Constructor que acepta un mensaje y otra excepci&oacute;n como causa.</p></li></ul></section><section><h3 id="1384593519#m-todos" data-toc="m-todos#CumuloMissingParameterException.md-m-todos">M&eacute;todos</h3><ul class="list" id="1384593519#y8w7an_65" start="1"><li class="list-item" id="1384593519#y8w7an_66"><p><span class="control" id="1384593519#y8w7an_72"><span class="inline-code" id="1384593519#y8w7an_73">getMessage()</span></span>: Devuelve el mensaje de error asociado con la excepci&oacute;n.</p></li><li class="list-item" id="1384593519#y8w7an_67"><p><span class="control" id="1384593519#y8w7an_74"><span class="inline-code" id="1384593519#y8w7an_75">getCause()</span></span>: Devuelve la excepci&oacute;n que caus&oacute; esta excepci&oacute;n, si existe.</p></li><li class="list-item" id="1384593519#y8w7an_68"><p><span class="control" id="1384593519#y8w7an_76"><span class="inline-code" id="1384593519#y8w7an_77">getTypeName()</span></span>: Devuelve el nombre del tipo de excepci&oacute;n.</p></li><li class="list-item" id="1384593519#y8w7an_69"><p><span class="control" id="1384593519#y8w7an_78"><span class="inline-code" id="1384593519#y8w7an_79">setMessage(String message)</span></span>: Establece el mensaje de error para la excepci&oacute;n.</p></li><li class="list-item" id="1384593519#y8w7an_70"><p><span class="control" id="1384593519#y8w7an_80"><span class="inline-code" id="1384593519#y8w7an_81">getLineNumber()</span></span>: Devuelve el n&uacute;mero de l&iacute;nea donde se gener&oacute; la excepci&oacute;n.</p></li><li class="list-item" id="1384593519#y8w7an_71"><p><span class="control" id="1384593519#y8w7an_82"><span class="inline-code" id="1384593519#y8w7an_83">getStackTraceString()</span></span>: Devuelve una representaci&oacute;n de texto del seguimiento de la pila.</p></li></ul></section></section><section><h2 id="1384593519#ejemplos-de-uso" data-toc="ejemplos-de-uso#CumuloMissingParameterException.md-ejemplos-de-uso">Ejemplos de Uso</h2><section><h3 id="1384593519#ejemplo-1-validaci-n-de-par-metros-de-configuraci-n" data-toc="ejemplo-1-validaci-n-de-par-metros-de-configuraci-n#CumuloMissingParameterException.md-ejemplo-1-validaci-n-de-par-metros-de-configuraci-n">Ejemplo 1: Validaci&oacute;n de Par&aacute;metros de Configuraci&oacute;n</h3><div class="detached code-block" id="1384593519#y8w7an_88"><pre><code class="language-none">public class CumuloConfigurationManager {
    
    public static void initializeFramework(Map&lt;String, Object&gt; config) {
        // Validar parámetros requeridos
        validateRequiredParameters(config);
        
        // Proceder con la inicialización
        String endpoint = (String) config.get('endpoint');
        String apiKey = (String) config.get('apiKey');
        Integer timeout = (Integer) config.get('timeout');
        
        // Lógica de inicialización del framework
        // ...
    }
    
    private static void validateRequiredParameters(Map&lt;String, Object&gt; config) {
        if (config == null) {
            throw new CumuloMissingParameterException('La configuración no puede ser nula');
        }
        
        List&lt;String&gt; requiredParams = new List&lt;String&gt;{'endpoint', 'apiKey', 'timeout'};
        
        for (String param : requiredParams) {
            if (!config.containsKey(param) || config.get(param) == null) {
                throw new CumuloMissingParameterException(
                    'Parámetro requerido faltante: ' + param
                );
            }
            
            if (config.get(param) instanceof String &amp;&amp; String.isBlank((String)config.get(param))) {
                throw new CumuloMissingParameterException(
                    'El parámetro ' + param + ' no puede estar vacío'
                );
            }
        }
    }
}

// Uso
try {
    Map&lt;String, Object&gt; config = new Map&lt;String, Object&gt;{
        'endpoint' =&gt; 'https://api.cumulo.com',
        'apiKey' =&gt; 'sk_test_123456'
        // Falta el parámetro 'timeout'
    };
    
    CumuloConfigurationManager.initializeFramework(config);
} catch (CumuloMissingParameterException e) {
    System.debug('Error de configuración: ' + e.getMessage());
    // Manejar el error específico de parámetro faltante
}</code></pre></div></section><section><h3 id="1384593519#ejemplo-2-validaci-n-en-m-todos-de-servicio" data-toc="ejemplo-2-validaci-n-en-m-todos-de-servicio#CumuloMissingParameterException.md-ejemplo-2-validaci-n-en-m-todos-de-servicio">Ejemplo 2: Validaci&oacute;n en M&eacute;todos de Servicio</h3><div class="detached code-block" id="1384593519#y8w7an_89"><pre><code class="language-none">public class CumuloDataService {
    
    public static Map&lt;String, Object&gt; processData(
        String recordId, 
        String operation, 
        Map&lt;String, Object&gt; data
    ) {
        // Validar parámetros de entrada
        validateInputParameters(recordId, operation, data);
        
        // Procesar los datos
        Map&lt;String, Object&gt; result = new Map&lt;String, Object&gt;();
        
        switch on operation.toUpperCase() {
            when 'CREATE' {
                result = createRecord(data);
            }
            when 'UPDATE' {
                result = updateRecord(recordId, data);
            }
            when 'DELETE' {
                result = deleteRecord(recordId);
            }
            when else {
                throw new IllegalArgumentException('Operación no soportada: ' + operation);
            }
        }
        
        return result;
    }
    
    private static void validateInputParameters(
        String recordId, 
        String operation, 
        Map&lt;String, Object&gt; data
    ) {
        if (String.isBlank(operation)) {
            throw new CumuloMissingParameterException('El parámetro &quot;operation&quot; es requerido');
        }
        
        Set&lt;String&gt; operationsRequiringId = new Set&lt;String&gt;{'UPDATE', 'DELETE'};
        if (operationsRequiringId.contains(operation.toUpperCase()) &amp;&amp; String.isBlank(recordId)) {
            throw new CumuloMissingParameterException(
                'El parámetro &quot;recordId&quot; es requerido para la operación ' + operation
            );
        }
        
        Set&lt;String&gt; operationsRequiringData = new Set&lt;String&gt;{'CREATE', 'UPDATE'};
        if (operationsRequiringData.contains(operation.toUpperCase())) {
            if (data == null || data.isEmpty()) {
                throw new CumuloMissingParameterException(
                    'El parámetro &quot;data&quot; es requerido para la operación ' + operation
                );
            }
        }
    }
    
    private static Map&lt;String, Object&gt; createRecord(Map&lt;String, Object&gt; data) {
        // Lógica de creación
        return new Map&lt;String, Object&gt;{'success' =&gt; true, 'id' =&gt; 'new_record_id'};
    }
    
    private static Map&lt;String, Object&gt; updateRecord(String recordId, Map&lt;String, Object&gt; data) {
        // Lógica de actualización
        return new Map&lt;String, Object&gt;{'success' =&gt; true, 'id' =&gt; recordId};
    }
    
    private static Map&lt;String, Object&gt; deleteRecord(String recordId) {
        // Lógica de eliminación
        return new Map&lt;String, Object&gt;{'success' =&gt; true, 'deleted' =&gt; true};
    }
}

// Uso
try {
    // Esto lanzará CumuloMissingParameterException porque falta recordId para UPDATE
    CumuloDataService.processData(null, 'UPDATE', new Map&lt;String, Object&gt;{'name' =&gt; 'Test'});
} catch (CumuloMissingParameterException e) {
    System.debug('Error: ' + e.getMessage());
    // Manejar error de parámetro faltante
}</code></pre></div></section><section><h3 id="1384593519#ejemplo-3-validaci-n-en-procedimientos-de-integraci-n" data-toc="ejemplo-3-validaci-n-en-procedimientos-de-integraci-n#CumuloMissingParameterException.md-ejemplo-3-validaci-n-en-procedimientos-de-integraci-n">Ejemplo 3: Validaci&oacute;n en Procedimientos de Integraci&oacute;n</h3><div class="detached code-block" id="1384593519#y8w7an_90"><pre><code class="language-none">public class CumuloIntegrationProcedure {
    
    public static Map&lt;String, Object&gt; executeIntegration(Map&lt;String, Object&gt; input) {
        try {
            // Validar estructura de entrada
            validateIntegrationInput(input);
            
            // Extraer parámetros validados
            String integrationPoint = (String) input.get('integrationPoint');
            Map&lt;String, Object&gt; payload = (Map&lt;String, Object&gt;) input.get('payload');
            Map&lt;String, Object&gt; headers = (Map&lt;String, Object&gt;) input.get('headers');
            
            // Ejecutar la integración
            return performIntegration(integrationPoint, payload, headers);
            
        } catch (CumuloMissingParameterException e) {
            // Devolver error estructurado
            return new Map&lt;String, Object&gt;{
                'success' =&gt; false,
                'errorType' =&gt; 'MISSING_PARAMETER',
                'errorMessage' =&gt; e.getMessage()
            };
        } catch (Exception e) {
            // Manejar otros errores
            return new Map&lt;String, Object&gt;{
                'success' =&gt; false,
                'errorType' =&gt; 'INTEGRATION_ERROR',
                'errorMessage' =&gt; e.getMessage()
            };
        }
    }
    
    private static void validateIntegrationInput(Map&lt;String, Object&gt; input) {
        if (input == null) {
            throw new CumuloMissingParameterException('Los datos de entrada no pueden ser nulos');
        }
        
        // Validar integrationPoint
        if (!input.containsKey('integrationPoint') || 
            String.isBlank((String)input.get('integrationPoint'))) {
            throw new CumuloMissingParameterException(
                'El parámetro &quot;integrationPoint&quot; es requerido'
            );
        }
        
        // Validar payload
        if (!input.containsKey('payload') || input.get('payload') == null) {
            throw new CumuloMissingParameterException(
                'El parámetro &quot;payload&quot; es requerido'
            );
        }
        
        // Validar que el payload sea un mapa
        if (!(input.get('payload') instanceof Map&lt;String, Object&gt;)) {
            throw new CumuloMissingParameterException(
                'El parámetro &quot;payload&quot; debe ser un objeto válido'
            );
        }
        
        // Headers es opcional, pero si está presente debe ser un mapa
        if (input.containsKey('headers') &amp;&amp; input.get('headers') != null) {
            if (!(input.get('headers') instanceof Map&lt;String, Object&gt;)) {
                throw new CumuloMissingParameterException(
                    'El parámetro &quot;headers&quot; debe ser un objeto válido si se proporciona'
                );
            }
        }
    }
    
    private static Map&lt;String, Object&gt; performIntegration(
        String integrationPoint, 
        Map&lt;String, Object&gt; payload, 
        Map&lt;String, Object&gt; headers
    ) {
        // Lógica de integración
        return new Map&lt;String, Object&gt;{
            'success' =&gt; true,
            'integrationPoint' =&gt; integrationPoint,
            'processedAt' =&gt; System.now()
        };
    }
}</code></pre></div></section><section><h3 id="1384593519#ejemplo-4-validaci-n-con-informaci-n-detallada" data-toc="ejemplo-4-validaci-n-con-informaci-n-detallada#CumuloMissingParameterException.md-ejemplo-4-validaci-n-con-informaci-n-detallada">Ejemplo 4: Validaci&oacute;n con Informaci&oacute;n Detallada</h3><div class="detached code-block" id="1384593519#y8w7an_91"><pre><code class="language-none">public class CumuloValidator {
    
    public static void validateBusinessObject(Map&lt;String, Object&gt; businessObject, String objectType) {
        if (String.isBlank(objectType)) {
            throw new CumuloMissingParameterException('El tipo de objeto es requerido');
        }
        
        // Definir campos requeridos por tipo de objeto
        Map&lt;String, List&lt;String&gt;&gt; requiredFieldsByType = new Map&lt;String, List&lt;String&gt;&gt;{
            'CUSTOMER' =&gt; new List&lt;String&gt;{'name', 'email', 'phone'},
            'PRODUCT' =&gt; new List&lt;String&gt;{'name', 'sku', 'price'},
            'ORDER' =&gt; new List&lt;String&gt;{'customerId', 'productIds', 'totalAmount'}
        };
        
        if (!requiredFieldsByType.containsKey(objectType.toUpperCase())) {
            throw new IllegalArgumentException('Tipo de objeto no soportado: ' + objectType);
        }
        
        List&lt;String&gt; requiredFields = requiredFieldsByType.get(objectType.toUpperCase());
        List&lt;String&gt; missingFields = new List&lt;String&gt;();
        
        for (String field : requiredFields) {
            if (!businessObject.containsKey(field) || 
                businessObject.get(field) == null ||
                (businessObject.get(field) instanceof String &amp;&amp; 
                 String.isBlank((String)businessObject.get(field)))) {
                missingFields.add(field);
            }
        }
        
        if (!missingFields.isEmpty()) {
            throw new CumuloMissingParameterException(
                'Faltan los siguientes campos requeridos para ' + objectType + ': ' + 
                String.join(missingFields, ', ')
            );
        }
    }
}

// Uso
try {
    Map&lt;String, Object&gt; customer = new Map&lt;String, Object&gt;{
        'name' =&gt; 'Juan Pérez',
        'email' =&gt; 'juan@example.com'
        // Falta 'phone'
    };
    
    CumuloValidator.validateBusinessObject(customer, 'CUSTOMER');
} catch (CumuloMissingParameterException e) {
    System.debug('Error de validación: ' + e.getMessage());
    // Resultado: &quot;Faltan los siguientes campos requeridos para CUSTOMER: phone&quot;
}</code></pre></div></section></section><section><h2 id="1384593519#implementaci-n-extendida-propuesta" data-toc="implementaci-n-extendida-propuesta#CumuloMissingParameterException.md-implementaci-n-extendida-propuesta">Implementaci&oacute;n Extendida Propuesta</h2><p id="1384593519#y8w7an_92">Aunque la implementaci&oacute;n actual es minimalista, podr&iacute;a extenderse para incluir informaci&oacute;n m&aacute;s espec&iacute;fica:</p><div class="detached code-block" id="1384593519#y8w7an_93"><pre><code class="language-none">/**
 * @description       : Excepción para parámetros faltantes en el framework Cumulo
 * @author            : felipe.correa@nespon.com
 * @project           : Foundation Salesforce - Suratech - UH-17589
 * @last modified on  : 11-21-2024
 * @last modified by  : felipe.correa@nespon.com
 **/
public with sharing class CumuloMissingParameterException extends Exception {
    
    private String parameterName;
    private String parameterType;
    private String contextMethod;
    private List&lt;String&gt; missingParameters;
    
    /**
     * Constructor por defecto
     */
    public CumuloMissingParameterException() {
        super();
    }
    
    /**
     * Constructor con mensaje de error
     * @param message Mensaje descriptivo del error
     */
    public CumuloMissingParameterException(String message) {
        super(message);
    }
    
    /**
     * Constructor con información específica del parámetro
     * @param message Mensaje descriptivo del error
     * @param parameterName Nombre del parámetro faltante
     * @param contextMethod Método donde ocurrió el error
     */
    public CumuloMissingParameterException(String message, String parameterName, String contextMethod) {
        super(message);
        this.parameterName = parameterName;
        this.contextMethod = contextMethod;
    }
    
    /**
     * Constructor para múltiples parámetros faltantes
     * @param message Mensaje descriptivo del error
     * @param missingParameters Lista de parámetros faltantes
     * @param contextMethod Método donde ocurrió el error
     */
    public CumuloMissingParameterException(
        String message, 
        List&lt;String&gt; missingParameters, 
        String contextMethod
    ) {
        super(message);
        this.missingParameters = missingParameters;
        this.contextMethod = contextMethod;
    }
    
    /**
     * Constructor con excepción causa
     * @param message Mensaje descriptivo del error
     * @param cause Excepción que causó esta excepción
     */
    public CumuloMissingParameterException(String message, Exception cause) {
        super(message, cause);
    }
    
    /**
     * Obtiene el nombre del parámetro faltante
     * @return Nombre del parámetro
     */
    public String getParameterName() {
        return this.parameterName;
    }
    
    /**
     * Obtiene el tipo del parámetro faltante
     * @return Tipo del parámetro
     */
    public String getParameterType() {
        return this.parameterType;
    }
    
    /**
     * Obtiene el método donde ocurrió el error
     * @return Nombre del método
     */
    public String getContextMethod() {
        return this.contextMethod;
    }
    
    /**
     * Obtiene la lista de parámetros faltantes
     * @return Lista de parámetros faltantes
     */
    public List&lt;String&gt; getMissingParameters() {
        return this.missingParameters != null ? this.missingParameters : new List&lt;String&gt;();
    }
    
    /**
     * Genera un mensaje completo con toda la información disponible
     * @return Mensaje completo
     */
    public String getDetailedMessage() {
        String detailedMessage = getMessage();
        
        if (String.isNotBlank(contextMethod)) {
            detailedMessage += '\nMétodo: ' + contextMethod;
        }
        
        if (String.isNotBlank(parameterName)) {
            detailedMessage += '\nParámetro faltante: ' + parameterName;
        }
        
        if (missingParameters != null &amp;&amp; !missingParameters.isEmpty()) {
            detailedMessage += '\nParámetros faltantes: ' + String.join(missingParameters, ', ');
        }
        
        return detailedMessage;
    }
}</code></pre></div></section><section><h2 id="1384593519#mejores-pr-cticas-para-su-uso" data-toc="mejores-pr-cticas-para-su-uso#CumuloMissingParameterException.md-mejores-pr-cticas-para-su-uso">Mejores Pr&aacute;cticas para su Uso</h2><ol class="list list-decimal" id="1384593519#y8w7an_94" type="1" start="1"><li class="list-item" id="1384593519#y8w7an_95"><p id="1384593519#y8w7an_100"><span class="control" id="1384593519#y8w7an_101">Mensajes Espec&iacute;ficos</span>: Proporcionar mensajes de error claros que indiquen exactamente qu&eacute; par&aacute;metro falta y en qu&eacute; contexto.</p></li><li class="list-item" id="1384593519#y8w7an_96"><p id="1384593519#y8w7an_102"><span class="control" id="1384593519#y8w7an_103">Validaci&oacute;n Temprana</span>: Utilizar esta excepci&oacute;n al inicio de los m&eacute;todos para validar par&aacute;metros de entrada.</p></li><li class="list-item" id="1384593519#y8w7an_97"><p id="1384593519#y8w7an_104"><span class="control" id="1384593519#y8w7an_105">Agrupaci&oacute;n de Validaciones</span>: Cuando sea posible, validar todos los par&aacute;metros requeridos de una vez y reportar todos los faltantes.</p></li><li class="list-item" id="1384593519#y8w7an_98"><p id="1384593519#y8w7an_106"><span class="control" id="1384593519#y8w7an_107">Documentaci&oacute;n de Par&aacute;metros</span>: Asegurar que la documentaci&oacute;n de los m&eacute;todos indique claramente qu&eacute; par&aacute;metros son requeridos.</p></li><li class="list-item" id="1384593519#y8w7an_99"><p id="1384593519#y8w7an_108"><span class="control" id="1384593519#y8w7an_109">Manejo Diferenciado</span>: Capturar y manejar esta excepci&oacute;n espec&iacute;ficamente para proporcionar mensajes de error m&aacute;s &uacute;tiles a los usuarios.</p></li></ol></section><section><h2 id="1384593519#consideraciones-de-dise-o" data-toc="consideraciones-de-dise-o#CumuloMissingParameterException.md-consideraciones-de-dise-o">Consideraciones de Dise&ntilde;o</h2><section><h3 id="1384593519#ventajas-de-la-implementaci-n-actual" data-toc="ventajas-de-la-implementaci-n-actual#CumuloMissingParameterException.md-ventajas-de-la-implementaci-n-actual">Ventajas de la Implementaci&oacute;n Actual</h3><ol class="list list-decimal" id="1384593519#y8w7an_112" type="1" start="1"><li class="list-item" id="1384593519#y8w7an_113"><p><span class="control" id="1384593519#y8w7an_116">Simplicidad</span>: La implementaci&oacute;n minimalista es f&aacute;cil de entender y utilizar.</p></li><li class="list-item" id="1384593519#y8w7an_114"><p><span class="control" id="1384593519#y8w7an_117">Enfoque Espec&iacute;fico</span>: Se centra exclusivamente en representar errores de par&aacute;metros faltantes.</p></li><li class="list-item" id="1384593519#y8w7an_115"><p><span class="control" id="1384593519#y8w7an_118">Respeto a la Seguridad</span>: El modificador <span class="inline-code" id="1384593519#y8w7an_119">with sharing</span> asegura que se respeten las reglas de compartici&oacute;n.</p></li></ol></section><section><h3 id="1384593519#posibles-mejoras" data-toc="posibles-mejoras#CumuloMissingParameterException.md-posibles-mejoras">Posibles Mejoras</h3><ol class="list list-decimal" id="1384593519#y8w7an_120" type="1" start="1"><li class="list-item" id="1384593519#y8w7an_121"><p><span class="control" id="1384593519#y8w7an_124">Informaci&oacute;n Detallada</span>: Podr&iacute;a extenderse para incluir informaci&oacute;n m&aacute;s espec&iacute;fica sobre los par&aacute;metros faltantes.</p></li><li class="list-item" id="1384593519#y8w7an_122"><p><span class="control" id="1384593519#y8w7an_125">M&eacute;todos de Utilidad</span>: Podr&iacute;an a&ntilde;adirse m&eacute;todos est&aacute;ticos para facilitar la validaci&oacute;n com&uacute;n de par&aacute;metros.</p></li><li class="list-item" id="1384593519#y8w7an_123"><p><span class="control" id="1384593519#y8w7an_126">Integraci&oacute;n con Logging</span>: Podr&iacute;a incluir funcionalidad para registrar autom&aacute;ticamente los errores de par&aacute;metros faltantes.</p></li></ol></section></section><section><h2 id="1384593519#integraci-n-con-pruebas-unitarias" data-toc="integraci-n-con-pruebas-unitarias#CumuloMissingParameterException.md-integraci-n-con-pruebas-unitarias">Integraci&oacute;n con Pruebas Unitarias</h2><div class="detached code-block" id="1384593519#y8w7an_127"><pre><code class="language-none">@IsTest
private class CumuloMissingParameterExceptionTest {
    
    @IsTest
    static void testBasicException() {
        String expectedMessage = 'Parámetro requerido faltante: testParam';
        
        try {
            throw new CumuloMissingParameterException(expectedMessage);
        } catch (CumuloMissingParameterException e) {
            System.assertEquals(expectedMessage, e.getMessage());
            System.assertEquals('CumuloMissingParameterException', e.getTypeName());
        }
    }
    
    @IsTest
    static void testValidationMethod() {
        Map&lt;String, Object&gt; incompleteConfig = new Map&lt;String, Object&gt;{
            'endpoint' =&gt; 'https://test.com'
            // Falta apiKey
        };
        
        try {
            CumuloConfigurationManager.initializeFramework(incompleteConfig);
            System.assert(false, 'Debería haber lanzado CumuloMissingParameterException');
        } catch (CumuloMissingParameterException e) {
            System.assert(e.getMessage().contains('apiKey'));
        }
    }
}</code></pre></div></section><section><h2 id="1384593519#notas-adicionales" data-toc="notas-adicionales#CumuloMissingParameterException.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="1384593519#y8w7an_128" type="1" start="1"><li class="list-item" id="1384593519#y8w7an_129"><p>El nombre &quot;Cumulo&quot; sugiere que forma parte de un framework espec&iacute;fico dentro de la organizaci&oacute;n Suratech.</p></li><li class="list-item" id="1384593519#y8w7an_130"><p>El modificador <span class="inline-code" id="1384593519#y8w7an_134">with sharing</span> indica que respeta las reglas de compartici&oacute;n de Salesforce, lo cual es apropiado para validaciones que pueden involucrar datos sensibles.</p></li><li class="list-item" id="1384593519#y8w7an_131"><p>Esta excepci&oacute;n complementa otras excepciones del sistema como <span class="inline-code" id="1384593519#y8w7an_135">ProductHandlerImplementationException</span>, proporcionando un ecosistema completo de manejo de errores espec&iacute;ficos.</p></li><li class="list-item" id="1384593519#y8w7an_132"><p>La referencia al proyecto &quot;UH-17589&quot; indica que forma parte de un desarrollo espec&iacute;fico y estructurado dentro del framework Foundation Salesforce.</p></li><li class="list-item" id="1384593519#y8w7an_133"><p>Es una pr&aacute;ctica excelente tener excepciones espec&iacute;ficas para diferentes tipos de errores de validaci&oacute;n, mejorando tanto la experiencia del desarrollador como la capacidad de depuraci&oacute;n del sistema.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="2045408102">LocalEmisionNotificationHandlerTest</h1><section><h2 id="2045408102#descripci-n-general" data-toc="descripci-n-general#LocalEmisionNotificationHandlerTest.md-descripci-n-general">Descripci&oacute;n General</h2><p id="2045408102#fqiivs_8"><span class="inline-code" id="2045408102#fqiivs_9">LocalEmisionNotificationHandlerTest</span> es una clase de prueba de Apex dise&ntilde;ada para validar el funcionamiento de la clase <span class="inline-code" id="2045408102#fqiivs_10">LocalEmisionNotificationHandler</span>, que gestiona notificaciones de emisi&oacute;n local para productos.</p></section><section><h2 id="2045408102#autor-y-proyecto" data-toc="autor-y-proyecto#LocalEmisionNotificationHandlerTest.md-autor-y-proyecto">Autor y Proyecto</h2><ul class="list" id="2045408102#fqiivs_11" start="1"><li class="list-item" id="2045408102#fqiivs_12"><p><span class="control" id="2045408102#fqiivs_15">Autor</span>: felipe.correa@nespon.com</p></li><li class="list-item" id="2045408102#fqiivs_13"><p><span class="control" id="2045408102#fqiivs_16">Proyecto</span>: Foundation Salesforce - Suratech - UH-17589</p></li><li class="list-item" id="2045408102#fqiivs_14"><p><span class="control" id="2045408102#fqiivs_17">&Uacute;ltima modificaci&oacute;n</span>: 31 de enero de 2025</p></li></ul></section><section><h2 id="2045408102#estructura-de-la-clase" data-toc="estructura-de-la-clase#LocalEmisionNotificationHandlerTest.md-estructura-de-la-clase">Estructura de la Clase</h2><section><h3 id="2045408102#m-todo-testsetup" data-toc="m-todo-testsetup#LocalEmisionNotificationHandlerTest.md-m-todo-testsetup">M&eacute;todo @testSetup</h3><div class="detached code-block" id="2045408102#fqiivs_20"><pre><code class="language-none">@testSetup
static void makeData() {
  TestUtils.insertTestUsers();
}</code></pre></div><p id="2045408102#fqiivs_21">Este m&eacute;todo configura los datos de prueba necesarios, espec&iacute;ficamente insertando usuarios de prueba mediante la clase utilitaria <span class="inline-code" id="2045408102#fqiivs_22">TestUtils</span>.</p></section><section><h3 id="2045408102#m-todos-de-prueba" data-toc="m-todos-de-prueba#LocalEmisionNotificationHandlerTest.md-m-todos-de-prueba">M&eacute;todos de Prueba</h3><section><h4 id="2045408102#1-testlocalemision-success" data-toc="1-testlocalemision-success#LocalEmisionNotificationHandlerTest.md-1-testlocalemision-success">1. testLocalEmision_Success</h4><div class="detached code-block" id="2045408102#fqiivs_26"><pre><code class="language-none">@isTest
static void testLocalEmision_Success()</code></pre></div><p id="2045408102#fqiivs_27">Valida el flujo exitoso de la notificaci&oacute;n de emisi&oacute;n local:</p><ul class="list" id="2045408102#fqiivs_28" start="1"><li class="list-item" id="2045408102#fqiivs_29"><p>Configura un mock HTTP que devuelve c&oacute;digo 200 (OK)</p></li><li class="list-item" id="2045408102#fqiivs_30"><p>Ejecuta la prueba en el contexto de un usuario de prueba</p></li><li class="list-item" id="2045408102#fqiivs_31"><p>Crea un mapa de entrada con el producto 'viajes'</p></li><li class="list-item" id="2045408102#fqiivs_32"><p>Encola un trabajo as&iacute;ncrono con <span class="inline-code" id="2045408102#fqiivs_34">LocalEmisionNotificationHandler</span></p></li><li class="list-item" id="2045408102#fqiivs_33"><p>Verifica que el estado del trabajo sea 'Completed'</p></li></ul></section><section><h4 id="2045408102#2-testlocalemision-exception-failure" data-toc="2-testlocalemision-exception-failure#LocalEmisionNotificationHandlerTest.md-2-testlocalemision-exception-failure">2. testLocalEmision_Exception_Failure</h4><div class="detached code-block" id="2045408102#fqiivs_35"><pre><code class="language-none">@isTest
static void testLocalEmision_Exception_Failure()</code></pre></div><p id="2045408102#fqiivs_36">Prueba el manejo de errores cuando el servicio HTTP falla:</p><ul class="list" id="2045408102#fqiivs_37" start="1"><li class="list-item" id="2045408102#fqiivs_38"><p>Configura un mock HTTP que devuelve c&oacute;digo 400 con un error</p></li><li class="list-item" id="2045408102#fqiivs_39"><p>Ejecuta la prueba en el contexto de un usuario de prueba</p></li><li class="list-item" id="2045408102#fqiivs_40"><p>Intenta encolar un trabajo con <span class="inline-code" id="2045408102#fqiivs_42">LocalEmisionNotificationHandler</span></p></li><li class="list-item" id="2045408102#fqiivs_41"><p>Verifica que se lance una excepci&oacute;n con el mensaje 'Error en el servicio'</p></li></ul></section><section><h4 id="2045408102#3-testlocalemision-noproduct-failure" data-toc="3-testlocalemision-noproduct-failure#LocalEmisionNotificationHandlerTest.md-3-testlocalemision-noproduct-failure">3. testLocalEmision_NoProduct_Failure</h4><div class="detached code-block" id="2045408102#fqiivs_43"><pre><code class="language-none">@isTest
static void testLocalEmision_NoProduct_Failure()</code></pre></div><p id="2045408102#fqiivs_44">Prueba el escenario de fallo cuando no se proporciona un producto:</p><ul class="list" id="2045408102#fqiivs_45" start="1"><li class="list-item" id="2045408102#fqiivs_46"><p>Ejecuta la prueba en el contexto de un usuario de prueba</p></li><li class="list-item" id="2045408102#fqiivs_47"><p>Crea un mapa de entrada vac&iacute;o (sin producto)</p></li><li class="list-item" id="2045408102#fqiivs_48"><p>Intenta encolar un trabajo con <span class="inline-code" id="2045408102#fqiivs_50">LocalEmisionNotificationHandler</span></p></li><li class="list-item" id="2045408102#fqiivs_49"><p>Verifica que se lance una excepci&oacute;n con el mensaje 'No se encontro el producto'</p></li></ul></section></section></section><section><h2 id="2045408102#dependencias" data-toc="dependencias#LocalEmisionNotificationHandlerTest.md-dependencias">Dependencias</h2><ul class="list" id="2045408102#fqiivs_51" start="1"><li class="list-item" id="2045408102#fqiivs_52"><p><span class="inline-code" id="2045408102#fqiivs_55">TestUtils</span>: Clase utilitaria para crear datos de prueba</p></li><li class="list-item" id="2045408102#fqiivs_53"><p><span class="inline-code" id="2045408102#fqiivs_56">LocalEmisionNotificationHandler</span>: Clase principal que se est&aacute; probando</p></li><li class="list-item" id="2045408102#fqiivs_54"><p><span class="inline-code" id="2045408102#fqiivs_57">LocalEmisionNotificationHandlerMock</span>: Mock para simular respuestas HTTP</p></li></ul></section><section><h2 id="2045408102#notas-t-cnicas" data-toc="notas-t-cnicas#LocalEmisionNotificationHandlerTest.md-notas-t-cnicas">Notas T&eacute;cnicas</h2><ul class="list" id="2045408102#fqiivs_58" start="1"><li class="list-item" id="2045408102#fqiivs_59"><p>La clase utiliza el framework de pruebas de Apex con anotaciones <span class="inline-code" id="2045408102#fqiivs_64">@isTest</span></p></li><li class="list-item" id="2045408102#fqiivs_60"><p>Implementa pruebas para escenarios positivos y negativos</p></li><li class="list-item" id="2045408102#fqiivs_61"><p>Utiliza mocks HTTP para simular llamadas a servicios externos</p></li><li class="list-item" id="2045408102#fqiivs_62"><p>Emplea trabajos as&iacute;ncronos con <span class="inline-code" id="2045408102#fqiivs_65">System.enqueueJob()</span></p></li><li class="list-item" id="2045408102#fqiivs_63"><p>Verifica el estado de los trabajos as&iacute;ncronos despu&eacute;s de su ejecuci&oacute;n</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1406606362">IFeatureFlags</h1><section><h2 id="1406606362#descripci-n-general" data-toc="descripci-n-general#IFeatureFlags.md-descripci-n-general">Descripci&oacute;n General</h2><p id="1406606362#-22780s_19"><span class="inline-code" id="1406606362#-22780s_20">IFeatureFlags</span> es una interfaz que define el contrato para la evaluaci&oacute;n de banderas de caracter&iacute;sticas (feature flags) en el sistema. Esta interfaz establece el m&eacute;todo necesario para evaluar si una caracter&iacute;stica espec&iacute;fica est&aacute; habilitada o no, devolviendo un resultado detallado de la evaluaci&oacute;n.</p></section><section><h2 id="1406606362#autor" data-toc="autor#IFeatureFlags.md-autor">Autor</h2><p id="1406606362#-22780s_21">Fabian Lopez \&lt;fabian.lopez@nespon.com\&gt;</p></section><section><h2 id="1406606362#ltima-modificaci-n" data-toc="ltima-modificaci-n#IFeatureFlags.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="1406606362#-22780s_22">11 de abril de 2025</p></section><section><h2 id="1406606362#definici-n-de-la-interfaz" data-toc="definici-n-de-la-interfaz#IFeatureFlags.md-definici-n-de-la-interfaz">Definici&oacute;n de la Interfaz</h2><div class="detached code-block" id="1406606362#-22780s_23"><pre><code class="language-none">public interface IFeatureFlags {
    FeatureFlags.FeatureEvaluationResult evaluate(String featureName);
}</code></pre></div></section><section><h2 id="1406606362#m-todos" data-toc="m-todos#IFeatureFlags.md-m-todos">M&eacute;todos</h2><section><h3 id="1406606362#evaluate-string-featurename" data-toc="evaluate-string-featurename#IFeatureFlags.md-evaluate-string-featurename">evaluate(String featureName)</h3><section><h4 id="1406606362#descripci-n" data-toc="descripci-n#IFeatureFlags.md-descripci-n">Descripci&oacute;n</h4><p id="1406606362#-22780s_30">Este m&eacute;todo eval&uacute;a si una caracter&iacute;stica espec&iacute;fica est&aacute; habilitada, bas&aacute;ndose en el nombre de la caracter&iacute;stica proporcionado.</p></section><section><h4 id="1406606362#par-metros" data-toc="par-metros#IFeatureFlags.md-par-metros">Par&aacute;metros</h4><ul class="list" id="1406606362#-22780s_31" start="1"><li class="list-item" id="1406606362#-22780s_32"><p><span class="inline-code" id="1406606362#-22780s_33">featureName</span> (String): Nombre de la caracter&iacute;stica a evaluar.</p></li></ul></section><section><h4 id="1406606362#retorno" data-toc="retorno#IFeatureFlags.md-retorno">Retorno</h4><ul class="list" id="1406606362#-22780s_34" start="1"><li class="list-item" id="1406606362#-22780s_35"><p><span class="inline-code" id="1406606362#-22780s_36">FeatureFlags.FeatureEvaluationResult</span>: Objeto que contiene el resultado detallado de la evaluaci&oacute;n de la caracter&iacute;stica, incluyendo si est&aacute; habilitada y posiblemente informaci&oacute;n adicional sobre el motivo de la decisi&oacute;n.</p></li></ul></section></section></section><section><h2 id="1406606362#dependencias" data-toc="dependencias#IFeatureFlags.md-dependencias">Dependencias</h2><ul class="list" id="1406606362#-22780s_37" start="1"><li class="list-item" id="1406606362#-22780s_38"><p><span class="inline-code" id="1406606362#-22780s_39">FeatureFlags.FeatureEvaluationResult</span>: Clase anidada o interna que define la estructura del resultado de evaluaci&oacute;n de una caracter&iacute;stica.</p></li></ul></section><section><h2 id="1406606362#prop-sito-y-aplicaciones" data-toc="prop-sito-y-aplicaciones#IFeatureFlags.md-prop-sito-y-aplicaciones">Prop&oacute;sito y Aplicaciones</h2><p id="1406606362#-22780s_40">El prop&oacute;sito principal de esta interfaz es proporcionar una abstracci&oacute;n para el mecanismo de evaluaci&oacute;n de banderas de caracter&iacute;sticas, permitiendo:</p><ol class="list list-decimal" id="1406606362#-22780s_41" type="1" start="1"><li class="list-item" id="1406606362#-22780s_44"><p><span class="control" id="1406606362#-22780s_48">Decisiones Din&aacute;micas</span>: Tomar decisiones en tiempo de ejecuci&oacute;n sobre qu&eacute; caracter&iacute;sticas est&aacute;n disponibles.</p></li><li class="list-item" id="1406606362#-22780s_45"><p><span class="control" id="1406606362#-22780s_49">Flexibilidad de Implementaci&oacute;n</span>: Permitir diferentes estrategias de evaluaci&oacute;n que pueden ser intercambiadas o modificadas sin afectar al c&oacute;digo que las utiliza.</p></li><li class="list-item" id="1406606362#-22780s_46"><p><span class="control" id="1406606362#-22780s_50">Pruebas Simplificadas</span>: Facilitar la creaci&oacute;n de implementaciones mock para pruebas unitarias.</p></li><li class="list-item" id="1406606362#-22780s_47"><p><span class="control" id="1406606362#-22780s_51">Desacoplamiento</span>: Separar la l&oacute;gica de decisi&oacute;n sobre caracter&iacute;sticas de la l&oacute;gica de negocio que depende de esas decisiones.</p></li></ol><p id="1406606362#-22780s_42">Esta interfaz es especialmente &uacute;til en escenarios como:</p><ul class="list" id="1406606362#-22780s_43" start="1"><li class="list-item" id="1406606362#-22780s_52"><p><span class="control" id="1406606362#-22780s_56">Despliegue Progresivo</span>: Habilitar nuevas caracter&iacute;sticas gradualmente para diferentes segmentos de usuarios.</p></li><li class="list-item" id="1406606362#-22780s_53"><p><span class="control" id="1406606362#-22780s_57">Pruebas A/B</span>: Mostrar diferentes variantes de una caracter&iacute;stica a diferentes usuarios para medir su eficacia.</p></li><li class="list-item" id="1406606362#-22780s_54"><p><span class="control" id="1406606362#-22780s_58">Switches de Emergencia</span>: Desactivar r&aacute;pidamente caracter&iacute;sticas problem&aacute;ticas sin necesidad de redeployer.</p></li><li class="list-item" id="1406606362#-22780s_55"><p><span class="control" id="1406606362#-22780s_59">Personalizaci&oacute;n por Usuario/Perfil</span>: Adaptar la experiencia del usuario bas&aacute;ndose en su perfil, permisos o preferencias.</p></li></ul></section><section><h2 id="1406606362#clase-featureevaluationresult-inferida" data-toc="clase-featureevaluationresult-inferida#IFeatureFlags.md-clase-featureevaluationresult-inferida">Clase FeatureEvaluationResult Inferida</h2><p id="1406606362#-22780s_60">Aunque no se muestra en el c&oacute;digo proporcionado, podemos inferir que existe una clase <span class="inline-code" id="1406606362#-22780s_62">FeatureEvaluationResult</span> dentro de una clase principal <span class="inline-code" id="1406606362#-22780s_63">FeatureFlags</span>. Esta clase probablemente tendr&iacute;a una estructura similar a la siguiente:</p><div class="detached code-block" id="1406606362#-22780s_61"><pre><code class="language-none">public class FeatureFlags {
    
    public class FeatureEvaluationResult {
        private final Boolean isEnabled;
        private final String reason;
        private final Map&lt;String, Object&gt; metadata;
        
        public FeatureEvaluationResult(Boolean isEnabled, String reason) {
            this.isEnabled = isEnabled;
            this.reason = reason;
            this.metadata = new Map&lt;String, Object&gt;();
        }
        
        public FeatureEvaluationResult(Boolean isEnabled, String reason, Map&lt;String, Object&gt; metadata) {
            this.isEnabled = isEnabled;
            this.reason = reason;
            this.metadata = metadata != null ? metadata : new Map&lt;String, Object&gt;();
        }
        
        public Boolean isEnabled() {
            return isEnabled;
        }
        
        public String getReason() {
            return reason;
        }
        
        public Map&lt;String, Object&gt; getMetadata() {
            return metadata;
        }
        
        public Object getMetadataValue(String key) {
            return metadata.containsKey(key) ? metadata.get(key) : null;
        }
    }
    
    // Otros métodos y clases de la clase principal FeatureFlags...
}</code></pre></div></section><section><h2 id="1406606362#ejemplos-de-implementaci-n" data-toc="ejemplos-de-implementaci-n#IFeatureFlags.md-ejemplos-de-implementaci-n">Ejemplos de Implementaci&oacute;n</h2><section><h3 id="1406606362#implementaci-n-b-sica" data-toc="implementaci-n-b-sica#IFeatureFlags.md-implementaci-n-b-sica">Implementaci&oacute;n B&aacute;sica</h3><div class="detached code-block" id="1406606362#-22780s_69"><pre><code class="language-none">public class BasicFeatureFlags implements IFeatureFlags {
    
    private Map&lt;String, Boolean&gt; featuresMap;
    
    public BasicFeatureFlags() {
        // Inicializar con algunas características predeterminadas
        featuresMap = new Map&lt;String, Boolean&gt;{
            'NewUserInterface' =&gt; true,
            'AdvancedReporting' =&gt; false,
            'MultiLanguageSupport' =&gt; true
        };
    }
    
    public FeatureFlags.FeatureEvaluationResult evaluate(String featureName) {
        if (String.isBlank(featureName)) {
            return new FeatureFlags.FeatureEvaluationResult(false, 'Feature name is blank');
        }
        
        Boolean isEnabled = featuresMap.containsKey(featureName) ? featuresMap.get(featureName) : false;
        String reason = isEnabled ? 'Feature explicitly enabled' : 'Feature not enabled or not found';
        
        return new FeatureFlags.FeatureEvaluationResult(isEnabled, reason);
    }
}</code></pre></div></section><section><h3 id="1406606362#implementaci-n-basada-en-metadatos-personalizados" data-toc="implementaci-n-basada-en-metadatos-personalizados#IFeatureFlags.md-implementaci-n-basada-en-metadatos-personalizados">Implementaci&oacute;n Basada en Metadatos Personalizados</h3><div class="detached code-block" id="1406606362#-22780s_70"><pre><code class="language-none">public class MetadataFeatureFlags implements IFeatureFlags {
    
    private IFeatureFlagProvider provider;
    
    public MetadataFeatureFlags() {
        this.provider = new DefaultFeatureFlagProvider();
    }
    
    public MetadataFeatureFlags(IFeatureFlagProvider provider) {
        this.provider = provider;
    }
    
    public FeatureFlags.FeatureEvaluationResult evaluate(String featureName) {
        if (String.isBlank(featureName)) {
            return new FeatureFlags.FeatureEvaluationResult(false, 'Feature name is blank');
        }
        
        Map&lt;String, FeatureFlag__mdt&gt; featureFlags = provider.getFeatureFlags();
        
        // Si la bandera no existe, la característica está deshabilitada
        if (!featureFlags.containsKey(featureName)) {
            return new FeatureFlags.FeatureEvaluationResult(
                false, 
                'Feature not found in metadata'
            );
        }
        
        FeatureFlag__mdt flag = featureFlags.get(featureName);
        
        // Si la bandera no está activa, la característica está deshabilitada
        if (!flag.Is_Active__c) {
            return new FeatureFlags.FeatureEvaluationResult(
                false, 
                'Feature is defined but not active'
            );
        }
        
        // Si la bandera requiere un permiso personalizado, verificar si el usuario actual lo tiene
        if (String.isNotBlank(flag.Custom_Permission_Name__c)) {
            Boolean hasPermission = FeatureManagement.checkPermission(flag.Custom_Permission_Name__c);
            
            if (!hasPermission) {
                return new FeatureFlags.FeatureEvaluationResult(
                    false, 
                    'User lacks required permission: ' + flag.Custom_Permission_Name__c
                );
            }
        }
        
        // Crear un mapa con metadatos adicionales que podrían ser útiles
        Map&lt;String, Object&gt; metadata = new Map&lt;String, Object&gt;{
            'flagId' =&gt; flag.DeveloperName,
            'lastModified' =&gt; flag.LastModifiedDate,
            'description' =&gt; flag.Description__c
        };
        
        // Si no se requiere permiso personalizado y la bandera está activa, la característica está habilitada
        return new FeatureFlags.FeatureEvaluationResult(
            true, 
            'Feature is active' + (String.isNotBlank(flag.Custom_Permission_Name__c) ? 
                                ' and user has required permission' : ''),
            metadata
        );
    }
}</code></pre></div></section><section><h3 id="1406606362#implementaci-n-basada-en-usuarios" data-toc="implementaci-n-basada-en-usuarios#IFeatureFlags.md-implementaci-n-basada-en-usuarios">Implementaci&oacute;n Basada en Usuarios</h3><div class="detached code-block" id="1406606362#-22780s_71"><pre><code class="language-none">public class UserBasedFeatureFlags implements IFeatureFlags {
    
    private Set&lt;String&gt; betaUserEmails;
    private Set&lt;String&gt; betaFeatures;
    
    public UserBasedFeatureFlags() {
        // Inicializar conjuntos de usuarios beta y características beta
        betaUserEmails = new Set&lt;String&gt;{
            'test.user@example.com',
            'beta.tester@example.com'
        };
        
        betaFeatures = new Set&lt;String&gt;{
            'NewSearchAlgorithm',
            'RedesignedProfile',
            'EnhancedDashboards'
        };
    }
    
    public FeatureFlags.FeatureEvaluationResult evaluate(String featureName) {
        if (String.isBlank(featureName)) {
            return new FeatureFlags.FeatureEvaluationResult(false, 'Feature name is blank');
        }
        
        // Si no es una característica beta, siempre está habilitada
        if (!betaFeatures.contains(featureName)) {
            return new FeatureFlags.FeatureEvaluationResult(true, 'Not a beta feature');
        }
        
        // Obtener el email del usuario actual
        String userEmail = UserInfo.getUserEmail();
        
        // Verificar si el usuario es un beta tester
        Boolean isBetaUser = betaUserEmails.contains(userEmail);
        
        // Crear metadatos con información adicional
        Map&lt;String, Object&gt; metadata = new Map&lt;String, Object&gt;{
            'isBetaFeature' =&gt; true,
            'userEmail' =&gt; userEmail
        };
        
        if (isBetaUser) {
            return new FeatureFlags.FeatureEvaluationResult(
                true, 
                'User is a beta tester with access to this feature',
                metadata
            );
        } else {
            return new FeatureFlags.FeatureEvaluationResult(
                false, 
                'User is not a beta tester',
                metadata
            );
        }
    }
}</code></pre></div></section><section><h3 id="1406606362#implementaci-n-compuesta" data-toc="implementaci-n-compuesta#IFeatureFlags.md-implementaci-n-compuesta">Implementaci&oacute;n Compuesta</h3><div class="detached code-block" id="1406606362#-22780s_72"><pre><code class="language-none">public class CompositeFeatureFlags implements IFeatureFlags {
    
    private List&lt;IFeatureFlags&gt; evaluators;
    
    public CompositeFeatureFlags() {
        // Inicializar con evaluadores predeterminados
        evaluators = new List&lt;IFeatureFlags&gt;{
            new MetadataFeatureFlags(),
            new UserBasedFeatureFlags()
        };
    }
    
    public CompositeFeatureFlags(List&lt;IFeatureFlags&gt; evaluators) {
        this.evaluators = evaluators != null ? evaluators : new List&lt;IFeatureFlags&gt;();
    }
    
    public FeatureFlags.FeatureEvaluationResult evaluate(String featureName) {
        if (String.isBlank(featureName)) {
            return new FeatureFlags.FeatureEvaluationResult(false, 'Feature name is blank');
        }
        
        // Si cualquier evaluador habilita la característica, se considera habilitada
        for (IFeatureFlags evaluator : evaluators) {
            FeatureFlags.FeatureEvaluationResult result = evaluator.evaluate(featureName);
            if (result.isEnabled()) {
                return result;
            }
        }
        
        // Si ningún evaluador habilitó la característica, devolver el resultado del último evaluador
        // o un resultado predeterminado si no hay evaluadores
        if (!evaluators.isEmpty()) {
            return evaluators[evaluators.size() - 1].evaluate(featureName);
        } else {
            return new FeatureFlags.FeatureEvaluationResult(false, 'No feature flag evaluators available');
        }
    }
    
    public void addEvaluator(IFeatureFlags evaluator) {
        if (evaluator != null) {
            evaluators.add(evaluator);
        }
    }
}</code></pre></div></section><section><h3 id="1406606362#implementaci-n-mock-para-pruebas" data-toc="implementaci-n-mock-para-pruebas#IFeatureFlags.md-implementaci-n-mock-para-pruebas">Implementaci&oacute;n Mock para Pruebas</h3><div class="detached code-block" id="1406606362#-22780s_73"><pre><code class="language-none">@IsTest
public class MockFeatureFlags implements IFeatureFlags {
    
    private Map&lt;String, Boolean&gt; featuresMap;
    private Map&lt;String, String&gt; reasonsMap;
    
    public MockFeatureFlags() {
        featuresMap = new Map&lt;String, Boolean&gt;();
        reasonsMap = new Map&lt;String, String&gt;();
    }
    
    public FeatureFlags.FeatureEvaluationResult evaluate(String featureName) {
        Boolean isEnabled = featuresMap.containsKey(featureName) ? featuresMap.get(featureName) : false;
        String reason = reasonsMap.containsKey(featureName) ? reasonsMap.get(featureName) : 'Default mock reason';
        
        return new FeatureFlags.FeatureEvaluationResult(isEnabled, reason);
    }
    
    // Métodos adicionales para configurar el mock
    
    public void setFeatureEnabled(String featureName, Boolean isEnabled) {
        featuresMap.put(featureName, isEnabled);
    }
    
    public void setFeatureReason(String featureName, String reason) {
        reasonsMap.put(featureName, reason);
    }
    
    public void reset() {
        featuresMap.clear();
        reasonsMap.clear();
    }
}</code></pre></div></section></section><section><h2 id="1406606362#ejemplo-de-uso" data-toc="ejemplo-de-uso#IFeatureFlags.md-ejemplo-de-uso">Ejemplo de Uso</h2><div class="detached code-block" id="1406606362#-22780s_74"><pre><code class="language-none">public class ProductController {
    
    private final IFeatureFlags featureFlags;
    
    public ProductController() {
        // Usar la implementación predeterminada
        this.featureFlags = new MetadataFeatureFlags();
    }
    
    // Constructor con inyección de dependencias para pruebas
    @TestVisible
    private ProductController(IFeatureFlags featureFlags) {
        this.featureFlags = featureFlags;
    }
    
    public List&lt;Product2&gt; getProductsForDisplay() {
        List&lt;Product2&gt; products = [SELECT Id, Name, Description, Family, IsActive FROM Product2 WHERE IsActive = true];
        
        // Verificar si la característica de filtrado avanzado está habilitada
        FeatureFlags.FeatureEvaluationResult advancedFilteringResult = 
            featureFlags.evaluate('AdvancedProductFiltering');
        
        if (advancedFilteringResult.isEnabled()) {
            // Aplicar filtrado avanzado
            return applyAdvancedFiltering(products);
        } else {
            // Aplicar filtrado básico
            return applyBasicFiltering(products);
        }
    }
    
    private List&lt;Product2&gt; applyAdvancedFiltering(List&lt;Product2&gt; products) {
        // Implementación del filtrado avanzado
        // ...
        return products;
    }
    
    private List&lt;Product2&gt; applyBasicFiltering(List&lt;Product2&gt; products) {
        // Implementación del filtrado básico
        // ...
        return products;
    }
}</code></pre></div></section><section><h2 id="1406606362#ejemplo-de-uso-en-controlador-lightning" data-toc="ejemplo-de-uso-en-controlador-lightning#IFeatureFlags.md-ejemplo-de-uso-en-controlador-lightning">Ejemplo de Uso en Controlador Lightning</h2><div class="detached code-block" id="1406606362#-22780s_75"><pre><code class="language-javascript">// productController.js
import { LightningElement, wire } from 'lwc';
import checkFeatureEnabled from '@salesforce/apex/FeatureFlagController.checkFeatureEnabled';
import getProducts from '@salesforce/apex/ProductController.getProducts';

export default class ProductList extends LightningElement {
    products;
    error;
    showAdvancedSearch = false;
    
    connectedCallback() {
        // Verificar si la característica de búsqueda avanzada está habilitada
        checkFeatureEnabled({ featureName: 'AdvancedProductSearch' })
            .then(result =&gt; {
                this.showAdvancedSearch = result.isEnabled;
                if (result.isEnabled) {
                    console.log('Advanced search enabled: ' + result.reason);
                }
            })
            .catch(error =&gt; {
                console.error('Error checking feature flag:', error);
            });
    }
    
    @wire(getProducts)
    wiredProducts({ error, data }) {
        if (data) {
            this.products = data;
            this.error = undefined;
        } else if (error) {
            this.error = error;
            this.products = undefined;
        }
    }
    
    // Resto del controlador...
}</code></pre></div><div class="detached code-block" id="1406606362#-22780s_76"><pre><code class="language-none">// FeatureFlagController.cls
public with sharing class FeatureFlagController {
    
    private static IFeatureFlags featureFlags = new MetadataFeatureFlags();
    
    @AuraEnabled(cacheable=true)
    public static Map&lt;String, Object&gt; checkFeatureEnabled(String featureName) {
        FeatureFlags.FeatureEvaluationResult result = featureFlags.evaluate(featureName);
        
        // Convertir el resultado a un mapa que pueda ser serializado para JavaScript
        return new Map&lt;String, Object&gt;{
            'isEnabled' =&gt; result.isEnabled(),
            'reason' =&gt; result.getReason()
        };
    }
}</code></pre></div></section><section><h2 id="1406606362#ejemplo-de-uso-en-pruebas" data-toc="ejemplo-de-uso-en-pruebas#IFeatureFlags.md-ejemplo-de-uso-en-pruebas">Ejemplo de Uso en Pruebas</h2><div class="detached code-block" id="1406606362#-22780s_77"><pre><code class="language-none">@IsTest
private class ProductControllerTest {
    
    @IsTest
    static void testGetProductsWithAdvancedFilteringEnabled() {
        // Configurar datos de prueba
        createTestProducts();
        
        // Crear un mock de IFeatureFlags
        MockFeatureFlags mockFeatureFlags = new MockFeatureFlags();
        mockFeatureFlags.setFeatureEnabled('AdvancedProductFiltering', true);
        mockFeatureFlags.setFeatureReason('AdvancedProductFiltering', 'Enabled for test');
        
        // Crear una instancia del controlador con el mock
        ProductController controller = new ProductController(mockFeatureFlags);
        
        // Ejecutar el método a probar
        Test.startTest();
        List&lt;Product2&gt; products = controller.getProductsForDisplay();
        Test.stopTest();
        
        // Verificar que se aplicó el filtrado avanzado
        // (Aquí se agregarían las aserciones específicas según la implementación del filtrado)
        System.assertEquals(5, products.size(), 'Should return 5 products with advanced filtering');
    }
    
    @IsTest
    static void testGetProductsWithAdvancedFilteringDisabled() {
        // Configurar datos de prueba
        createTestProducts();
        
        // Crear un mock de IFeatureFlags
        MockFeatureFlags mockFeatureFlags = new MockFeatureFlags();
        mockFeatureFlags.setFeatureEnabled('AdvancedProductFiltering', false);
        mockFeatureFlags.setFeatureReason('AdvancedProductFiltering', 'Disabled for test');
        
        // Crear una instancia del controlador con el mock
        ProductController controller = new ProductController(mockFeatureFlags);
        
        // Ejecutar el método a probar
        Test.startTest();
        List&lt;Product2&gt; products = controller.getProductsForDisplay();
        Test.stopTest();
        
        // Verificar que se aplicó el filtrado básico
        // (Aquí se agregarían las aserciones específicas según la implementación del filtrado)
        System.assertEquals(3, products.size(), 'Should return 3 products with basic filtering');
    }
    
    private static void createTestProducts() {
        // Lógica para crear productos de prueba
        // ...
    }
}</code></pre></div></section><section><h2 id="1406606362#relaci-n-con-ifeatureflagprovider" data-toc="relaci-n-con-ifeatureflagprovider#IFeatureFlags.md-relaci-n-con-ifeatureflagprovider">Relaci&oacute;n con IFeatureFlagProvider</h2><p id="1406606362#-22780s_78">La interfaz <span class="inline-code" id="1406606362#-22780s_81">IFeatureFlags</span> probablemente trabaja en conjunto con la interfaz <span class="inline-code" id="1406606362#-22780s_82">IFeatureFlagProvider</span> en un sistema de gesti&oacute;n de banderas de caracter&iacute;sticas m&aacute;s amplio:</p><ul class="list" id="1406606362#-22780s_79" start="1"><li class="list-item" id="1406606362#-22780s_83"><p><span class="inline-code" id="1406606362#-22780s_85">IFeatureFlagProvider</span>: Se enfoca en obtener y proporcionar acceso a la configuraci&oacute;n de las banderas de caracter&iacute;sticas.</p></li><li class="list-item" id="1406606362#-22780s_84"><p><span class="inline-code" id="1406606362#-22780s_86">IFeatureFlags</span>: Se enfoca en la evaluaci&oacute;n l&oacute;gica de si una caracter&iacute;stica est&aacute; habilitada o no para un contexto particular.</p></li></ul><p id="1406606362#-22780s_80">Una implementaci&oacute;n t&iacute;pica de <span class="inline-code" id="1406606362#-22780s_87">IFeatureFlags</span> (como la clase <span class="inline-code" id="1406606362#-22780s_88">MetadataFeatureFlags</span> en los ejemplos) podr&iacute;a utilizar un <span class="inline-code" id="1406606362#-22780s_89">IFeatureFlagProvider</span> para obtener la configuraci&oacute;n de las banderas y luego aplicar la l&oacute;gica de evaluaci&oacute;n.</p></section><section><h2 id="1406606362#mejores-pr-cticas" data-toc="mejores-pr-cticas#IFeatureFlags.md-mejores-pr-cticas">Mejores Pr&aacute;cticas</h2><ol class="list list-decimal" id="1406606362#-22780s_90" type="1" start="1"><li class="list-item" id="1406606362#-22780s_91"><p><span class="control" id="1406606362#-22780s_96">Inyecci&oacute;n de Dependencias</span>: Utilizar inyecci&oacute;n de dependencias para proporcionar implementaciones espec&iacute;ficas de <span class="inline-code" id="1406606362#-22780s_97">IFeatureFlags</span> a las clases que lo necesitan, facilitando las pruebas y la flexibilidad.</p></li><li class="list-item" id="1406606362#-22780s_92"><p><span class="control" id="1406606362#-22780s_98">Resultados Informativos</span>: Proporcionar razones claras y detalladas en los resultados de evaluaci&oacute;n para facilitar la depuraci&oacute;n y el entendimiento.</p></li><li class="list-item" id="1406606362#-22780s_93"><p><span class="control" id="1406606362#-22780s_99">Cach&eacute; Inteligente</span>: Implementar mecanismos de cach&eacute; para evitar evaluaciones repetitivas de las mismas caracter&iacute;sticas en una misma transacci&oacute;n.</p></li><li class="list-item" id="1406606362#-22780s_94"><p><span class="control" id="1406606362#-22780s_100">Auditor&iacute;a</span>: Considerar registrar evaluaciones importantes para an&aacute;lisis y depuraci&oacute;n.</p></li><li class="list-item" id="1406606362#-22780s_95"><p><span class="control" id="1406606362#-22780s_101">Comportamiento Predeterminado Seguro</span>: Si una caracter&iacute;stica no est&aacute; definida, normalmente deber&iacute;a considerarse como deshabilitada.</p></li></ol></section><section><h2 id="1406606362#consideraciones-de-dise-o" data-toc="consideraciones-de-dise-o#IFeatureFlags.md-consideraciones-de-dise-o">Consideraciones de Dise&ntilde;o</h2><section><h3 id="1406606362#ventajas" data-toc="ventajas#IFeatureFlags.md-ventajas">Ventajas</h3><ol class="list list-decimal" id="1406606362#-22780s_104" type="1" start="1"><li class="list-item" id="1406606362#-22780s_105"><p><span class="control" id="1406606362#-22780s_109">Flexibilidad</span>: Permite intercambiar diferentes estrategias de evaluaci&oacute;n sin modificar el c&oacute;digo cliente.</p></li><li class="list-item" id="1406606362#-22780s_106"><p><span class="control" id="1406606362#-22780s_110">Testabilidad</span>: Facilita la prueba de c&oacute;digo que depende de banderas de caracter&iacute;sticas.</p></li><li class="list-item" id="1406606362#-22780s_107"><p><span class="control" id="1406606362#-22780s_111">Separaci&oacute;n de Responsabilidades</span>: Separa la l&oacute;gica de evaluaci&oacute;n de caracter&iacute;sticas de la l&oacute;gica de negocio.</p></li><li class="list-item" id="1406606362#-22780s_108"><p><span class="control" id="1406606362#-22780s_112">Extensibilidad</span>: Permite a&ntilde;adir nuevas estrategias de evaluaci&oacute;n sin modificar el c&oacute;digo existente.</p></li></ol></section><section><h3 id="1406606362#desaf-os" data-toc="desaf-os#IFeatureFlags.md-desaf-os">Desaf&iacute;os</h3><ol class="list list-decimal" id="1406606362#-22780s_113" type="1" start="1"><li class="list-item" id="1406606362#-22780s_114"><p><span class="control" id="1406606362#-22780s_117">Complejidad</span>: Introduce una capa adicional de abstracci&oacute;n.</p></li><li class="list-item" id="1406606362#-22780s_115"><p><span class="control" id="1406606362#-22780s_118">Overhead de Performance</span>: Puede a&ntilde;adir cierto overhead de rendimiento, especialmente si la evaluaci&oacute;n es compleja.</p></li><li class="list-item" id="1406606362#-22780s_116"><p><span class="control" id="1406606362#-22780s_119">Mantenimiento</span>: Requiere mantener la configuraci&oacute;n de banderas actualizada y relevante.</p></li></ol></section></section><section><h2 id="1406606362#notas-adicionales" data-toc="notas-adicionales#IFeatureFlags.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="1406606362#-22780s_120" type="1" start="1"><li class="list-item" id="1406606362#-22780s_121"><p>La interfaz <span class="inline-code" id="1406606362#-22780s_125">IFeatureFlags</span> es parte de un sistema m&aacute;s amplio de gesti&oacute;n de caracter&iacute;sticas que probablemente incluye otros componentes como proveedores de configuraci&oacute;n, servicios de administraci&oacute;n, etc.</p></li><li class="list-item" id="1406606362#-22780s_122"><p>La clase <span class="inline-code" id="1406606362#-22780s_126">FeatureEvaluationResult</span> proporciona m&aacute;s informaci&oacute;n que un simple booleano, permitiendo entender por qu&eacute; una caracter&iacute;stica est&aacute; habilitada o deshabilitada.</p></li><li class="list-item" id="1406606362#-22780s_123"><p>Este enfoque a menudo se utiliza en conjunto con estrategias de despliegue continuo, permitiendo liberar c&oacute;digo que contiene caracter&iacute;sticas incompletas o experimentales sin exponerlas a todos los usuarios.</p></li><li class="list-item" id="1406606362#-22780s_124"><p>Las implementaciones concretas pueden variar significativamente seg&uacute;n los requisitos espec&iacute;ficos del sistema, desde simples verificaciones de configuraci&oacute;n hasta algoritmos complejos que consideran m&uacute;ltiples factores como perfiles de usuario, regiones geogr&aacute;ficas, horarios, etc.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1223111818">IFeatureFlagProvider</h1><section><h2 id="1223111818#descripci-n-general" data-toc="descripci-n-general#IFeatureFlagProvider.md-descripci-n-general">Descripci&oacute;n General</h2><p id="1223111818#-een8ta_17"><span class="inline-code" id="1223111818#-een8ta_18">IFeatureFlagProvider</span> es una interfaz que define el contrato para proveedores de banderas de caracter&iacute;sticas (feature flags) en el sistema. Esta interfaz establece los m&eacute;todos necesarios para acceder tanto a los nombres de permisos personalizados como a las configuraciones de banderas de caracter&iacute;sticas almacenadas en metadatos personalizados.</p></section><section><h2 id="1223111818#definici-n-de-la-interfaz" data-toc="definici-n-de-la-interfaz#IFeatureFlagProvider.md-definici-n-de-la-interfaz">Definici&oacute;n de la Interfaz</h2><div class="detached code-block" id="1223111818#-een8ta_19"><pre><code class="language-none">public interface IFeatureFlagProvider {
    
    Set&lt;String&gt; getCustomPermissionNames();
    Map&lt;String,FeatureFlag__mdt&gt; getFeatureFlags();

}</code></pre></div></section><section><h2 id="1223111818#m-todos" data-toc="m-todos#IFeatureFlagProvider.md-m-todos">M&eacute;todos</h2><section><h3 id="1223111818#getcustompermissionnames" data-toc="getcustompermissionnames#IFeatureFlagProvider.md-getcustompermissionnames">getCustomPermissionNames()</h3><section><h4 id="1223111818#descripci-n" data-toc="descripci-n#IFeatureFlagProvider.md-descripci-n">Descripci&oacute;n</h4><p id="1223111818#-een8ta_27">Este m&eacute;todo debe devolver un conjunto de nombres de permisos personalizados disponibles en el sistema. Los permisos personalizados suelen utilizarse como uno de los mecanismos para controlar la activaci&oacute;n de caracter&iacute;sticas espec&iacute;ficas para diferentes usuarios o perfiles.</p></section><section><h4 id="1223111818#par-metros" data-toc="par-metros#IFeatureFlagProvider.md-par-metros">Par&aacute;metros</h4><p id="1223111818#-een8ta_28">Ninguno.</p></section><section><h4 id="1223111818#retorno" data-toc="retorno#IFeatureFlagProvider.md-retorno">Retorno</h4><ul class="list" id="1223111818#-een8ta_29" start="1"><li class="list-item" id="1223111818#-een8ta_30"><p><span class="inline-code" id="1223111818#-een8ta_31">Set&lt;String&gt;</span>: Conjunto de nombres de permisos personalizados.</p></li></ul></section></section><section><h3 id="1223111818#getfeatureflags" data-toc="getfeatureflags#IFeatureFlagProvider.md-getfeatureflags">getFeatureFlags()</h3><section><h4 id="1223111818#descripci-n" data-toc="descripci-n#IFeatureFlagProvider.md-descripci-n">Descripci&oacute;n</h4><p id="1223111818#-een8ta_37">Este m&eacute;todo debe devolver un mapa de banderas de caracter&iacute;sticas definidas en el sistema. Las banderas de caracter&iacute;sticas est&aacute;n almacenadas en registros de metadatos personalizados (<span class="inline-code" id="1223111818#-een8ta_38">FeatureFlag__mdt</span>) y permiten configurar caracter&iacute;sticas espec&iacute;ficas que pueden ser activadas o desactivadas de forma din&aacute;mica.</p></section><section><h4 id="1223111818#par-metros" data-toc="par-metros#IFeatureFlagProvider.md-par-metros">Par&aacute;metros</h4><p id="1223111818#-een8ta_39">Ninguno.</p></section><section><h4 id="1223111818#retorno" data-toc="retorno#IFeatureFlagProvider.md-retorno">Retorno</h4><ul class="list" id="1223111818#-een8ta_40" start="1"><li class="list-item" id="1223111818#-een8ta_41"><p><span class="inline-code" id="1223111818#-een8ta_42">Map&lt;String, FeatureFlag__mdt&gt;</span>: Mapa donde la clave es el nombre de la bandera de caracter&iacute;stica y el valor es el registro de metadatos personalizado correspondiente.</p></li></ul></section></section></section><section><h2 id="1223111818#dependencias" data-toc="dependencias#IFeatureFlagProvider.md-dependencias">Dependencias</h2><ul class="list" id="1223111818#-een8ta_43" start="1"><li class="list-item" id="1223111818#-een8ta_44"><p><span class="inline-code" id="1223111818#-een8ta_45">FeatureFlag__mdt</span>: Tipo de metadatos personalizado que contiene la configuraci&oacute;n de las banderas de caracter&iacute;sticas.</p></li></ul></section><section><h2 id="1223111818#prop-sito-y-aplicaciones" data-toc="prop-sito-y-aplicaciones#IFeatureFlagProvider.md-prop-sito-y-aplicaciones">Prop&oacute;sito y Aplicaciones</h2><p id="1223111818#-een8ta_46">El prop&oacute;sito principal de esta interfaz es proporcionar una abstracci&oacute;n para el acceso a la configuraci&oacute;n de banderas de caracter&iacute;sticas. Esto permite:</p><ol class="list list-decimal" id="1223111818#-een8ta_47" type="1" start="1"><li class="list-item" id="1223111818#-een8ta_50"><p><span class="control" id="1223111818#-een8ta_54">Gesti&oacute;n Centralizada</span>: Centralizar la l&oacute;gica de acceso a banderas de caracter&iacute;sticas.</p></li><li class="list-item" id="1223111818#-een8ta_51"><p><span class="control" id="1223111818#-een8ta_55">Flexibilidad de Implementaci&oacute;n</span>: Permitir diferentes implementaciones seg&uacute;n el entorno o las necesidades.</p></li><li class="list-item" id="1223111818#-een8ta_52"><p><span class="control" id="1223111818#-een8ta_56">Facilidad de Pruebas</span>: Facilitar la creaci&oacute;n de implementaciones mock para pruebas unitarias.</p></li><li class="list-item" id="1223111818#-een8ta_53"><p><span class="control" id="1223111818#-een8ta_57">Desacoplamiento</span>: Desacoplar la gesti&oacute;n de caracter&iacute;sticas del c&oacute;digo que las utiliza.</p></li></ol><p id="1223111818#-een8ta_48">Esta interfaz es particularmente &uacute;til en escenarios como:</p><ul class="list" id="1223111818#-een8ta_49" start="1"><li class="list-item" id="1223111818#-een8ta_58"><p><span class="control" id="1223111818#-een8ta_62">Despliegue Progresivo</span>: Liberar caracter&iacute;sticas a grupos selectos de usuarios antes de un lanzamiento general.</p></li><li class="list-item" id="1223111818#-een8ta_59"><p><span class="control" id="1223111818#-een8ta_63">Test A/B</span>: Probar diferentes variantes de una caracter&iacute;stica con diferentes grupos de usuarios.</p></li><li class="list-item" id="1223111818#-een8ta_60"><p><span class="control" id="1223111818#-een8ta_64">Configuraci&oacute;n por Entorno</span>: Activar o desactivar caracter&iacute;sticas espec&iacute;ficas seg&uacute;n el entorno (desarrollo, prueba, producci&oacute;n).</p></li><li class="list-item" id="1223111818#-een8ta_61"><p><span class="control" id="1223111818#-een8ta_65">Interruptores de Emergencia</span>: Proporcionar la capacidad de desactivar r&aacute;pidamente caracter&iacute;sticas problem&aacute;ticas sin necesidad de desplegar nuevo c&oacute;digo.</p></li></ul></section><section><h2 id="1223111818#ejemplos-de-implementaci-n" data-toc="ejemplos-de-implementaci-n#IFeatureFlagProvider.md-ejemplos-de-implementaci-n">Ejemplos de Implementaci&oacute;n</h2><section><h3 id="1223111818#implementaci-n-b-sica" data-toc="implementaci-n-b-sica#IFeatureFlagProvider.md-implementaci-n-b-sica">Implementaci&oacute;n B&aacute;sica</h3><div class="detached code-block" id="1223111818#-een8ta_69"><pre><code class="language-none">public class DefaultFeatureFlagProvider implements IFeatureFlagProvider {
    
    public Set&lt;String&gt; getCustomPermissionNames() {
        // Obtener todos los permisos personalizados disponibles en el sistema
        Set&lt;String&gt; permissionNames = new Set&lt;String&gt;();
        
        for (CustomPermission cp : [SELECT Id, DeveloperName FROM CustomPermission]) {
            permissionNames.add(cp.DeveloperName);
        }
        
        return permissionNames;
    }
    
    public Map&lt;String, FeatureFlag__mdt&gt; getFeatureFlags() {
        // Obtener todas las banderas de características desde los metadatos personalizados
        Map&lt;String, FeatureFlag__mdt&gt; featureFlags = new Map&lt;String, FeatureFlag__mdt&gt;();
        
        for (FeatureFlag__mdt flag : [SELECT DeveloperName, MasterLabel, Is_Active__c, 
                                     Description__c, Custom_Permission_Name__c, 
                                     Min_Api_Version__c, Max_Api_Version__c
                                     FROM FeatureFlag__mdt]) {
            featureFlags.put(flag.DeveloperName, flag);
        }
        
        return featureFlags;
    }
}</code></pre></div></section><section><h3 id="1223111818#implementaci-n-con-cach" data-toc="implementaci-n-con-cach#IFeatureFlagProvider.md-implementaci-n-con-cach">Implementaci&oacute;n con Cach&eacute;</h3><div class="detached code-block" id="1223111818#-een8ta_70"><pre><code class="language-none">public class CachedFeatureFlagProvider implements IFeatureFlagProvider {
    
    private static Set&lt;String&gt; cachedPermissionNames;
    private static Map&lt;String, FeatureFlag__mdt&gt; cachedFeatureFlags;
    private static Datetime lastCacheRefresh;
    private static final Integer CACHE_EXPIRY_MINS = 15;
    
    public Set&lt;String&gt; getCustomPermissionNames() {
        if (shouldRefreshCache()) {
            refreshCache();
        }
        return cachedPermissionNames;
    }
    
    public Map&lt;String, FeatureFlag__mdt&gt; getFeatureFlags() {
        if (shouldRefreshCache()) {
            refreshCache();
        }
        return cachedFeatureFlags;
    }
    
    private Boolean shouldRefreshCache() {
        if (cachedPermissionNames == null || cachedFeatureFlags == null || lastCacheRefresh == null) {
            return true;
        }
        
        Datetime now = Datetime.now();
        Long millisSinceRefresh = now.getTime() - lastCacheRefresh.getTime();
        Long millisToExpiry = CACHE_EXPIRY_MINS * 60 * 1000;
        
        return millisSinceRefresh &gt; millisToExpiry;
    }
    
    private void refreshCache() {
        // Obtener permisos personalizados
        cachedPermissionNames = new Set&lt;String&gt;();
        for (CustomPermission cp : [SELECT DeveloperName FROM CustomPermission]) {
            cachedPermissionNames.add(cp.DeveloperName);
        }
        
        // Obtener banderas de características
        cachedFeatureFlags = new Map&lt;String, FeatureFlag__mdt&gt;();
        for (FeatureFlag__mdt flag : [SELECT DeveloperName, MasterLabel, Is_Active__c, 
                                     Description__c, Custom_Permission_Name__c, 
                                     Min_Api_Version__c, Max_Api_Version__c
                                     FROM FeatureFlag__mdt]) {
            cachedFeatureFlags.put(flag.DeveloperName, flag);
        }
        
        // Actualizar timestamp de refresco
        lastCacheRefresh = Datetime.now();
    }
}</code></pre></div></section><section><h3 id="1223111818#mock-para-pruebas" data-toc="mock-para-pruebas#IFeatureFlagProvider.md-mock-para-pruebas">Mock para Pruebas</h3><div class="detached code-block" id="1223111818#-een8ta_71"><pre><code class="language-none">@IsTest
public class MockFeatureFlagProvider implements IFeatureFlagProvider {
    
    private Set&lt;String&gt; mockPermissions;
    private Map&lt;String, FeatureFlag__mdt&gt; mockFeatureFlags;
    
    public MockFeatureFlagProvider() {
        // Inicializar con valores predeterminados vacíos
        mockPermissions = new Set&lt;String&gt;();
        mockFeatureFlags = new Map&lt;String, FeatureFlag__mdt&gt;();
    }
    
    public Set&lt;String&gt; getCustomPermissionNames() {
        return mockPermissions;
    }
    
    public Map&lt;String, FeatureFlag__mdt&gt; getFeatureFlags() {
        return mockFeatureFlags;
    }
    
    // Métodos adicionales para configurar el mock para pruebas
    
    public void addCustomPermission(String permissionName) {
        mockPermissions.add(permissionName);
    }
    
    public void setCustomPermissions(Set&lt;String&gt; permissions) {
        mockPermissions = permissions;
    }
    
    public void addFeatureFlag(String flagName, Boolean isActive, String permissionName) {
        FeatureFlag__mdt flag = createMockFeatureFlag(flagName, isActive, permissionName);
        mockFeatureFlags.put(flagName, flag);
    }
    
    public void setFeatureFlags(Map&lt;String, FeatureFlag__mdt&gt; featureFlags) {
        mockFeatureFlags = featureFlags;
    }
    
    private FeatureFlag__mdt createMockFeatureFlag(String name, Boolean isActive, String permissionName) {
        // Crear una instancia de FeatureFlag__mdt utilizando técnicas de prueba
        // Nota: Como los registros de metadatos personalizados no se pueden crear en tiempo de ejecución,
        // se necesitaría utilizar técnicas como la reflexión o una clase wrapper
        
        // Ejemplo simplificado (no funcionará directamente, es ilustrativo)
        FeatureFlag__mdt mockFlag = new FeatureFlag__mdt();
        mockFlag.DeveloperName = name;
        mockFlag.MasterLabel = name;
        mockFlag.Is_Active__c = isActive;
        mockFlag.Custom_Permission_Name__c = permissionName;
        
        return mockFlag;
    }
}</code></pre></div></section></section><section><h2 id="1223111818#clase-de-servicio-de-feature-flags" data-toc="clase-de-servicio-de-feature-flags#IFeatureFlagProvider.md-clase-de-servicio-de-feature-flags">Clase de Servicio de Feature Flags</h2><p id="1223111818#-een8ta_72">Esta interfaz normalmente ser&iacute;a utilizada por una clase de servicio que proporciona la l&oacute;gica para verificar si una caracter&iacute;stica est&aacute; habilitada:</p><div class="detached code-block" id="1223111818#-een8ta_73"><pre><code class="language-none">public class FeatureFlagService {
    
    private static FeatureFlagService instance;
    private IFeatureFlagProvider provider;
    
    // Constructor privado para patrón Singleton
    private FeatureFlagService() {
        this.provider = new DefaultFeatureFlagProvider();
    }
    
    // Método para obtener la instancia singleton
    public static FeatureFlagService getInstance() {
        if (instance == null) {
            instance = new FeatureFlagService();
        }
        return instance;
    }
    
    // Método para inyectar un proveedor personalizado (útil para pruebas)
    public void setProvider(IFeatureFlagProvider customProvider) {
        this.provider = customProvider;
    }
    
    // Verificar si una característica está habilitada
    public Boolean isFeatureEnabled(String featureName) {
        Map&lt;String, FeatureFlag__mdt&gt; featureFlags = provider.getFeatureFlags();
        
        // Si la bandera no existe, la característica está deshabilitada
        if (!featureFlags.containsKey(featureName)) {
            return false;
        }
        
        FeatureFlag__mdt flag = featureFlags.get(featureName);
        
        // Si la bandera no está activa, la característica está deshabilitada
        if (!flag.Is_Active__c) {
            return false;
        }
        
        // Si la bandera requiere un permiso personalizado, verificar si el usuario actual lo tiene
        if (String.isNotBlank(flag.Custom_Permission_Name__c)) {
            return FeatureManagement.checkPermission(flag.Custom_Permission_Name__c);
        }
        
        // Si no se requiere permiso personalizado y la bandera está activa, la característica está habilitada
        return true;
    }
    
    // Verificar si una característica está habilitada y cumple con restricciones de versión API
    public Boolean isFeatureEnabledForApiVersion(String featureName, Decimal apiVersion) {
        Map&lt;String, FeatureFlag__mdt&gt; featureFlags = provider.getFeatureFlags();
        
        // Si la bandera no existe, la característica está deshabilitada
        if (!featureFlags.containsKey(featureName)) {
            return false;
        }
        
        FeatureFlag__mdt flag = featureFlags.get(featureName);
        
        // Verificar si la bandera está habilitada
        if (!isFeatureEnabled(featureName)) {
            return false;
        }
        
        // Verificar restricciones de versión API
        if (flag.Min_Api_Version__c != null &amp;&amp; apiVersion &lt; flag.Min_Api_Version__c) {
            return false;
        }
        
        if (flag.Max_Api_Version__c != null &amp;&amp; apiVersion &gt; flag.Max_Api_Version__c) {
            return false;
        }
        
        return true;
    }
}</code></pre></div></section><section><h2 id="1223111818#ejemplo-de-uso" data-toc="ejemplo-de-uso#IFeatureFlagProvider.md-ejemplo-de-uso">Ejemplo de Uso</h2><div class="detached code-block" id="1223111818#-een8ta_74"><pre><code class="language-none">// Obtener instancia del servicio
FeatureFlagService featureFlagService = FeatureFlagService.getInstance();

// Verificar si una característica está habilitada
if (featureFlagService.isFeatureEnabled('NewUserInterface')) {
    // Usar la nueva interfaz de usuario
    showNewUI();
} else {
    // Usar la interfaz de usuario clásica
    showClassicUI();
}

// Ejemplo con versión API
Decimal currentApiVersion = 54.0;
if (featureFlagService.isFeatureEnabledForApiVersion('AdvancedSearch', currentApiVersion)) {
    // Usar funcionalidad de búsqueda avanzada
    performAdvancedSearch();
} else {
    // Usar búsqueda estándar
    performStandardSearch();
}</code></pre></div></section><section><h2 id="1223111818#ejemplo-de-uso-en-pruebas" data-toc="ejemplo-de-uso-en-pruebas#IFeatureFlagProvider.md-ejemplo-de-uso-en-pruebas">Ejemplo de uso en Pruebas</h2><div class="detached code-block" id="1223111818#-een8ta_75"><pre><code class="language-none">@IsTest
private class FeatureFlagServiceTest {
    
    @IsTest
    static void testFeatureEnabled() {
        // Crear un mock del proveedor
        MockFeatureFlagProvider mockProvider = new MockFeatureFlagProvider();
        
        // Configurar el mock para la prueba
        mockProvider.addFeatureFlag('TestFeature', true, null);
        
        // Inyectar el mock en el servicio
        FeatureFlagService service = FeatureFlagService.getInstance();
        service.setProvider(mockProvider);
        
        // Verificar que la característica está habilitada
        System.assertEquals(true, service.isFeatureEnabled('TestFeature'));
    }
    
    @IsTest
    static void testFeatureDisabled() {
        // Crear un mock del proveedor
        MockFeatureFlagProvider mockProvider = new MockFeatureFlagProvider();
        
        // Configurar el mock para la prueba
        mockProvider.addFeatureFlag('TestFeature', false, null);
        
        // Inyectar el mock en el servicio
        FeatureFlagService service = FeatureFlagService.getInstance();
        service.setProvider(mockProvider);
        
        // Verificar que la característica está deshabilitada
        System.assertEquals(false, service.isFeatureEnabled('TestFeature'));
    }
    
    // Otros casos de prueba...
}</code></pre></div></section><section><h2 id="1223111818#estructura-del-objeto-personalizado-featureflag-mdt" data-toc="estructura-del-objeto-personalizado-featureflag-mdt#IFeatureFlagProvider.md-estructura-del-objeto-personalizado-featureflag-mdt">Estructura del Objeto Personalizado FeatureFlag__mdt</h2><p id="1223111818#-een8ta_76">El tipo de metadatos personalizado <span class="inline-code" id="1223111818#-een8ta_78">FeatureFlag__mdt</span> probablemente tendr&iacute;a la siguiente estructura:</p><div class="table-wrapper detached"><table id="1223111818#-een8ta_77"><tr class="header-row" id="1223111818#-een8ta_79"><th id="1223111818#-een8ta_87"><p>Campo</p></th><th id="1223111818#-een8ta_88"><p>Tipo</p></th><th id="1223111818#-een8ta_89"><p>Descripci&oacute;n</p></th></tr><tr class="" id="1223111818#-een8ta_80"><td id="1223111818#-een8ta_90"><p>DeveloperName</p></td><td id="1223111818#-een8ta_91"><p>String</p></td><td id="1223111818#-een8ta_92"><p>Nombre &uacute;nico de la bandera de caracter&iacute;stica</p></td></tr><tr class="" id="1223111818#-een8ta_81"><td id="1223111818#-een8ta_93"><p>MasterLabel</p></td><td id="1223111818#-een8ta_94"><p>String</p></td><td id="1223111818#-een8ta_95"><p>Etiqueta visible para la bandera</p></td></tr><tr class="" id="1223111818#-een8ta_82"><td id="1223111818#-een8ta_96"><p>Is_Active__c</p></td><td id="1223111818#-een8ta_97"><p>Boolean</p></td><td id="1223111818#-een8ta_98"><p>Indica si la caracter&iacute;stica est&aacute; activa</p></td></tr><tr class="" id="1223111818#-een8ta_83"><td id="1223111818#-een8ta_99"><p>Description__c</p></td><td id="1223111818#-een8ta_100"><p>Text</p></td><td id="1223111818#-een8ta_101"><p>Descripci&oacute;n de la caracter&iacute;stica</p></td></tr><tr class="" id="1223111818#-een8ta_84"><td id="1223111818#-een8ta_102"><p>Custom_Permission_Name__c</p></td><td id="1223111818#-een8ta_103"><p>String</p></td><td id="1223111818#-een8ta_104"><p>Nombre del permiso personalizado requerido (si aplica)</p></td></tr><tr class="" id="1223111818#-een8ta_85"><td id="1223111818#-een8ta_105"><p>Min_Api_Version__c</p></td><td id="1223111818#-een8ta_106"><p>Number</p></td><td id="1223111818#-een8ta_107"><p>Versi&oacute;n m&iacute;nima de API compatible (si aplica)</p></td></tr><tr class="" id="1223111818#-een8ta_86"><td id="1223111818#-een8ta_108"><p>Max_Api_Version__c</p></td><td id="1223111818#-een8ta_109"><p>Number</p></td><td id="1223111818#-een8ta_110"><p>Versi&oacute;n m&aacute;xima de API compatible (si aplica)</p></td></tr></table></div></section><section><h2 id="1223111818#mejores-pr-cticas" data-toc="mejores-pr-cticas#IFeatureFlagProvider.md-mejores-pr-cticas">Mejores Pr&aacute;cticas</h2><ol class="list list-decimal" id="1223111818#-een8ta_111" type="1" start="1"><li class="list-item" id="1223111818#-een8ta_112"><p><span class="control" id="1223111818#-een8ta_117">Cach&eacute; Eficiente</span>: Implementar estrategias de cach&eacute; para evitar consultas repetitivas a los metadatos.</p></li><li class="list-item" id="1223111818#-een8ta_113"><p><span class="control" id="1223111818#-een8ta_118">Manejo de Errores</span>: Incluir manejo de errores robusto en las implementaciones para evitar que fallos en la configuraci&oacute;n de banderas afecten la funcionalidad principal.</p></li><li class="list-item" id="1223111818#-een8ta_114"><p><span class="control" id="1223111818#-een8ta_119">Despliegue Controlado</span>: Utilizar las banderas de caracter&iacute;sticas para implementar un despliegue controlado de nuevas funcionalidades.</p></li><li class="list-item" id="1223111818#-een8ta_115"><p><span class="control" id="1223111818#-een8ta_120">Documentaci&oacute;n</span>: Mantener documentaci&oacute;n clara sobre cada bandera de caracter&iacute;stica y su prop&oacute;sito.</p></li><li class="list-item" id="1223111818#-een8ta_116"><p><span class="control" id="1223111818#-een8ta_121">Limpieza</span>: Implementar un proceso regular para revisar y eliminar banderas de caracter&iacute;sticas obsoletas.</p></li></ol></section><section><h2 id="1223111818#consideraciones-de-rendimiento" data-toc="consideraciones-de-rendimiento#IFeatureFlagProvider.md-consideraciones-de-rendimiento">Consideraciones de Rendimiento</h2><ol class="list list-decimal" id="1223111818#-een8ta_122" type="1" start="1"><li class="list-item" id="1223111818#-een8ta_123"><p><span class="control" id="1223111818#-een8ta_126">Consultas Optimizadas</span>: Minimizar el n&uacute;mero de consultas SOQL cargando todos los datos necesarios de una vez.</p></li><li class="list-item" id="1223111818#-een8ta_124"><p><span class="control" id="1223111818#-een8ta_127">Uso de Cach&eacute;</span>: Implementar mecanismos de cach&eacute; para reducir las consultas a la base de datos.</p></li><li class="list-item" id="1223111818#-een8ta_125"><p><span class="control" id="1223111818#-een8ta_128">Tama&ntilde;o de los Datos</span>: Ser consciente del n&uacute;mero de banderas de caracter&iacute;sticas y permisos personalizados, ya que un n&uacute;mero grande podr&iacute;a afectar el rendimiento.</p></li></ol></section><section><h2 id="1223111818#consideraciones-de-seguridad" data-toc="consideraciones-de-seguridad#IFeatureFlagProvider.md-consideraciones-de-seguridad">Consideraciones de Seguridad</h2><ol class="list list-decimal" id="1223111818#-een8ta_129" type="1" start="1"><li class="list-item" id="1223111818#-een8ta_130"><p><span class="control" id="1223111818#-een8ta_133">Control de Acceso</span>: Asegurar que los permisos personalizados est&eacute;n configurados correctamente para controlar el acceso a las caracter&iacute;sticas.</p></li><li class="list-item" id="1223111818#-een8ta_131"><p><span class="control" id="1223111818#-een8ta_134">Validaci&oacute;n de Entradas</span>: Validar los nombres de caracter&iacute;sticas antes de utilizarlos en las consultas.</p></li><li class="list-item" id="1223111818#-een8ta_132"><p><span class="control" id="1223111818#-een8ta_135">Exposici&oacute;n de Caracter&iacute;sticas</span>: Tener cuidado con la exposici&oacute;n de informaci&oacute;n sobre caracter&iacute;sticas en desarrollo a usuarios no autorizados.</p></li></ol></section><section><h2 id="1223111818#notas-adicionales" data-toc="notas-adicionales#IFeatureFlagProvider.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="1223111818#-een8ta_136" type="1" start="1"><li class="list-item" id="1223111818#-een8ta_137"><p>Esta interfaz es parte de un sistema m&aacute;s amplio de gesti&oacute;n de caracter&iacute;sticas que probablemente incluye otros componentes como servicios de administraci&oacute;n, p&aacute;ginas de configuraci&oacute;n, etc.</p></li><li class="list-item" id="1223111818#-een8ta_138"><p>La implementaci&oacute;n concreta podr&iacute;a necesitar ajustes dependiendo de los requisitos espec&iacute;ficos y la arquitectura del sistema.</p></li><li class="list-item" id="1223111818#-een8ta_139"><p>En sistemas con un gran n&uacute;mero de banderas de caracter&iacute;sticas, podr&iacute;a ser beneficioso implementar categor&iacute;as o grupos para una mejor organizaci&oacute;n.</p></li><li class="list-item" id="1223111818#-een8ta_140"><p>La interfaz podr&iacute;a extenderse para incluir m&eacute;todos adicionales, como la capacidad de filtrar banderas por categor&iacute;a o buscar banderas que coincidan con ciertos criterios.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1350189393">FeatureFlags</h1><section><h2 id="1350189393#descripci-n-general" data-toc="descripci-n-general#FeatureFlags.md-descripci-n-general">Descripci&oacute;n General</h2><p id="1350189393#x7qvsr_15">Clase principal para la evaluaci&oacute;n y gesti&oacute;n de feature flags en el sistema. Implementa la interfaz <span class="inline-code" id="1350189393#x7qvsr_16">IFeatureFlags</span> y proporciona un mecanismo robusto para activar/desactivar funcionalidades basado en Custom Permissions y Custom Metadata Types.</p></section><section><h2 id="1350189393#informaci-n-de-la-clase" data-toc="informaci-n-de-la-clase#FeatureFlags.md-informaci-n-de-la-clase">Informaci&oacute;n de la Clase</h2><ul class="list" id="1350189393#x7qvsr_17" start="1"><li class="list-item" id="1350189393#x7qvsr_18"><p><span class="control" id="1350189393#x7qvsr_24">Autor:</span> felipe.correa@nespon.com</p></li><li class="list-item" id="1350189393#x7qvsr_19"><p><span class="control" id="1350189393#x7qvsr_25">Proyecto:</span> Foundation Salesforce - Suratech - UH-17589</p></li><li class="list-item" id="1350189393#x7qvsr_20"><p><span class="control" id="1350189393#x7qvsr_26">&Uacute;ltima modificaci&oacute;n:</span> 04-11-2025</p></li><li class="list-item" id="1350189393#x7qvsr_21"><p><span class="control" id="1350189393#x7qvsr_27">Modificado por:</span> fabian.lopez@nespon.com</p></li><li class="list-item" id="1350189393#x7qvsr_22"><p><span class="control" id="1350189393#x7qvsr_28">Tipo:</span> Clase p&uacute;blica con sharing</p></li><li class="list-item" id="1350189393#x7qvsr_23"><p><span class="control" id="1350189393#x7qvsr_29">Implementa:</span> IFeatureFlags</p></li></ul></section><section><h2 id="1350189393#propiedades-privadas" data-toc="propiedades-privadas#FeatureFlags.md-propiedades-privadas">Propiedades Privadas</h2><section><h3 id="1350189393#features" data-toc="features#FeatureFlags.md-features">features</h3><div class="detached code-block" id="1350189393#x7qvsr_33"><pre><code class="language-none">private Map&lt;String, FeatureFlag__mdt&gt; features</code></pre></div><p id="1350189393#x7qvsr_34">Mapa que contiene todos los feature flags definidos como Custom Metadata Types.</p></section><section><h3 id="1350189393#custompermissionnames" data-toc="custompermissionnames#FeatureFlags.md-custompermissionnames">customPermissionNames</h3><div class="detached code-block" id="1350189393#x7qvsr_35"><pre><code class="language-none">private Set&lt;String&gt; customPermissionNames</code></pre></div><p id="1350189393#x7qvsr_36">Conjunto de nombres de Custom Permissions disponibles en la organizaci&oacute;n.</p></section><section><h3 id="1350189393#mockvalues" data-toc="mockvalues#FeatureFlags.md-mockvalues">mockValues</h3><div class="detached code-block" id="1350189393#x7qvsr_37"><pre><code class="language-none">private static Map&lt;String, Boolean&gt; mockValues</code></pre></div><p id="1350189393#x7qvsr_38">Mapa est&aacute;tico para almacenar valores mock durante la ejecuci&oacute;n de tests.</p></section></section><section><h2 id="1350189393#constructores" data-toc="constructores#FeatureFlags.md-constructores">Constructores</h2><section><h3 id="1350189393#constructor-con-provider" data-toc="constructor-con-provider#FeatureFlags.md-constructor-con-provider">Constructor con Provider</h3><div class="detached code-block" id="1350189393#x7qvsr_41"><pre><code class="language-none">public FeatureFlags(IFeatureFlagProvider provider)</code></pre></div><p id="1350189393#x7qvsr_42"><span class="control" id="1350189393#x7qvsr_47">Descripci&oacute;n:</span> Constructor que permite inyecci&oacute;n de dependencias para el proveedor de feature flags.</p><p id="1350189393#x7qvsr_43"><span class="control" id="1350189393#x7qvsr_48">Par&aacute;metros:</span></p><ul class="list" id="1350189393#x7qvsr_44" start="1"><li class="list-item" id="1350189393#x7qvsr_49"><p><span class="inline-code" id="1350189393#x7qvsr_50">provider</span> (IFeatureFlagProvider): Implementaci&oacute;n del proveedor de feature flags</p></li></ul><p id="1350189393#x7qvsr_45"><span class="control" id="1350189393#x7qvsr_51">Comportamiento:</span></p><ul class="list" id="1350189393#x7qvsr_46" start="1"><li class="list-item" id="1350189393#x7qvsr_52"><p>Inicializa <span class="inline-code" id="1350189393#x7qvsr_54">features</span> usando <span class="inline-code" id="1350189393#x7qvsr_55">provider.getFeatureFlags()</span></p></li><li class="list-item" id="1350189393#x7qvsr_53"><p>Inicializa <span class="inline-code" id="1350189393#x7qvsr_56">customPermissionNames</span> usando <span class="inline-code" id="1350189393#x7qvsr_57">provider.getCustomPermissionNames()</span></p></li></ul></section><section><h3 id="1350189393#constructor-por-defecto" data-toc="constructor-por-defecto#FeatureFlags.md-constructor-por-defecto">Constructor por Defecto</h3><div class="detached code-block" id="1350189393#x7qvsr_58"><pre><code class="language-none">public FeatureFlags()</code></pre></div><p id="1350189393#x7qvsr_59"><span class="control" id="1350189393#x7qvsr_62">Descripci&oacute;n:</span> Constructor por defecto que utiliza <span class="inline-code" id="1350189393#x7qvsr_63">FeatureFlagProvider</span> como implementaci&oacute;n est&aacute;ndar.</p><p id="1350189393#x7qvsr_60"><span class="control" id="1350189393#x7qvsr_64">Comportamiento:</span></p><ul class="list" id="1350189393#x7qvsr_61" start="1"><li class="list-item" id="1350189393#x7qvsr_65"><p>Llama al constructor principal con una nueva instancia de <span class="inline-code" id="1350189393#x7qvsr_66">FeatureFlagProvider</span></p></li></ul></section></section><section><h2 id="1350189393#m-todos-principales" data-toc="m-todos-principales#FeatureFlags.md-m-todos-principales">M&eacute;todos Principales</h2><section><h3 id="1350189393#evaluate" data-toc="evaluate#FeatureFlags.md-evaluate">evaluate</h3><div class="detached code-block" id="1350189393#x7qvsr_70"><pre><code class="language-none">public FeatureEvaluationResult evaluate(String featureName)</code></pre></div><p id="1350189393#x7qvsr_71"><span class="control" id="1350189393#x7qvsr_78">Descripci&oacute;n:</span> M&eacute;todo principal para evaluar el estado de un feature flag espec&iacute;fico.</p><p id="1350189393#x7qvsr_72"><span class="control" id="1350189393#x7qvsr_79">Par&aacute;metros:</span></p><ul class="list" id="1350189393#x7qvsr_73" start="1"><li class="list-item" id="1350189393#x7qvsr_80"><p><span class="inline-code" id="1350189393#x7qvsr_81">featureName</span> (String): Nombre del feature flag a evaluar</p></li></ul><p id="1350189393#x7qvsr_74"><span class="control" id="1350189393#x7qvsr_82">Retorna:</span></p><ul class="list" id="1350189393#x7qvsr_75" start="1"><li class="list-item" id="1350189393#x7qvsr_83"><p><span class="inline-code" id="1350189393#x7qvsr_84">FeatureEvaluationResult</span>: Objeto que contiene el resultado, nombre del feature y raz&oacute;n de la evaluaci&oacute;n</p></li></ul><p id="1350189393#x7qvsr_76"><span class="control" id="1350189393#x7qvsr_85">L&oacute;gica de Evaluaci&oacute;n:</span></p><ol class="list list-decimal" id="1350189393#x7qvsr_77" type="1" start="1"><li class="list-item" id="1350189393#x7qvsr_86"><p id="1350189393#x7qvsr_90"><span class="control" id="1350189393#x7qvsr_92">Contexto de Test:</span></p><ul class="list" id="1350189393#x7qvsr_91" start="1"><li class="list-item" id="1350189393#x7qvsr_93"><p>Si <span class="inline-code" id="1350189393#x7qvsr_97">Test.isRunningTest()</span> es true, configura valores mock para features espec&iacute;ficos</p></li><li class="list-item" id="1350189393#x7qvsr_94"><p><span class="inline-code" id="1350189393#x7qvsr_98">sura_foundation_platform_events</span> = true (para tests de PlatformEventIntegrationObserver)</p></li><li class="list-item" id="1350189393#x7qvsr_95"><p><span class="inline-code" id="1350189393#x7qvsr_99">sura_foundation_event_logs</span> = true (para tests de EventLogManager)</p></li><li class="list-item" id="1350189393#x7qvsr_96"><p>Retorna valor mock si existe</p></li></ul></li><li class="list-item" id="1350189393#x7qvsr_87"><p id="1350189393#x7qvsr_100"><span class="control" id="1350189393#x7qvsr_102">Evaluaci&oacute;n por Custom Permission:</span></p><ul class="list" id="1350189393#x7qvsr_101" start="1"><li class="list-item" id="1350189393#x7qvsr_103"><p>Si el feature name existe en <span class="inline-code" id="1350189393#x7qvsr_106">customPermissionNames</span></p></li><li class="list-item" id="1350189393#x7qvsr_104"><p>Usa <span class="inline-code" id="1350189393#x7qvsr_107">FeatureManagement.checkPermission()</span> para verificar el permiso</p></li><li class="list-item" id="1350189393#x7qvsr_105"><p>Retorna <span class="inline-code" id="1350189393#x7qvsr_108">HAS_CUSTOM_PERMISSION</span> o <span class="inline-code" id="1350189393#x7qvsr_109">MISSING_CUSTOM_PERMISSION</span></p></li></ul></li><li class="list-item" id="1350189393#x7qvsr_88"><p id="1350189393#x7qvsr_110"><span class="control" id="1350189393#x7qvsr_112">Evaluaci&oacute;n por Custom Metadata Type:</span></p><ul class="list" id="1350189393#x7qvsr_111" start="1"><li class="list-item" id="1350189393#x7qvsr_113"><p>Si el feature existe en el mapa <span class="inline-code" id="1350189393#x7qvsr_116">features</span></p></li><li class="list-item" id="1350189393#x7qvsr_114"><p>Verifica el campo <span class="inline-code" id="1350189393#x7qvsr_117">Is_Active__c</span></p></li><li class="list-item" id="1350189393#x7qvsr_115"><p>Retorna <span class="inline-code" id="1350189393#x7qvsr_118">CUSTOM_METADATA_TYPE_ENABLED</span> o <span class="inline-code" id="1350189393#x7qvsr_119">CUSTOM_METADATA_TYPE_DISABLED</span></p></li></ul></li><li class="list-item" id="1350189393#x7qvsr_89"><p id="1350189393#x7qvsr_120"><span class="control" id="1350189393#x7qvsr_122">Feature No Encontrado:</span></p><ul class="list" id="1350189393#x7qvsr_121" start="1"><li class="list-item" id="1350189393#x7qvsr_123"><p>Si el feature no existe en ninguna fuente</p></li><li class="list-item" id="1350189393#x7qvsr_124"><p>Retorna <span class="inline-code" id="1350189393#x7qvsr_125">FLAG_NOT_FOUND</span></p></li></ul></li></ol></section><section><h3 id="1350189393#lwcevaluate-m-todo-est-tico-para-lwc" data-toc="lwcevaluate-m-todo-est-tico-para-lwc#FeatureFlags.md-lwcevaluate-m-todo-est-tico-para-lwc">lwcEvaluate (M&eacute;todo Est&aacute;tico para LWC)</h3><div class="detached code-block" id="1350189393#x7qvsr_126"><pre><code class="language-none">@AuraEnabled(cacheable=true)
public static Boolean lwcEvaluate(String featureName)</code></pre></div><p id="1350189393#x7qvsr_127"><span class="control" id="1350189393#x7qvsr_134">Descripci&oacute;n:</span> M&eacute;todo est&aacute;tico optimizado para componentes Lightning Web Components.</p><p id="1350189393#x7qvsr_128"><span class="control" id="1350189393#x7qvsr_135">Par&aacute;metros:</span></p><ul class="list" id="1350189393#x7qvsr_129" start="1"><li class="list-item" id="1350189393#x7qvsr_136"><p><span class="inline-code" id="1350189393#x7qvsr_137">featureName</span> (String): Nombre del feature flag a evaluar</p></li></ul><p id="1350189393#x7qvsr_130"><span class="control" id="1350189393#x7qvsr_138">Retorna:</span></p><ul class="list" id="1350189393#x7qvsr_131" start="1"><li class="list-item" id="1350189393#x7qvsr_139"><p><span class="inline-code" id="1350189393#x7qvsr_140">Boolean</span>: Estado del feature flag (true/false)</p></li></ul><p id="1350189393#x7qvsr_132"><span class="control" id="1350189393#x7qvsr_141">Caracter&iacute;sticas:</span></p><ul class="list" id="1350189393#x7qvsr_133" start="1"><li class="list-item" id="1350189393#x7qvsr_142"><p>Anotado con <span class="inline-code" id="1350189393#x7qvsr_145">@AuraEnabled(cacheable=true)</span> para optimizaci&oacute;n de cache</p></li><li class="list-item" id="1350189393#x7qvsr_143"><p>Crea una nueva instancia de <span class="inline-code" id="1350189393#x7qvsr_146">FeatureFlags</span> para cada evaluaci&oacute;n</p></li><li class="list-item" id="1350189393#x7qvsr_144"><p>Simplifica el resultado a un boolean</p></li></ul></section><section><h3 id="1350189393#setmockvalue-m-todo-de-test" data-toc="setmockvalue-m-todo-de-test#FeatureFlags.md-setmockvalue-m-todo-de-test">setMockValue (M&eacute;todo de Test)</h3><div class="detached code-block" id="1350189393#x7qvsr_147"><pre><code class="language-none">@TestVisible
private static void setMockValue(String featureName, Boolean value)</code></pre></div><p id="1350189393#x7qvsr_148"><span class="control" id="1350189393#x7qvsr_152">Descripci&oacute;n:</span> M&eacute;todo utilitario para configurar valores mock durante tests.</p><p id="1350189393#x7qvsr_149"><span class="control" id="1350189393#x7qvsr_153">Par&aacute;metros:</span></p><ul class="list" id="1350189393#x7qvsr_150" start="1"><li class="list-item" id="1350189393#x7qvsr_154"><p><span class="inline-code" id="1350189393#x7qvsr_156">featureName</span> (String): Nombre del feature flag</p></li><li class="list-item" id="1350189393#x7qvsr_155"><p><span class="inline-code" id="1350189393#x7qvsr_157">value</span> (Boolean): Valor mock a asignar</p></li></ul><p id="1350189393#x7qvsr_151"><span class="control" id="1350189393#x7qvsr_158">Visibilidad:</span> Solo visible durante tests (<span class="inline-code" id="1350189393#x7qvsr_159">@TestVisible</span>)</p></section></section><section><h2 id="1350189393#clases-internas" data-toc="clases-internas#FeatureFlags.md-clases-internas">Clases Internas</h2><section><h3 id="1350189393#featureevaluationresult" data-toc="featureevaluationresult#FeatureFlags.md-featureevaluationresult">FeatureEvaluationResult</h3><div class="detached code-block" id="1350189393#x7qvsr_162"><pre><code class="language-none">public class FeatureEvaluationResult</code></pre></div><p id="1350189393#x7qvsr_163"><span class="control" id="1350189393#x7qvsr_170">Descripci&oacute;n:</span> Clase interna que encapsula el resultado de una evaluaci&oacute;n de feature flag.</p><p id="1350189393#x7qvsr_164"><span class="control" id="1350189393#x7qvsr_171">Propiedades:</span></p><ul class="list" id="1350189393#x7qvsr_165" start="1"><li class="list-item" id="1350189393#x7qvsr_172"><p><span class="inline-code" id="1350189393#x7qvsr_175">result</span> (Boolean): Estado del feature flag</p></li><li class="list-item" id="1350189393#x7qvsr_173"><p><span class="inline-code" id="1350189393#x7qvsr_176">featureName</span> (String): Nombre del feature evaluado</p></li><li class="list-item" id="1350189393#x7qvsr_174"><p><span class="inline-code" id="1350189393#x7qvsr_177">reason</span> (FeatureReason): Raz&oacute;n de la evaluaci&oacute;n</p></li></ul><p id="1350189393#x7qvsr_166"><span class="control" id="1350189393#x7qvsr_178">M&eacute;todos:</span></p><ul class="list" id="1350189393#x7qvsr_167" start="1"><li class="list-item" id="1350189393#x7qvsr_179"><p><span class="inline-code" id="1350189393#x7qvsr_182">isEnabled()</span>: Retorna el estado boolean del feature</p></li><li class="list-item" id="1350189393#x7qvsr_180"><p><span class="inline-code" id="1350189393#x7qvsr_183">getFeatureName()</span>: Retorna el nombre del feature</p></li><li class="list-item" id="1350189393#x7qvsr_181"><p><span class="inline-code" id="1350189393#x7qvsr_184">getReason()</span>: Retorna la raz&oacute;n de la evaluaci&oacute;n</p></li></ul><p id="1350189393#x7qvsr_168"><span class="control" id="1350189393#x7qvsr_185">Constructor:</span></p><div class="detached code-block" id="1350189393#x7qvsr_169"><pre><code class="language-none">public FeatureEvaluationResult(Boolean result, String featureName, FeatureReason reason)</code></pre></div></section><section><h3 id="1350189393#featurereason-enum" data-toc="featurereason-enum#FeatureFlags.md-featurereason-enum">FeatureReason (Enum)</h3><div class="detached code-block" id="1350189393#x7qvsr_186"><pre><code class="language-none">public enum FeatureReason</code></pre></div><p id="1350189393#x7qvsr_187"><span class="control" id="1350189393#x7qvsr_189">Valores:</span></p><ul class="list" id="1350189393#x7qvsr_188" start="1"><li class="list-item" id="1350189393#x7qvsr_190"><p><span class="inline-code" id="1350189393#x7qvsr_196">HAS_CUSTOM_PERMISSION</span>: Feature habilitado por Custom Permission</p></li><li class="list-item" id="1350189393#x7qvsr_191"><p><span class="inline-code" id="1350189393#x7qvsr_197">MISSING_CUSTOM_PERMISSION</span>: Feature deshabilitado por falta de Custom Permission</p></li><li class="list-item" id="1350189393#x7qvsr_192"><p><span class="inline-code" id="1350189393#x7qvsr_198">CUSTOM_METADATA_TYPE_ENABLED</span>: Feature habilitado por Custom Metadata Type</p></li><li class="list-item" id="1350189393#x7qvsr_193"><p><span class="inline-code" id="1350189393#x7qvsr_199">CUSTOM_METADATA_TYPE_DISABLED</span>: Feature deshabilitado por Custom Metadata Type</p></li><li class="list-item" id="1350189393#x7qvsr_194"><p><span class="inline-code" id="1350189393#x7qvsr_200">FLAG_NOT_FOUND</span>: Feature flag no encontrado en el sistema</p></li><li class="list-item" id="1350189393#x7qvsr_195"><p><span class="inline-code" id="1350189393#x7qvsr_201">MOCK_VALUE</span>: Valor configurado para testing</p></li></ul></section></section><section><h2 id="1350189393#estrategias-de-evaluaci-n" data-toc="estrategias-de-evaluaci-n#FeatureFlags.md-estrategias-de-evaluaci-n">Estrategias de Evaluaci&oacute;n</h2><section><h3 id="1350189393#jerarqu-a-de-evaluaci-n" data-toc="jerarqu-a-de-evaluaci-n#FeatureFlags.md-jerarqu-a-de-evaluaci-n">Jerarqu&iacute;a de Evaluaci&oacute;n</h3><ol class="list list-decimal" id="1350189393#x7qvsr_204" type="1" start="1"><li class="list-item" id="1350189393#x7qvsr_205"><p><span class="control" id="1350189393#x7qvsr_209">Mock Values</span> (solo en tests)</p></li><li class="list-item" id="1350189393#x7qvsr_206"><p><span class="control" id="1350189393#x7qvsr_210">Custom Permissions</span> (basado en usuario/perfil)</p></li><li class="list-item" id="1350189393#x7qvsr_207"><p><span class="control" id="1350189393#x7qvsr_211">Custom Metadata Types</span> (configuraci&oacute;n global)</p></li><li class="list-item" id="1350189393#x7qvsr_208"><p><span class="control" id="1350189393#x7qvsr_212">Default</span> (feature no encontrado = false)</p></li></ol></section><section><h3 id="1350189393#ventajas-del-dise-o" data-toc="ventajas-del-dise-o#FeatureFlags.md-ventajas-del-dise-o">Ventajas del Dise&ntilde;o</h3><ul class="list" id="1350189393#x7qvsr_213" start="1"><li class="list-item" id="1350189393#x7qvsr_214"><p><span class="control" id="1350189393#x7qvsr_219">Flexibilidad:</span> Soporta m&uacute;ltiples fuentes de configuraci&oacute;n</p></li><li class="list-item" id="1350189393#x7qvsr_215"><p><span class="control" id="1350189393#x7qvsr_220">Granularidad:</span> Control a nivel de usuario (permissions) y global (metadata)</p></li><li class="list-item" id="1350189393#x7qvsr_216"><p><span class="control" id="1350189393#x7qvsr_221">Testabilidad:</span> Sistema de mocking integrado</p></li><li class="list-item" id="1350189393#x7qvsr_217"><p><span class="control" id="1350189393#x7qvsr_222">Performance:</span> Cache habilitado para LWC</p></li><li class="list-item" id="1350189393#x7qvsr_218"><p><span class="control" id="1350189393#x7qvsr_223">Trazabilidad:</span> Razones detalladas de evaluaci&oacute;n</p></li></ul></section></section><section><h2 id="1350189393#integraci-n-con-lightning-web-components" data-toc="integraci-n-con-lightning-web-components#FeatureFlags.md-integraci-n-con-lightning-web-components">Integraci&oacute;n con Lightning Web Components</h2><section><h3 id="1350189393#uso-en-lwc" data-toc="uso-en-lwc#FeatureFlags.md-uso-en-lwc">Uso en LWC</h3><div class="detached code-block" id="1350189393#x7qvsr_225"><pre><code class="language-javascript">import { wire } from 'lwc';
import lwcEvaluate from '@salesforce/apex/FeatureFlags.lwcEvaluate';

export default class MyComponent extends LightningElement {
    @wire(lwcEvaluate, { featureName: 'my_feature' })
    featureResult;
    
    get isFeatureEnabled() {
        return this.featureResult.data === true;
    }
}</code></pre></div></section></section><section><h2 id="1350189393#casos-de-uso" data-toc="casos-de-uso#FeatureFlags.md-casos-de-uso">Casos de Uso</h2><section><h3 id="1350189393#desarrollo" data-toc="desarrollo#FeatureFlags.md-desarrollo">Desarrollo</h3><ul class="list" id="1350189393#x7qvsr_229" start="1"><li class="list-item" id="1350189393#x7qvsr_230"><p>Control de features en desarrollo vs producci&oacute;n</p></li><li class="list-item" id="1350189393#x7qvsr_231"><p>Activaci&oacute;n gradual de funcionalidades (rollout progresivo)</p></li><li class="list-item" id="1350189393#x7qvsr_232"><p>A/B testing basado en perfiles de usuario</p></li></ul></section><section><h3 id="1350189393#administraci-n" data-toc="administraci-n#FeatureFlags.md-administraci-n">Administraci&oacute;n</h3><ul class="list" id="1350189393#x7qvsr_233" start="1"><li class="list-item" id="1350189393#x7qvsr_234"><p>Habilitar/deshabilitar features sin deployments</p></li><li class="list-item" id="1350189393#x7qvsr_235"><p>Control granular por usuario o perfil</p></li><li class="list-item" id="1350189393#x7qvsr_236"><p>Configuraci&oacute;n centralizada de comportamientos</p></li></ul></section><section><h3 id="1350189393#testing" data-toc="testing#FeatureFlags.md-testing">Testing</h3><ul class="list" id="1350189393#x7qvsr_237" start="1"><li class="list-item" id="1350189393#x7qvsr_238"><p>Simulaci&oacute;n de diferentes estados de features</p></li><li class="list-item" id="1350189393#x7qvsr_239"><p>Tests independientes del estado real de configuraci&oacute;n</p></li><li class="list-item" id="1350189393#x7qvsr_240"><p>Validaci&oacute;n de comportamiento con features activadas/desactivadas</p></li></ul></section></section><section><h2 id="1350189393#dependencias" data-toc="dependencias#FeatureFlags.md-dependencias">Dependencias</h2><ul class="list" id="1350189393#x7qvsr_241" start="1"><li class="list-item" id="1350189393#x7qvsr_242"><p><span class="control" id="1350189393#x7qvsr_247">IFeatureFlags:</span> Interfaz implementada</p></li><li class="list-item" id="1350189393#x7qvsr_243"><p><span class="control" id="1350189393#x7qvsr_248">IFeatureFlagProvider:</span> Para obtenci&oacute;n de datos</p></li><li class="list-item" id="1350189393#x7qvsr_244"><p><span class="control" id="1350189393#x7qvsr_249">FeatureFlagProvider:</span> Implementaci&oacute;n por defecto del proveedor</p></li><li class="list-item" id="1350189393#x7qvsr_245"><p><span class="control" id="1350189393#x7qvsr_250">FeatureFlag__mdt:</span> Custom Metadata Type para configuraci&oacute;n</p></li><li class="list-item" id="1350189393#x7qvsr_246"><p><span class="control" id="1350189393#x7qvsr_251">FeatureManagement:</span> API de Salesforce para Custom Permissions</p></li></ul></section><section><h2 id="1350189393#consideraciones-de-performance" data-toc="consideraciones-de-performance#FeatureFlags.md-consideraciones-de-performance">Consideraciones de Performance</h2><ul class="list" id="1350189393#x7qvsr_252" start="1"><li class="list-item" id="1350189393#x7qvsr_253"><p>Custom Metadata Types est&aacute;n cacheados autom&aacute;ticamente</p></li><li class="list-item" id="1350189393#x7qvsr_254"><p>Custom Permissions se eval&uacute;an en tiempo real</p></li><li class="list-item" id="1350189393#x7qvsr_255"><p>M&eacute;todo LWC con cache habilitado para mejor performance en UI</p></li><li class="list-item" id="1350189393#x7qvsr_256"><p>Mock values solo se procesan durante tests</p></li></ul></section><section><h2 id="1350189393#mejoras-potenciales" data-toc="mejoras-potenciales#FeatureFlags.md-mejoras-potenciales">Mejoras Potenciales</h2><ul class="list" id="1350189393#x7qvsr_257" start="1"><li class="list-item" id="1350189393#x7qvsr_258"><p>Implementar cache local para Custom Permissions</p></li><li class="list-item" id="1350189393#x7qvsr_259"><p>Agregar logging de evaluaciones para auditor&iacute;a</p></li><li class="list-item" id="1350189393#x7qvsr_260"><p>Soporte para feature flags con valores complejos (no solo boolean)</p></li><li class="list-item" id="1350189393#x7qvsr_261"><p>Integraci&oacute;n con herramientas de monitoreo para uso de features</p></li><li class="list-item" id="1350189393#x7qvsr_262"><p>Implementar feature flags con fecha de expiraci&oacute;n</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1002509171">FeatureFlagProvider</h1><section><h2 id="1002509171#descripci-n-general" data-toc="descripci-n-general#FeatureFlagProvider.md-descripci-n-general">Descripci&oacute;n General</h2><p id="1002509171#-jh6iad_10">Clase que implementa la interfaz <span class="inline-code" id="1002509171#-jh6iad_11">IFeatureFlagProvider</span> para proporcionar funcionalidad de gesti&oacute;n de feature flags y permisos personalizados en Salesforce. Permite obtener informaci&oacute;n sobre permisos personalizados y feature flags configurados en el sistema.</p></section><section><h2 id="1002509171#informaci-n-de-la-clase" data-toc="informaci-n-de-la-clase#FeatureFlagProvider.md-informaci-n-de-la-clase">Informaci&oacute;n de la Clase</h2><ul class="list" id="1002509171#-jh6iad_12" start="1"><li class="list-item" id="1002509171#-jh6iad_13"><p><span class="control" id="1002509171#-jh6iad_16">Tipo:</span> Clase p&uacute;blica con sharing</p></li><li class="list-item" id="1002509171#-jh6iad_14"><p><span class="control" id="1002509171#-jh6iad_17">Implementa:</span> IFeatureFlagProvider</p></li><li class="list-item" id="1002509171#-jh6iad_15"><p><span class="control" id="1002509171#-jh6iad_18">Prop&oacute;sito:</span> Proveedor de feature flags y permisos personalizados</p></li></ul></section><section><h2 id="1002509171#m-todos" data-toc="m-todos#FeatureFlagProvider.md-m-todos">M&eacute;todos</h2><section><h3 id="1002509171#getcustompermissionnames" data-toc="getcustompermissionnames#FeatureFlagProvider.md-getcustompermissionnames">getCustomPermissionNames</h3><div class="detached code-block" id="1002509171#-jh6iad_21"><pre><code class="language-none">public Set&lt;String&gt; getCustomPermissionNames()</code></pre></div><p id="1002509171#-jh6iad_22"><span class="control" id="1002509171#-jh6iad_30">Descripci&oacute;n:</span> Obtiene todos los nombres de desarrollador de los permisos personalizados disponibles en la organizaci&oacute;n.</p><p id="1002509171#-jh6iad_23"><span class="control" id="1002509171#-jh6iad_31">Par&aacute;metros:</span> Ninguno</p><p id="1002509171#-jh6iad_24"><span class="control" id="1002509171#-jh6iad_32">Retorna:</span></p><ul class="list" id="1002509171#-jh6iad_25" start="1"><li class="list-item" id="1002509171#-jh6iad_33"><p><span class="inline-code" id="1002509171#-jh6iad_34">Set&lt;String&gt;</span>: Conjunto de nombres de desarrollador de permisos personalizados</p></li></ul><p id="1002509171#-jh6iad_26"><span class="control" id="1002509171#-jh6iad_35">Comportamiento:</span></p><ol class="list list-decimal" id="1002509171#-jh6iad_27" type="1" start="1"><li class="list-item" id="1002509171#-jh6iad_36"><p>Crea un conjunto vac&iacute;o para almacenar los nombres de permisos</p></li><li class="list-item" id="1002509171#-jh6iad_37"><p>Ejecuta una consulta SOQL para obtener todos los permisos personalizados</p></li><li class="list-item" id="1002509171#-jh6iad_38"><p>Itera sobre los resultados y agrega el <span class="inline-code" id="1002509171#-jh6iad_40">DeveloperName</span> de cada permiso al conjunto</p></li><li class="list-item" id="1002509171#-jh6iad_39"><p>Retorna el conjunto completo de nombres</p></li></ol><p id="1002509171#-jh6iad_28"><span class="control" id="1002509171#-jh6iad_41">Consulta SOQL utilizada:</span></p><div class="detached code-block" id="1002509171#-jh6iad_29"><pre><code class="language-sql">SELECT Id, DeveloperName FROM CustomPermission</code></pre></div></section><section><h3 id="1002509171#getfeatureflags" data-toc="getfeatureflags#FeatureFlagProvider.md-getfeatureflags">getFeatureFlags</h3><div class="detached code-block" id="1002509171#-jh6iad_42"><pre><code class="language-none">public Map&lt;String,FeatureFlag__mdt&gt; getFeatureFlags()</code></pre></div><p id="1002509171#-jh6iad_43"><span class="control" id="1002509171#-jh6iad_49">Descripci&oacute;n:</span> Obtiene todos los feature flags configurados como Custom Metadata Types.</p><p id="1002509171#-jh6iad_44"><span class="control" id="1002509171#-jh6iad_50">Par&aacute;metros:</span> Ninguno</p><p id="1002509171#-jh6iad_45"><span class="control" id="1002509171#-jh6iad_51">Retorna:</span></p><ul class="list" id="1002509171#-jh6iad_46" start="1"><li class="list-item" id="1002509171#-jh6iad_52"><p><span class="inline-code" id="1002509171#-jh6iad_53">Map&lt;String,FeatureFlag__mdt&gt;</span>: Mapa con todos los feature flags donde la clave es el nombre del registro y el valor es el objeto metadata</p></li></ul><p id="1002509171#-jh6iad_47"><span class="control" id="1002509171#-jh6iad_54">Comportamiento:</span></p><ul class="list" id="1002509171#-jh6iad_48" start="1"><li class="list-item" id="1002509171#-jh6iad_55"><p>Utiliza el m&eacute;todo est&aacute;tico <span class="inline-code" id="1002509171#-jh6iad_57">getAll()</span> de Custom Metadata Types para obtener todos los registros de <span class="inline-code" id="1002509171#-jh6iad_58">FeatureFlag__mdt</span></p></li><li class="list-item" id="1002509171#-jh6iad_56"><p>Retorna directamente el mapa completo sin filtrado</p></li></ul></section></section><section><h2 id="1002509171#funcionalidad-principal" data-toc="funcionalidad-principal#FeatureFlagProvider.md-funcionalidad-principal">Funcionalidad Principal</h2><section><h3 id="1002509171#gesti-n-de-permisos-personalizados" data-toc="gesti-n-de-permisos-personalizados#FeatureFlagProvider.md-gesti-n-de-permisos-personalizados">Gesti&oacute;n de Permisos Personalizados</h3><ul class="list" id="1002509171#-jh6iad_61" start="1"><li class="list-item" id="1002509171#-jh6iad_62"><p>Proporciona acceso program&aacute;tico a todos los permisos personalizados de la organizaci&oacute;n</p></li><li class="list-item" id="1002509171#-jh6iad_63"><p>Facilita la validaci&oacute;n de permisos en tiempo de ejecuci&oacute;n</p></li><li class="list-item" id="1002509171#-jh6iad_64"><p>Permite implementar l&oacute;gica condicional basada en permisos</p></li></ul></section><section><h3 id="1002509171#gesti-n-de-feature-flags" data-toc="gesti-n-de-feature-flags#FeatureFlagProvider.md-gesti-n-de-feature-flags">Gesti&oacute;n de Feature Flags</h3><ul class="list" id="1002509171#-jh6iad_65" start="1"><li class="list-item" id="1002509171#-jh6iad_66"><p>Acceso centralizado a los feature flags configurados</p></li><li class="list-item" id="1002509171#-jh6iad_67"><p>Utiliza Custom Metadata Types para configuraci&oacute;n sin c&oacute;digo</p></li><li class="list-item" id="1002509171#-jh6iad_68"><p>Permite activar/desactivar funcionalidades din&aacute;micamente</p></li></ul></section></section><section><h2 id="1002509171#consideraciones-de-dise-o" data-toc="consideraciones-de-dise-o#FeatureFlagProvider.md-consideraciones-de-dise-o">Consideraciones de Dise&ntilde;o</h2><section><h3 id="1002509171#sharing-settings" data-toc="sharing-settings#FeatureFlagProvider.md-sharing-settings">Sharing Settings</h3><ul class="list" id="1002509171#-jh6iad_72" start="1"><li class="list-item" id="1002509171#-jh6iad_73"><p>Declarada como <span class="inline-code" id="1002509171#-jh6iad_75">with sharing</span> para respetar las reglas de seguridad del usuario actual</p></li><li class="list-item" id="1002509171#-jh6iad_74"><p>Asegura que las consultas respeten los permisos de acceso a datos</p></li></ul></section><section><h3 id="1002509171#performance" data-toc="performance#FeatureFlagProvider.md-performance">Performance</h3><ul class="list" id="1002509171#-jh6iad_76" start="1"><li class="list-item" id="1002509171#-jh6iad_77"><p><span class="inline-code" id="1002509171#-jh6iad_79">getCustomPermissionNames()</span>: Ejecuta consulta SOQL, considerar cach&eacute; si se llama frecuentemente</p></li><li class="list-item" id="1002509171#-jh6iad_78"><p><span class="inline-code" id="1002509171#-jh6iad_80">getFeatureFlags()</span>: Utiliza Custom Metadata Types que est&aacute;n cacheados autom&aacute;ticamente</p></li></ul></section><section><h3 id="1002509171#dependencias" data-toc="dependencias#FeatureFlagProvider.md-dependencias">Dependencias</h3><ul class="list" id="1002509171#-jh6iad_81" start="1"><li class="list-item" id="1002509171#-jh6iad_82"><p>Requiere Custom Metadata Type <span class="inline-code" id="1002509171#-jh6iad_85">FeatureFlag__mdt</span></p></li><li class="list-item" id="1002509171#-jh6iad_83"><p>Depende de la existencia de Custom Permissions en la organizaci&oacute;n</p></li><li class="list-item" id="1002509171#-jh6iad_84"><p>Implementa interfaz <span class="inline-code" id="1002509171#-jh6iad_86">IFeatureFlagProvider</span></p></li></ul></section></section><section><h2 id="1002509171#casos-de-uso" data-toc="casos-de-uso#FeatureFlagProvider.md-casos-de-uso">Casos de Uso</h2><ol class="list list-decimal" id="1002509171#-jh6iad_87" type="1" start="1"><li class="list-item" id="1002509171#-jh6iad_88"><p><span class="control" id="1002509171#-jh6iad_92">Validaci&oacute;n de Permisos:</span> Verificar si un usuario tiene permisos espec&iacute;ficos antes de ejecutar operaciones</p></li><li class="list-item" id="1002509171#-jh6iad_89"><p><span class="control" id="1002509171#-jh6iad_93">Feature Toggling:</span> Activar/desactivar funcionalidades basado en feature flags</p></li><li class="list-item" id="1002509171#-jh6iad_90"><p><span class="control" id="1002509171#-jh6iad_94">Configuraci&oacute;n Din&aacute;mica:</span> Cambiar comportamiento de la aplicaci&oacute;n sin despliegues de c&oacute;digo</p></li><li class="list-item" id="1002509171#-jh6iad_91"><p><span class="control" id="1002509171#-jh6iad_95">Control de Acceso:</span> Implementar l&oacute;gica de autorizaci&oacute;n granular</p></li></ol></section><section><h2 id="1002509171#mejoras-potenciales" data-toc="mejoras-potenciales#FeatureFlagProvider.md-mejoras-potenciales">Mejoras Potenciales</h2><ul class="list" id="1002509171#-jh6iad_96" start="1"><li class="list-item" id="1002509171#-jh6iad_97"><p>Implementar cach&eacute; para <span class="inline-code" id="1002509171#-jh6iad_100">getCustomPermissionNames()</span> si se requiere alto rendimiento</p></li><li class="list-item" id="1002509171#-jh6iad_98"><p>Agregar m&eacute;todos para verificar permisos espec&iacute;ficos de usuarios</p></li><li class="list-item" id="1002509171#-jh6iad_99"><p>Incluir logging para auditor&iacute;a de acceso a feature flags</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1104960030">AccountConfigurator</h1><section><h2 id="-1104960030#descripci-n-general" data-toc="descripci-n-general#AccountConfigurator.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-1104960030#-fw06as_14">Interfaz global que define el contrato para configuradores de objetos <span class="inline-code" id="-1104960030#-fw06as_15">Account</span>. Implementa el patr&oacute;n Strategy permitiendo aplicar diferentes configuraciones a instancias de Account de manera flexible y extensible. Esta interfaz trabaja en conjunto con <span class="inline-code" id="-1104960030#-fw06as_16">AccountBuilder</span> para proporcionar un sistema de configuraci&oacute;n modular.</p></section><section><h2 id="-1104960030#informaci-n-de-la-interfaz" data-toc="informaci-n-de-la-interfaz#AccountConfigurator.md-informaci-n-de-la-interfaz">Informaci&oacute;n de la Interfaz</h2><ul class="list" id="-1104960030#-fw06as_17" start="1"><li class="list-item" id="-1104960030#-fw06as_18"><p><span class="control" id="-1104960030#-fw06as_23">Autor:</span> Jean Carlos Melendez</p></li><li class="list-item" id="-1104960030#-fw06as_19"><p><span class="control" id="-1104960030#-fw06as_24">&Uacute;ltima modificaci&oacute;n:</span> 01-30-2025</p></li><li class="list-item" id="-1104960030#-fw06as_20"><p><span class="control" id="-1104960030#-fw06as_25">Modificado por:</span> Jean Carlos Melendez</p></li><li class="list-item" id="-1104960030#-fw06as_21"><p><span class="control" id="-1104960030#-fw06as_26">Tipo:</span> Interfaz global</p></li><li class="list-item" id="-1104960030#-fw06as_22"><p><span class="control" id="-1104960030#-fw06as_27">Prop&oacute;sito:</span> Contrato para configuradores de Account en patr&oacute;n Strategy</p></li></ul></section><section><h2 id="-1104960030#m-todo-de-la-interfaz" data-toc="m-todo-de-la-interfaz#AccountConfigurator.md-m-todo-de-la-interfaz">M&eacute;todo de la Interfaz</h2><section><h3 id="-1104960030#configure" data-toc="configure#AccountConfigurator.md-configure">configure</h3><div class="detached code-block" id="-1104960030#-fw06as_29"><pre><code class="language-none">void configure(Account account)</code></pre></div><p id="-1104960030#-fw06as_30"><span class="control" id="-1104960030#-fw06as_36">Descripci&oacute;n:</span> M&eacute;todo que debe ser implementado por todas las clases configuradoras para aplicar configuraciones espec&iacute;ficas a un objeto Account.</p><p id="-1104960030#-fw06as_31"><span class="control" id="-1104960030#-fw06as_37">Par&aacute;metros:</span></p><ul class="list" id="-1104960030#-fw06as_32" start="1"><li class="list-item" id="-1104960030#-fw06as_38"><p><span class="inline-code" id="-1104960030#-fw06as_39">account</span> (Account): Instancia del objeto Account a configurar</p></li></ul><p id="-1104960030#-fw06as_33"><span class="control" id="-1104960030#-fw06as_40">Retorna:</span> <span class="inline-code" id="-1104960030#-fw06as_41">void</span> - Modifica el Account por referencia</p><p id="-1104960030#-fw06as_34"><span class="control" id="-1104960030#-fw06as_42">Responsabilidades de la Implementaci&oacute;n:</span></p><ul class="list" id="-1104960030#-fw06as_35" start="1"><li class="list-item" id="-1104960030#-fw06as_43"><p>Aplicar configuraciones espec&iacute;ficas al Account recibido</p></li><li class="list-item" id="-1104960030#-fw06as_44"><p>Modificar campos, establecer valores por defecto, o aplicar l&oacute;gica de negocio</p></li><li class="list-item" id="-1104960030#-fw06as_45"><p>Manejar excepciones de configuraci&oacute;n si es necesario</p></li></ul></section></section><section><h2 id="-1104960030#patr-n-de-dise-o" data-toc="patr-n-de-dise-o#AccountConfigurator.md-patr-n-de-dise-o">Patr&oacute;n de Dise&ntilde;o</h2><section><h3 id="-1104960030#strategy-pattern" data-toc="strategy-pattern#AccountConfigurator.md-strategy-pattern">Strategy Pattern</h3><p id="-1104960030#-fw06as_48">Esta interfaz implementa el <span class="control" id="-1104960030#-fw06as_50">patr&oacute;n Strategy</span>, que permite:</p><ul class="list" id="-1104960030#-fw06as_49" start="1"><li class="list-item" id="-1104960030#-fw06as_51"><p><span class="control" id="-1104960030#-fw06as_55">Intercambiabilidad:</span> Diferentes estrategias de configuraci&oacute;n sin cambiar el c&oacute;digo cliente</p></li><li class="list-item" id="-1104960030#-fw06as_52"><p><span class="control" id="-1104960030#-fw06as_56">Extensibilidad:</span> Agregar nuevas configuraciones sin modificar c&oacute;digo existente</p></li><li class="list-item" id="-1104960030#-fw06as_53"><p><span class="control" id="-1104960030#-fw06as_57">Separaci&oacute;n de responsabilidades:</span> Cada configurador maneja una preocupaci&oacute;n espec&iacute;fica</p></li><li class="list-item" id="-1104960030#-fw06as_54"><p><span class="control" id="-1104960030#-fw06as_58">Reutilizaci&oacute;n:</span> Configuradores pueden ser compartidos entre diferentes builders</p></li></ul></section><section><h3 id="-1104960030#integraci-n-con-builder-pattern" data-toc="integraci-n-con-builder-pattern#AccountConfigurator.md-integraci-n-con-builder-pattern">Integraci&oacute;n con Builder Pattern</h3><p id="-1104960030#-fw06as_59">Trabaja en conjunto con <span class="inline-code" id="-1104960030#-fw06as_61">AccountBuilder</span> para crear un sistema flexible:</p><div class="detached code-block" id="-1104960030#-fw06as_60"><pre><code class="language-none">// El Builder utiliza la interfaz
global AccountBuilder addConfigurators(List&lt;AccountConfigurator&gt; configuratorsList)

// Durante build(), aplica todos los configuradores
for (AccountConfigurator configurator : configurators) {
    configurator.configure(account);
}</code></pre></div></section></section><section><h2 id="-1104960030#implementaciones-recomendadas" data-toc="implementaciones-recomendadas#AccountConfigurator.md-implementaciones-recomendadas">Implementaciones Recomendadas</h2><section><h3 id="-1104960030#configurador-de-industria" data-toc="configurador-de-industria#AccountConfigurator.md-configurador-de-industria">Configurador de Industria</h3><div class="detached code-block" id="-1104960030#-fw06as_67"><pre><code class="language-none">global class IndustryAccountConfigurator implements AccountConfigurator {
    private String industry;
    
    global IndustryAccountConfigurator(String industry) {
        this.industry = industry;
    }
    
    global void configure(Account account) {
        account.Industry = this.industry;
        
        // Configuración específica por industria
        switch on industry {
            when 'Technology' {
                account.Type = 'Customer - Direct';
                account.Rating = 'Hot';
            }
            when 'Healthcare' {
                account.Type = 'Customer - Channel';
                account.Rating = 'Warm';
            }
        }
    }
}</code></pre></div></section><section><h3 id="-1104960030#configurador-de-direcci-n-completa" data-toc="configurador-de-direcci-n-completa#AccountConfigurator.md-configurador-de-direcci-n-completa">Configurador de Direcci&oacute;n Completa</h3><div class="detached code-block" id="-1104960030#-fw06as_68"><pre><code class="language-none">global class AddressAccountConfigurator implements AccountConfigurator {
    private String street, city, state, country, postalCode;
    
    global AddressAccountConfigurator(String street, String city, String state, String country, String postalCode) {
        this.street = street;
        this.city = city;
        this.state = state;
        this.country = country;
        this.postalCode = postalCode;
    }
    
    global void configure(Account account) {
        // Billing Address
        account.BillingStreet = this.street;
        account.BillingCity = this.city;
        account.BillingState = this.state;
        account.BillingCountry = this.country;
        account.BillingPostalCode = this.postalCode;
        
        // Shipping Address (mismo que billing por defecto)
        account.ShippingStreet = this.street;
        account.ShippingCity = this.city;
        account.ShippingState = this.state;
        account.ShippingCountry = this.country;
        account.ShippingPostalCode = this.postalCode;
    }
}</code></pre></div></section><section><h3 id="-1104960030#configurador-de-campos-personalizados" data-toc="configurador-de-campos-personalizados#AccountConfigurator.md-configurador-de-campos-personalizados">Configurador de Campos Personalizados</h3><div class="detached code-block" id="-1104960030#-fw06as_69"><pre><code class="language-none">global class CustomFieldAccountConfigurator implements AccountConfigurator {
    private Map&lt;String, Object&gt; customFields;
    
    global CustomFieldAccountConfigurator(Map&lt;String, Object&gt; customFields) {
        this.customFields = customFields;
    }
    
    global void configure(Account account) {
        for (String fieldName : customFields.keySet()) {
            try {
                account.put(fieldName, customFields.get(fieldName));
            } catch (Exception e) {
                System.debug('Error setting custom field ' + fieldName + ': ' + e.getMessage());
            }
        }
    }
}</code></pre></div></section><section><h3 id="-1104960030#configurador-de-integraci-n-externa" data-toc="configurador-de-integraci-n-externa#AccountConfigurator.md-configurador-de-integraci-n-externa">Configurador de Integraci&oacute;n Externa</h3><div class="detached code-block" id="-1104960030#-fw06as_70"><pre><code class="language-none">global class ExternalSystemAccountConfigurator implements AccountConfigurator {
    private String externalSystemId;
    private String systemName;
    
    global ExternalSystemAccountConfigurator(String externalSystemId, String systemName) {
        this.externalSystemId = externalSystemId;
        this.systemName = systemName;
    }
    
    global void configure(Account account) {
        // Configurar campos de integración
        account.put('External_System_ID__c', this.externalSystemId);
        account.put('Source_System__c', this.systemName);
        account.put('Integration_Status__c', 'Pending');
        account.put('Last_Sync_Date__c', System.now());
    }
}</code></pre></div></section><section><h3 id="-1104960030#configurador-condicional" data-toc="configurador-condicional#AccountConfigurator.md-configurador-condicional">Configurador Condicional</h3><div class="detached code-block" id="-1104960030#-fw06as_71"><pre><code class="language-none">global class ConditionalAccountConfigurator implements AccountConfigurator {
    private Map&lt;String, Object&gt; conditions;
    private List&lt;AccountConfigurator&gt; configurators;
    
    global ConditionalAccountConfigurator(Map&lt;String, Object&gt; conditions, List&lt;AccountConfigurator&gt; configurators) {
        this.conditions = conditions;
        this.configurators = configurators;
    }
    
    global void configure(Account account) {
        if (shouldApplyConfiguration(account)) {
            for (AccountConfigurator configurator : configurators) {
                configurator.configure(account);
            }
        }
    }
    
    private Boolean shouldApplyConfiguration(Account account) {
        // Lógica para evaluar condiciones
        for (String field : conditions.keySet()) {
            if (account.get(field) != conditions.get(field)) {
                return false;
            }
        }
        return true;
    }
}</code></pre></div></section></section><section><h2 id="-1104960030#casos-de-uso-completos" data-toc="casos-de-uso-completos#AccountConfigurator.md-casos-de-uso-completos">Casos de Uso Completos</h2><section><h3 id="-1104960030#configuraci-n-empresarial-completa" data-toc="configuraci-n-empresarial-completa#AccountConfigurator.md-configuraci-n-empresarial-completa">Configuraci&oacute;n Empresarial Completa</h3><div class="detached code-block" id="-1104960030#-fw06as_74"><pre><code class="language-none">List&lt;AccountConfigurator&gt; enterpriseConfigurators = new List&lt;AccountConfigurator&gt;{
    new IndustryAccountConfigurator('Technology'),
    new AddressAccountConfigurator('123 Tech St', 'San Francisco', 'CA', 'USA', '94105'),
    new CustomFieldAccountConfigurator(new Map&lt;String, Object&gt;{
        'Annual_Revenue__c' =&gt; 1000000,
        'Employee_Count__c' =&gt; 50,
        'Support_Level__c' =&gt; 'Premium'
    }),
    new ExternalSystemAccountConfigurator('EXT-12345', 'CRM_Legacy')
};

Account enterpriseAccount = new AccountBuilder()
    .setName('TechCorp Solutions')
    .setPhone('555-123-4567')
    .addConfigurators(enterpriseConfigurators)
    .buildAndInsert();</code></pre></div></section><section><h3 id="-1104960030#configuraci-n-con-validaci-n" data-toc="configuraci-n-con-validaci-n#AccountConfigurator.md-configuraci-n-con-validaci-n">Configuraci&oacute;n con Validaci&oacute;n</h3><div class="detached code-block" id="-1104960030#-fw06as_75"><pre><code class="language-none">global class ValidatedAccountConfigurator implements AccountConfigurator {
    private List&lt;AccountConfigurator&gt; configurators;
    
    global void configure(Account account) {
        // Pre-validación
        validateAccount(account);
        
        // Aplicar configuradores
        for (AccountConfigurator configurator : configurators) {
            configurator.configure(account);
        }
        
        // Post-validación
        validateConfiguredAccount(account);
    }
    
    private void validateAccount(Account account) {
        if (String.isBlank(account.Name)) {
            throw new ConfigurationException('Account name is required before configuration');
        }
    }
    
    private void validateConfiguredAccount(Account account) {
        // Validaciones post-configuración
    }
}</code></pre></div></section></section><section><h2 id="-1104960030#ventajas-del-dise-o" data-toc="ventajas-del-dise-o#AccountConfigurator.md-ventajas-del-dise-o">Ventajas del Dise&ntilde;o</h2><section><h3 id="-1104960030#flexibilidad" data-toc="flexibilidad#AccountConfigurator.md-flexibilidad">Flexibilidad</h3><ul class="list" id="-1104960030#-fw06as_79" start="1"><li class="list-item" id="-1104960030#-fw06as_80"><p><span class="control" id="-1104960030#-fw06as_83">Composici&oacute;n din&aacute;mica:</span> Diferentes combinaciones de configuradores para diferentes tipos de Account</p></li><li class="list-item" id="-1104960030#-fw06as_81"><p><span class="control" id="-1104960030#-fw06as_84">Configuraci&oacute;n condicional:</span> Aplicar configuraciones basadas en condiciones espec&iacute;ficas</p></li><li class="list-item" id="-1104960030#-fw06as_82"><p><span class="control" id="-1104960030#-fw06as_85">Reutilizaci&oacute;n:</span> Configuradores pueden usarse en m&uacute;ltiples contextos</p></li></ul></section><section><h3 id="-1104960030#mantenibilidad" data-toc="mantenibilidad#AccountConfigurator.md-mantenibilidad">Mantenibilidad</h3><ul class="list" id="-1104960030#-fw06as_86" start="1"><li class="list-item" id="-1104960030#-fw06as_87"><p><span class="control" id="-1104960030#-fw06as_90">Separaci&oacute;n de responsabilidades:</span> Cada configurador maneja una preocupaci&oacute;n espec&iacute;fica</p></li><li class="list-item" id="-1104960030#-fw06as_88"><p><span class="control" id="-1104960030#-fw06as_91">F&aacute;cil testing:</span> Configuradores pueden probarse independientemente</p></li><li class="list-item" id="-1104960030#-fw06as_89"><p><span class="control" id="-1104960030#-fw06as_92">C&oacute;digo modular:</span> Cambios en configuraciones no afectan otras partes del sistema</p></li></ul></section><section><h3 id="-1104960030#extensibilidad" data-toc="extensibilidad#AccountConfigurator.md-extensibilidad">Extensibilidad</h3><ul class="list" id="-1104960030#-fw06as_93" start="1"><li class="list-item" id="-1104960030#-fw06as_94"><p><span class="control" id="-1104960030#-fw06as_97">Nuevas configuraciones:</span> Agregar configuradores sin modificar c&oacute;digo existente</p></li><li class="list-item" id="-1104960030#-fw06as_95"><p><span class="control" id="-1104960030#-fw06as_98">Configuraciones complejas:</span> Combinar m&uacute;ltiples configuradores simples</p></li><li class="list-item" id="-1104960030#-fw06as_96"><p><span class="control" id="-1104960030#-fw06as_99">Integraci&oacute;n con sistemas externos:</span> Configuradores espec&iacute;ficos para integraciones</p></li></ul></section></section><section><h2 id="-1104960030#testing-strategies" data-toc="testing-strategies#AccountConfigurator.md-testing-strategies">Testing Strategies</h2><section><h3 id="-1104960030#test-de-configurador-individual" data-toc="test-de-configurador-individual#AccountConfigurator.md-test-de-configurador-individual">Test de Configurador Individual</h3><div class="detached code-block" id="-1104960030#-fw06as_102"><pre><code class="language-none">@isTest
private class IndustryAccountConfiguratorTest {
    @isTest
    static void testTechnologyIndustryConfiguration() {
        Account testAccount = new Account(Name = 'Test Account');
        AccountConfigurator configurator = new IndustryAccountConfigurator('Technology');
        
        configurator.configure(testAccount);
        
        System.assertEquals('Technology', testAccount.Industry);
        System.assertEquals('Customer - Direct', testAccount.Type);
        System.assertEquals('Hot', testAccount.Rating);
    }
}</code></pre></div></section><section><h3 id="-1104960030#test-de-m-ltiples-configuradores" data-toc="test-de-m-ltiples-configuradores#AccountConfigurator.md-test-de-m-ltiples-configuradores">Test de M&uacute;ltiples Configuradores</h3><div class="detached code-block" id="-1104960030#-fw06as_103"><pre><code class="language-none">@isTest
static void testMultipleConfigurators() {
    Account testAccount = new Account(Name = 'Test Account');
    List&lt;AccountConfigurator&gt; configurators = new List&lt;AccountConfigurator&gt;{
        new IndustryAccountConfigurator('Healthcare'),
        new AddressAccountConfigurator('456 Health Ave', 'Boston', 'MA', 'USA', '02101')
    };
    
    for (AccountConfigurator configurator : configurators) {
        configurator.configure(testAccount);
    }
    
    System.assertEquals('Healthcare', testAccount.Industry);
    System.assertEquals('456 Health Ave', testAccount.BillingStreet);
    System.assertEquals('Boston', testAccount.BillingCity);
}</code></pre></div></section></section><section><h2 id="-1104960030#consideraciones-de-implementaci-n" data-toc="consideraciones-de-implementaci-n#AccountConfigurator.md-consideraciones-de-implementaci-n">Consideraciones de Implementaci&oacute;n</h2><section><h3 id="-1104960030#performance" data-toc="performance#AccountConfigurator.md-performance">Performance</h3><ul class="list" id="-1104960030#-fw06as_107" start="1"><li class="list-item" id="-1104960030#-fw06as_108"><p>Configuradores deben ser eficientes, especialmente en operaciones bulk</p></li><li class="list-item" id="-1104960030#-fw06as_109"><p>Evitar consultas SOQL dentro de configuradores cuando sea posible</p></li><li class="list-item" id="-1104960030#-fw06as_110"><p>Considerar cache para configuraciones complejas</p></li></ul></section><section><h3 id="-1104960030#error-handling" data-toc="error-handling#AccountConfigurator.md-error-handling">Error Handling</h3><ul class="list" id="-1104960030#-fw06as_111" start="1"><li class="list-item" id="-1104960030#-fw06as_112"><p>Configuradores deben manejar errores gracefully</p></li><li class="list-item" id="-1104960030#-fw06as_113"><p>Logging apropiado para debugging</p></li><li class="list-item" id="-1104960030#-fw06as_114"><p>Validaci&oacute;n de datos de entrada</p></li></ul></section><section><h3 id="-1104960030#security" data-toc="security#AccountConfigurator.md-security">Security</h3><ul class="list" id="-1104960030#-fw06as_115" start="1"><li class="list-item" id="-1104960030#-fw06as_116"><p>Validar permisos de campo antes de configurar</p></li><li class="list-item" id="-1104960030#-fw06as_117"><p>Sanitizar datos de entrada</p></li><li class="list-item" id="-1104960030#-fw06as_118"><p>Respetar field-level security</p></li></ul></section></section><section><h2 id="-1104960030#mejores-pr-cticas" data-toc="mejores-pr-cticas#AccountConfigurator.md-mejores-pr-cticas">Mejores Pr&aacute;cticas</h2><section><h3 id="-1104960030#naming-convention" data-toc="naming-convention#AccountConfigurator.md-naming-convention">Naming Convention</h3><ul class="list" id="-1104960030#-fw06as_123" start="1"><li class="list-item" id="-1104960030#-fw06as_124"><p>Sufijo <span class="inline-code" id="-1104960030#-fw06as_126">AccountConfigurator</span> para todas las implementaciones</p></li><li class="list-item" id="-1104960030#-fw06as_125"><p>Nombres descriptivos que indiquen el prop&oacute;sito: <span class="inline-code" id="-1104960030#-fw06as_127">IndustryAccountConfigurator</span></p></li></ul></section><section><h3 id="-1104960030#constructor-pattern" data-toc="constructor-pattern#AccountConfigurator.md-constructor-pattern">Constructor Pattern</h3><ul class="list" id="-1104960030#-fw06as_128" start="1"><li class="list-item" id="-1104960030#-fw06as_129"><p>Configuradores deben recibir datos necesarios en el constructor</p></li><li class="list-item" id="-1104960030#-fw06as_130"><p>Evitar configuradores con estado mutable</p></li></ul></section><section><h3 id="-1104960030#validation" data-toc="validation#AccountConfigurator.md-validation">Validation</h3><ul class="list" id="-1104960030#-fw06as_131" start="1"><li class="list-item" id="-1104960030#-fw06as_132"><p>Validar par&aacute;metros en constructores</p></li><li class="list-item" id="-1104960030#-fw06as_133"><p>Manejar casos edge apropiadamente</p></li><li class="list-item" id="-1104960030#-fw06as_134"><p>Documentar precondiciones y postcondiciones</p></li></ul></section><section><h3 id="-1104960030#logging" data-toc="logging#AccountConfigurator.md-logging">Logging</h3><ul class="list" id="-1104960030#-fw06as_135" start="1"><li class="list-item" id="-1104960030#-fw06as_136"><p>Log configuraciones aplicadas para auditor&iacute;a</p></li><li class="list-item" id="-1104960030#-fw06as_137"><p>Debug level apropiado para diferentes entornos</p></li></ul></section></section><section><h2 id="-1104960030#dependencias" data-toc="dependencias#AccountConfigurator.md-dependencias">Dependencias</h2><ul class="list" id="-1104960030#-fw06as_138" start="1"><li class="list-item" id="-1104960030#-fw06as_140"><p><span class="control" id="-1104960030#-fw06as_143">Account:</span> Objeto est&aacute;ndar de Salesforce a configurar</p></li><li class="list-item" id="-1104960030#-fw06as_141"><p><span class="control" id="-1104960030#-fw06as_144">AccountBuilder:</span> Clase que utiliza esta interfaz</p></li><li class="list-item" id="-1104960030#-fw06as_142"><p><span class="control" id="-1104960030#-fw06as_145">System.debug:</span> Para logging (recomendado en implementaciones)</p></li></ul><p id="-1104960030#-fw06as_139">Esta interfaz es fundamental para crear un sistema flexible y extensible de configuraci&oacute;n de Accounts, permitiendo que el c&oacute;digo sea mantenible y f&aacute;cil de extender con nuevas funcionalidades.</p></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-53121842">AccountBuilder</h1><section><h2 id="-53121842#descripci-n-general" data-toc="descripci-n-general#AccountBuilder.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-53121842#-xwoijm_17">Clase global que implementa el patr&oacute;n Builder para la construcci&oacute;n flexible y configuraci&oacute;n de objetos <span class="inline-code" id="-53121842#-xwoijm_18">Account</span>. Proporciona una interfaz fluida para crear cuentas con diferentes configuraciones, soporte para configuradores personalizados, y m&eacute;todos de conveniencia para conversi&oacute;n de Leads a Accounts.</p></section><section><h2 id="-53121842#informaci-n-de-la-clase" data-toc="informaci-n-de-la-clase#AccountBuilder.md-informaci-n-de-la-clase">Informaci&oacute;n de la Clase</h2><ul class="list" id="-53121842#-xwoijm_19" start="1"><li class="list-item" id="-53121842#-xwoijm_20"><p><span class="control" id="-53121842#-xwoijm_25">Autor:</span> Jean Carlos Melendez</p></li><li class="list-item" id="-53121842#-xwoijm_21"><p><span class="control" id="-53121842#-xwoijm_26">&Uacute;ltima modificaci&oacute;n:</span> 01-30-2025</p></li><li class="list-item" id="-53121842#-xwoijm_22"><p><span class="control" id="-53121842#-xwoijm_27">Modificado por:</span> Jean Carlos Melendez</p></li><li class="list-item" id="-53121842#-xwoijm_23"><p><span class="control" id="-53121842#-xwoijm_28">Tipo:</span> Clase global</p></li><li class="list-item" id="-53121842#-xwoijm_24"><p><span class="control" id="-53121842#-xwoijm_29">Prop&oacute;sito:</span> Constructor flexible de objetos Account con patr&oacute;n Builder</p></li></ul></section><section><h2 id="-53121842#propiedades-globales" data-toc="propiedades-globales#AccountBuilder.md-propiedades-globales">Propiedades Globales</h2><section><h3 id="-53121842#account" data-toc="account#AccountBuilder.md-account">account</h3><div class="detached code-block" id="-53121842#-xwoijm_32"><pre><code class="language-none">global Account account</code></pre></div><p id="-53121842#-xwoijm_33">Instancia del objeto <span class="inline-code" id="-53121842#-xwoijm_34">Account</span> que se est&aacute; construyendo.</p></section><section><h3 id="-53121842#configurators" data-toc="configurators#AccountBuilder.md-configurators">configurators</h3><div class="detached code-block" id="-53121842#-xwoijm_35"><pre><code class="language-none">global List&lt;AccountConfigurator&gt; configurators</code></pre></div><p id="-53121842#-xwoijm_36">Lista de configuradores personalizados que se aplicar&aacute;n durante la construcci&oacute;n del Account.</p></section></section><section><h2 id="-53121842#constructor" data-toc="constructor#AccountBuilder.md-constructor">Constructor</h2><section><h3 id="-53121842#accountbuilder" data-toc="accountbuilder#AccountBuilder.md-accountbuilder">AccountBuilder()</h3><div class="detached code-block" id="-53121842#-xwoijm_38"><pre><code class="language-none">global AccountBuilder()</code></pre></div><p id="-53121842#-xwoijm_39"><span class="control" id="-53121842#-xwoijm_42">Descripci&oacute;n:</span> Constructor por defecto que inicializa un nuevo objeto Account vac&iacute;o.</p><p id="-53121842#-xwoijm_40"><span class="control" id="-53121842#-xwoijm_43">Comportamiento:</span></p><ul class="list" id="-53121842#-xwoijm_41" start="1"><li class="list-item" id="-53121842#-xwoijm_44"><p>Crea una nueva instancia de <span class="inline-code" id="-53121842#-xwoijm_46">Account</span></p></li><li class="list-item" id="-53121842#-xwoijm_45"><p>Inicializa la lista de configuradores vac&iacute;a</p></li></ul></section></section><section><h2 id="-53121842#m-todos-builder-fluent-interface" data-toc="m-todos-builder-fluent-interface#AccountBuilder.md-m-todos-builder-fluent-interface">M&eacute;todos Builder (Fluent Interface)</h2><section><h3 id="-53121842#setid" data-toc="setid#AccountBuilder.md-setid">setId</h3><div class="detached code-block" id="-53121842#-xwoijm_52"><pre><code class="language-none">global AccountBuilder setId(String Id)</code></pre></div><p id="-53121842#-xwoijm_53"><span class="control" id="-53121842#-xwoijm_57">Descripci&oacute;n:</span> Establece el ID del Account (t&iacute;picamente para updates).</p><p id="-53121842#-xwoijm_54"><span class="control" id="-53121842#-xwoijm_58">Par&aacute;metros:</span></p><ul class="list" id="-53121842#-xwoijm_55" start="1"><li class="list-item" id="-53121842#-xwoijm_59"><p><span class="inline-code" id="-53121842#-xwoijm_60">Id</span> (String): ID del Account</p></li></ul><p id="-53121842#-xwoijm_56"><span class="control" id="-53121842#-xwoijm_61">Retorna:</span> <span class="inline-code" id="-53121842#-xwoijm_62">AccountBuilder</span> para encadenamiento de m&eacute;todos</p></section><section><h3 id="-53121842#setname" data-toc="setname#AccountBuilder.md-setname">setName</h3><div class="detached code-block" id="-53121842#-xwoijm_63"><pre><code class="language-none">global AccountBuilder setName(String name)</code></pre></div><p id="-53121842#-xwoijm_64"><span class="control" id="-53121842#-xwoijm_68">Descripci&oacute;n:</span> Establece el nombre del Account.</p><p id="-53121842#-xwoijm_65"><span class="control" id="-53121842#-xwoijm_69">Par&aacute;metros:</span></p><ul class="list" id="-53121842#-xwoijm_66" start="1"><li class="list-item" id="-53121842#-xwoijm_70"><p><span class="inline-code" id="-53121842#-xwoijm_71">name</span> (String): Nombre del Account</p></li></ul><p id="-53121842#-xwoijm_67"><span class="control" id="-53121842#-xwoijm_72">Retorna:</span> <span class="inline-code" id="-53121842#-xwoijm_73">AccountBuilder</span> para encadenamiento de m&eacute;todos</p></section><section><h3 id="-53121842#setphone" data-toc="setphone#AccountBuilder.md-setphone">setPhone</h3><div class="detached code-block" id="-53121842#-xwoijm_74"><pre><code class="language-none">global AccountBuilder setPhone(String phone)</code></pre></div><p id="-53121842#-xwoijm_75"><span class="control" id="-53121842#-xwoijm_79">Descripci&oacute;n:</span> Establece el tel&eacute;fono del Account.</p><p id="-53121842#-xwoijm_76"><span class="control" id="-53121842#-xwoijm_80">Par&aacute;metros:</span></p><ul class="list" id="-53121842#-xwoijm_77" start="1"><li class="list-item" id="-53121842#-xwoijm_81"><p><span class="inline-code" id="-53121842#-xwoijm_82">phone</span> (String): N&uacute;mero de tel&eacute;fono</p></li></ul><p id="-53121842#-xwoijm_78"><span class="control" id="-53121842#-xwoijm_83">Retorna:</span> <span class="inline-code" id="-53121842#-xwoijm_84">AccountBuilder</span> para encadenamiento de m&eacute;todos</p></section><section><h3 id="-53121842#setbillingaddress" data-toc="setbillingaddress#AccountBuilder.md-setbillingaddress">setBillingAddress</h3><div class="detached code-block" id="-53121842#-xwoijm_85"><pre><code class="language-none">global AccountBuilder setBillingAddress(String city, String street)</code></pre></div><p id="-53121842#-xwoijm_86"><span class="control" id="-53121842#-xwoijm_91">Descripci&oacute;n:</span> Establece la direcci&oacute;n de facturaci&oacute;n del Account.</p><p id="-53121842#-xwoijm_87"><span class="control" id="-53121842#-xwoijm_92">Par&aacute;metros:</span></p><ul class="list" id="-53121842#-xwoijm_88" start="1"><li class="list-item" id="-53121842#-xwoijm_93"><p><span class="inline-code" id="-53121842#-xwoijm_95">city</span> (String): Ciudad de facturaci&oacute;n</p></li><li class="list-item" id="-53121842#-xwoijm_94"><p><span class="inline-code" id="-53121842#-xwoijm_96">street</span> (String): Calle de facturaci&oacute;n</p></li></ul><p id="-53121842#-xwoijm_89"><span class="control" id="-53121842#-xwoijm_97">Retorna:</span> <span class="inline-code" id="-53121842#-xwoijm_98">AccountBuilder</span> para encadenamiento de m&eacute;todos</p><p id="-53121842#-xwoijm_90"><span class="control" id="-53121842#-xwoijm_99">Nota:</span> Solo configura ciudad y calle; otros campos de direcci&oacute;n pueden necesitar m&eacute;todos adicionales.</p></section><section><h3 id="-53121842#addconfigurators" data-toc="addconfigurators#AccountBuilder.md-addconfigurators">addConfigurators</h3><div class="detached code-block" id="-53121842#-xwoijm_100"><pre><code class="language-none">global AccountBuilder addConfigurators(List&lt;AccountConfigurator&gt; configuratorsList)</code></pre></div><p id="-53121842#-xwoijm_101"><span class="control" id="-53121842#-xwoijm_107">Descripci&oacute;n:</span> Agrega una lista de configuradores personalizados que se aplicar&aacute;n durante la construcci&oacute;n.</p><p id="-53121842#-xwoijm_102"><span class="control" id="-53121842#-xwoijm_108">Par&aacute;metros:</span></p><ul class="list" id="-53121842#-xwoijm_103" start="1"><li class="list-item" id="-53121842#-xwoijm_109"><p><span class="inline-code" id="-53121842#-xwoijm_110">configuratorsList</span> (List</p><p>): Lista de configuradores a agregar</p></li></ul><p id="-53121842#-xwoijm_104"><span class="control" id="-53121842#-xwoijm_112">Retorna:</span> <span class="inline-code" id="-53121842#-xwoijm_113">AccountBuilder</span> para encadenamiento de m&eacute;todos</p><p id="-53121842#-xwoijm_105"><span class="control" id="-53121842#-xwoijm_114">Comportamiento:</span></p><ul class="list" id="-53121842#-xwoijm_106" start="1"><li class="list-item" id="-53121842#-xwoijm_115"><p>Verifica que la lista no est&eacute; vac&iacute;a antes de agregar</p></li><li class="list-item" id="-53121842#-xwoijm_116"><p>Utiliza <span class="inline-code" id="-53121842#-xwoijm_117">addAll()</span> para agregar todos los configuradores de una vez</p></li></ul></section></section><section><h2 id="-53121842#m-todos-de-construcci-n" data-toc="m-todos-de-construcci-n#AccountBuilder.md-m-todos-de-construcci-n">M&eacute;todos de Construcci&oacute;n</h2><section><h3 id="-53121842#build" data-toc="build#AccountBuilder.md-build">build</h3><div class="detached code-block" id="-53121842#-xwoijm_120"><pre><code class="language-none">global Account build()</code></pre></div><p id="-53121842#-xwoijm_121"><span class="control" id="-53121842#-xwoijm_125">Descripci&oacute;n:</span> Construye el objeto Account aplicando todos los configuradores sin persistirlo en la base de datos.</p><p id="-53121842#-xwoijm_122"><span class="control" id="-53121842#-xwoijm_126">Retorna:</span> <span class="inline-code" id="-53121842#-xwoijm_127">Account</span> configurado pero no insertado</p><p id="-53121842#-xwoijm_123"><span class="control" id="-53121842#-xwoijm_128">Proceso:</span></p><ol class="list list-decimal" id="-53121842#-xwoijm_124" type="1" start="1"><li class="list-item" id="-53121842#-xwoijm_129"><p>Verifica si hay configuradores en la lista</p></li><li class="list-item" id="-53121842#-xwoijm_130"><p>Itera sobre cada configurador y llama a <span class="inline-code" id="-53121842#-xwoijm_132">configure(account)</span></p></li><li class="list-item" id="-53121842#-xwoijm_131"><p>Retorna el Account configurado</p></li></ol></section><section><h3 id="-53121842#buildandinsert" data-toc="buildandinsert#AccountBuilder.md-buildandinsert">buildAndInsert</h3><div class="detached code-block" id="-53121842#-xwoijm_133"><pre><code class="language-none">global Account buildAndInsert()</code></pre></div><p id="-53121842#-xwoijm_134"><span class="control" id="-53121842#-xwoijm_138">Descripci&oacute;n:</span> Construye el objeto Account, aplica configuradores, y lo inserta en la base de datos.</p><p id="-53121842#-xwoijm_135"><span class="control" id="-53121842#-xwoijm_139">Retorna:</span> <span class="inline-code" id="-53121842#-xwoijm_140">Account</span> configurado e insertado con ID asignado</p><p id="-53121842#-xwoijm_136"><span class="control" id="-53121842#-xwoijm_141">Proceso:</span></p><ol class="list list-decimal" id="-53121842#-xwoijm_137" type="1" start="1"><li class="list-item" id="-53121842#-xwoijm_142"><p>Aplica todos los configuradores (mismo proceso que <span class="inline-code" id="-53121842#-xwoijm_145">build()</span>)</p></li><li class="list-item" id="-53121842#-xwoijm_143"><p>Ejecuta <span class="inline-code" id="-53121842#-xwoijm_146">insert account</span></p></li><li class="list-item" id="-53121842#-xwoijm_144"><p>Retorna el Account con ID asignado</p></li></ol></section></section><section><h2 id="-53121842#m-todos-de-servicio" data-toc="m-todos-de-servicio#AccountBuilder.md-m-todos-de-servicio">M&eacute;todos de Servicio</h2><section><h3 id="-53121842#accountservice-con-record-type" data-toc="accountservice-con-record-type#AccountBuilder.md-accountservice-con-record-type">AccountService (con Record Type)</h3><div class="detached code-block" id="-53121842#-xwoijm_149"><pre><code class="language-none">global Account AccountService(Lead foundLead, String recordTypeAPIName)</code></pre></div><p id="-53121842#-xwoijm_150"><span class="control" id="-53121842#-xwoijm_157">Descripci&oacute;n:</span> M&eacute;todo de servicio para crear un Account basado en un Lead con un Record Type espec&iacute;fico.</p><p id="-53121842#-xwoijm_151"><span class="control" id="-53121842#-xwoijm_158">Par&aacute;metros:</span></p><ul class="list" id="-53121842#-xwoijm_152" start="1"><li class="list-item" id="-53121842#-xwoijm_159"><p><span class="inline-code" id="-53121842#-xwoijm_161">foundLead</span> (Lead): Lead fuente para extraer datos</p></li><li class="list-item" id="-53121842#-xwoijm_160"><p><span class="inline-code" id="-53121842#-xwoijm_162">recordTypeAPIName</span> (String): API Name del Record Type a asignar</p></li></ul><p id="-53121842#-xwoijm_153"><span class="control" id="-53121842#-xwoijm_163">Retorna:</span> <span class="inline-code" id="-53121842#-xwoijm_164">Account</span> creado e insertado</p><p id="-53121842#-xwoijm_154"><span class="control" id="-53121842#-xwoijm_165">Proceso:</span></p><ol class="list list-decimal" id="-53121842#-xwoijm_155" type="1" start="1"><li class="list-item" id="-53121842#-xwoijm_166"><p>Consulta el Record Type por <span class="inline-code" id="-53121842#-xwoijm_171">DeveloperName</span></p></li><li class="list-item" id="-53121842#-xwoijm_167"><p>Crea un nuevo AccountBuilder</p></li><li class="list-item" id="-53121842#-xwoijm_168"><p>Configura nombre (concatenando LastName + FirstName del Lead)</p></li><li class="list-item" id="-53121842#-xwoijm_169"><p>Configura tel&eacute;fono desde <span class="inline-code" id="-53121842#-xwoijm_172">MobilePhone</span> del Lead</p></li><li class="list-item" id="-53121842#-xwoijm_170"><p>Ejecuta <span class="inline-code" id="-53121842#-xwoijm_173">buildAndInsert()</span></p></li></ol><p id="-53121842#-xwoijm_156"><span class="control" id="-53121842#-xwoijm_174">Nota:</span> El c&oacute;digo tiene una consulta SOQL para Record Type pero no se asigna al Account.</p></section><section><h3 id="-53121842#accountservice-record-type-por-defecto" data-toc="accountservice-record-type-por-defecto#AccountBuilder.md-accountservice-record-type-por-defecto">AccountService (Record Type por Defecto)</h3><div class="detached code-block" id="-53121842#-xwoijm_175"><pre><code class="language-none">global Account AccountService(Lead foundLead)</code></pre></div><p id="-53121842#-xwoijm_176"><span class="control" id="-53121842#-xwoijm_181">Descripci&oacute;n:</span> Sobrecarga del m&eacute;todo anterior que usa 'PersonAccount' como Record Type por defecto.</p><p id="-53121842#-xwoijm_177"><span class="control" id="-53121842#-xwoijm_182">Par&aacute;metros:</span></p><ul class="list" id="-53121842#-xwoijm_178" start="1"><li class="list-item" id="-53121842#-xwoijm_183"><p><span class="inline-code" id="-53121842#-xwoijm_184">foundLead</span> (Lead): Lead fuente para extraer datos</p></li></ul><p id="-53121842#-xwoijm_179"><span class="control" id="-53121842#-xwoijm_185">Retorna:</span> <span class="inline-code" id="-53121842#-xwoijm_186">Account</span> creado e insertado</p><p id="-53121842#-xwoijm_180"><span class="control" id="-53121842#-xwoijm_187">Comportamiento:</span> Llama a <span class="inline-code" id="-53121842#-xwoijm_188">AccountService(foundLead, 'PersonAccount')</span></p></section></section><section><h2 id="-53121842#patr-n-de-dise-o-implementado" data-toc="patr-n-de-dise-o-implementado#AccountBuilder.md-patr-n-de-dise-o-implementado">Patr&oacute;n de Dise&ntilde;o Implementado</h2><section><h3 id="-53121842#builder-pattern" data-toc="builder-pattern#AccountBuilder.md-builder-pattern">Builder Pattern</h3><p id="-53121842#-xwoijm_190"><span class="control" id="-53121842#-xwoijm_194">Ventajas:</span></p><ul class="list" id="-53121842#-xwoijm_191" start="1"><li class="list-item" id="-53121842#-xwoijm_195"><p><span class="control" id="-53121842#-xwoijm_199">Fluent Interface:</span> M&eacute;todos encadenables para construcci&oacute;n intuitiva</p></li><li class="list-item" id="-53121842#-xwoijm_196"><p><span class="control" id="-53121842#-xwoijm_200">Flexibilidad:</span> Configuraci&oacute;n opcional de diferentes campos</p></li><li class="list-item" id="-53121842#-xwoijm_197"><p><span class="control" id="-53121842#-xwoijm_201">Extensibilidad:</span> Soporte para configuradores personalizados</p></li><li class="list-item" id="-53121842#-xwoijm_198"><p><span class="control" id="-53121842#-xwoijm_202">Reutilizaci&oacute;n:</span> Mismo builder puede crear m&uacute;ltiples variaciones</p></li></ul><p id="-53121842#-xwoijm_192"><span class="control" id="-53121842#-xwoijm_203">Estructura:</span></p><div class="detached code-block" id="-53121842#-xwoijm_193"><pre><code class="language-none">Account acc = new AccountBuilder()
    .setName(&quot;Test Company&quot;)
    .setPhone(&quot;555-1234&quot;)
    .setBillingAddress(&quot;Miami&quot;, &quot;123 Main St&quot;)
    .addConfigurators(customConfigurators)
    .buildAndInsert();</code></pre></div></section></section><section><h2 id="-53121842#patr-n-strategy-con-configuradores" data-toc="patr-n-strategy-con-configuradores#AccountBuilder.md-patr-n-strategy-con-configuradores">Patr&oacute;n Strategy (con Configuradores)</h2><section><h3 id="-53121842#accountconfigurator-interface" data-toc="accountconfigurator-interface#AccountBuilder.md-accountconfigurator-interface">AccountConfigurator Interface</h3><p id="-53121842#-xwoijm_205">Los configuradores implementan el patr&oacute;n Strategy para aplicar configuraciones espec&iacute;ficas:</p><div class="detached code-block" id="-53121842#-xwoijm_206"><pre><code class="language-none">public interface AccountConfigurator {
    void configure(Account account);
}</code></pre></div><p id="-53121842#-xwoijm_207"><span class="control" id="-53121842#-xwoijm_209">Ejemplos de Configuradores:</span></p><ul class="list" id="-53121842#-xwoijm_208" start="1"><li class="list-item" id="-53121842#-xwoijm_210"><p>Configurador de campos personalizados</p></li><li class="list-item" id="-53121842#-xwoijm_211"><p>Configurador de integraci&oacute;n externa</p></li><li class="list-item" id="-53121842#-xwoijm_212"><p>Configurador espec&iacute;fico por industria</p></li></ul></section></section><section><h2 id="-53121842#casos-de-uso" data-toc="casos-de-uso#AccountBuilder.md-casos-de-uso">Casos de Uso</h2><section><h3 id="-53121842#construcci-n-b-sica" data-toc="construcci-n-b-sica#AccountBuilder.md-construcci-n-b-sica">Construcci&oacute;n B&aacute;sica</h3><div class="detached code-block" id="-53121842#-xwoijm_217"><pre><code class="language-none">Account basicAccount = new AccountBuilder()
    .setName(&quot;ACME Corp&quot;)
    .setPhone(&quot;555-0123&quot;)
    .build();</code></pre></div></section><section><h3 id="-53121842#conversi-n-de-lead-a-account" data-toc="conversi-n-de-lead-a-account#AccountBuilder.md-conversi-n-de-lead-a-account">Conversi&oacute;n de Lead a Account</h3><div class="detached code-block" id="-53121842#-xwoijm_218"><pre><code class="language-none">Lead myLead = [SELECT LastName, FirstName, MobilePhone FROM Lead LIMIT 1];
Account convertedAccount = new AccountBuilder().AccountService(myLead);</code></pre></div></section><section><h3 id="-53121842#configuraci-n-avanzada-con-configuradores" data-toc="configuraci-n-avanzada-con-configuradores#AccountBuilder.md-configuraci-n-avanzada-con-configuradores">Configuraci&oacute;n Avanzada con Configuradores</h3><div class="detached code-block" id="-53121842#-xwoijm_219"><pre><code class="language-none">List&lt;AccountConfigurator&gt; configs = new List&lt;AccountConfigurator&gt;{
    new IndustryConfigurator('Technology'),
    new CustomFieldConfigurator()
};

Account complexAccount = new AccountBuilder()
    .setName(&quot;Tech Solutions Inc&quot;)
    .addConfigurators(configs)
    .buildAndInsert();</code></pre></div></section><section><h3 id="-53121842#account-con-record-type-espec-fico" data-toc="account-con-record-type-espec-fico#AccountBuilder.md-account-con-record-type-espec-fico">Account con Record Type Espec&iacute;fico</h3><div class="detached code-block" id="-53121842#-xwoijm_220"><pre><code class="language-none">Account personAccount = new AccountBuilder()
    .AccountService(leadRecord, 'PersonAccount');</code></pre></div></section></section><section><h2 id="-53121842#ventajas-del-dise-o" data-toc="ventajas-del-dise-o#AccountBuilder.md-ventajas-del-dise-o">Ventajas del Dise&ntilde;o</h2><section><h3 id="-53121842#flexibilidad" data-toc="flexibilidad#AccountBuilder.md-flexibilidad">Flexibilidad</h3><ul class="list" id="-53121842#-xwoijm_224" start="1"><li class="list-item" id="-53121842#-xwoijm_225"><p>Configuraci&oacute;n incremental de campos</p></li><li class="list-item" id="-53121842#-xwoijm_226"><p>Soporte para extensiones a trav&eacute;s de configuradores</p></li><li class="list-item" id="-53121842#-xwoijm_227"><p>M&eacute;todos de conveniencia para casos comunes</p></li></ul></section><section><h3 id="-53121842#mantenibilidad" data-toc="mantenibilidad#AccountBuilder.md-mantenibilidad">Mantenibilidad</h3><ul class="list" id="-53121842#-xwoijm_228" start="1"><li class="list-item" id="-53121842#-xwoijm_229"><p>Separaci&oacute;n clara entre construcci&oacute;n y configuraci&oacute;n</p></li><li class="list-item" id="-53121842#-xwoijm_230"><p>C&oacute;digo reutilizable para diferentes tipos de Account</p></li><li class="list-item" id="-53121842#-xwoijm_231"><p>F&aacute;cil testing a trav&eacute;s de builders</p></li></ul></section><section><h3 id="-53121842#usabilidad" data-toc="usabilidad#AccountBuilder.md-usabilidad">Usabilidad</h3><ul class="list" id="-53121842#-xwoijm_232" start="1"><li class="list-item" id="-53121842#-xwoijm_233"><p>Interfaz fluida y legible</p></li><li class="list-item" id="-53121842#-xwoijm_234"><p>M&eacute;todos de servicio para casos espec&iacute;ficos</p></li><li class="list-item" id="-53121842#-xwoijm_235"><p>Soporte tanto para build como insert</p></li></ul></section></section><section><h2 id="-53121842#consideraciones-y-mejoras" data-toc="consideraciones-y-mejoras#AccountBuilder.md-consideraciones-y-mejoras">Consideraciones y Mejoras</h2><section><h3 id="-53121842#problemas-identificados" data-toc="problemas-identificados#AccountBuilder.md-problemas-identificados">Problemas Identificados</h3><ol class="list list-decimal" id="-53121842#-xwoijm_238" type="1" start="1"><li class="list-item" id="-53121842#-xwoijm_239"><p><span class="control" id="-53121842#-xwoijm_242">Record Type no asignado:</span> El m&eacute;todo <span class="inline-code" id="-53121842#-xwoijm_243">AccountService</span> consulta Record Type pero no lo asigna</p></li><li class="list-item" id="-53121842#-xwoijm_240"><p><span class="control" id="-53121842#-xwoijm_244">Validaci&oacute;n limitada:</span> Falta validaci&oacute;n de campos requeridos</p></li><li class="list-item" id="-53121842#-xwoijm_241"><p><span class="control" id="-53121842#-xwoijm_245">Manejo de errores:</span> No hay manejo de excepciones en inserts</p></li></ol></section><section><h3 id="-53121842#mejoras-sugeridas" data-toc="mejoras-sugeridas#AccountBuilder.md-mejoras-sugeridas">Mejoras Sugeridas</h3><section><h4 id="-53121842#correcci-n-de-record-type" data-toc="correcci-n-de-record-type#AccountBuilder.md-correcci-n-de-record-type">Correcci&oacute;n de Record Type</h4><div class="detached code-block" id="-53121842#-xwoijm_249"><pre><code class="language-none">global Account AccountService(Lead foundLead, String recordTypeAPIName) {
    Id recordTypeId = [SELECT Id FROM RecordType 
                      WHERE DeveloperName = :recordTypeAPIName LIMIT 1].Id;
    
    return new AccountBuilder()
        .setId(null) // Nuevo método para Record Type
        .setRecordTypeId(recordTypeId) // Método faltante
        .setName(foundLead?.LastName + ' ' + foundLead?.FirstName)
        .setPhone(foundLead?.MobilePhone)
        .buildAndInsert();
}</code></pre></div></section><section><h4 id="-53121842#m-todos-adicionales-recomendados" data-toc="m-todos-adicionales-recomendados#AccountBuilder.md-m-todos-adicionales-recomendados">M&eacute;todos Adicionales Recomendados</h4><div class="detached code-block" id="-53121842#-xwoijm_250"><pre><code class="language-none">global AccountBuilder setRecordTypeId(Id recordTypeId)
global AccountBuilder setIndustry(String industry)
global AccountBuilder setWebsite(String website)
global AccountBuilder setShippingAddress(String city, String street)</code></pre></div></section><section><h4 id="-53121842#validaci-n" data-toc="validaci-n#AccountBuilder.md-validaci-n">Validaci&oacute;n</h4><div class="detached code-block" id="-53121842#-xwoijm_251"><pre><code class="language-none">global Account build() {
    validateRequiredFields();
    applyConfigurators();
    return account;
}

private void validateRequiredFields() {
    if (String.isBlank(account.Name)) {
        throw new BuilderException('Account Name is required');
    }
}</code></pre></div></section></section></section><section><h2 id="-53121842#dependencias" data-toc="dependencias#AccountBuilder.md-dependencias">Dependencias</h2><ul class="list" id="-53121842#-xwoijm_252" start="1"><li class="list-item" id="-53121842#-xwoijm_253"><p><span class="control" id="-53121842#-xwoijm_257">Account:</span> Objeto est&aacute;ndar de Salesforce</p></li><li class="list-item" id="-53121842#-xwoijm_254"><p><span class="control" id="-53121842#-xwoijm_258">Lead:</span> Para m&eacute;todos de conversi&oacute;n</p></li><li class="list-item" id="-53121842#-xwoijm_255"><p><span class="control" id="-53121842#-xwoijm_259">RecordType:</span> Para configuraci&oacute;n de tipos de cuenta</p></li><li class="list-item" id="-53121842#-xwoijm_256"><p><span class="control" id="-53121842#-xwoijm_260">AccountConfigurator:</span> Interfaz para configuradores personalizados (debe ser implementada)</p></li></ul></section><section><h2 id="-53121842#testing-considerations" data-toc="testing-considerations#AccountBuilder.md-testing-considerations">Testing Considerations</h2><ul class="list" id="-53121842#-xwoijm_261" start="1"><li class="list-item" id="-53121842#-xwoijm_262"><p>Crear builders de test con datos mock</p></li><li class="list-item" id="-53121842#-xwoijm_263"><p>Probar encadenamiento de m&eacute;todos</p></li><li class="list-item" id="-53121842#-xwoijm_264"><p>Validar configuradores personalizados</p></li><li class="list-item" id="-53121842#-xwoijm_265"><p>Testing de m&eacute;todos de servicio con Leads reales</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1368901578">QuotingException</h1><section><h2 id="-1368901578#descripci-n-general" data-toc="descripci-n-general#QuotingException.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-1368901578#-gk7216_18"><span class="inline-code" id="-1368901578#-gk7216_19">QuotingException</span> es una clase de excepci&oacute;n personalizada que extiende la clase <span class="inline-code" id="-1368901578#-gk7216_20">Exception</span> est&aacute;ndar de Apex. Esta clase est&aacute; dise&ntilde;ada para representar errores espec&iacute;ficos que ocurren durante los procesos de cotizaci&oacute;n en el sistema.</p></section><section><h2 id="-1368901578#autor" data-toc="autor#QuotingException.md-autor">Autor</h2><p id="-1368901578#-gk7216_21">Soulberto Lorenzo \&lt;soulberto@cloudblue.us\&gt;</p></section><section><h2 id="-1368901578#ltima-modificaci-n" data-toc="ltima-modificaci-n#QuotingException.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="-1368901578#-gk7216_22">16 de agosto de 2024</p></section><section><h2 id="-1368901578#estructura" data-toc="estructura#QuotingException.md-estructura">Estructura</h2><div class="detached code-block" id="-1368901578#-gk7216_23"><pre><code class="language-none">public class QuotingException extends Exception {

}</code></pre></div><p id="-1368901578#-gk7216_24">La clase no define m&eacute;todos o propiedades adicionales m&aacute;s all&aacute; de los heredados de la clase base <span class="inline-code" id="-1368901578#-gk7216_25">Exception</span>.</p></section><section><h2 id="-1368901578#herencia" data-toc="herencia#QuotingException.md-herencia">Herencia</h2><ul class="list" id="-1368901578#-gk7216_26" start="1"><li class="list-item" id="-1368901578#-gk7216_27"><p><span class="control" id="-1368901578#-gk7216_29">Clase Base</span>: <span class="inline-code" id="-1368901578#-gk7216_30">Exception</span></p></li><li class="list-item" id="-1368901578#-gk7216_28"><p><span class="control" id="-1368901578#-gk7216_31">Paquete</span>: Est&aacute;ndar de Salesforce</p></li></ul></section><section><h2 id="-1368901578#prop-sito" data-toc="prop-sito#QuotingException.md-prop-sito">Prop&oacute;sito</h2><p id="-1368901578#-gk7216_32">El prop&oacute;sito principal de esta clase es proporcionar un tipo de excepci&oacute;n espec&iacute;fico para errores relacionados con el proceso de cotizaci&oacute;n, permitiendo:</p><ol class="list list-decimal" id="-1368901578#-gk7216_33" type="1" start="1"><li class="list-item" id="-1368901578#-gk7216_34"><p><span class="control" id="-1368901578#-gk7216_38">Categorizaci&oacute;n de Errores</span>: Distinguir errores de cotizaci&oacute;n de otros tipos de excepciones en el sistema.</p></li><li class="list-item" id="-1368901578#-gk7216_35"><p><span class="control" id="-1368901578#-gk7216_39">Manejo Espec&iacute;fico</span>: Permitir que el c&oacute;digo que captura excepciones pueda identificar y manejar espec&iacute;ficamente errores del proceso de cotizaci&oacute;n.</p></li><li class="list-item" id="-1368901578#-gk7216_36"><p><span class="control" id="-1368901578#-gk7216_40">Claridad en el C&oacute;digo</span>: Mejorar la legibilidad del c&oacute;digo al indicar expl&iacute;citamente cuando un error est&aacute; relacionado con el proceso de cotizaci&oacute;n.</p></li><li class="list-item" id="-1368901578#-gk7216_37"><p><span class="control" id="-1368901578#-gk7216_41">Seguimiento Espec&iacute;fico</span>: Facilitar el seguimiento y an&aacute;lisis de errores espec&iacute;ficos del proceso de cotizaci&oacute;n.</p></li></ol></section><section><h2 id="-1368901578#m-todos-heredados" data-toc="m-todos-heredados#QuotingException.md-m-todos-heredados">M&eacute;todos Heredados</h2><p id="-1368901578#-gk7216_42">Al extender la clase <span class="inline-code" id="-1368901578#-gk7216_45">Exception</span> est&aacute;ndar, <span class="inline-code" id="-1368901578#-gk7216_46">QuotingException</span> hereda los siguientes m&eacute;todos y propiedades:</p><section><h3 id="-1368901578#constructores" data-toc="constructores#QuotingException.md-constructores">Constructores</h3><ul class="list" id="-1368901578#-gk7216_47" start="1"><li class="list-item" id="-1368901578#-gk7216_48"><p><span class="control" id="-1368901578#-gk7216_52"><span class="inline-code" id="-1368901578#-gk7216_53">QuotingException()</span></span>: Constructor por defecto.</p></li><li class="list-item" id="-1368901578#-gk7216_49"><p><span class="control" id="-1368901578#-gk7216_54"><span class="inline-code" id="-1368901578#-gk7216_55">QuotingException(String message)</span></span>: Constructor que acepta un mensaje de error.</p></li><li class="list-item" id="-1368901578#-gk7216_50"><p><span class="control" id="-1368901578#-gk7216_56"><span class="inline-code" id="-1368901578#-gk7216_57">QuotingException(Exception cause)</span></span>: Constructor que acepta otra excepci&oacute;n como causa.</p></li><li class="list-item" id="-1368901578#-gk7216_51"><p><span class="control" id="-1368901578#-gk7216_58"><span class="inline-code" id="-1368901578#-gk7216_59">QuotingException(String message, Exception cause)</span></span>: Constructor que acepta un mensaje y otra excepci&oacute;n como causa.</p></li></ul></section><section><h3 id="-1368901578#m-todos" data-toc="m-todos#QuotingException.md-m-todos">M&eacute;todos</h3><ul class="list" id="-1368901578#-gk7216_60" start="1"><li class="list-item" id="-1368901578#-gk7216_61"><p><span class="control" id="-1368901578#-gk7216_67"><span class="inline-code" id="-1368901578#-gk7216_68">getMessage()</span></span>: Devuelve el mensaje de error asociado con la excepci&oacute;n.</p></li><li class="list-item" id="-1368901578#-gk7216_62"><p><span class="control" id="-1368901578#-gk7216_69"><span class="inline-code" id="-1368901578#-gk7216_70">getCause()</span></span>: Devuelve la excepci&oacute;n que caus&oacute; esta excepci&oacute;n, si existe.</p></li><li class="list-item" id="-1368901578#-gk7216_63"><p><span class="control" id="-1368901578#-gk7216_71"><span class="inline-code" id="-1368901578#-gk7216_72">getTypeName()</span></span>: Devuelve el nombre del tipo de excepci&oacute;n.</p></li><li class="list-item" id="-1368901578#-gk7216_64"><p><span class="control" id="-1368901578#-gk7216_73"><span class="inline-code" id="-1368901578#-gk7216_74">setMessage(String message)</span></span>: Establece el mensaje de error para la excepci&oacute;n.</p></li><li class="list-item" id="-1368901578#-gk7216_65"><p><span class="control" id="-1368901578#-gk7216_75"><span class="inline-code" id="-1368901578#-gk7216_76">getLineNumber()</span></span>: Devuelve el n&uacute;mero de l&iacute;nea donde se gener&oacute; la excepci&oacute;n.</p></li><li class="list-item" id="-1368901578#-gk7216_66"><p><span class="control" id="-1368901578#-gk7216_77"><span class="inline-code" id="-1368901578#-gk7216_78">getStackTraceString()</span></span>: Devuelve una representaci&oacute;n de texto del seguimiento de la pila.</p></li></ul></section></section><section><h2 id="-1368901578#uso-en-el-sistema" data-toc="uso-en-el-sistema#QuotingException.md-uso-en-el-sistema">Uso en el Sistema</h2><p id="-1368901578#-gk7216_79">Esta excepci&oacute;n est&aacute; dise&ntilde;ada para ser utilizada por clases que participan en el proceso de cotizaci&oacute;n, tales como:</p><ol class="list list-decimal" id="-1368901578#-gk7216_80" type="1" start="1"><li class="list-item" id="-1368901578#-gk7216_81"><p><span class="control" id="-1368901578#-gk7216_85"><span class="inline-code" id="-1368901578#-gk7216_86">QuoteProductHandler</span></span>: Puede lanzar esta excepci&oacute;n cuando hay problemas espec&iacute;ficos en el proceso de cotizaci&oacute;n.</p></li><li class="list-item" id="-1368901578#-gk7216_82"><p><span class="control" id="-1368901578#-gk7216_87"><span class="inline-code" id="-1368901578#-gk7216_88">QuoteUtils</span></span>: Puede lanzar esta excepci&oacute;n cuando hay problemas en la validaci&oacute;n o manipulaci&oacute;n de cotizaciones.</p></li><li class="list-item" id="-1368901578#-gk7216_83"><p><span class="control" id="-1368901578#-gk7216_89">Clases de validaci&oacute;n de datos</span>: Pueden lanzar esta excepci&oacute;n cuando los datos de entrada para una cotizaci&oacute;n no cumplen con los requisitos.</p></li><li class="list-item" id="-1368901578#-gk7216_84"><p><span class="control" id="-1368901578#-gk7216_90">Procedimientos de integraci&oacute;n</span>: Pueden lanzar esta excepci&oacute;n cuando hay problemas al interactuar con sistemas externos durante el proceso de cotizaci&oacute;n.</p></li></ol></section><section><h2 id="-1368901578#ejemplo-de-lanzamiento" data-toc="ejemplo-de-lanzamiento#QuotingException.md-ejemplo-de-lanzamiento">Ejemplo de Lanzamiento</h2><div class="detached code-block" id="-1368901578#-gk7216_91"><pre><code class="language-none">public Map&lt;String, Object&gt; calculatePremium(Map&lt;String, Object&gt; quoteData) {
    try {
        // Validar datos de entrada
        if (!quoteData.containsKey('insuredItems') || quoteData.get('insuredItems') == null) {
            throw new QuotingException('Los elementos asegurados son requeridos para calcular la prima');
        }
        
        List&lt;Object&gt; insuredItems = (List&lt;Object&gt;)quoteData.get('insuredItems');
        if (insuredItems.isEmpty()) {
            throw new QuotingException('Debe proporcionar al menos un elemento asegurado');
        }
        
        // Calcular la prima basada en los elementos asegurados
        Decimal totalPremium = 0;
        for (Object item : insuredItems) {
            Map&lt;String, Object&gt; insuredItem = (Map&lt;String, Object&gt;)item;
            
            if (!insuredItem.containsKey('value') || insuredItem.get('value') == null) {
                throw new QuotingException('Cada elemento asegurado debe tener un valor especificado');
            }
            
            Decimal itemValue = (Decimal)insuredItem.get('value');
            Decimal itemPremium = calculateItemPremium(itemValue, insuredItem);
            totalPremium += itemPremium;
        }
        
        // Crear respuesta
        return new Map&lt;String, Object&gt;{
            'totalPremium' =&gt; totalPremium,
            'currency' =&gt; 'USD',
            'calculationDate' =&gt; System.now()
        };
    } catch (QuotingException qe) {
        // Relanzar la excepción específica de cotización
        throw qe;
    } catch (Exception e) {
        // Convertir excepciones genéricas en QuotingException
        throw new QuotingException('Error al calcular la prima: ' + e.getMessage(), e);
    }
}

private Decimal calculateItemPremium(Decimal itemValue, Map&lt;String, Object&gt; itemData) {
    // Lógica de cálculo de prima para un elemento específico
    // ...
    
    // Si hay algún problema específico del cálculo
    if (itemValue &lt;= 0) {
        throw new QuotingException('El valor del elemento asegurado debe ser mayor que cero');
    }
    
    return itemValue * 0.05; // Ejemplo simplificado
}</code></pre></div></section><section><h2 id="-1368901578#ejemplo-de-captura" data-toc="ejemplo-de-captura#QuotingException.md-ejemplo-de-captura">Ejemplo de Captura</h2><div class="detached code-block" id="-1368901578#-gk7216_92"><pre><code class="language-none">try {
    // Obtener datos de cotización
    Map&lt;String, Object&gt; quoteData = getQuoteDataFromRequest();
    
    // Calcular la prima
    Map&lt;String, Object&gt; premiumResult = calculatePremium(quoteData);
    
    // Procesar el resultado
    processQuoteResult(premiumResult);
} catch (QuotingException qe) {
    // Manejo específico para errores de cotización
    System.debug('Error en el proceso de cotización: ' + qe.getMessage());
    
    // Registrar el error específico de cotización
    Quoting_Error__c errorRecord = new Quoting_Error__c(
        Error_Message__c = qe.getMessage(),
        Stack_Trace__c = qe.getStackTraceString(),
        Timestamp__c = Datetime.now(),
        Quote_Data__c = JSON.serialize(quoteData)
    );
    insert errorRecord;
    
    // Devolver una respuesta de error específica para cotizaciones
    return createQuotingErrorResponse(qe.getMessage());
} catch (Exception e) {
    // Manejo genérico para otros tipos de excepciones
    System.debug('Error general: ' + e.getMessage());
    
    // Devolver una respuesta de error genérica
    return createGenericErrorResponse(e.getMessage());
}</code></pre></div></section><section><h2 id="-1368901578#extensi-n-personalizada" data-toc="extensi-n-personalizada#QuotingException.md-extensi-n-personalizada">Extensi&oacute;n Personalizada</h2><p id="-1368901578#-gk7216_93">Aunque la implementaci&oacute;n actual es minimalista, la clase puede ser extendida para incluir informaci&oacute;n adicional espec&iacute;fica del proceso de cotizaci&oacute;n:</p><div class="detached code-block" id="-1368901578#-gk7216_94"><pre><code class="language-none">public class EnhancedQuotingException extends QuotingException {
    private String errorCode;
    private String quoteId;
    private String productCode;
    private Decimal attemptedPremium;
    
    public EnhancedQuotingException(String message) {
        super(message);
    }
    
    public EnhancedQuotingException(String message, String errorCode) {
        super(message);
        this.errorCode = errorCode;
    }
    
    public EnhancedQuotingException(
        String message, 
        String errorCode, 
        String quoteId, 
        String productCode
    ) {
        super(message);
        this.errorCode = errorCode;
        this.quoteId = quoteId;
        this.productCode = productCode;
    }
    
    public EnhancedQuotingException(
        String message, 
        String errorCode, 
        String quoteId, 
        String productCode, 
        Decimal attemptedPremium,
        Exception cause
    ) {
        super(message, cause);
        this.errorCode = errorCode;
        this.quoteId = quoteId;
        this.productCode = productCode;
        this.attemptedPremium = attemptedPremium;
    }
    
    public String getErrorCode() {
        return this.errorCode;
    }
    
    public String getQuoteId() {
        return this.quoteId;
    }
    
    public String getProductCode() {
        return this.productCode;
    }
    
    public Decimal getAttemptedPremium() {
        return this.attemptedPremium;
    }
}</code></pre></div></section><section><h2 id="-1368901578#mejores-pr-cticas" data-toc="mejores-pr-cticas#QuotingException.md-mejores-pr-cticas">Mejores Pr&aacute;cticas</h2><ol class="list list-decimal" id="-1368901578#-gk7216_95" type="1" start="1"><li class="list-item" id="-1368901578#-gk7216_96"><p><span class="control" id="-1368901578#-gk7216_101">Mensajes Descriptivos</span>: Incluir informaci&oacute;n espec&iacute;fica en los mensajes de error, como campos faltantes, valores inv&aacute;lidos o condiciones no cumplidas.</p></li><li class="list-item" id="-1368901578#-gk7216_97"><p><span class="control" id="-1368901578#-gk7216_102">Captura Selectiva</span>: Capturar esta excepci&oacute;n espec&iacute;ficamente cuando se quiera manejar errores de cotizaci&oacute;n de manera diferenciada.</p></li><li class="list-item" id="-1368901578#-gk7216_98"><p><span class="control" id="-1368901578#-gk7216_103">Informaci&oacute;n de Contexto</span>: Al lanzar la excepci&oacute;n, proporcionar informaci&oacute;n de contexto que pueda ayudar a diagnosticar el problema, como los datos de entrada que causaron el error.</p></li><li class="list-item" id="-1368901578#-gk7216_99"><p><span class="control" id="-1368901578#-gk7216_104">Encadenamiento de Excepciones</span>: Utilizar el constructor que acepta una excepci&oacute;n causa para preservar el seguimiento de la pila original cuando se convierten excepciones gen&eacute;ricas en <span class="inline-code" id="-1368901578#-gk7216_105">QuotingException</span>.</p></li><li class="list-item" id="-1368901578#-gk7216_100"><p><span class="control" id="-1368901578#-gk7216_106">Registro Adecuado</span>: Registrar las excepciones capturadas para su posterior an&aacute;lisis y soluci&oacute;n de problemas, posiblemente en un objeto personalizado para errores de cotizaci&oacute;n.</p></li></ol></section><section><h2 id="-1368901578#puntos-a-considerar" data-toc="puntos-a-considerar#QuotingException.md-puntos-a-considerar">Puntos a Considerar</h2><ol class="list list-decimal" id="-1368901578#-gk7216_107" type="1" start="1"><li class="list-item" id="-1368901578#-gk7216_108"><p><span class="control" id="-1368901578#-gk7216_112">Granularidad</span>: Considerar si es necesario tener subtipos m&aacute;s espec&iacute;ficos de <span class="inline-code" id="-1368901578#-gk7216_113">QuotingException</span> para diferentes aspectos del proceso de cotizaci&oacute;n (por ejemplo, <span class="inline-code" id="-1368901578#-gk7216_114">QuoteValidationException</span>, <span class="inline-code" id="-1368901578#-gk7216_115">PremiumCalculationException</span>, etc.).</p></li><li class="list-item" id="-1368901578#-gk7216_109"><p><span class="control" id="-1368901578#-gk7216_116">C&oacute;digos de Error</span>: Implementar un sistema de c&oacute;digos de error para categorizar diferentes tipos de errores de cotizaci&oacute;n de manera m&aacute;s estructurada.</p></li><li class="list-item" id="-1368901578#-gk7216_110"><p><span class="control" id="-1368901578#-gk7216_117">Informaci&oacute;n Contextual</span>: Evaluar la necesidad de incluir informaci&oacute;n contextual adicional en la excepci&oacute;n, como se muestra en el ejemplo de extensi&oacute;n personalizada.</p></li><li class="list-item" id="-1368901578#-gk7216_111"><p><span class="control" id="-1368901578#-gk7216_118">Integraci&oacute;n con Sistemas de Monitoreo</span>: Asegurar que estas excepciones se integren adecuadamente con los sistemas de monitoreo y alerta existentes.</p></li></ol></section><section><h2 id="-1368901578#integraci-n-con-otras-clases" data-toc="integraci-n-con-otras-clases#QuotingException.md-integraci-n-con-otras-clases">Integraci&oacute;n con Otras Clases</h2><section><h3 id="-1368901578#relaci-n-con-quoteproducthandler" data-toc="relaci-n-con-quoteproducthandler#QuotingException.md-relaci-n-con-quoteproducthandler">Relaci&oacute;n con QuoteProductHandler</h3><p id="-1368901578#-gk7216_121">La clase <span class="inline-code" id="-1368901578#-gk7216_123">QuoteProductHandler</span> podr&iacute;a utilizar <span class="inline-code" id="-1368901578#-gk7216_124">QuotingException</span> para manejar errores espec&iacute;ficos del proceso de cotizaci&oacute;n:</p><div class="detached code-block" id="-1368901578#-gk7216_122"><pre><code class="language-none">// Ejemplo de uso en QuoteProductHandler
public override Map&lt;String, Object&gt; process(
  Map&lt;String, Object&gt; options,
  Map&lt;String, Object&gt; input,
  Map&lt;String, Object&gt; output
) {
  try {
    // Validar datos de entrada
    Map&lt;Boolean, Object&gt; validation = QuoteUtils.validateInputMapForQuoting(input);
    if (validation.containsKey(false)) {
      throw new QuotingException(validation.get(false).toString());
    }
    
    // Procesar la cotización
    // ...
    
    return output;
  } catch (QuotingException qe) {
    // Manejar o relanzar la excepción específica de cotización
    throw qe;
  } catch (Exception e) {
    // Convertir otras excepciones en QuotingException
    throw new QuotingException('Error en el proceso de cotización: ' + e.getMessage(), e);
  }
}</code></pre></div></section><section><h3 id="-1368901578#relaci-n-con-quoteutils" data-toc="relaci-n-con-quoteutils#QuotingException.md-relaci-n-con-quoteutils">Relaci&oacute;n con QuoteUtils</h3><p id="-1368901578#-gk7216_125">La clase <span class="inline-code" id="-1368901578#-gk7216_127">QuoteUtils</span> podr&iacute;a lanzar <span class="inline-code" id="-1368901578#-gk7216_128">QuotingException</span> en sus m&eacute;todos de validaci&oacute;n:</p><div class="detached code-block" id="-1368901578#-gk7216_126"><pre><code class="language-none">// Ejemplo de cómo QuoteUtils podría lanzar QuotingException
public static void validateQuoteData(Map&lt;String, Object&gt; quoteData) {
  if (!quoteData.containsKey(MAIN_NODE) || quoteData.get(MAIN_NODE) == null) {
    throw new QuotingException('Falta el nodo principal requerido: ' + MAIN_NODE);
  }
  
  Map&lt;String, Object&gt; mainNode = (Map&lt;String, Object&gt;)quoteData.get(MAIN_NODE);
  
  for (String requiredParam : REQUIRED_PARAMETERS) {
    if (!mainNode.containsKey(requiredParam) || mainNode.get(requiredParam) == null) {
      throw new QuotingException('Falta el parámetro requerido: ' + requiredParam);
    }
  }
}</code></pre></div></section></section><section><h2 id="-1368901578#notas-adicionales" data-toc="notas-adicionales#QuotingException.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-1368901578#-gk7216_129" type="1" start="1"><li class="list-item" id="-1368901578#-gk7216_130"><p>Esta clase forma parte del ecosistema de cotizaci&oacute;n de la organizaci&oacute;n y se utiliza en conjunto con otras clases como <span class="inline-code" id="-1368901578#-gk7216_134">QuoteProductHandler</span> y <span class="inline-code" id="-1368901578#-gk7216_135">QuoteUtils</span>.</p></li><li class="list-item" id="-1368901578#-gk7216_131"><p>La simplicidad de la implementaci&oacute;n sugiere que la clase se utiliza principalmente para categorizaci&oacute;n de errores m&aacute;s que para transportar informaci&oacute;n adicional espec&iacute;fica.</p></li><li class="list-item" id="-1368901578#-gk7216_132"><p>En un entorno de producci&oacute;n, considerar la implementaci&oacute;n de mecanismos de registro y notificaci&oacute;n automatizados para errores de cotizaci&oacute;n.</p></li><li class="list-item" id="-1368901578#-gk7216_133"><p>Esta excepci&oacute;n podr&iacute;a ser parte de una jerarqu&iacute;a m&aacute;s amplia de excepciones espec&iacute;ficas del dominio, posiblemente con una superclase com&uacute;n como <span class="inline-code" id="-1368901578#-gk7216_136">DomainException</span> o similar.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-809568624">APIs y Endpoints - SURA Foundation Framework</h1><section><h2 id="-809568624#resumen-ejecutivo" data-toc="resumen-ejecutivo#APIs y Endpoints.md-resumen-ejecutivo">Resumen Ejecutivo</h2><p id="-809568624#vka0kc_17">Este documento describe las APIs, endpoints y m&eacute;todos de integraci&oacute;n disponibles en <span class="control" id="-809568624#vka0kc_19">SURA Foundation Framework</span>. El framework expone servicios REST, m&eacute;todos Apex invocables, y Integration Procedures para facilitar la integraci&oacute;n con sistemas externos y componentes de Vlocity/OmniStudio.</p></section><section><h2 id="-809568624#arquitectura-de-apis" data-toc="arquitectura-de-apis#APIs y Endpoints.md-arquitectura-de-apis">🏗️ Arquitectura de APIs</h2><section><h3 id="-809568624#principios-de-dise-o" data-toc="principios-de-dise-o#APIs y Endpoints.md-principios-de-dise-o">Principios de Dise&ntilde;o</h3><ol class="list list-decimal" id="-809568624#vka0kc_21" type="1" start="1"><li class="list-item" id="-809568624#vka0kc_24"><p><span class="control" id="-809568624#vka0kc_29">RESTful</span>: Seguimiento de est&aacute;ndares REST para APIs HTTP</p></li><li class="list-item" id="-809568624#vka0kc_25"><p><span class="control" id="-809568624#vka0kc_30">Versionado</span>: Control de versiones para compatibilidad</p></li><li class="list-item" id="-809568624#vka0kc_26"><p><span class="control" id="-809568624#vka0kc_31">Seguridad</span>: Autenticaci&oacute;n y autorizaci&oacute;n robusta</p></li><li class="list-item" id="-809568624#vka0kc_27"><p><span class="control" id="-809568624#vka0kc_32">Observabilidad</span>: Logging completo de requests/responses</p></li><li class="list-item" id="-809568624#vka0kc_28"><p><span class="control" id="-809568624#vka0kc_33">Resiliencia</span>: Manejo de errores y reintentos configurables</p></li></ol><div class="detached code-block" id="-809568624#vka0kc_22"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────────┐
│                    FOUNDATION API ARCHITECTURE                 │
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐ │
│  │   External  │    │  Vlocity    │    │    Internal         │ │
│  │   Systems   │    │ Components  │    │   Processes         │ │
│  │             │    │             │    │                     │ │
│  └──────┬──────┘    └──────┬──────┘    └──────┬──────────────┘ │
│         │                  │                  │                │
│         │ REST APIs        │ Apex Methods     │ Platform Events │
│         │                  │                  │                │
│         ▼                  ▼                  ▼                │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │              SURA FOUNDATION CORE                          │ │
│  │                                                             │ │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────────────┐   │ │
│  │  │   API       │ │ Integration │ │     Event           │   │ │
│  │  │  Gateway    │ │ Procedures  │ │   Management        │   │ │
│  │  └─────────────┘ └─────────────┘ └─────────────────────┘   │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘</code></pre></div></section></section><section><h2 id="-809568624#rest-apis" data-toc="rest-apis#APIs y Endpoints.md-rest-apis">🌐 REST APIs</h2><section><h3 id="-809568624#base-url-y-versionado" data-toc="base-url-y-versionado#APIs y Endpoints.md-base-url-y-versionado">Base URL y Versionado</h3><p id="-809568624#vka0kc_36"><span class="control" id="-809568624#vka0kc_39">Base URL:</span> <span class="inline-code" id="-809568624#vka0kc_40">/services/apexrest/sura/foundation/v1/</span></p><p id="-809568624#vka0kc_37"><span class="control" id="-809568624#vka0kc_41">Estructura de Endpoints:</span></p><div class="detached code-block" id="-809568624#vka0kc_38"><pre><code class="language-none">https://{instance}.salesforce.com/services/apexrest/sura/foundation/v1/{resource}</code></pre></div></section><section><h3 id="-809568624#autenticaci-n" data-toc="autenticaci-n#APIs y Endpoints.md-autenticaci-n">Autenticaci&oacute;n</h3><p id="-809568624#vka0kc_42"><span class="control" id="-809568624#vka0kc_47">M&eacute;todos Soportados:</span></p><ul class="list" id="-809568624#vka0kc_43" start="1"><li class="list-item" id="-809568624#vka0kc_48"><p>OAuth 2.0 (Recomendado)</p></li><li class="list-item" id="-809568624#vka0kc_49"><p>Session ID</p></li><li class="list-item" id="-809568624#vka0kc_50"><p>Connected Apps</p></li></ul><p id="-809568624#vka0kc_44"><span class="control" id="-809568624#vka0kc_51">Headers Requeridos:</span></p><div class="detached code-block" id="-809568624#vka0kc_45"><pre><code class="language-http">Authorization: Bearer {access_token}
Content-Type: application/json
Accept: application/json
X-SURA-API-Version: v1</code></pre></div></section></section><section><h2 id="-809568624#endpoints-principales" data-toc="endpoints-principales#APIs y Endpoints.md-endpoints-principales">📋 Endpoints Principales</h2><section><h3 id="-809568624#1-process-management-apis" data-toc="1-process-management-apis#APIs y Endpoints.md-1-process-management-apis">1. Process Management APIs</h3><section><h4 id="-809568624#post-process-execute" data-toc="post-process-execute#APIs y Endpoints.md-post-process-execute">POST /process/execute</h4><p id="-809568624#vka0kc_58"><span class="control" id="-809568624#vka0kc_63">Prop&oacute;sito:</span> Ejecutar un proceso espec&iacute;fico del framework</p><p id="-809568624#vka0kc_59"><span class="control" id="-809568624#vka0kc_64">Request:</span></p><div class="detached code-block" id="-809568624#vka0kc_60"><pre><code class="language-http">POST /services/apexrest/sura/foundation/v1/process/execute
Content-Type: application/json

{
  &quot;processName&quot;: &quot;LeadKnowing&quot;,
  &quot;productFamily&quot;: &quot;Seguros de Motos&quot;,
  &quot;stage&quot;: &quot;Conocimiento&quot;,
  &quot;recordId&quot;: &quot;00Q000000123456&quot;,
  &quot;parameters&quot;: {
    &quot;vehicleType&quot;: &quot;Moto&quot;,
    &quot;engine&quot;: &quot;150CC&quot;,
    &quot;model&quot;: &quot;2024&quot;,
    &quot;validateRUNT&quot;: true
  },
  &quot;executeAsync&quot;: false
}</code></pre></div><p id="-809568624#vka0kc_61"><span class="control" id="-809568624#vka0kc_65">Response:</span></p><div class="detached code-block" id="-809568624#vka0kc_62"><pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;processExecutionId&quot;: &quot;a0X000000123456&quot;,
  &quot;status&quot;: &quot;Completed&quot;,
  &quot;duration&quot;: 1250,
  &quot;result&quot;: {
    &quot;processedRecords&quot;: 1,
    &quot;validationsPassed&quot;: true,
    &quot;integrationsCalled&quot;: [&quot;RUNT&quot;, &quot;FASECOLDA&quot;],
    &quot;nextStage&quot;: &quot;Tarificación&quot;
  },
  &quot;errors&quot;: [],
  &quot;warnings&quot;: [
    {
      &quot;code&quot;: &quot;WARN_001&quot;,
      &quot;message&quot;: &quot;Vehículo no encontrado en FASECOLDA, usando valores por defecto&quot;
    }
  ]
}</code></pre></div></section><section><h4 id="-809568624#get-process-status" data-toc="get-process-status#APIs y Endpoints.md-get-process-status">GET /process/status/</h4><p id="-809568624#vka0kc_67"><span class="control" id="-809568624#vka0kc_70">Prop&oacute;sito:</span> Consultar el estado de una ejecuci&oacute;n</p><p id="-809568624#vka0kc_68"><span class="control" id="-809568624#vka0kc_71">Response:</span></p><div class="detached code-block" id="-809568624#vka0kc_69"><pre><code class="language-json">{
  &quot;executionId&quot;: &quot;a0X000000123456&quot;,
  &quot;status&quot;: &quot;Running&quot;,
  &quot;progress&quot;: 75,
  &quot;startTime&quot;: &quot;2025-05-23T10:30:00Z&quot;,
  &quot;estimatedCompletion&quot;: &quot;2025-05-23T10:32:30Z&quot;,
  &quot;currentPhase&quot;: &quot;In&quot;,
  &quot;processedSteps&quot;: [
    {
      &quot;stepName&quot;: &quot;Validation&quot;,
      &quot;status&quot;: &quot;Completed&quot;,
      &quot;duration&quot;: 150
    },
    {
      &quot;stepName&quot;: &quot;Integration&quot;,
      &quot;status&quot;: &quot;Running&quot;,
      &quot;duration&quot;: 0
    }
  ]
}</code></pre></div></section></section><section><h3 id="-809568624#2-integration-apis" data-toc="2-integration-apis#APIs y Endpoints.md-2-integration-apis">2. Integration APIs</h3><section><h4 id="-809568624#post-integration-external-call" data-toc="post-integration-external-call#APIs y Endpoints.md-post-integration-external-call">POST /integration/external/call</h4><p id="-809568624#vka0kc_73"><span class="control" id="-809568624#vka0kc_78">Prop&oacute;sito:</span> Realizar llamadas a servicios externos con retry logic</p><p id="-809568624#vka0kc_74"><span class="control" id="-809568624#vka0kc_79">Request:</span></p><div class="detached code-block" id="-809568624#vka0kc_75"><pre><code class="language-http">POST /services/apexrest/sura/foundation/v1/integration/external/call
Content-Type: application/json

{
  &quot;serviceName&quot;: &quot;RUNT_VehicleConsultation&quot;,
  &quot;endpoint&quot;: &quot;/api/vehicles/lookup&quot;,
  &quot;method&quot;: &quot;POST&quot;,
  &quot;headers&quot;: {
    &quot;X-API-Key&quot;: &quot;encrypted_key&quot;,
    &quot;Content-Type&quot;: &quot;application/json&quot;
  },
  &quot;payload&quot;: {
    &quot;plate&quot;: &quot;ABC123&quot;,
    &quot;documentType&quot;: &quot;CC&quot;,
    &quot;documentNumber&quot;: &quot;12345678&quot;
  },
  &quot;retryConfig&quot;: {
    &quot;maxRetries&quot;: 3,
    &quot;retryPattern&quot;: &quot;Fibonacci&quot;,
    &quot;retryOnCodes&quot;: [500, 502, 503, 504]
  }
}</code></pre></div><p id="-809568624#vka0kc_76"><span class="control" id="-809568624#vka0kc_80">Response:</span></p><div class="detached code-block" id="-809568624#vka0kc_77"><pre><code class="language-json">{
  &quot;integrationId&quot;: &quot;IL-000123&quot;,
  &quot;success&quot;: true,
  &quot;httpStatus&quot;: 200,
  &quot;duration&quot;: 850,
  &quot;retryAttempts&quot;: 0,
  &quot;response&quot;: {
    &quot;vehicleFound&quot;: true,
    &quot;vehicleData&quot;: {
      &quot;brand&quot;: &quot;YAMAHA&quot;,
      &quot;model&quot;: &quot;YBR 125&quot;,
      &quot;year&quot;: 2023,
      &quot;engine&quot;: &quot;125CC&quot;,
      &quot;fasecolda&quot;: &quot;123456&quot;
    }
  }
}</code></pre></div></section></section><section><h3 id="-809568624#3-event-management-apis" data-toc="3-event-management-apis#APIs y Endpoints.md-3-event-management-apis">3. Event Management APIs</h3><section><h4 id="-809568624#post-events-publish" data-toc="post-events-publish#APIs y Endpoints.md-post-events-publish">POST /events/publish</h4><p id="-809568624#vka0kc_83"><span class="control" id="-809568624#vka0kc_86">Prop&oacute;sito:</span> Publicar eventos en el sistema</p><p id="-809568624#vka0kc_84"><span class="control" id="-809568624#vka0kc_87">Request:</span></p><div class="detached code-block" id="-809568624#vka0kc_85"><pre><code class="language-json">{
  &quot;eventType&quot;: &quot;ProcessCompleted&quot;,
  &quot;category&quot;: &quot;Business&quot;,
  &quot;recordId&quot;: &quot;00Q000000123456&quot;,
  &quot;payload&quot;: {
    &quot;processName&quot;: &quot;LeadKnowing&quot;,
    &quot;stage&quot;: &quot;Conocimiento&quot;,
    &quot;result&quot;: &quot;Success&quot;,
    &quot;nextActions&quot;: [&quot;StartRating&quot;]
  },
  &quot;publishAsync&quot;: true
}</code></pre></div></section><section><h4 id="-809568624#get-events-history" data-toc="get-events-history#APIs y Endpoints.md-get-events-history">GET /events/history/</h4><p id="-809568624#vka0kc_89"><span class="control" id="-809568624#vka0kc_92">Prop&oacute;sito:</span> Obtener historial de eventos de un registro</p><p id="-809568624#vka0kc_90"><span class="control" id="-809568624#vka0kc_93">Response:</span></p><div class="detached code-block" id="-809568624#vka0kc_91"><pre><code class="language-json">{
  &quot;recordId&quot;: &quot;00Q000000123456&quot;,
  &quot;totalEvents&quot;: 15,
  &quot;events&quot;: [
    {
      &quot;eventId&quot;: &quot;EL-000456&quot;,
      &quot;eventType&quot;: &quot;ProcessStarted&quot;,
      &quot;timestamp&quot;: &quot;2025-05-23T10:30:00Z&quot;,
      &quot;processName&quot;: &quot;LeadKnowing&quot;,
      &quot;status&quot;: &quot;Success&quot;,
      &quot;duration&quot;: 150
    },
    {
      &quot;eventId&quot;: &quot;EL-000457&quot;,
      &quot;eventType&quot;: &quot;IntegrationCalled&quot;,
      &quot;timestamp&quot;: &quot;2025-05-23T10:30:05Z&quot;,
      &quot;serviceName&quot;: &quot;RUNT&quot;,
      &quot;status&quot;: &quot;Success&quot;,
      &quot;duration&quot;: 850
    }
  ]
}</code></pre></div></section></section><section><h3 id="-809568624#4-configuration-apis" data-toc="4-configuration-apis#APIs y Endpoints.md-4-configuration-apis">4. Configuration APIs</h3><section><h4 id="-809568624#get-config-processes" data-toc="get-config-processes#APIs y Endpoints.md-get-config-processes">GET /config/processes</h4><p id="-809568624#vka0kc_96"><span class="control" id="-809568624#vka0kc_99">Prop&oacute;sito:</span> Obtener configuraci&oacute;n de procesos</p><p id="-809568624#vka0kc_97"><span class="control" id="-809568624#vka0kc_100">Response:</span></p><div class="detached code-block" id="-809568624#vka0kc_98"><pre><code class="language-json">{
  &quot;processes&quot;: [
    {
      &quot;developerName&quot;: &quot;Lead_Motos_Conocimiento&quot;,
      &quot;productFamily&quot;: &quot;Seguros de Motos&quot;,
      &quot;stage&quot;: &quot;Conocimiento&quot;,
      &quot;handlerClass&quot;: &quot;MT_Kn_123&quot;,
      &quot;isActive&quot;: true,
      &quot;order&quot;: 0,
      &quot;configuration&quot;: {
        &quot;validateRUNT&quot;: true,
        &quot;requireFasecolda&quot;: true
      }
    }
  ]
}</code></pre></div></section><section><h4 id="-809568624#put-config-feature-flags" data-toc="put-config-feature-flags#APIs y Endpoints.md-put-config-feature-flags">PUT /config/feature-flags/</h4><p id="-809568624#vka0kc_102"><span class="control" id="-809568624#vka0kc_106">Prop&oacute;sito:</span> Actualizar feature flags</p><p id="-809568624#vka0kc_103"><span class="control" id="-809568624#vka0kc_107">Request:</span></p><div class="detached code-block" id="-809568624#vka0kc_104"><pre><code class="language-json">{
  &quot;isEnabled&quot;: true,
  &quot;environment&quot;: &quot;Production&quot;,
  &quot;effectiveDate&quot;: &quot;2025-06-01&quot;,
  &quot;configuration&quot;: {
    &quot;rolloutPercentage&quot;: 50
  }
}</code></pre></div></section></section></section><section><h2 id="-809568624#m-todos-apex-invocables" data-toc="m-todos-apex-invocables#APIs y Endpoints.md-m-todos-apex-invocables">⚡ M&eacute;todos Apex Invocables</h2><section><h3 id="-809568624#1-processexecutor" data-toc="1-processexecutor#APIs y Endpoints.md-1-processexecutor">1. ProcessExecutor</h3><p id="-809568624#vka0kc_111"><span class="control" id="-809568624#vka0kc_117">Prop&oacute;sito:</span> Ejecutar procesos desde Flows o Process Builder</p><div class="detached code-block" id="-809568624#vka0kc_112"><pre><code class="language-none">@InvocableMethod(
  label='Execute Foundation Process'
  description='Executes a Foundation framework process'
)
public static List&lt;ProcessResult&gt; executeProcess(List&lt;ProcessRequest&gt; requests)</code></pre></div><p id="-809568624#vka0kc_113"><span class="control" id="-809568624#vka0kc_118">Input:</span></p><div class="detached code-block" id="-809568624#vka0kc_114"><pre><code class="language-none">public class ProcessRequest {
  @InvocableVariable(required=true)
  public String processName;
  
  @InvocableVariable(required=true)
  public String productFamily;
  
  @InvocableVariable(required=true)
  public String recordId;
  
  @InvocableVariable
  public String parametersJSON;
}</code></pre></div><p id="-809568624#vka0kc_115"><span class="control" id="-809568624#vka0kc_119">Output:</span></p><div class="detached code-block" id="-809568624#vka0kc_116"><pre><code class="language-none">public class ProcessResult {
  @InvocableVariable
  public Boolean success;
  
  @InvocableVariable
  public String executionId;
  
  @InvocableVariable
  public String status;
  
  @InvocableVariable
  public String errorMessage;
  
  @InvocableVariable
  public String resultJSON;
}</code></pre></div></section><section><h3 id="-809568624#2-eventpublisher" data-toc="2-eventpublisher#APIs y Endpoints.md-2-eventpublisher">2. EventPublisher</h3><p id="-809568624#vka0kc_120"><span class="control" id="-809568624#vka0kc_122">Prop&oacute;sito:</span> Publicar eventos desde automaciones</p><div class="detached code-block" id="-809568624#vka0kc_121"><pre><code class="language-none">@InvocableMethod(
  label='Publish Foundation Event'
  description='Publishes an event to the Foundation event system'
)
public static List&lt;EventResult&gt; publishEvent(List&lt;EventRequest&gt; requests)</code></pre></div></section><section><h3 id="-809568624#3-integrationcaller" data-toc="3-integrationcaller#APIs y Endpoints.md-3-integrationcaller">3. IntegrationCaller</h3><p id="-809568624#vka0kc_123"><span class="control" id="-809568624#vka0kc_126">Prop&oacute;sito:</span> Llamar servicios externos desde Flows</p><div class="detached code-block" id="-809568624#vka0kc_124"><pre><code class="language-none">@InvocableMethod(
  label='Call External Service'
  description='Calls an external service with retry logic'
)
public static List&lt;IntegrationResult&gt; callExternalService(List&lt;IntegrationRequest&gt; requests)</code></pre></div></section></section><section><h2 id="-809568624#integration-procedures-vlocity" data-toc="integration-procedures-vlocity#APIs y Endpoints.md-integration-procedures-vlocity">🔗 Integration Procedures (Vlocity)</h2><section><h3 id="-809568624#1-sffoundation-processlauncher" data-toc="1-sffoundation-processlauncher#APIs y Endpoints.md-1-sffoundation-processlauncher">1. SFFoundation_ProcessLauncher</h3><p id="-809568624#vka0kc_130"><span class="control" id="-809568624#vka0kc_135">Prop&oacute;sito:</span> Lanzar procesos Foundation desde OmniScript</p><p id="-809568624#vka0kc_131"><span class="control" id="-809568624#vka0kc_136">Input Node:</span></p><div class="detached code-block" id="-809568624#vka0kc_132"><pre><code class="language-json">{
  &quot;processConfig&quot;: {
    &quot;processName&quot;: &quot;%processName%&quot;,
    &quot;productFamily&quot;: &quot;%productFamily%&quot;,
    &quot;stage&quot;: &quot;%stage%&quot;
  },
  &quot;recordData&quot;: {
    &quot;recordId&quot;: &quot;%recordId%&quot;,
    &quot;objectType&quot;: &quot;%objectType%&quot;
  },
  &quot;parameters&quot;: &quot;%processParameters%&quot;
}</code></pre></div><p id="-809568624#vka0kc_133"><span class="control" id="-809568624#vka0kc_137">Output Node:</span></p><div class="detached code-block" id="-809568624#vka0kc_134"><pre><code class="language-json">{
  &quot;executionResult&quot;: {
    &quot;success&quot;: true,
    &quot;executionId&quot;: &quot;a0X000000123456&quot;,
    &quot;status&quot;: &quot;Completed&quot;,
    &quot;duration&quot;: 1250,
    &quot;nextStage&quot;: &quot;Tarificación&quot;
  }
}</code></pre></div></section><section><h3 id="-809568624#2-sffoundation-configurationreader" data-toc="2-sffoundation-configurationreader#APIs y Endpoints.md-2-sffoundation-configurationreader">2. SFFoundation_ConfigurationReader</h3><p id="-809568624#vka0kc_138"><span class="control" id="-809568624#vka0kc_143">Prop&oacute;sito:</span> Leer configuraciones del framework</p><p id="-809568624#vka0kc_139"><span class="control" id="-809568624#vka0kc_144">Input:</span></p><div class="detached code-block" id="-809568624#vka0kc_140"><pre><code class="language-json">{
  &quot;configType&quot;: &quot;ProcessConfiguration&quot;,
  &quot;filters&quot;: {
    &quot;productFamily&quot;: &quot;Seguros de Motos&quot;,
    &quot;isActive&quot;: true
  }
}</code></pre></div><p id="-809568624#vka0kc_141"><span class="control" id="-809568624#vka0kc_145">Output:</span></p><div class="detached code-block" id="-809568624#vka0kc_142"><pre><code class="language-json">{
  &quot;configurations&quot;: [
    {
      &quot;processName&quot;: &quot;LeadKnowing&quot;,
      &quot;handlerClass&quot;: &quot;MT_Kn_123&quot;,
      &quot;order&quot;: 0,
      &quot;settings&quot;: {}
    }
  ]
}</code></pre></div></section><section><h3 id="-809568624#3-sffoundation-eventhistoryreader" data-toc="3-sffoundation-eventhistoryreader#APIs y Endpoints.md-3-sffoundation-eventhistoryreader">3. SFFoundation_EventHistoryReader</h3><p id="-809568624#vka0kc_146"><span class="control" id="-809568624#vka0kc_150">Prop&oacute;sito:</span> Obtener historial de eventos</p><p id="-809568624#vka0kc_147"><span class="control" id="-809568624#vka0kc_151">Input:</span></p><div class="detached code-block" id="-809568624#vka0kc_148"><pre><code class="language-json">{
  &quot;recordId&quot;: &quot;%recordId%&quot;,
  &quot;eventTypes&quot;: [&quot;ProcessStarted&quot;, &quot;ProcessCompleted&quot;],
  &quot;dateRange&quot;: {
    &quot;startDate&quot;: &quot;%startDate%&quot;,
    &quot;endDate&quot;: &quot;%endDate%&quot;
  }
}</code></pre></div></section></section><section><h2 id="-809568624#platform-events" data-toc="platform-events#APIs y Endpoints.md-platform-events">📡 Platform Events</h2><section><h3 id="-809568624#suscripciones-disponibles" data-toc="suscripciones-disponibles#APIs y Endpoints.md-suscripciones-disponibles">Suscripciones Disponibles</h3><section><h4 id="-809568624#sffoundation-processevent-e" data-toc="sffoundation-processevent-e#APIs y Endpoints.md-sffoundation-processevent-e">SFFoundation_ProcessEvent__e</h4><p id="-809568624#vka0kc_155"><span class="control" id="-809568624#vka0kc_158">Trigger:</span> Cambios en estado de procesos</p><p id="-809568624#vka0kc_156"><span class="control" id="-809568624#vka0kc_159">Payload:</span></p><div class="detached code-block" id="-809568624#vka0kc_157"><pre><code class="language-json">{
  &quot;EventType__c&quot;: &quot;ProcessCompleted&quot;,
  &quot;ProcessName__c&quot;: &quot;LeadKnowing&quot;,
  &quot;ProductFamily__c&quot;: &quot;Seguros de Motos&quot;,
  &quot;Stage__c&quot;: &quot;Conocimiento&quot;,
  &quot;Status__c&quot;: &quot;Success&quot;,
  &quot;RecordId__c&quot;: &quot;00Q000000123456&quot;,
  &quot;Payload__c&quot;: &quot;{\&quot;duration\&quot;: 1250, \&quot;nextStage\&quot;: \&quot;Tarificación\&quot;}&quot;
}</code></pre></div></section><section><h4 id="-809568624#sffoundation-integrationevent-e" data-toc="sffoundation-integrationevent-e#APIs y Endpoints.md-sffoundation-integrationevent-e">SFFoundation_IntegrationEvent__e</h4><p id="-809568624#vka0kc_160"><span class="control" id="-809568624#vka0kc_164">Trigger:</span> Eventos de integraciones externas</p><p id="-809568624#vka0kc_161"><span class="control" id="-809568624#vka0kc_165">Payload:</span></p><div class="detached code-block" id="-809568624#vka0kc_162"><pre><code class="language-json">{
  &quot;ServiceName__c&quot;: &quot;RUNT_VehicleConsultation&quot;,
  &quot;EventType__c&quot;: &quot;Response&quot;,
  &quot;Status__c&quot;: &quot;Success&quot;,
  &quot;HttpStatus__c&quot;: 200,
  &quot;Duration__c&quot;: 850,
  &quot;RequestId__c&quot;: &quot;REQ-123456&quot;
}</code></pre></div></section></section></section><section><h2 id="-809568624#seguridad-y-autenticaci-n" data-toc="seguridad-y-autenticaci-n#APIs y Endpoints.md-seguridad-y-autenticaci-n">🔒 Seguridad y Autenticaci&oacute;n</h2><section><h3 id="-809568624#oauth-2-0-flow" data-toc="oauth-2-0-flow#APIs y Endpoints.md-oauth-2-0-flow">OAuth 2.0 Flow</h3><div class="detached mermaid" id="-809568624#vka0kc_168"><svg aria-roledescription="sequence" role="graphics-document document" viewBox="-50 -10 680 435" style="max-width: 680px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid"><g></g><defs><symbol height="24" width="24" id="computer"><path d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z" transform="scale(.5)"></path></symbol></defs><defs><symbol clip-rule="evenodd" fill-rule="evenodd" id="database"><path d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z" transform="scale(.5)"></path></symbol></defs><defs><symbol height="24" width="24" id="clock"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z" transform="scale(.5)"></path></symbol></defs><g><line stroke="#999" stroke-width="0.5px" class="200" y2="369" x2="75" y1="5" x1="75" id="actor12"></line><g id="root-12"><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor" alignment-baseline="central" dominant-baseline="central" y="32.5" x="75"><tspan dy="0" x="75">Client</tspan></text></g></g><g><line stroke="#999" stroke-width="0.5px" class="200" y2="369" x2="305" y1="5" x1="305" id="actor13"></line><g id="root-13"><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="230"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor" alignment-baseline="central" dominant-baseline="central" y="32.5" x="305"><tspan dy="0" x="305">AuthServer</tspan></text></g></g><g><line stroke="#999" stroke-width="0.5px" class="200" y2="369" x2="505" y1="5" x1="505" id="actor14"></line><g id="root-14"><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="430"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor" alignment-baseline="central" dominant-baseline="central" y="32.5" x="505"><tspan dy="0" x="505">FoundationAPI</tspan></text></g></g><defs><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="9" id="arrowhead"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker refY="5" refX="4" orient="auto" markerHeight="8" markerWidth="15" id="crosshead"><path style="stroke-dasharray: 0, 0;" d="M 1,2 L 6,7 M 6,2 L 1,7" stroke-width="1pt" stroke="#000000" fill="none"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="18" id="filled-head"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="40" markerWidth="60" refY="15" refX="15" id="sequencenumber"><circle r="6" cy="15" cx="15"></circle></marker></defs><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="80" x="190">1. Request Access Token</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="109" x2="305" y1="109" x1="75"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="124" x="190">2. Return Access Token</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="153" x2="75" y1="153" x1="305"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="168" x="290">3. API Call with Bearer Token</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="197" x2="505" y1="197" x1="75"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="212" x="405">4. Validate Token</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="241" x2="305" y1="241" x1="505"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="256" x="405">5. Token Valid</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="285" x2="505" y1="285" x1="305"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="300" x="290">6. API Response</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="329" x2="75" y1="329" x1="505"></line><g><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="349" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor" alignment-baseline="central" dominant-baseline="central" y="381.5" x="75"><tspan dy="0" x="75">Client</tspan></text></g><g><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="349" x="230"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor" alignment-baseline="central" dominant-baseline="central" y="381.5" x="305"><tspan dy="0" x="305">AuthServer</tspan></text></g><g><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="349" x="430"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor" alignment-baseline="central" dominant-baseline="central" y="381.5" x="505"><tspan dy="0" x="505">FoundationAPI</tspan></text></g></svg></div></section><section><h3 id="-809568624#permisos-requeridos" data-toc="permisos-requeridos#APIs y Endpoints.md-permisos-requeridos">Permisos Requeridos</h3><p id="-809568624#vka0kc_169"><span class="control" id="-809568624#vka0kc_174">Custom Permissions:</span></p><ul class="list" id="-809568624#vka0kc_170" start="1"><li class="list-item" id="-809568624#vka0kc_175"><p><span class="inline-code" id="-809568624#vka0kc_179">SFFoundation_ProcessExecutor</span>: Ejecutar procesos</p></li><li class="list-item" id="-809568624#vka0kc_176"><p><span class="inline-code" id="-809568624#vka0kc_180">SFFoundation_ConfigurationManager</span>: Gestionar configuraciones</p></li><li class="list-item" id="-809568624#vka0kc_177"><p><span class="inline-code" id="-809568624#vka0kc_181">SFFoundation_EventPublisher</span>: Publicar eventos</p></li><li class="list-item" id="-809568624#vka0kc_178"><p><span class="inline-code" id="-809568624#vka0kc_182">SFFoundation_IntegrationCaller</span>: Llamar servicios externos</p></li></ul><p id="-809568624#vka0kc_171"><span class="control" id="-809568624#vka0kc_183">Object Permissions:</span></p><ul class="list" id="-809568624#vka0kc_172" start="1"><li class="list-item" id="-809568624#vka0kc_184"><p><span class="inline-code" id="-809568624#vka0kc_187">SFFoundation_ProcessExecution__c</span>: Create, Read</p></li><li class="list-item" id="-809568624#vka0kc_185"><p><span class="inline-code" id="-809568624#vka0kc_188">SFFoundation_EventLog__c</span>: Create, Read</p></li><li class="list-item" id="-809568624#vka0kc_186"><p><span class="inline-code" id="-809568624#vka0kc_189">SFFoundation_IntegrationLog__c</span>: Create, Read</p></li></ul></section></section><section><h2 id="-809568624#rate-limiting-y-quotas" data-toc="rate-limiting-y-quotas#APIs y Endpoints.md-rate-limiting-y-quotas">📊 Rate Limiting y Quotas</h2><section><h3 id="-809568624#l-mites-por-endpoint" data-toc="l-mites-por-endpoint#APIs y Endpoints.md-l-mites-por-endpoint">L&iacute;mites por Endpoint</h3><div class="table-wrapper detached"><table id="-809568624#vka0kc_192"><tr class="header-row" id="-809568624#vka0kc_193"><th id="-809568624#vka0kc_198"><p>Endpoint</p></th><th id="-809568624#vka0kc_199"><p>Requests/Hour</p></th><th id="-809568624#vka0kc_200"><p>Burst Limit</p></th></tr><tr class="" id="-809568624#vka0kc_194"><td id="-809568624#vka0kc_201"><p><span class="inline-code" id="-809568624#vka0kc_204">/process/execute</span></p></td><td id="-809568624#vka0kc_202"><p>1000</p></td><td id="-809568624#vka0kc_203"><p>10/min</p></td></tr><tr class="" id="-809568624#vka0kc_195"><td id="-809568624#vka0kc_205"><p><span class="inline-code" id="-809568624#vka0kc_208">/integration/external/call</span></p></td><td id="-809568624#vka0kc_206"><p>500</p></td><td id="-809568624#vka0kc_207"><p>5/min</p></td></tr><tr class="" id="-809568624#vka0kc_196"><td id="-809568624#vka0kc_209"><p><span class="inline-code" id="-809568624#vka0kc_212">/events/publish</span></p></td><td id="-809568624#vka0kc_210"><p>2000</p></td><td id="-809568624#vka0kc_211"><p>20/min</p></td></tr><tr class="" id="-809568624#vka0kc_197"><td id="-809568624#vka0kc_213"><p><span class="inline-code" id="-809568624#vka0kc_216">/config/*</span></p></td><td id="-809568624#vka0kc_214"><p>100</p></td><td id="-809568624#vka0kc_215"><p>2/min</p></td></tr></table></div></section><section><h3 id="-809568624#manejo-de-rate-limiting" data-toc="manejo-de-rate-limiting#APIs y Endpoints.md-manejo-de-rate-limiting">Manejo de Rate Limiting</h3><p id="-809568624#vka0kc_217"><span class="control" id="-809568624#vka0kc_222">Response Headers:</span></p><div class="detached code-block" id="-809568624#vka0kc_218"><pre><code class="language-http">X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1621840800
Retry-After: 60</code></pre></div><p id="-809568624#vka0kc_219"><span class="control" id="-809568624#vka0kc_223">Error Response (429):</span></p><div class="detached code-block" id="-809568624#vka0kc_220"><pre><code class="language-json">{
  &quot;error&quot;: {
    &quot;code&quot;: &quot;RATE_LIMIT_EXCEEDED&quot;,
    &quot;message&quot;: &quot;Rate limit exceeded. Retry after 60 seconds.&quot;,
    &quot;retryAfter&quot;: 60
  }
}</code></pre></div></section></section><section><h2 id="-809568624#monitoreo-y-observabilidad" data-toc="monitoreo-y-observabilidad#APIs y Endpoints.md-monitoreo-y-observabilidad">🔍 Monitoreo y Observabilidad</h2><section><h3 id="-809568624#request-response-logging" data-toc="request-response-logging#APIs y Endpoints.md-request-response-logging">Request/Response Logging</h3><p id="-809568624#vka0kc_226"><span class="control" id="-809568624#vka0kc_230">Automated Logging:</span></p><ul class="list" id="-809568624#vka0kc_227" start="1"><li class="list-item" id="-809568624#vka0kc_231"><p>Todas las API calls son loggeadas autom&aacute;ticamente</p></li><li class="list-item" id="-809568624#vka0kc_232"><p>Headers, payload y response capturados</p></li><li class="list-item" id="-809568624#vka0kc_233"><p>M&eacute;tricas de performance incluidas</p></li></ul><p id="-809568624#vka0kc_228"><span class="control" id="-809568624#vka0kc_234">Log Structure:</span></p><div class="detached code-block" id="-809568624#vka0kc_229"><pre><code class="language-json">{
  &quot;requestId&quot;: &quot;REQ-123456&quot;,
  &quot;endpoint&quot;: &quot;/process/execute&quot;,
  &quot;method&quot;: &quot;POST&quot;,
  &quot;userId&quot;: &quot;005000000123456&quot;,
  &quot;requestTime&quot;: &quot;2025-05-23T10:30:00Z&quot;,
  &quot;responseTime&quot;: &quot;2025-05-23T10:30:01.250Z&quot;,
  &quot;duration&quot;: 1250,
  &quot;httpStatus&quot;: 200,
  &quot;success&quot;: true,
  &quot;requestHeaders&quot;: {},
  &quot;requestBody&quot;: {},
  &quot;responseBody&quot;: {}
}</code></pre></div></section><section><h3 id="-809568624#health-check-endpoint" data-toc="health-check-endpoint#APIs y Endpoints.md-health-check-endpoint">Health Check Endpoint</h3><section><h4 id="-809568624#get-health" data-toc="get-health#APIs y Endpoints.md-get-health">GET /health</h4><p id="-809568624#vka0kc_236"><span class="control" id="-809568624#vka0kc_239">Response:</span></p><div class="detached code-block" id="-809568624#vka0kc_237"><pre><code class="language-json">{
  &quot;status&quot;: &quot;healthy&quot;,
  &quot;version&quot;: &quot;1.0.6&quot;,
  &quot;timestamp&quot;: &quot;2025-05-23T10:30:00Z&quot;,
  &quot;components&quot;: {
    &quot;database&quot;: {
      &quot;status&quot;: &quot;healthy&quot;,
      &quot;responseTime&quot;: 15
    },
    &quot;externalServices&quot;: {
      &quot;RUNT&quot;: {
        &quot;status&quot;: &quot;healthy&quot;,
        &quot;responseTime&quot;: 250
      },
      &quot;FASECOLDA&quot;: {
        &quot;status&quot;: &quot;degraded&quot;,
        &quot;responseTime&quot;: 1500,
        &quot;lastError&quot;: &quot;Timeout&quot;
      }
    },
    &quot;eventSystem&quot;: {
      &quot;status&quot;: &quot;healthy&quot;,
      &quot;queueDepth&quot;: 12
    }
  }
}</code></pre></div></section></section></section><section><h2 id="-809568624#c-digos-de-error-est-ndar" data-toc="c-digos-de-error-est-ndar#APIs y Endpoints.md-c-digos-de-error-est-ndar">📝 C&oacute;digos de Error Est&aacute;ndar</h2><section><h3 id="-809568624#http-status-codes" data-toc="http-status-codes#APIs y Endpoints.md-http-status-codes">HTTP Status Codes</h3><div class="table-wrapper detached"><table id="-809568624#vka0kc_242"><tr class="header-row" id="-809568624#vka0kc_243"><th id="-809568624#vka0kc_253"><p>C&oacute;digo</p></th><th id="-809568624#vka0kc_254"><p>Descripci&oacute;n</p></th><th id="-809568624#vka0kc_255"><p>Acci&oacute;n Recomendada</p></th></tr><tr class="" id="-809568624#vka0kc_244"><td id="-809568624#vka0kc_256"><p>200</p></td><td id="-809568624#vka0kc_257"><p>Success</p></td><td id="-809568624#vka0kc_258"><p>Continuar</p></td></tr><tr class="" id="-809568624#vka0kc_245"><td id="-809568624#vka0kc_259"><p>201</p></td><td id="-809568624#vka0kc_260"><p>Created</p></td><td id="-809568624#vka0kc_261"><p>Recurso creado exitosamente</p></td></tr><tr class="" id="-809568624#vka0kc_246"><td id="-809568624#vka0kc_262"><p>400</p></td><td id="-809568624#vka0kc_263"><p>Bad Request</p></td><td id="-809568624#vka0kc_264"><p>Verificar par&aacute;metros de entrada</p></td></tr><tr class="" id="-809568624#vka0kc_247"><td id="-809568624#vka0kc_265"><p>401</p></td><td id="-809568624#vka0kc_266"><p>Unauthorized</p></td><td id="-809568624#vka0kc_267"><p>Verificar autenticaci&oacute;n</p></td></tr><tr class="" id="-809568624#vka0kc_248"><td id="-809568624#vka0kc_268"><p>403</p></td><td id="-809568624#vka0kc_269"><p>Forbidden</p></td><td id="-809568624#vka0kc_270"><p>Verificar permisos</p></td></tr><tr class="" id="-809568624#vka0kc_249"><td id="-809568624#vka0kc_271"><p>404</p></td><td id="-809568624#vka0kc_272"><p>Not Found</p></td><td id="-809568624#vka0kc_273"><p>Verificar endpoint y recursos</p></td></tr><tr class="" id="-809568624#vka0kc_250"><td id="-809568624#vka0kc_274"><p>429</p></td><td id="-809568624#vka0kc_275"><p>Rate Limited</p></td><td id="-809568624#vka0kc_276"><p>Implementar retry con backoff</p></td></tr><tr class="" id="-809568624#vka0kc_251"><td id="-809568624#vka0kc_277"><p>500</p></td><td id="-809568624#vka0kc_278"><p>Internal Error</p></td><td id="-809568624#vka0kc_279"><p>Contactar soporte</p></td></tr><tr class="" id="-809568624#vka0kc_252"><td id="-809568624#vka0kc_280"><p>503</p></td><td id="-809568624#vka0kc_281"><p>Service Unavailable</p></td><td id="-809568624#vka0kc_282"><p>Retry m&aacute;s tarde</p></td></tr></table></div></section><section><h3 id="-809568624#error-response-format" data-toc="error-response-format#APIs y Endpoints.md-error-response-format">Error Response Format</h3><div class="detached code-block" id="-809568624#vka0kc_283"><pre><code class="language-json">{
  &quot;error&quot;: {
    &quot;code&quot;: &quot;VALIDATION_ERROR&quot;,
    &quot;message&quot;: &quot;Invalid process configuration&quot;,
    &quot;details&quot;: [
      {
        &quot;field&quot;: &quot;processName&quot;,
        &quot;message&quot;: &quot;Process name is required&quot;
      },
      {
        &quot;field&quot;: &quot;productFamily&quot;,
        &quot;message&quot;: &quot;Invalid product family specified&quot;
      }
    ],
    &quot;requestId&quot;: &quot;REQ-123456&quot;,
    &quot;timestamp&quot;: &quot;2025-05-23T10:30:00Z&quot;
  }
}</code></pre></div></section></section><section><h2 id="-809568624#ejemplos-de-integraci-n" data-toc="ejemplos-de-integraci-n#APIs y Endpoints.md-ejemplos-de-integraci-n">🧪 Ejemplos de Integraci&oacute;n</h2><section><h3 id="-809568624#javascript-node-js" data-toc="javascript-node-js#APIs y Endpoints.md-javascript-node-js">JavaScript/Node.js</h3><div class="detached code-block" id="-809568624#vka0kc_287"><pre><code class="language-javascript">const axios = require('axios');

class FoundationClient {
  constructor(instanceUrl, accessToken) {
    this.baseURL = `${instanceUrl}/services/apexrest/sura/foundation/v1`;
    this.headers = {
      'Authorization': `Bearer ${accessToken}`,
      'Content-Type': 'application/json',
      'X-SURA-API-Version': 'v1'
    };
  }

  async executeProcess(processConfig) {
    try {
      const response = await axios.post(
        `${this.baseURL}/process/execute`,
        processConfig,
        { headers: this.headers }
      );
      return response.data;
    } catch (error) {
      throw new Error(`Process execution failed: ${error.message}`);
    }
  }

  async getProcessStatus(executionId) {
    try {
      const response = await axios.get(
        `${this.baseURL}/process/status/${executionId}`,
        { headers: this.headers }
      );
      return response.data;
    } catch (error) {
      throw new Error(`Status check failed: ${error.message}`);
    }
  }
}

// Uso
const client = new FoundationClient(
  'https://myorg.salesforce.com',
  'access_token_here'
);

const result = await client.executeProcess({
  processName: 'LeadKnowing',
  productFamily: 'Seguros de Motos',
  recordId: '00Q000000123456',
  parameters: {
    vehicleType: 'Moto',
    validateRUNT: true
  }
});</code></pre></div></section><section><h3 id="-809568624#curl-examples" data-toc="curl-examples#APIs y Endpoints.md-curl-examples">cURL Examples</h3><div class="detached code-block" id="-809568624#vka0kc_288"><pre><code class="language-bash"># Execute Process
curl -X POST \
  https://myorg.salesforce.com/services/apexrest/sura/foundation/v1/process/execute \
  -H 'Authorization: Bearer ACCESS_TOKEN' \
  -H 'Content-Type: application/json' \
  -H 'X-SURA-API-Version: v1' \
  -d '{
    &quot;processName&quot;: &quot;LeadKnowing&quot;,
    &quot;productFamily&quot;: &quot;Seguros de Motos&quot;,
    &quot;recordId&quot;: &quot;00Q000000123456&quot;,
    &quot;parameters&quot;: {
      &quot;vehicleType&quot;: &quot;Moto&quot;,
      &quot;validateRUNT&quot;: true
    }
  }'

# Check Process Status
curl -X GET \
  https://myorg.salesforce.com/services/apexrest/sura/foundation/v1/process/status/a0X000000123456 \
  -H 'Authorization: Bearer ACCESS_TOKEN' \
  -H 'X-SURA-API-Version: v1'</code></pre></div></section></section><section><h2 id="-809568624#postman-collection" data-toc="postman-collection#APIs y Endpoints.md-postman-collection">📋 Postman Collection</h2><section><h3 id="-809568624#collection-structure" data-toc="collection-structure#APIs y Endpoints.md-collection-structure">Collection Structure</h3><div class="detached code-block" id="-809568624#vka0kc_291"><pre><code class="language-json">{
  &quot;info&quot;: {
    &quot;name&quot;: &quot;SURA Foundation Framework APIs&quot;,
    &quot;description&quot;: &quot;Complete API collection for Foundation Framework&quot;,
    &quot;version&quot;: &quot;1.0.0&quot;
  },
  &quot;variable&quot;: [
    {
      &quot;key&quot;: &quot;baseUrl&quot;,
      &quot;value&quot;: &quot;{{instanceUrl}}/services/apexrest/sura/foundation/v1&quot;
    },
    {
      &quot;key&quot;: &quot;accessToken&quot;,
      &quot;value&quot;: &quot;{{token}}&quot;
    }
  ],
  &quot;auth&quot;: {
    &quot;type&quot;: &quot;bearer&quot;,
    &quot;bearer&quot;: [
      {
        &quot;key&quot;: &quot;token&quot;,
        &quot;value&quot;: &quot;{{accessToken}}&quot;
      }
    ]
  }
}</code></pre></div></section></section><section><h2 id="-809568624#best-practices" data-toc="best-practices#APIs y Endpoints.md-best-practices">🚀 Best Practices</h2><section><h3 id="-809568624#para-desarrolladores" data-toc="para-desarrolladores#APIs y Endpoints.md-para-desarrolladores">Para Desarrolladores</h3><ol class="list list-decimal" id="-809568624#vka0kc_295" type="1" start="1"><li class="list-item" id="-809568624#vka0kc_296"><p><span class="control" id="-809568624#vka0kc_301">Versionado</span>: Siempre especificar versi&oacute;n de API</p></li><li class="list-item" id="-809568624#vka0kc_297"><p><span class="control" id="-809568624#vka0kc_302">Error Handling</span>: Implementar retry logic para errores 5xx</p></li><li class="list-item" id="-809568624#vka0kc_298"><p><span class="control" id="-809568624#vka0kc_303">Timeouts</span>: Configurar timeouts apropiados (30s recomendado)</p></li><li class="list-item" id="-809568624#vka0kc_299"><p><span class="control" id="-809568624#vka0kc_304">Logging</span>: Loggear requests/responses para debugging</p></li><li class="list-item" id="-809568624#vka0kc_300"><p><span class="control" id="-809568624#vka0kc_305">Rate Limiting</span>: Implementar backoff exponencial</p></li></ol></section><section><h3 id="-809568624#para-integraciones" data-toc="para-integraciones#APIs y Endpoints.md-para-integraciones">Para Integraciones</h3><ol class="list list-decimal" id="-809568624#vka0kc_306" type="1" start="1"><li class="list-item" id="-809568624#vka0kc_309"><p><span class="control" id="-809568624#vka0kc_314">Async Processing</span>: Usar ejecuci&oacute;n as&iacute;ncrona para procesos largos</p></li><li class="list-item" id="-809568624#vka0kc_310"><p><span class="control" id="-809568624#vka0kc_315">Batch Operations</span>: Agrupar operaciones cuando sea posible</p></li><li class="list-item" id="-809568624#vka0kc_311"><p><span class="control" id="-809568624#vka0kc_316">Caching</span>: Cachear configuraciones que no cambian frecuentemente</p></li><li class="list-item" id="-809568624#vka0kc_312"><p><span class="control" id="-809568624#vka0kc_317">Monitoring</span>: Implementar health checks y alertas</p></li><li class="list-item" id="-809568624#vka0kc_313"><p><span class="control" id="-809568624#vka0kc_318">Security</span>: Renovar tokens antes de expiraci&oacute;n</p></li></ol><p id="-809568624#vka0kc_308"><span class="control" id="-809568624#vka0kc_319">Fecha de Actualizaci&oacute;n:</span> Mayo 2025<span class="control" id="-809568624#vka0kc_321">Versi&oacute;n de API:</span> v1.0<span class="control" id="-809568624#vka0kc_323">Mantenido por:</span> Equipo de Integraci&oacute;n SURA Foundation</p></section></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1028232267">QuoteUtils</h1><section><h2 id="-1028232267#descripci-n-general" data-toc="descripci-n-general#QuoteUtils.md-descripci-n-general">Descripci&oacute;n General</h2><p id="-1028232267#lh09xz_15"><span class="inline-code" id="-1028232267#lh09xz_16">QuoteUtils</span> es una clase virtual global que proporciona utilidades para trabajar con cotizaciones (Quote) en Salesforce. Esta clase ofrece m&eacute;todos para validar, actualizar y consultar cotizaciones, as&iacute; como para establecer relaciones entre cotizaciones, cuentas y oportunidades.</p></section><section><h2 id="-1028232267#autor" data-toc="autor#QuoteUtils.md-autor">Autor</h2><p id="-1028232267#lh09xz_17">Jean Carlos Melendez \&lt;jean@cloudblue.us\&gt;</p></section><section><h2 id="-1028232267#ltima-modificaci-n" data-toc="ltima-modificaci-n#QuoteUtils.md-ltima-modificaci-n">&Uacute;ltima Modificaci&oacute;n</h2><p id="-1028232267#lh09xz_18">31 de enero de 2025 por Esneyder Zabala</p></section><section><h2 id="-1028232267#constantes" data-toc="constantes#QuoteUtils.md-constantes">Constantes</h2><div class="table-wrapper detached"><table id="-1028232267#lh09xz_19"><tr class="header-row" id="-1028232267#lh09xz_20"><th id="-1028232267#lh09xz_23"><p>Nombre</p></th><th id="-1028232267#lh09xz_24"><p>Tipo</p></th><th id="-1028232267#lh09xz_25"><p>Descripci&oacute;n</p></th></tr><tr class="" id="-1028232267#lh09xz_21"><td id="-1028232267#lh09xz_26"><p><span class="inline-code" id="-1028232267#lh09xz_29">MAIN_NODE</span></p></td><td id="-1028232267#lh09xz_27"><p><span class="inline-code" id="-1028232267#lh09xz_30">String</span></p></td><td id="-1028232267#lh09xz_28"><p>Clave del nodo principal en los datos de entrada para cotizaciones: 'quotepolicyJson'</p></td></tr><tr class="" id="-1028232267#lh09xz_22"><td id="-1028232267#lh09xz_31"><p><span class="inline-code" id="-1028232267#lh09xz_34">REQUIRED_PARAMETERS</span></p></td><td id="-1028232267#lh09xz_32"><p><span class="inline-code" id="-1028232267#lh09xz_35">Set&lt;String&gt;</span></p></td><td id="-1028232267#lh09xz_33"><p>Conjunto de par&aacute;metros requeridos para la cotizaci&oacute;n: 'term', 'productConfigurationDetail', 'insuredItems', 'additionalFields', 'OpportunityDetails'</p></td></tr></table></div></section><section><h2 id="-1028232267#m-todos" data-toc="m-todos#QuoteUtils.md-m-todos">M&eacute;todos</h2><section><h3 id="-1028232267#isvalidsalesforceid-string-objectid" data-toc="isvalidsalesforceid-string-objectid#QuoteUtils.md-isvalidsalesforceid-string-objectid">isValidSalesforceId(String objectId)</h3><section><h4 id="-1028232267#descripci-n" data-toc="descripci-n#QuoteUtils.md-descripci-n">Descripci&oacute;n</h4><p id="-1028232267#lh09xz_49">Comprueba si un ID proporcionado es un ID de Salesforce v&aacute;lido que corresponde a alg&uacute;n objeto.</p></section><section><h4 id="-1028232267#par-metros" data-toc="par-metros#QuoteUtils.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1028232267#lh09xz_50" start="1"><li class="list-item" id="-1028232267#lh09xz_51"><p><span class="inline-code" id="-1028232267#lh09xz_52">objectId</span> (String): El ID de Salesforce a validar.</p></li></ul></section><section><h4 id="-1028232267#retorno" data-toc="retorno#QuoteUtils.md-retorno">Retorno</h4><ul class="list" id="-1028232267#lh09xz_53" start="1"><li class="list-item" id="-1028232267#lh09xz_54"><p><span class="inline-code" id="-1028232267#lh09xz_55">Boolean</span>: <span class="inline-code" id="-1028232267#lh09xz_56">true</span> si el ID es v&aacute;lido y corresponde a un objeto, <span class="inline-code" id="-1028232267#lh09xz_57">false</span> en caso contrario.</p></li></ul></section><section><h4 id="-1028232267#proceso" data-toc="proceso#QuoteUtils.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1028232267#lh09xz_58" type="1" start="1"><li class="list-item" id="-1028232267#lh09xz_59"><p>Intenta convertir la cadena a un ID de Salesforce.</p></li><li class="list-item" id="-1028232267#lh09xz_60"><p>Si la conversi&oacute;n es exitosa, obtiene el tipo de objeto asociado al ID.</p></li><li class="list-item" id="-1028232267#lh09xz_61"><p>Verifica que el tipo de objeto no est&eacute; en blanco.</p></li><li class="list-item" id="-1028232267#lh09xz_62"><p>Si ocurre alguna excepci&oacute;n durante el proceso, retorna <span class="inline-code" id="-1028232267#lh09xz_63">false</span>.</p></li></ol></section><section><h4 id="-1028232267#c-digo" data-toc="c-digo#QuoteUtils.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1028232267#lh09xz_64"><pre><code class="language-none">global static Boolean isValidSalesforceId(String objectId) {
  try {
    Id validId = Id.valueOf(objectId); // Lanza excepción si el ID no es válido
    String sObjectType = validId.getSObjectType().getDescribe().getName();
    return String.isNotBlank(sObjectType);
  } catch (Exception e) {
    return false; // El ID no es válido o no pertenece a un objeto conocido
  }
}</code></pre></div></section></section><section><h3 id="-1028232267#validateinputmapforquoting-map-string-object-inputmap" data-toc="validateinputmapforquoting-map-string-object-inputmap#QuoteUtils.md-validateinputmapforquoting-map-string-object-inputmap">validateInputMapForQuoting(Map&lt;String, Object&gt; inputMap)</h3><section><h4 id="-1028232267#descripci-n" data-toc="descripci-n#QuoteUtils.md-descripci-n">Descripci&oacute;n</h4><p id="-1028232267#lh09xz_72">Verifica si todos los nodos principales requeridos est&aacute;n presentes en el mapa de entrada para un proceso de cotizaci&oacute;n.</p></section><section><h4 id="-1028232267#par-metros" data-toc="par-metros#QuoteUtils.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1028232267#lh09xz_73" start="1"><li class="list-item" id="-1028232267#lh09xz_74"><p><span class="inline-code" id="-1028232267#lh09xz_75">inputMap</span> (Map&lt;String, Object&gt;): Mapa de entrada que contiene los datos a validar.</p></li></ul></section><section><h4 id="-1028232267#retorno" data-toc="retorno#QuoteUtils.md-retorno">Retorno</h4><ul class="list" id="-1028232267#lh09xz_76" start="1"><li class="list-item" id="-1028232267#lh09xz_77"><p><span class="inline-code" id="-1028232267#lh09xz_78">Map&lt;Boolean, Object&gt;</span>: Mapa con el resultado de la validaci&oacute;n. La clave es un booleano que indica si la validaci&oacute;n fue exitosa, y el valor es un mensaje descriptivo.</p></li></ul></section><section><h4 id="-1028232267#proceso" data-toc="proceso#QuoteUtils.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1028232267#lh09xz_79" type="1" start="1"><li class="list-item" id="-1028232267#lh09xz_80"><p>Verifica la existencia del nodo principal (<span class="inline-code" id="-1028232267#lh09xz_84">MAIN_NODE</span>).</p></li><li class="list-item" id="-1028232267#lh09xz_81"><p>Obtiene el mapa correspondiente al nodo principal.</p></li><li class="list-item" id="-1028232267#lh09xz_82"><p>Verifica la existencia de cada uno de los par&aacute;metros requeridos definidos en <span class="inline-code" id="-1028232267#lh09xz_85">REQUIRED_PARAMETERS</span>.</p></li><li class="list-item" id="-1028232267#lh09xz_83"><p>Devuelve un mapa con el resultado de la validaci&oacute;n y un mensaje descriptivo.</p></li></ol></section><section><h4 id="-1028232267#c-digo" data-toc="c-digo#QuoteUtils.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1028232267#lh09xz_86"><pre><code class="language-none">global static Map&lt;Boolean, Object&gt; validateInputMapForQuoting(
  Map&lt;String, Object&gt; inputMap
) {
  if (!inputMap.containsKey(MAIN_NODE) || inputMap?.get(MAIN_NODE) == null) {
    return createValidationResult(
      false,
      'Falta el nodo principal requerido: ' + MAIN_NODE
    );
  }
  Map&lt;String, Object&gt; mainNode = (Map&lt;String, Object&gt;) inputMap.get(
    MAIN_NODE
  );

  for (String node : REQUIRED_PARAMETERS) {
    if (!mainNode.containsKey(node)) {
      return createValidationResult(
        false,
        'Falta el nodo requerido: ' + node
      );
    }
  }
  System.debug('Todos los nodos requeridos están presentes.');
  return createValidationResult(
    true,
    'Todos los parámetros requeridos están presentes.'
  );
}</code></pre></div></section></section><section><h3 id="-1028232267#createvalidationresult-boolean-isvalid-string-message" data-toc="createvalidationresult-boolean-isvalid-string-message#QuoteUtils.md-createvalidationresult-boolean-isvalid-string-message">createValidationResult(Boolean isValid, String message)</h3><section><h4 id="-1028232267#descripci-n" data-toc="descripci-n#QuoteUtils.md-descripci-n">Descripci&oacute;n</h4><p id="-1028232267#lh09xz_93">M&eacute;todo privado est&aacute;tico que crea un mapa est&aacute;ndar para representar el resultado de una validaci&oacute;n.</p></section><section><h4 id="-1028232267#par-metros" data-toc="par-metros#QuoteUtils.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1028232267#lh09xz_94" start="1"><li class="list-item" id="-1028232267#lh09xz_95"><p><span class="inline-code" id="-1028232267#lh09xz_97">isValid</span> (Boolean): Indicador de si la validaci&oacute;n fue exitosa.</p></li><li class="list-item" id="-1028232267#lh09xz_96"><p><span class="inline-code" id="-1028232267#lh09xz_98">message</span> (String): Mensaje descriptivo del resultado.</p></li></ul></section><section><h4 id="-1028232267#retorno" data-toc="retorno#QuoteUtils.md-retorno">Retorno</h4><ul class="list" id="-1028232267#lh09xz_99" start="1"><li class="list-item" id="-1028232267#lh09xz_100"><p><span class="inline-code" id="-1028232267#lh09xz_101">Map&lt;Boolean, Object&gt;</span>: Mapa con el estado de validaci&oacute;n y el mensaje.</p></li></ul></section><section><h4 id="-1028232267#c-digo" data-toc="c-digo#QuoteUtils.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1028232267#lh09xz_102"><pre><code class="language-none">private static Map&lt;Boolean, Object&gt; createValidationResult(
  Boolean isValid,
  String message
) {
  return new Map&lt;Boolean, Object&gt;{ isValid =&gt; message };
}</code></pre></div></section></section><section><h3 id="-1028232267#updatequotestate-id-quoteid-string-status" data-toc="updatequotestate-id-quoteid-string-status#QuoteUtils.md-updatequotestate-id-quoteid-string-status">updateQuoteState(Id quoteId, String status)</h3><section><h4 id="-1028232267#descripci-n" data-toc="descripci-n#QuoteUtils.md-descripci-n">Descripci&oacute;n</h4><p id="-1028232267#lh09xz_110">Actualiza el estado de una cotizaci&oacute;n, verificando primero que el valor del estado sea v&aacute;lido.</p></section><section><h4 id="-1028232267#par-metros" data-toc="par-metros#QuoteUtils.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1028232267#lh09xz_111" start="1"><li class="list-item" id="-1028232267#lh09xz_112"><p><span class="inline-code" id="-1028232267#lh09xz_114">quoteId</span> (Id): Id de la cotizaci&oacute;n a actualizar.</p></li><li class="list-item" id="-1028232267#lh09xz_113"><p><span class="inline-code" id="-1028232267#lh09xz_115">status</span> (String): Nuevo valor para el campo Status.</p></li></ul></section><section><h4 id="-1028232267#retorno" data-toc="retorno#QuoteUtils.md-retorno">Retorno</h4><ul class="list" id="-1028232267#lh09xz_116" start="1"><li class="list-item" id="-1028232267#lh09xz_117"><p><span class="inline-code" id="-1028232267#lh09xz_118">SObject</span>: La cotizaci&oacute;n actualizada.</p></li></ul></section><section><h4 id="-1028232267#proceso" data-toc="proceso#QuoteUtils.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1028232267#lh09xz_119" type="1" start="1"><li class="list-item" id="-1028232267#lh09xz_120"><p>Obtiene los metadatos del objeto Quote para acceder a la descripci&oacute;n del campo Status.</p></li><li class="list-item" id="-1028232267#lh09xz_121"><p>Verifica que el valor de estado proporcionado sea v&aacute;lido seg&uacute;n los valores de la lista de selecci&oacute;n (picklist).</p></li><li class="list-item" id="-1028232267#lh09xz_122"><p>Si el valor no es v&aacute;lido, lanza una excepci&oacute;n.</p></li><li class="list-item" id="-1028232267#lh09xz_123"><p>Consulta la cotizaci&oacute;n por su ID.</p></li><li class="list-item" id="-1028232267#lh09xz_124"><p>Actualiza el campo Status con el nuevo valor.</p></li><li class="list-item" id="-1028232267#lh09xz_125"><p>Guarda los cambios.</p></li><li class="list-item" id="-1028232267#lh09xz_126"><p>Devuelve la cotizaci&oacute;n actualizada.</p></li></ol></section><section><h4 id="-1028232267#c-digo" data-toc="c-digo#QuoteUtils.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1028232267#lh09xz_127"><pre><code class="language-none">global static SObject updateQuoteState(Id quoteId, String status) {
  // Obtener la metadata del objeto Quote
  Schema.SObjectType quoteSchema = Schema.getGlobalDescribe().get('Quote');
  Schema.DescribeSObjectResult quoteDescribe = quoteSchema.getDescribe();
  Map&lt;String, Schema.SObjectField&gt; fieldMap = quoteDescribe.fields.getMap();
  Schema.DescribeFieldResult statusFieldDescribe = fieldMap.get('Status')
    .getDescribe();

  if (!CorePicklistUtils.containsVal(fieldMap.get('Status'), status)) {
    throw new ProductHandlerImplementationException(
      'invalid opportunity stage',
      'UNPROCESSABLE_ENTITY',
      422
    );
  }
  String query = 'SELECT Id, Status FROM Quote WHERE Id = :quoteId';
  List&lt;SObject&gt; results = Database.query(query);
  SObject quote = results[0];
  quote.put('Status', status);
  System.debug('quote utils: ' + quote);
  update quote;
  System.debug('quote utils update ok: ' + quote);
  return quote;
}</code></pre></div></section></section><section><h3 id="-1028232267#getquotebyid-id-quoteid" data-toc="getquotebyid-id-quoteid#QuoteUtils.md-getquotebyid-id-quoteid">getQuoteById(Id quoteId)</h3><section><h4 id="-1028232267#descripci-n" data-toc="descripci-n#QuoteUtils.md-descripci-n">Descripci&oacute;n</h4><p id="-1028232267#lh09xz_134">Obtiene una cotizaci&oacute;n por su ID, incluyendo campos espec&iacute;ficos.</p></section><section><h4 id="-1028232267#par-metros" data-toc="par-metros#QuoteUtils.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1028232267#lh09xz_135" start="1"><li class="list-item" id="-1028232267#lh09xz_136"><p><span class="inline-code" id="-1028232267#lh09xz_137">quoteId</span> (Id): Id de la cotizaci&oacute;n a consultar.</p></li></ul></section><section><h4 id="-1028232267#retorno" data-toc="retorno#QuoteUtils.md-retorno">Retorno</h4><ul class="list" id="-1028232267#lh09xz_138" start="1"><li class="list-item" id="-1028232267#lh09xz_139"><p><span class="inline-code" id="-1028232267#lh09xz_140">SObject</span>: La cotizaci&oacute;n encontrada.</p></li></ul></section><section><h4 id="-1028232267#c-digo" data-toc="c-digo#QuoteUtils.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1028232267#lh09xz_141"><pre><code class="language-none">global static SObject getQuoteById(Id quoteId) {
  String query = 'SELECT Id, Name, AccountId, OpportunityId, Status, OwnerId FROM Quote WHERE Id = :quoteId LIMIT 1';
  List&lt;SObject&gt; quotes = Database.query(query);
  return quotes[0];
}</code></pre></div></section></section><section><h3 id="-1028232267#setinsuredpartytoquoteandopp-list-map-string-object-insuredpeople-sobject-quote" data-toc="setinsuredpartytoquoteandopp-list-map-string-object-insuredpeople-sobject-quote#QuoteUtils.md-setinsuredpartytoquoteandopp-list-map-string-object-insuredpeople-sobject-quote">setInsuredPartyToQuoteAndOpp(List&lt;Map&lt;String, Object&gt;&gt; insuredPeople, SObject quote)</h3><section><h4 id="-1028232267#descripci-n" data-toc="descripci-n#QuoteUtils.md-descripci-n">Descripci&oacute;n</h4><p id="-1028232267#lh09xz_149">M&eacute;todo virtual que establece las partes aseguradas en una cotizaci&oacute;n y actualiza la cuenta asociada a la oportunidad relacionada.</p></section><section><h4 id="-1028232267#par-metros" data-toc="par-metros#QuoteUtils.md-par-metros">Par&aacute;metros</h4><ul class="list" id="-1028232267#lh09xz_150" start="1"><li class="list-item" id="-1028232267#lh09xz_151"><p><span class="inline-code" id="-1028232267#lh09xz_153">insuredPeople</span> (List&lt;Map&lt;String, Object&gt;&gt;): Lista de mapas que representan las personas aseguradas.</p></li><li class="list-item" id="-1028232267#lh09xz_152"><p><span class="inline-code" id="-1028232267#lh09xz_154">quote</span> (SObject): La cotizaci&oacute;n a la que se asociar&aacute;n las partes aseguradas.</p></li></ul></section><section><h4 id="-1028232267#retorno" data-toc="retorno#QuoteUtils.md-retorno">Retorno</h4><ul class="list" id="-1028232267#lh09xz_155" start="1"><li class="list-item" id="-1028232267#lh09xz_156"><p><span class="inline-code" id="-1028232267#lh09xz_157">void</span></p></li></ul></section><section><h4 id="-1028232267#proceso" data-toc="proceso#QuoteUtils.md-proceso">Proceso</h4><ol class="list list-decimal" id="-1028232267#lh09xz_158" type="1" start="1"><li class="list-item" id="-1028232267#lh09xz_159"><p>Obtiene el ID de la oportunidad asociada a la cotizaci&oacute;n.</p></li><li class="list-item" id="-1028232267#lh09xz_160"><p>Consulta la oportunidad para obtener sus detalles.</p></li><li class="list-item" id="-1028232267#lh09xz_161"><p>Recorre la lista de personas aseguradas.</p></li><li class="list-item" id="-1028232267#lh09xz_162"><p>Para cada persona, si contiene una clave 'Asegurado' con una cuenta asociada, actualiza la cuenta de la oportunidad.</p></li><li class="list-item" id="-1028232267#lh09xz_163"><p>Actualiza tanto la cotizaci&oacute;n como la oportunidad para guardar los cambios.</p></li></ol></section><section><h4 id="-1028232267#c-digo" data-toc="c-digo#QuoteUtils.md-c-digo">C&oacute;digo</h4><div class="detached code-block" id="-1028232267#lh09xz_164"><pre><code class="language-none">global virtual void setInsuredPartyToQuoteAndOpp(
  List&lt;Map&lt;String, Object&gt;&gt; insuredPeople,
  SObject quote
) {
  // Obtener OpportunityId de la Quote
  Id opportunityId = (Id) quote.get('OpportunityId');

  Opportunity opp = [
    SELECT Id, AccountId
    FROM Opportunity
    WHERE Id = :opportunityId
  ];

  for (Map&lt;String, Object&gt; person : insuredPeople) {
    System.debug(person);
    if (person.containsKey('Asegurado')) {
      Account account = (Account) person.get('Asegurado');
      System.debug(account);
      if (account != null) {
        opp.AccountId = account.Id;
      }
    }
  }
  update quote;
  update opp;
}</code></pre></div></section></section></section><section><h2 id="-1028232267#excepciones" data-toc="excepciones#QuoteUtils.md-excepciones">Excepciones</h2><section><h3 id="-1028232267#producthandlerimplementationexception" data-toc="producthandlerimplementationexception#QuoteUtils.md-producthandlerimplementationexception">ProductHandlerImplementationException</h3><p id="-1028232267#lh09xz_167">Esta excepci&oacute;n se lanza en el m&eacute;todo <span class="inline-code" id="-1028232267#lh09xz_169">updateQuoteState</span> cuando se proporciona un valor de estado no v&aacute;lido para la cotizaci&oacute;n.</p></section></section><section><h2 id="-1028232267#dependencias" data-toc="dependencias#QuoteUtils.md-dependencias">Dependencias</h2><ul class="list" id="-1028232267#lh09xz_170" start="1"><li class="list-item" id="-1028232267#lh09xz_171"><p><span class="inline-code" id="-1028232267#lh09xz_176">CorePicklistUtils</span>: Clase utilitaria que contiene el m&eacute;todo <span class="inline-code" id="-1028232267#lh09xz_177">containsVal</span> para verificar si un valor est&aacute; presente en una lista de selecci&oacute;n.</p></li><li class="list-item" id="-1028232267#lh09xz_172"><p><span class="inline-code" id="-1028232267#lh09xz_178">ProductHandlerImplementationException</span>: Excepci&oacute;n personalizada lanzada cuando hay errores en la implementaci&oacute;n del manejador de productos.</p></li><li class="list-item" id="-1028232267#lh09xz_173"><p><span class="inline-code" id="-1028232267#lh09xz_179">Quote</span>: Objeto est&aacute;ndar de Salesforce para cotizaciones.</p></li><li class="list-item" id="-1028232267#lh09xz_174"><p><span class="inline-code" id="-1028232267#lh09xz_180">Opportunity</span>: Objeto est&aacute;ndar de Salesforce para oportunidades.</p></li><li class="list-item" id="-1028232267#lh09xz_175"><p><span class="inline-code" id="-1028232267#lh09xz_181">Account</span>: Objeto est&aacute;ndar de Salesforce para cuentas.</p></li></ul></section><section><h2 id="-1028232267#estructura-de-datos-esperada" data-toc="estructura-de-datos-esperada#QuoteUtils.md-estructura-de-datos-esperada">Estructura de Datos Esperada</h2><p id="-1028232267#lh09xz_182">La clase espera que los datos de entrada para la validaci&oacute;n de cotizaciones tengan la siguiente estructura:</p><div class="detached code-block" id="-1028232267#lh09xz_183"><pre><code class="language-json">{
  &quot;quotepolicyJson&quot;: {
    &quot;term&quot;: { /* ... */ },
    &quot;productConfigurationDetail&quot;: { /* ... */ },
    &quot;insuredItems&quot;: [ /* ... */ ],
    &quot;additionalFields&quot;: { /* ... */ },
    &quot;OpportunityDetails&quot;: { /* ... */ }
  },
  /* Otros campos opcionales */
}</code></pre></div></section><section><h2 id="-1028232267#ejemplo-de-uso" data-toc="ejemplo-de-uso#QuoteUtils.md-ejemplo-de-uso">Ejemplo de Uso</h2><section><h3 id="-1028232267#validar-datos-de-entrada-para-cotizaci-n" data-toc="validar-datos-de-entrada-para-cotizaci-n#QuoteUtils.md-validar-datos-de-entrada-para-cotizaci-n">Validar datos de entrada para cotizaci&oacute;n</h3><div class="detached code-block" id="-1028232267#lh09xz_188"><pre><code class="language-none">// Preparar datos de entrada para validación
Map&lt;String, Object&gt; term = new Map&lt;String, Object&gt;{
  'startDate' =&gt; Date.today(),
  'endDate' =&gt; Date.today().addYears(1)
};

Map&lt;String, Object&gt; productConfigDetail = new Map&lt;String, Object&gt;{
  'productCode' =&gt; 'AUTO-001',
  'coverageLevel' =&gt; 'Premium'
};

List&lt;Map&lt;String, Object&gt;&gt; insuredItems = new List&lt;Map&lt;String, Object&gt;&gt;{
  new Map&lt;String, Object&gt;{
    'type' =&gt; 'Vehicle',
    'make' =&gt; 'Toyota',
    'model' =&gt; 'Corolla',
    'year' =&gt; 2020
  }
};

Map&lt;String, Object&gt; additionalFields = new Map&lt;String, Object&gt;{
  'discountCode' =&gt; 'NEWCUST10'
};

Map&lt;String, Object&gt; opportunityDetails = new Map&lt;String, Object&gt;{
  'opportunityId' =&gt; '0061x00000AbCdEf',
  'accountId' =&gt; '0011x00000GhIjKl'
};

Map&lt;String, Object&gt; quotepolicyJson = new Map&lt;String, Object&gt;{
  'term' =&gt; term,
  'productConfigurationDetail' =&gt; productConfigDetail,
  'insuredItems' =&gt; insuredItems,
  'additionalFields' =&gt; additionalFields,
  'OpportunityDetails' =&gt; opportunityDetails
};

Map&lt;String, Object&gt; input = new Map&lt;String, Object&gt;{
  'quotepolicyJson' =&gt; quotepolicyJson
};

// Validar los datos de entrada
Map&lt;Boolean, Object&gt; validationResult = QuoteUtils.validateInputMapForQuoting(input);
if (validationResult.containsKey(false)) {
  System.debug('Error de validación: ' + validationResult.get(false));
  // Manejar el error
} else {
  System.debug('Validación exitosa: ' + validationResult.get(true));
  // Continuar con el proceso
}</code></pre></div></section><section><h3 id="-1028232267#actualizar-el-estado-de-una-cotizaci-n" data-toc="actualizar-el-estado-de-una-cotizaci-n#QuoteUtils.md-actualizar-el-estado-de-una-cotizaci-n">Actualizar el estado de una cotizaci&oacute;n</h3><div class="detached code-block" id="-1028232267#lh09xz_189"><pre><code class="language-none">// ID de la cotización a actualizar
Id quoteId = '0Q00x000000XXXXX';

try {
  // Actualizar el estado a &quot;Approved&quot;
  SObject updatedQuote = QuoteUtils.updateQuoteState(quoteId, 'Approved');
  System.debug('Cotización actualizada: ' + updatedQuote);
} catch (ProductHandlerImplementationException e) {
  System.debug('Error al actualizar el estado: ' + e.getMessage());
}</code></pre></div></section><section><h3 id="-1028232267#obtener-una-cotizaci-n-por-id" data-toc="obtener-una-cotizaci-n-por-id#QuoteUtils.md-obtener-una-cotizaci-n-por-id">Obtener una cotizaci&oacute;n por ID</h3><div class="detached code-block" id="-1028232267#lh09xz_190"><pre><code class="language-none">// ID de la cotización a consultar
Id quoteId = '0Q00x000000XXXXX';

// Obtener la cotización
SObject quote = QuoteUtils.getQuoteById(quoteId);
System.debug('Cotización obtenida: ' + quote);</code></pre></div></section><section><h3 id="-1028232267#establecer-partes-aseguradas" data-toc="establecer-partes-aseguradas#QuoteUtils.md-establecer-partes-aseguradas">Establecer partes aseguradas</h3><div class="detached code-block" id="-1028232267#lh09xz_191"><pre><code class="language-none">// ID de la cotización
Id quoteId = '0Q00x000000XXXXX';

// Obtener la cotización
SObject quote = QuoteUtils.getQuoteById(quoteId);

// Crear cuenta para el asegurado
Account insuredAccount = new Account(
  Name = 'Asegurado Principal',
  Phone = '555-1234',
  BillingCity = 'Ciudad Ejemplo'
);
insert insuredAccount;

// Crear lista de partes aseguradas
List&lt;Map&lt;String, Object&gt;&gt; insuredParties = new List&lt;Map&lt;String, Object&gt;&gt;{
  new Map&lt;String, Object&gt;{
    'Asegurado' =&gt; insuredAccount,
    'TipoAsegurado' =&gt; 'Principal'
  }
};

// Establecer las partes aseguradas
QuoteUtils quoteUtils = new QuoteUtils();
quoteUtils.setInsuredPartyToQuoteAndOpp(insuredParties, quote);</code></pre></div></section></section><section><h2 id="-1028232267#extensi-n-de-la-clase" data-toc="extensi-n-de-la-clase#QuoteUtils.md-extensi-n-de-la-clase">Extensi&oacute;n de la Clase</h2><p id="-1028232267#lh09xz_192">Siendo una clase virtual, <span class="inline-code" id="-1028232267#lh09xz_194">QuoteUtils</span> puede ser extendida para personalizar comportamientos espec&iacute;ficos:</p><div class="detached code-block" id="-1028232267#lh09xz_193"><pre><code class="language-none">public class CustomQuoteUtils extends QuoteUtils {
    
    // Sobrescribir el método para añadir lógica personalizada
    global override void setInsuredPartyToQuoteAndOpp(
        List&lt;Map&lt;String, Object&gt;&gt; insuredPeople,
        SObject quote
    ) {
        // Obtener OpportunityId de la Quote
        Id opportunityId = (Id) quote.get('OpportunityId');

        Opportunity opp = [
            SELECT Id, AccountId, StageName, Amount
            FROM Opportunity
            WHERE Id = :opportunityId
        ];

        // Lógica personalizada para determinar la cuenta principal
        Account primaryAccount = null;
        Map&lt;String, Account&gt; accountsByType = new Map&lt;String, Account&gt;();
        
        // Clasificar cuentas por tipo
        for (Map&lt;String, Object&gt; person : insuredPeople) {
            if (person.containsKey('Asegurado')) {
                Account account = (Account) person.get('Asegurado');
                String tipoAsegurado = (String) person.get('TipoAsegurado');
                
                if (account != null) {
                    accountsByType.put(tipoAsegurado, account);
                    
                    if (tipoAsegurado == 'Principal' || primaryAccount == null) {
                        primaryAccount = account;
                    }
                }
            }
        }
        
        // Establecer la cuenta principal en la oportunidad
        if (primaryAccount != null) {
            opp.AccountId = primaryAccount.Id;
        }
        
        // Actualizar campos adicionales en la oportunidad basados en la cotización
        quote.put('Insured_Party_Count__c', insuredPeople.size());
        
        // Llamar al método personalizado para crear contactos de roles
        createContactRoles(opp.Id, accountsByType);
        
        // Guardar cambios
        update quote;
        update opp;
    }
    
    // Método adicional para crear roles de contacto
    private void createContactRoles(Id opportunityId, Map&lt;String, Account&gt; accountsByType) {
        List&lt;OpportunityContactRole&gt; roles = new List&lt;OpportunityContactRole&gt;();
        
        for (String type : accountsByType.keySet()) {
            Account acc = accountsByType.get(type);
            
            // Obtener el contacto primario de la cuenta
            Contact primaryContact = [
                SELECT Id 
                FROM Contact 
                WHERE AccountId = :acc.Id
                LIMIT 1
            ];
            
            if (primaryContact != null) {
                OpportunityContactRole role = new OpportunityContactRole(
                    OpportunityId = opportunityId,
                    ContactId = primaryContact.Id,
                    Role = mapTypeToRole(type)
                );
                roles.add(role);
            }
        }
        
        if (!roles.isEmpty()) {
            insert roles;
        }
    }
    
    // Método para mapear tipo de asegurado a rol de contacto
    private String mapTypeToRole(String type) {
        switch on type {
            when 'Principal' {
                return 'Decision Maker';
            }
            when 'Adicional' {
                return 'Influencer';
            }
            when else {
                return 'Other';
            }
        }
    }
}</code></pre></div></section><section><h2 id="-1028232267#consideraciones-y-mejores-pr-cticas" data-toc="consideraciones-y-mejores-pr-cticas#QuoteUtils.md-consideraciones-y-mejores-pr-cticas">Consideraciones y Mejores Pr&aacute;cticas</h2><ol class="list list-decimal" id="-1028232267#lh09xz_195" type="1" start="1"><li class="list-item" id="-1028232267#lh09xz_196"><p id="-1028232267#lh09xz_201"><span class="control" id="-1028232267#lh09xz_202">Manejo de Excepciones</span>: La clase maneja excepciones en algunos m&eacute;todos pero no en todos. Considerar implementar un manejo consistente de excepciones en todos los m&eacute;todos.</p></li><li class="list-item" id="-1028232267#lh09xz_197"><p id="-1028232267#lh09xz_203"><span class="control" id="-1028232267#lh09xz_204">M&eacute;todos Virtuales</span>: El m&eacute;todo <span class="inline-code" id="-1028232267#lh09xz_205">setInsuredPartyToQuoteAndOpp</span> est&aacute; marcado como virtual, permitiendo su personalizaci&oacute;n en clases derivadas. Al extender la clase, asegurarse de mantener la funcionalidad b&aacute;sica o llamar al m&eacute;todo base seg&uacute;n sea necesario.</p></li><li class="list-item" id="-1028232267#lh09xz_198"><p id="-1028232267#lh09xz_206"><span class="control" id="-1028232267#lh09xz_207">DML en Bucles</span>: El m&eacute;todo <span class="inline-code" id="-1028232267#lh09xz_208">setInsuredPartyToQuoteAndOpp</span> realiza operaciones DML fuera de los bucles, lo cual es una buena pr&aacute;ctica para evitar alcanzar l&iacute;mites de gobernador.</p></li><li class="list-item" id="-1028232267#lh09xz_199"><p id="-1028232267#lh09xz_209"><span class="control" id="-1028232267#lh09xz_210">Validaci&oacute;n de Entradas</span>: La clase incluye m&eacute;todos para validar la estructura de los datos de entrada, lo que es una buena pr&aacute;ctica para garantizar la integridad de los datos.</p></li><li class="list-item" id="-1028232267#lh09xz_200"><p id="-1028232267#lh09xz_211"><span class="control" id="-1028232267#lh09xz_212">Uso de Consultas Din&aacute;micas</span>: La clase utiliza consultas din&aacute;micas para obtener objetos. Cuando sea posible, considerar el uso de consultas est&aacute;ticas para aprovechar la verificaci&oacute;n en tiempo de compilaci&oacute;n.</p></li></ol></section><section><h2 id="-1028232267#notas-adicionales" data-toc="notas-adicionales#QuoteUtils.md-notas-adicionales">Notas Adicionales</h2><ol class="list list-decimal" id="-1028232267#lh09xz_213" type="1" start="1"><li class="list-item" id="-1028232267#lh09xz_214"><p>La clase utiliza el operador de navegaci&oacute;n segura (<span class="inline-code" id="-1028232267#lh09xz_218">?.</span>) para evitar excepciones de referencia nula al acceder a valores en mapas.</p></li><li class="list-item" id="-1028232267#lh09xz_215"><p>El mensaje de excepci&oacute;n en <span class="inline-code" id="-1028232267#lh09xz_219">updateQuoteState</span> menciona &quot;invalid opportunity stage&quot; aunque est&aacute; validando el estado de una cotizaci&oacute;n, lo que podr&iacute;a indicar un error o reutilizaci&oacute;n de c&oacute;digo.</p></li><li class="list-item" id="-1028232267#lh09xz_216"><p>La clase parece formar parte de un sistema m&aacute;s amplio para la gesti&oacute;n de cotizaciones y productos, interactuando con otras clases como <span class="inline-code" id="-1028232267#lh09xz_220">CorePicklistUtils</span> y <span class="inline-code" id="-1028232267#lh09xz_221">ProductHandlerImplementationException</span>.</p></li><li class="list-item" id="-1028232267#lh09xz_217"><p>El uso de la palabra clave <span class="inline-code" id="-1028232267#lh09xz_222">global</span> indica que esta clase est&aacute; dise&ntilde;ada para ser accesible desde paquetes gestionados o diferentes namespaces.</p></li></ol></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-427355904">Gu&iacute;as de Implementaci&oacute;n - SURA Foundation Framework</h1><section><h2 id="-427355904#resumen-ejecutivo" data-toc="resumen-ejecutivo#Guía de Implementación.md-resumen-ejecutivo">Resumen Ejecutivo</h2><p id="-427355904#-13w85w_17">Esta gu&iacute;a proporciona instrucciones completas para la implementaci&oacute;n, configuraci&oacute;n y despliegue de <span class="control" id="-427355904#-13w85w_19">SURA Foundation Framework</span>. Incluye desde la instalaci&oacute;n inicial hasta la configuraci&oacute;n avanzada, mejores pr&aacute;cticas y troubleshooting para garantizar una implementaci&oacute;n exitosa.</p></section><section><h2 id="-427355904#prerrequisitos" data-toc="prerrequisitos#Guía de Implementación.md-prerrequisitos">🎯 Prerrequisitos</h2><section><h3 id="-427355904#requisitos-de-ambiente" data-toc="requisitos-de-ambiente#Guía de Implementación.md-requisitos-de-ambiente">Requisitos de Ambiente</h3><section><h4 id="-427355904#salesforce-organization" data-toc="salesforce-organization#Guía de Implementación.md-salesforce-organization">Salesforce Organization</h4><ul class="list" id="-427355904#-13w85w_25" start="1"><li class="list-item" id="-427355904#-13w85w_26"><p><span class="control" id="-427355904#-13w85w_30">Edici&oacute;n</span>: Enterprise, Unlimited, o Developer Edition</p></li><li class="list-item" id="-427355904#-13w85w_27"><p><span class="control" id="-427355904#-13w85w_31">API Version</span>: 58.0 o superior</p></li><li class="list-item" id="-427355904#-13w85w_28"><p><span class="control" id="-427355904#-13w85w_32">My Domain</span>: Configurado y desplegado</p></li><li class="list-item" id="-427355904#-13w85w_29"><p><span class="control" id="-427355904#-13w85w_33">Lightning Experience</span>: Habilitado</p></li></ul></section><section><h4 id="-427355904#vlocity-omnistudio" data-toc="vlocity-omnistudio#Guía de Implementación.md-vlocity-omnistudio">Vlocity/OmniStudio</h4><ul class="list" id="-427355904#-13w85w_34" start="1"><li class="list-item" id="-427355904#-13w85w_35"><p><span class="control" id="-427355904#-13w85w_39">OmniStudio</span>: Versi&oacute;n 2024.1 o superior</p></li><li class="list-item" id="-427355904#-13w85w_36"><p><span class="control" id="-427355904#-13w85w_40">Industries CPQ</span>: Instalado y configurado</p></li><li class="list-item" id="-427355904#-13w85w_37"><p><span class="control" id="-427355904#-13w85w_41">Integration Procedures</span>: Disponibles</p></li><li class="list-item" id="-427355904#-13w85w_38"><p><span class="control" id="-427355904#-13w85w_42">Data Raptors</span>: Configurados</p></li></ul></section><section><h4 id="-427355904#permisos-y-licencias" data-toc="permisos-y-licencias#Guía de Implementación.md-permisos-y-licencias">Permisos y Licencias</h4><div class="detached code-block" id="-427355904#-13w85w_43"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────────┐
│                    LICENSING REQUIREMENTS                      │
│                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   Salesforce    │  │     Vlocity     │  │    Foundation   │ │
│  │    Licenses     │  │    Licenses     │  │    Permissions  │ │
│  │                 │  │                 │  │                 │ │
│  │ • Platform      │  │ • Industries    │  │ • Process       │ │
│  │ • CRM          │  │   CPQ           │  │   Executor      │ │
│  │ • API Access    │  │ • OmniStudio    │  │ • Config        │ │
│  │                 │  │ • Integration   │  │   Manager       │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────────┘</code></pre></div></section></section><section><h3 id="-427355904#usuarios-y-roles" data-toc="usuarios-y-roles#Guía de Implementación.md-usuarios-y-roles">Usuarios y Roles</h3><p id="-427355904#-13w85w_44"><span class="control" id="-427355904#-13w85w_47">Roles Requeridos:</span></p><ul class="list" id="-427355904#-13w85w_45" start="1"><li class="list-item" id="-427355904#-13w85w_48"><p><span class="control" id="-427355904#-13w85w_52">System Administrator</span>: Instalaci&oacute;n y configuraci&oacute;n inicial</p></li><li class="list-item" id="-427355904#-13w85w_49"><p><span class="control" id="-427355904#-13w85w_53">Foundation Administrator</span>: Gesti&oacute;n de procesos y configuraciones</p></li><li class="list-item" id="-427355904#-13w85w_50"><p><span class="control" id="-427355904#-13w85w_54">Integration Specialist</span>: Configuraci&oacute;n de servicios externos</p></li><li class="list-item" id="-427355904#-13w85w_51"><p><span class="control" id="-427355904#-13w85w_55">Developer</span>: Extensiones y customizaciones</p></li></ul></section></section><section><h2 id="-427355904#instalaci-n-del-managed-package" data-toc="instalaci-n-del-managed-package#Guía de Implementación.md-instalaci-n-del-managed-package">📦 Instalaci&oacute;n del Managed Package</h2><section><h3 id="-427355904#paso-1-descarga-e-instalaci-n" data-toc="paso-1-descarga-e-instalaci-n#Guía de Implementación.md-paso-1-descarga-e-instalaci-n">Paso 1: Descarga e Instalaci&oacute;n</h3><section><h4 id="-427355904#desde-appexchange-recomendado" data-toc="desde-appexchange-recomendado#Guía de Implementación.md-desde-appexchange-recomendado">Desde AppExchange (Recomendado)</h4><div class="detached code-block" id="-427355904#-13w85w_62"><pre><code class="language-bash">1. Acceder a AppExchange
2. Buscar &quot;SURA Foundation Framework&quot;
3. Hacer clic en &quot;Get It Now&quot;
4. Seleccionar ambiente de destino
5. Confirmar instalación</code></pre></div></section><section><h4 id="-427355904#instalaci-n-manual-sandbox" data-toc="instalaci-n-manual-sandbox#Guía de Implementación.md-instalaci-n-manual-sandbox">Instalaci&oacute;n Manual (Sandbox)</h4><div class="detached code-block" id="-427355904#-13w85w_63"><pre><code class="language-bash"># URL de instalación directa
https://login.salesforce.com/packaging/installPackage.apexp?p0=04t...

# Para Sandbox
https://test.salesforce.com/packaging/installPackage.apexp?p0=04t...</code></pre></div></section><section><h4 id="-427355904#package-id-por-versi-n" data-toc="package-id-por-versi-n#Guía de Implementación.md-package-id-por-versi-n">Package ID por Versi&oacute;n</h4><div class="detached code-block" id="-427355904#-13w85w_64"><pre><code class="language-none">Versión 1.0-1: 04tXXXXXXXXXXXX1
Versión 1.0-3: 04tXXXXXXXXXXXX3
Versión 1.0-4: 04tXXXXXXXXXXXX4
Versión 1.0-5: 04tXXXXXXXXXXXX5
Versión 1.0-6: 04tXXXXXXXXXXXX6 (Actual)</code></pre></div></section></section><section><h3 id="-427355904#paso-2-configuraci-n-de-instalaci-n" data-toc="paso-2-configuraci-n-de-instalaci-n#Guía de Implementación.md-paso-2-configuraci-n-de-instalaci-n">Paso 2: Configuraci&oacute;n de Instalaci&oacute;n</h3><section><h4 id="-427355904#opciones-de-instalaci-n" data-toc="opciones-de-instalaci-n#Guía de Implementación.md-opciones-de-instalaci-n">Opciones de Instalaci&oacute;n</h4><div class="detached code-block" id="-427355904#-13w85w_66"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────────┐
│                 INSTALLATION OPTIONS                           │
│                                                                 │
│  [x] Install for All Users                                     │
│  [ ] Install for Admins Only                                   │
│  [ ] Install for Specific Profiles                             │
│                                                                 │
│  Security Settings:                                             │
│  [x] Grant access to all data                                  │
│  [x] Enable Apex class access                                  │
│  [x] Enable custom tabs                                        │
│                                                                 │
│  Advanced Options:                                              │
│  [x] Compile all Apex classes                                  │
│  [x] Enable push notifications                                 │
│  [x] Upgrade existing components                               │
└─────────────────────────────────────────────────────────────────┘</code></pre></div></section></section><section><h3 id="-427355904#paso-3-validaci-n-de-instalaci-n" data-toc="paso-3-validaci-n-de-instalaci-n#Guía de Implementación.md-paso-3-validaci-n-de-instalaci-n">Paso 3: Validaci&oacute;n de Instalaci&oacute;n</h3><section><h4 id="-427355904#script-de-validaci-n" data-toc="script-de-validaci-n#Guía de Implementación.md-script-de-validaci-n">Script de Validaci&oacute;n</h4><div class="detached code-block" id="-427355904#-13w85w_68"><pre><code class="language-none">// Ejecutar en Developer Console
System.debug('=== SURA Foundation Installation Validation ===');

// Verificar clases instaladas
Type coreClass = Type.forName('SFSura', 'Core');
System.debug('Core class installed: ' + (coreClass != null));

// Verificar objetos personalizados
Schema.DescribeSObjectResult eventLogDesc = 
    SFFoundation_EventLog__c.SObjectType.getDescribe();
System.debug('EventLog object installed: ' + eventLogDesc.isCreateable());

// Verificar Custom Metadata Types
List&lt;SFFoundation_ProcessConfiguration__mdt&gt; configs = 
    [SELECT Id FROM SFFoundation_ProcessConfiguration__mdt LIMIT 1];
System.debug('Process configurations available: ' + !configs.isEmpty());

System.debug('=== Installation validation complete ===');</code></pre></div></section></section></section><section><h2 id="-427355904#configuraci-n-inicial" data-toc="configuraci-n-inicial#Guía de Implementación.md-configuraci-n-inicial">⚙️ Configuraci&oacute;n Inicial</h2><section><h3 id="-427355904#paso-1-configuraci-n-de-metadatos" data-toc="paso-1-configuraci-n-de-metadatos#Guía de Implementación.md-paso-1-configuraci-n-de-metadatos">Paso 1: Configuraci&oacute;n de Metadatos</h3><section><h4 id="-427355904#instalar-configuraciones-b-sicas" data-toc="instalar-configuraciones-b-sicas#Guía de Implementación.md-instalar-configuraciones-b-sicas">Instalar Configuraciones B&aacute;sicas</h4><div class="detached code-block" id="-427355904#-13w85w_75"><pre><code class="language-none">// Ejecutar desde el Panel de Administración
// Navegación: Setup &gt; Apps &gt; App Manager &gt; SURA Foundation

1. Hacer clic en &quot;Instalar metadatos y configuraciones iniciales&quot;
2. Seleccionar productos a configurar:
   [x] Seguros de Motos
   [x] Seguros de Autos
   [ ] Seguros de Viajes (Beta)
   [ ] Arrendamiento (Beta)
3. Confirmar instalación</code></pre></div></section><section><h4 id="-427355904#configuraci-n-manual-de-procesos" data-toc="configuraci-n-manual-de-procesos#Guía de Implementación.md-configuraci-n-manual-de-procesos">Configuraci&oacute;n Manual de Procesos</h4><div class="detached code-block" id="-427355904#-13w85w_76"><pre><code class="language-sql">-- Custom Metadata Type: SFFoundation_ProcessConfiguration__mdt

INSERT SFFoundation_ProcessConfiguration__mdt (
    DeveloperName = 'Lead_Motos_Conocimiento',
    MasterLabel = 'Lead Motos - Conocimiento',
    ProductFamily__c = 'Seguros de Motos',
    Stage__c = 'Conocimiento',
    HandlerClass__c = 'MT_Kn_123',
    Order__c = 0,
    IsActive__c = true,
    ApiName__c = 'leadMotosKnowing'
);</code></pre></div></section></section><section><h3 id="-427355904#paso-2-feature-flags" data-toc="paso-2-feature-flags#Guía de Implementación.md-paso-2-feature-flags">Paso 2: Feature Flags</h3><section><h4 id="-427355904#configuraci-n-b-sica-de-features" data-toc="configuraci-n-b-sica-de-features#Guía de Implementación.md-configuraci-n-b-sica-de-features">Configuraci&oacute;n B&aacute;sica de Features</h4><div class="detached code-block" id="-427355904#-13w85w_78"><pre><code class="language-json">{
  &quot;featureFlags&quot;: [
    {
      &quot;developerName&quot;: &quot;EnableFoundationLogging&quot;,
      &quot;isEnabled&quot;: true,
      &quot;environment&quot;: &quot;All&quot;,
      &quot;scope&quot;: &quot;Global&quot;,
      &quot;description&quot;: &quot;Habilita logging del framework&quot;
    },
    {
      &quot;developerName&quot;: &quot;EnableAdvancedValidations&quot;,
      &quot;isEnabled&quot;: false,
      &quot;environment&quot;: &quot;Production&quot;,
      &quot;scope&quot;: &quot;Global&quot;,
      &quot;description&quot;: &quot;Validaciones avanzadas de negocio&quot;
    },
    {
      &quot;developerName&quot;: &quot;EnableRUNTIntegration&quot;,
      &quot;isEnabled&quot;: true,
      &quot;environment&quot;: &quot;All&quot;,
      &quot;scope&quot;: &quot;Product&quot;,
      &quot;productFamily&quot;: &quot;Seguros de Motos&quot;,
      &quot;description&quot;: &quot;Integración con RUNT para motos&quot;
    }
  ]
}</code></pre></div></section></section><section><h3 id="-427355904#paso-3-configuraci-n-de-integraciones" data-toc="paso-3-configuraci-n-de-integraciones#Guía de Implementación.md-paso-3-configuraci-n-de-integraciones">Paso 3: Configuraci&oacute;n de Integraciones</h3><section><h4 id="-427355904#runt-integration" data-toc="runt-integration#Guía de Implementación.md-runt-integration">RUNT Integration</h4><div class="detached code-block" id="-427355904#-13w85w_81"><pre><code class="language-none">// Custom Metadata: SFFoundation_IntegrationConfiguration__mdt

ServiceName__c: 'RUNT_VehicleConsultation'
BaseURL__c: 'https://api.runt.gov.co/v2'
AuthMethod__c: 'API_Key'
TimeoutMs__c: 30000
MaxRetries__c: 3
RetryPattern__c: 'Fibonacci'
RetryIntervalMs__c: 1000
RetryOnHttpCodes__c: '500,502,503,504'
IsActive__c: true</code></pre></div></section><section><h4 id="-427355904#fasecolda-integration" data-toc="fasecolda-integration#Guía de Implementación.md-fasecolda-integration">FASECOLDA Integration</h4><div class="detached code-block" id="-427355904#-13w85w_82"><pre><code class="language-none">ServiceName__c: 'FASECOLDA_VehicleData'
BaseURL__c: 'https://api.fasecolda.com/v1'
AuthMethod__c: 'Bearer_Token'
TimeoutMs__c: 20000
MaxRetries__c: 2
RetryPattern__c: 'Incremental'
RetryIntervalMs__c: 500
RetryOnHttpCodes__c: '429,500,502,503'
IsActive__c: true</code></pre></div></section></section></section><section><h2 id="-427355904#configuraci-n-por-ambiente" data-toc="configuraci-n-por-ambiente#Guía de Implementación.md-configuraci-n-por-ambiente">🔧 Configuraci&oacute;n por Ambiente</h2><section><h3 id="-427355904#desarrollo-sandbox" data-toc="desarrollo-sandbox#Guía de Implementación.md-desarrollo-sandbox">Desarrollo (Sandbox)</h3><section><h4 id="-427355904#configuraciones-espec-ficas" data-toc="configuraciones-espec-ficas#Guía de Implementación.md-configuraciones-espec-ficas">Configuraciones Espec&iacute;ficas</h4><div class="detached code-block" id="-427355904#-13w85w_89"><pre><code class="language-json">{
  &quot;environment&quot;: &quot;Development&quot;,
  &quot;settings&quot;: {
    &quot;logging&quot;: {
      &quot;level&quot;: &quot;DEBUG&quot;,
      &quot;retentionDays&quot;: 7
    },
    &quot;integrations&quot;: {
      &quot;timeout&quot;: 60000,
      &quot;enableMocks&quot;: true,
      &quot;bypassValidations&quot;: true
    },
    &quot;features&quot;: {
      &quot;enableAllFeatures&quot;: true,
      &quot;debugMode&quot;: true
    }
  }
}</code></pre></div></section><section><h4 id="-427355904#mock-services" data-toc="mock-services#Guía de Implementación.md-mock-services">Mock Services</h4><div class="detached code-block" id="-427355904#-13w85w_90"><pre><code class="language-none">// Habilitar servicios simulados para desarrollo
SFFoundation_GlobalSettings__c devSettings = new SFFoundation_GlobalSettings__c();
devSettings.Name = 'Development';
devSettings.IsEnabled__c = true;
devSettings.LogLevel__c = 'DEBUG';
devSettings.DefaultTimeout__c = 60000;
insert devSettings;</code></pre></div></section></section><section><h3 id="-427355904#testing-uat" data-toc="testing-uat#Guía de Implementación.md-testing-uat">Testing (UAT)</h3><section><h4 id="-427355904#configuraciones-de-prueba" data-toc="configuraciones-de-prueba#Guía de Implementación.md-configuraciones-de-prueba">Configuraciones de Prueba</h4><div class="detached code-block" id="-427355904#-13w85w_92"><pre><code class="language-json">{
  &quot;environment&quot;: &quot;Testing&quot;,
  &quot;settings&quot;: {
    &quot;logging&quot;: {
      &quot;level&quot;: &quot;INFO&quot;,
      &quot;retentionDays&quot;: 30
    },
    &quot;integrations&quot;: {
      &quot;timeout&quot;: 30000,
      &quot;enableMocks&quot;: false,
      &quot;useTestEndpoints&quot;: true
    },
    &quot;features&quot;: {
      &quot;gradualRollout&quot;: true,
      &quot;rolloutPercentage&quot;: 50
    }
  }
}</code></pre></div></section></section><section><h3 id="-427355904#producci-n" data-toc="producci-n#Guía de Implementación.md-producci-n">Producci&oacute;n</h3><section><h4 id="-427355904#configuraciones-de-producci-n" data-toc="configuraciones-de-producci-n#Guía de Implementación.md-configuraciones-de-producci-n">Configuraciones de Producci&oacute;n</h4><div class="detached code-block" id="-427355904#-13w85w_94"><pre><code class="language-json">{
  &quot;environment&quot;: &quot;Production&quot;,
  &quot;settings&quot;: {
    &quot;logging&quot;: {
      &quot;level&quot;: &quot;ERROR&quot;,
      &quot;retentionDays&quot;: 90
    },
    &quot;integrations&quot;: {
      &quot;timeout&quot;: 30000,
      &quot;enableMocks&quot;: false,
      &quot;useProductionEndpoints&quot;: true
    },
    &quot;features&quot;: {
      &quot;conservativeRollout&quot;: true,
      &quot;rolloutPercentage&quot;: 10
    }
  }
}</code></pre></div></section></section></section><section><h2 id="-427355904#despliegue-y-migraci-n" data-toc="despliegue-y-migraci-n#Guía de Implementación.md-despliegue-y-migraci-n">🚀 Despliegue y Migraci&oacute;n</h2><section><h3 id="-427355904#estrategia-de-despliegue" data-toc="estrategia-de-despliegue#Guía de Implementación.md-estrategia-de-despliegue">Estrategia de Despliegue</h3><section><h4 id="-427355904#blue-green-deployment" data-toc="blue-green-deployment#Guía de Implementación.md-blue-green-deployment">Blue-Green Deployment</h4><div class="detached code-block" id="-427355904#-13w85w_100"><pre><code class="language-none">┌─────────────────────────────────────────────────────────────────┐
│                    DEPLOYMENT STRATEGY                         │
│                                                                 │
│  ┌─────────────────┐           ┌─────────────────────────────┐  │
│  │      BLUE       │           │            GREEN            │  │
│  │   (Current)     │           │         (New Version)       │  │
│  │                 │           │                             │  │
│  │ • Version 1.0-5 │    ───▶   │ • Version 1.0-6            │  │
│  │ • 100% Traffic  │           │ • 0% Traffic                │  │
│  │ • Stable        │           │ • Testing                   │  │
│  └─────────────────┘           └─────────────────────────────┘  │
│                                                                 │
│  Phase 1: Deploy Green (0% traffic)                           │
│  Phase 2: Validate Green (smoke tests)                        │
│  Phase 3: Route 10% traffic to Green                          │
│  Phase 4: Monitor and increase to 50%                         │
│  Phase 5: Full cutover to Green (100%)                        │
│  Phase 6: Blue becomes standby                                │
└─────────────────────────────────────────────────────────────────┘</code></pre></div></section><section><h4 id="-427355904#rolling-deployment-por-productos" data-toc="rolling-deployment-por-productos#Guía de Implementación.md-rolling-deployment-por-productos">Rolling Deployment por Productos</h4><div class="detached code-block" id="-427355904#-13w85w_101"><pre><code class="language-none">Week 1: Seguros de Motos (Pilot)
  - Deploy to 10% of users
  - Monitor for 48 hours
  - Scale to 50% if successful

Week 2: Seguros de Autos
  - Same progressive rollout
  - Parallel monitoring

Week 3: Full Production
  - Complete rollout
  - Legacy system sunset</code></pre></div></section></section><section><h3 id="-427355904#checklist-de-pre-despliegue" data-toc="checklist-de-pre-despliegue#Guía de Implementación.md-checklist-de-pre-despliegue">Checklist de Pre-Despliegue</h3><section><h4 id="-427355904#validaciones-t-cnicas" data-toc="validaciones-t-cnicas#Guía de Implementación.md-validaciones-t-cnicas">Validaciones T&eacute;cnicas</h4><div class="detached code-block" id="-427355904#-13w85w_104"><pre><code class="language-none">□ Package installation successful
□ All Apex classes compiled
□ Custom objects accessible
□ Metadata types populated
□ Platform events configured
□ Integration endpoints tested
□ Feature flags configured
□ Permissions assigned
□ Test coverage &gt; 75%
□ Performance benchmarks met</code></pre></div></section><section><h4 id="-427355904#validaciones-de-negocio" data-toc="validaciones-de-negocio#Guía de Implementación.md-validaciones-de-negocio">Validaciones de Negocio</h4><div class="detached code-block" id="-427355904#-13w85w_105"><pre><code class="language-none">□ Process configurations validated
□ Business rules tested
□ Integration data validated
□ User acceptance tests passed
□ Training materials updated
□ Support team briefed
□ Rollback plan prepared
□ Communication plan executed</code></pre></div></section></section></section><section><h2 id="-427355904#configuraci-n-de-usuarios-y-permisos" data-toc="configuraci-n-de-usuarios-y-permisos#Guía de Implementación.md-configuraci-n-de-usuarios-y-permisos">👥 Configuraci&oacute;n de Usuarios y Permisos</h2><section><h3 id="-427355904#permission-sets" data-toc="permission-sets#Guía de Implementación.md-permission-sets">Permission Sets</h3><section><h4 id="-427355904#sffoundation-processexecutor" data-toc="sffoundation-processexecutor#Guía de Implementación.md-sffoundation-processexecutor">SFFoundation_ProcessExecutor</h4><div class="detached code-block" id="-427355904#-13w85w_112"><pre><code class="language-none">// Permisos para ejecutar procesos
Custom Permissions:
- SFFoundation_ProcessExecutor: true

Object Permissions:
- SFFoundation_ProcessExecution__c: Create, Read
- SFFoundation_EventLog__c: Create, Read
- Lead: Read, Edit
- Opportunity: Read, Edit
- Quote: Read, Edit

Apex Classes:
- SFSura.Core: Enabled
- SFSura.ProcessManager: Enabled
- SFSura.LeadHandler: Enabled</code></pre></div></section><section><h4 id="-427355904#sffoundation-configurationmanager" data-toc="sffoundation-configurationmanager#Guía de Implementación.md-sffoundation-configurationmanager">SFFoundation_ConfigurationManager</h4><div class="detached code-block" id="-427355904#-13w85w_113"><pre><code class="language-none">// Permisos para gestionar configuraciones
Custom Permissions:
- SFFoundation_ConfigurationManager: true

Object Permissions:
- SFFoundation_ProcessConfiguration__mdt: Read
- SFFoundation_FeatureFlag__mdt: Read, Edit
- SFFoundation_IntegrationConfiguration__mdt: Read

Apps:
- SURA Foundation Admin: Visible</code></pre></div></section><section><h4 id="-427355904#sffoundation-integrationuser" data-toc="sffoundation-integrationuser#Guía de Implementación.md-sffoundation-integrationuser">SFFoundation_IntegrationUser</h4><div class="detached code-block" id="-427355904#-13w85w_114"><pre><code class="language-none">// Permisos para integraciones
Custom Permissions:
- SFFoundation_IntegrationCaller: true

Object Permissions:
- SFFoundation_IntegrationLog__c: Create, Read
- SFFoundation_EventLog__c: Create, Read

Apex Classes:
- SFSura.ExternalServiceHandler: Enabled
- SFSura.IntegrationManager: Enabled</code></pre></div></section></section><section><h3 id="-427355904#asignaci-n-de-permisos" data-toc="asignaci-n-de-permisos#Guía de Implementación.md-asignaci-n-de-permisos">Asignaci&oacute;n de Permisos</h3><section><h4 id="-427355904#por-rol" data-toc="por-rol#Guía de Implementación.md-por-rol">Por Rol</h4><div class="detached code-block" id="-427355904#-13w85w_116"><pre><code class="language-none">// System Administrator
- SFFoundation_ProcessExecutor
- SFFoundation_ConfigurationManager
- SFFoundation_IntegrationUser

// Sales User
- SFFoundation_ProcessExecutor

// Integration User
- SFFoundation_IntegrationUser

// Support User
- SFFoundation_ProcessExecutor (Read-only)</code></pre></div></section></section></section><section><h2 id="-427355904#configuraci-n-de-integraciones" data-toc="configuraci-n-de-integraciones#Guía de Implementación.md-configuraci-n-de-integraciones">🔗 Configuraci&oacute;n de Integraciones</h2><section><h3 id="-427355904#named-credentials" data-toc="named-credentials#Guía de Implementación.md-named-credentials">Named Credentials</h3><section><h4 id="-427355904#runt-integration" data-toc="runt-integration#Guía de Implementación.md-runt-integration">RUNT Integration</h4><div class="detached code-block" id="-427355904#-13w85w_122"><pre><code class="language-none">Name: RUNT_API_Credential
URL: https://api.runt.gov.co/v2
Identity Type: Named Principal
Authentication Protocol: Password Authentication
Username: ${system_username}
Password: ${system_password}

Custom Headers:
- X-API-Key: ${api_key}
- Content-Type: application/json</code></pre></div></section><section><h4 id="-427355904#fasecolda-integration" data-toc="fasecolda-integration#Guía de Implementación.md-fasecolda-integration">FASECOLDA Integration</h4><div class="detached code-block" id="-427355904#-13w85w_123"><pre><code class="language-none">Name: FASECOLDA_API_Credential
URL: https://api.fasecolda.com/v1
Identity Type: Named Principal
Authentication Protocol: OAuth 2.0
Client ID: ${client_id}
Client Secret: ${client_secret}
Scope: vehicle_data

Custom Headers:
- Accept: application/json
- X-Client-Version: 1.0</code></pre></div></section></section><section><h3 id="-427355904#remote-site-settings" data-toc="remote-site-settings#Guía de Implementación.md-remote-site-settings">Remote Site Settings</h3><div class="detached code-block" id="-427355904#-13w85w_124"><pre><code class="language-none">// RUNT
Name: RUNT_API
Remote Site URL: https://api.runt.gov.co
Active: true
Description: RUNT vehicle consultation service

// FASECOLDA
Name: FASECOLDA_API
Remote Site URL: https://api.fasecolda.com
Active: true
Description: FASECOLDA vehicle data service

// Payment Gateway
Name: Payment_Gateway
Remote Site URL: https://payments.sura.com
Active: true
Description: SURA payment processing gateway</code></pre></div></section></section><section><h2 id="-427355904#monitoreo-y-mantenimiento" data-toc="monitoreo-y-mantenimiento#Guía de Implementación.md-monitoreo-y-mantenimiento">📊 Monitoreo y Mantenimiento</h2><section><h3 id="-427355904#dashboard-de-monitoreo" data-toc="dashboard-de-monitoreo#Guía de Implementación.md-dashboard-de-monitoreo">Dashboard de Monitoreo</h3><section><h4 id="-427355904#configuraci-n-de-dashboard" data-toc="configuraci-n-de-dashboard#Guía de Implementación.md-configuraci-n-de-dashboard">Configuraci&oacute;n de Dashboard</h4><div class="detached code-block" id="-427355904#-13w85w_131"><pre><code class="language-none">Dashboard Name: SURA Foundation Monitoring

Components:
1. Process Execution Summary (Last 24h)
   - Total executions
   - Success rate
   - Average duration
   - Error distribution

2. Integration Health
   - Service availability
   - Response times
   - Error rates
   - Retry statistics

3. System Performance
   - CPU usage
   - Memory usage
   - API limits
   - Storage usage

4. Business Metrics
   - Leads processed
   - Quotes generated
   - Policies issued
   - Revenue impact</code></pre></div></section><section><h4 id="-427355904#reports-de-monitoreo" data-toc="reports-de-monitoreo#Guía de Implementación.md-reports-de-monitoreo">Reports de Monitoreo</h4><div class="detached code-block" id="-427355904#-13w85w_132"><pre><code class="language-sql">-- Process Performance Report
SELECT 
  ProcessName__c,
  COUNT(Id) as TotalExecutions,
  AVG(Duration__c) as AvgDuration,
  COUNT(CASE WHEN Status__c = 'Failed' THEN 1 END) as FailedExecutions
FROM SFFoundation_ProcessExecution__c
WHERE CreatedDate = LAST_N_DAYS:7
GROUP BY ProcessName__c
ORDER BY TotalExecutions DESC

-- Integration Health Report
SELECT 
  ServiceName__c,
  AVG(Duration__c) as AvgResponseTime,
  COUNT(CASE WHEN IsSuccess__c = true THEN 1 END) as SuccessCount,
  COUNT(CASE WHEN IsSuccess__c = false THEN 1 END) as ErrorCount
FROM SFFoundation_IntegrationLog__c
WHERE CreatedDate = TODAY
GROUP BY ServiceName__c</code></pre></div></section></section><section><h3 id="-427355904#alertas-autom-ticas" data-toc="alertas-autom-ticas#Guía de Implementación.md-alertas-autom-ticas">Alertas Autom&aacute;ticas</h3><section><h4 id="-427355904#email-alerts" data-toc="email-alerts#Guía de Implementación.md-email-alerts">Email Alerts</h4><div class="detached code-block" id="-427355904#-13w85w_134"><pre><code class="language-none">// Configurar en Workflow Rules o Process Builder

Alert: High Error Rate
Condition: Error rate &gt; 5% in last hour
Recipients: sysadmin@sura.com, devops@sura.com

Alert: Integration Failure
Condition: Service unavailable &gt; 5 minutes
Recipients: integration-team@sura.com

Alert: Performance Degradation
Condition: Avg response time &gt; 5 seconds
Recipients: performance-team@sura.com</code></pre></div></section></section><section><h3 id="-427355904#mantenimiento-regular" data-toc="mantenimiento-regular#Guía de Implementación.md-mantenimiento-regular">Mantenimiento Regular</h3><section><h4 id="-427355904#tareas-semanales" data-toc="tareas-semanales#Guía de Implementación.md-tareas-semanales">Tareas Semanales</h4><div class="detached code-block" id="-427355904#-13w85w_137"><pre><code class="language-none">□ Review error logs
□ Check integration health
□ Monitor performance metrics
□ Update feature flag configurations
□ Review capacity utilization
□ Backup configuration metadata</code></pre></div></section><section><h4 id="-427355904#tareas-mensuales" data-toc="tareas-mensuales#Guía de Implementación.md-tareas-mensuales">Tareas Mensuales</h4><div class="detached code-block" id="-427355904#-13w85w_138"><pre><code class="language-none">□ Archive old event logs
□ Review and optimize queries
□ Update integration credentials
□ Performance testing
□ Security review
□ Documentation updates</code></pre></div></section></section></section><section><h2 id="-427355904#configuraci-n-avanzada" data-toc="configuraci-n-avanzada#Guía de Implementación.md-configuraci-n-avanzada">🔧 Configuraci&oacute;n Avanzada</h2><section><h3 id="-427355904#custom-settings-avanzadas" data-toc="custom-settings-avanzadas#Guía de Implementación.md-custom-settings-avanzadas">Custom Settings Avanzadas</h3><section><h4 id="-427355904#performance-tuning" data-toc="performance-tuning#Guía de Implementación.md-performance-tuning">Performance Tuning</h4><div class="detached code-block" id="-427355904#-13w85w_144"><pre><code class="language-none">SFFoundation_GlobalSettings__c perfSettings = new SFFoundation_GlobalSettings__c();
perfSettings.Name = 'PerformanceSettings';
perfSettings.DefaultTimeout__c = 30000;
perfSettings.MaxRetries__c = 3;
perfSettings.CleanupBatchSize__c = 200;
perfSettings.LogLevel__c = 'INFO';

insert perfSettings;</code></pre></div></section><section><h4 id="-427355904#configuraci-n-de-cache" data-toc="configuraci-n-de-cache#Guía de Implementación.md-configuraci-n-de-cache">Configuraci&oacute;n de Cache</h4><div class="detached code-block" id="-427355904#-13w85w_145"><pre><code class="language-json">{
  &quot;cacheSettings&quot;: {
    &quot;processConfigurations&quot;: {
      &quot;ttl&quot;: 3600,
      &quot;maxSize&quot;: 1000,
      &quot;enabled&quot;: true
    },
    &quot;featureFlags&quot;: {
      &quot;ttl&quot;: 1800,
      &quot;maxSize&quot;: 500,
      &quot;enabled&quot;: true
    },
    &quot;integrationConfigs&quot;: {
      &quot;ttl&quot;: 7200,
      &quot;maxSize&quot;: 100,
      &quot;enabled&quot;: true
    }
  }
}</code></pre></div></section></section><section><h3 id="-427355904#configuraci-n-de-batch-jobs" data-toc="configuraci-n-de-batch-jobs#Guía de Implementación.md-configuraci-n-de-batch-jobs">Configuraci&oacute;n de Batch Jobs</h3><section><h4 id="-427355904#event-log-cleanup" data-toc="event-log-cleanup#Guía de Implementación.md-event-log-cleanup">Event Log Cleanup</h4><div class="detached code-block" id="-427355904#-13w85w_148"><pre><code class="language-none">// Schedule cleanup job
SFFoundation_EventLogCleanupBatch cleanup = new SFFoundation_EventLogCleanupBatch();
String cronExpression = '0 0 2 * * ?'; // Daily at 2 AM
System.schedule('Foundation Event Log Cleanup', cronExpression, cleanup);</code></pre></div></section><section><h4 id="-427355904#integration-health-check" data-toc="integration-health-check#Guía de Implementación.md-integration-health-check">Integration Health Check</h4><div class="detached code-block" id="-427355904#-13w85w_149"><pre><code class="language-none">// Schedule health check job
SFFoundation_HealthCheckBatch healthCheck = new SFFoundation_HealthCheckBatch();
String cronExpression = '0 */15 * * * ?'; // Every 15 minutes
System.schedule('Foundation Health Check', cronExpression, healthCheck);</code></pre></div></section></section></section><section><h2 id="-427355904#troubleshooting" data-toc="troubleshooting#Guía de Implementación.md-troubleshooting">🐛 Troubleshooting</h2><section><h3 id="-427355904#problemas-comunes" data-toc="problemas-comunes#Guía de Implementación.md-problemas-comunes">Problemas Comunes</h3><section><h4 id="-427355904#1-package-installation-failures" data-toc="1-package-installation-failures#Guía de Implementación.md-1-package-installation-failures">1. Package Installation Failures</h4><div class="detached code-block" id="-427355904#-13w85w_157"><pre><code class="language-none">Error: &quot;Package installation failed due to missing dependencies&quot;

Solución:
1. Verificar que Vlocity/OmniStudio esté instalado
2. Confirmar versión de API compatible
3. Revisar permisos de usuario instalador
4. Verificar límites de storage</code></pre></div></section><section><h4 id="-427355904#2-process-execution-errors" data-toc="2-process-execution-errors#Guía de Implementación.md-2-process-execution-errors">2. Process Execution Errors</h4><div class="detached code-block" id="-427355904#-13w85w_158"><pre><code class="language-none">Error: &quot;Handler class not found: MT_Kn_123&quot;

Solución:
1. Verificar configuración en ProcessConfiguration__mdt
2. Confirmar que la clase existe y es accesible
3. Revisar permisos de Apex class access
4. Validar naming convention</code></pre></div></section><section><h4 id="-427355904#3-integration-timeouts" data-toc="3-integration-timeouts#Guía de Implementación.md-3-integration-timeouts">3. Integration Timeouts</h4><div class="detached code-block" id="-427355904#-13w85w_159"><pre><code class="language-none">Error: &quot;Integration timeout after 30000ms&quot;

Solución:
1. Aumentar timeout en IntegrationConfiguration__mdt
2. Verificar conectividad de red
3. Revisar Named Credentials
4. Contactar proveedor del servicio</code></pre></div></section><section><h4 id="-427355904#4-performance-issues" data-toc="4-performance-issues#Guía de Implementación.md-4-performance-issues">4. Performance Issues</h4><div class="detached code-block" id="-427355904#-13w85w_160"><pre><code class="language-none">Error: &quot;Process execution taking too long&quot;

Solución:
1. Revisar governor limits usage
2. Optimizar queries SOQL
3. Implementar async processing
4. Revisar bulk operations</code></pre></div></section></section><section><h3 id="-427355904#logs-de-debug" data-toc="logs-de-debug#Guía de Implementación.md-logs-de-debug">Logs de Debug</h3><section><h4 id="-427355904#habilitar-debug-logging" data-toc="habilitar-debug-logging#Guía de Implementación.md-habilitar-debug-logging">Habilitar Debug Logging</h4><div class="detached code-block" id="-427355904#-13w85w_163"><pre><code class="language-none">// Configurar trace flags para debugging
1. Setup &gt; Debug Logs
2. New Trace Flag
3. Traced Entity Type: User
4. Start Date: Today
5. Expiration Date: Tomorrow
6. Debug Level: Foundation_Debug

// Custom Debug Level
Apex Code: DEBUG
Apex Profiling: INFO
Callout: DEBUG
Database: DEBUG
System: DEBUG
Validation: INFO
Visualforce: INFO
Workflow: INFO</code></pre></div></section><section><h4 id="-427355904#analizar-logs" data-toc="analizar-logs#Guía de Implementación.md-analizar-logs">Analizar Logs</h4><div class="detached code-block" id="-427355904#-13w85w_164"><pre><code class="language-none">// Buscar patrones en logs
System.debug('=== Foundation Process Start ===');
System.debug('Process: ' + processName);
System.debug('Duration: ' + duration + 'ms');
System.debug('=== Foundation Process End ===');

// Filtrar en Developer Console:
// USER_DEBUG|Foundation</code></pre></div></section></section></section><section><h2 id="-427355904#checklist-de-go-live" data-toc="checklist-de-go-live#Guía de Implementación.md-checklist-de-go-live">📋 Checklist de Go-Live</h2><section><h3 id="-427355904#pre-go-live-1-semana-antes" data-toc="pre-go-live-1-semana-antes#Guía de Implementación.md-pre-go-live-1-semana-antes">Pre-Go-Live (1 semana antes)</h3><section><h4 id="-427355904#validaciones-t-cnicas" data-toc="validaciones-t-cnicas#Guía de Implementación.md-validaciones-t-cnicas">Validaciones T&eacute;cnicas</h4><div class="detached code-block" id="-427355904#-13w85w_171"><pre><code class="language-none">□ All environments synchronized
□ Production data validated
□ Performance benchmarks met
□ Security scan completed
□ Backup procedures tested
□ Rollback plan validated
□ Monitoring alerts configured
□ Load testing completed</code></pre></div></section><section><h4 id="-427355904#validaciones-de-negocio" data-toc="validaciones-de-negocio#Guía de Implementación.md-validaciones-de-negocio">Validaciones de Negocio</h4><div class="detached code-block" id="-427355904#-13w85w_172"><pre><code class="language-none">□ User acceptance testing passed
□ Business process validation
□ Data migration completed
□ Training sessions conducted
□ Support documentation ready
□ Communication plan executed
□ Change management approved
□ Go/No-Go decision made</code></pre></div></section></section><section><h3 id="-427355904#go-live-day" data-toc="go-live-day#Guía de Implementación.md-go-live-day">Go-Live Day</h3><section><h4 id="-427355904#deployment-sequence" data-toc="deployment-sequence#Guía de Implementación.md-deployment-sequence">Deployment Sequence</h4><div class="detached code-block" id="-427355904#-13w85w_175"><pre><code class="language-none">Hour 0: Deploy to production
Hour 1: Smoke tests
Hour 2: Enable for pilot users (10%)
Hour 4: Monitor and validate
Hour 6: Scale to 50% if successful
Hour 12: Full deployment if stable
Hour 24: Post-deployment review</code></pre></div></section><section><h4 id="-427355904#monitoring-checklist" data-toc="monitoring-checklist#Guía de Implementación.md-monitoring-checklist">Monitoring Checklist</h4><div class="detached code-block" id="-427355904#-13w85w_176"><pre><code class="language-none">□ System health dashboard green
□ All integrations responding
□ Error rates within acceptable limits
□ Performance metrics normal
□ User feedback positive
□ No critical issues reported
□ Support team ready
□ Escalation procedures active</code></pre></div></section></section><section><h3 id="-427355904#post-go-live-1-semana-despu-s" data-toc="post-go-live-1-semana-despu-s#Guía de Implementación.md-post-go-live-1-semana-despu-s">Post-Go-Live (1 semana despu&eacute;s)</h3><section><h4 id="-427355904#validation-activities" data-toc="validation-activities#Guía de Implementación.md-validation-activities">Validation Activities</h4><div class="detached code-block" id="-427355904#-13w85w_178"><pre><code class="language-none">□ Review all metrics and KPIs
□ Collect user feedback
□ Document lessons learned
□ Optimize based on real usage
□ Plan next iteration
□ Update documentation
□ Schedule regular reviews
□ Celebrate success! 🎉</code></pre></div></section></section></section><section><h2 id="-427355904#recursos-adicionales" data-toc="recursos-adicionales#Guía de Implementación.md-recursos-adicionales">📚 Recursos Adicionales</h2><section><h3 id="-427355904#documentaci-n-t-cnica" data-toc="documentaci-n-t-cnica#Guía de Implementación.md-documentaci-n-t-cnica">Documentaci&oacute;n T&eacute;cnica</h3><ul class="list" id="-427355904#-13w85w_183" start="1"><li class="list-item" id="-427355904#-13w85w_184"><p><span class="control" id="-427355904#-13w85w_189">Arquitectura General</span>: Diagramas y patrones implementados</p></li><li class="list-item" id="-427355904#-13w85w_185"><p><span class="control" id="-427355904#-13w85w_190">Modelo de Datos</span>: Objetos, relaciones y estructura</p></li><li class="list-item" id="-427355904#-13w85w_186"><p><span class="control" id="-427355904#-13w85w_191">APIs y Endpoints</span>: Documentaci&oacute;n completa de servicios</p></li><li class="list-item" id="-427355904#-13w85w_187"><p><span class="control" id="-427355904#-13w85w_192">Cat&aacute;logo de Clases</span>: Todas las clases documentadas</p></li><li class="list-item" id="-427355904#-13w85w_188"><p><span class="control" id="-427355904#-13w85w_193">Alcance y Limitaciones</span>: Cobertura del framework</p></li></ul></section><section><h3 id="-427355904#herramientas-de-desarrollo" data-toc="herramientas-de-desarrollo#Guía de Implementación.md-herramientas-de-desarrollo">Herramientas de Desarrollo</h3><div class="detached code-block" id="-427355904#-13w85w_194"><pre><code class="language-none">- Salesforce CLI (sfdx)
- VS Code con Salesforce Extensions
- Postman Collection para APIs
- Workbench para administración
- Data Loader para migraciones</code></pre></div></section><section><h3 id="-427355904#contactos-de-soporte" data-toc="contactos-de-soporte#Guía de Implementación.md-contactos-de-soporte">Contactos de Soporte</h3><div class="detached code-block" id="-427355904#-13w85w_195"><pre><code class="language-none">Arquitectura: Soulberto Lorenzo &lt;soulberto@cloudblue.us&gt;
Desarrollo: Jean Carlos Melendez &lt;jean@cloudblue.us&gt;
Soporte: foundation-support@sura.com
Documentación: docs@sura-foundation.com</code></pre></div><p id="-427355904#-13w85w_197"><span class="control" id="-427355904#-13w85w_198">Fecha de Actualizaci&oacute;n:</span> Mayo 2025<span class="control" id="-427355904#-13w85w_200">Versi&oacute;n de Implementaci&oacute;n:</span> 1.0<span class="control" id="-427355904#-13w85w_202">Mantenido por:</span> Equipo de Implementaci&oacute;n SURA Foundation<span class="control" id="-427355904#-13w85w_204">Estado:</span> Documento Vivo - Actualizaci&oacute;n Continua</p></section></section></article></div></section></div></body></html>